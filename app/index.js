!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==n(e)&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=13)}([function(e,t,n){"use strict";e.exports=n(8)},function(e,t,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,s,l=a(e),u=1;u<arguments.length;u++){for(var c in n=Object(arguments[u]))i.call(n,c)&&(l[c]=n[c]);if(r){s=r(n);for(var h=0;h<s.length;h++)o.call(n,s[h])&&(l[s[h]]=n[s[h]])}}return l}},function(e,t,n){"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(9)},function(e,t,r){"use strict";(function(e){var r=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()},i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};function o(e,t){return e(t={exports:{}},t.exports),t.exports}var a,s=o((function(e,t){(function(){var r="Expected a function",o="__lodash_placeholder__",a=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],s="[object Arguments]",l="[object Array]",u="[object Boolean]",c="[object Date]",h="[object Error]",d="[object Function]",f="[object GeneratorFunction]",p="[object Map]",m="[object Number]",v="[object Object]",g="[object RegExp]",y="[object Set]",_="[object String]",x="[object Symbol]",b="[object WeakMap]",w="[object ArrayBuffer]",S="[object DataView]",E="[object Float32Array]",T="[object Float64Array]",M="[object Int8Array]",C="[object Int16Array]",A="[object Int32Array]",R="[object Uint8Array]",P="[object Uint16Array]",k="[object Uint32Array]",L=/\b__p \+= '';/g,N=/\b(__p \+=) '' \+/g,I=/(__e\(.*?\)|\b__t\)) \+\n'';/g,O=/&(?:amp|lt|gt|quot|#39);/g,D=/[&<>"']/g,z=RegExp(O.source),F=RegExp(D.source),B=/<%-([\s\S]+?)%>/g,U=/<%([\s\S]+?)%>/g,V=/<%=([\s\S]+?)%>/g,G=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,j=/^\w*$/,H=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,W=/[\\^$.*+?()[\]{}|]/g,q=RegExp(W.source),Y=/^\s+|\s+$/g,X=/^\s+/,Z=/\s+$/,$=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,K=/\{\n\/\* \[wrapped with (.+)\] \*/,J=/,? & /,Q=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ee=/\\(\\)?/g,te=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ne=/\w*$/,re=/^[-+]0x[0-9a-f]+$/i,ie=/^0b[01]+$/i,oe=/^\[object .+?Constructor\]$/,ae=/^0o[0-7]+$/i,se=/^(?:0|[1-9]\d*)$/,le=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ue=/($^)/,ce=/['\n\r\u2028\u2029\\]/g,he="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",de="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",fe="["+de+"]",pe="["+he+"]",me="\\d+",ve="[a-z\\xdf-\\xf6\\xf8-\\xff]",ge="[^\\ud800-\\udfff"+de+me+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",ye="\\ud83c[\\udffb-\\udfff]",_e="[^\\ud800-\\udfff]",xe="(?:\\ud83c[\\udde6-\\uddff]){2}",be="[\\ud800-\\udbff][\\udc00-\\udfff]",we="[A-Z\\xc0-\\xd6\\xd8-\\xde]",Se="(?:"+ve+"|"+ge+")",Ee="(?:"+we+"|"+ge+")",Te="(?:"+pe+"|"+ye+")?",Me="[\\ufe0e\\ufe0f]?"+Te+"(?:\\u200d(?:"+[_e,xe,be].join("|")+")[\\ufe0e\\ufe0f]?"+Te+")*",Ce="(?:"+["[\\u2700-\\u27bf]",xe,be].join("|")+")"+Me,Ae="(?:"+[_e+pe+"?",pe,xe,be,"[\\ud800-\\udfff]"].join("|")+")",Re=RegExp("['’]","g"),Pe=RegExp(pe,"g"),ke=RegExp(ye+"(?="+ye+")|"+Ae+Me,"g"),Le=RegExp([we+"?"+ve+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[fe,we,"$"].join("|")+")",Ee+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[fe,we+Se,"$"].join("|")+")",we+"?"+Se+"+(?:['’](?:d|ll|m|re|s|t|ve))?",we+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",me,Ce].join("|"),"g"),Ne=RegExp("[\\u200d\\ud800-\\udfff"+he+"\\ufe0e\\ufe0f]"),Ie=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Oe=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],De=-1,ze={};ze[E]=ze[T]=ze[M]=ze[C]=ze[A]=ze[R]=ze["[object Uint8ClampedArray]"]=ze[P]=ze[k]=!0,ze[s]=ze[l]=ze[w]=ze[u]=ze[S]=ze[c]=ze[h]=ze[d]=ze[p]=ze[m]=ze[v]=ze[g]=ze[y]=ze[_]=ze[b]=!1;var Fe={};Fe[s]=Fe[l]=Fe[w]=Fe[S]=Fe[u]=Fe[c]=Fe[E]=Fe[T]=Fe[M]=Fe[C]=Fe[A]=Fe[p]=Fe[m]=Fe[v]=Fe[g]=Fe[y]=Fe[_]=Fe[x]=Fe[R]=Fe["[object Uint8ClampedArray]"]=Fe[P]=Fe[k]=!0,Fe[h]=Fe[d]=Fe[b]=!1;var Be={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ue=parseFloat,Ve=parseInt,Ge="object"==n(i)&&i&&i.Object===Object&&i,je="object"==("undefined"==typeof self?"undefined":n(self))&&self&&self.Object===Object&&self,He=Ge||je||Function("return this")(),We=t&&!t.nodeType&&t,qe=We&&e&&!e.nodeType&&e,Ye=qe&&qe.exports===We,Xe=Ye&&Ge.process,Ze=function(){try{return qe&&qe.require&&qe.require("util").types||Xe&&Xe.binding&&Xe.binding("util")}catch(e){}}(),$e=Ze&&Ze.isArrayBuffer,Ke=Ze&&Ze.isDate,Je=Ze&&Ze.isMap,Qe=Ze&&Ze.isRegExp,et=Ze&&Ze.isSet,tt=Ze&&Ze.isTypedArray;function nt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function rt(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(r,a,n(a),e)}return r}function it(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function ot(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function at(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function st(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}function lt(e,t){return!(null==e||!e.length)&&yt(e,t,0)>-1}function ut(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function ct(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function ht(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function dt(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function ft(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function pt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var mt=wt("length");function vt(e,t,n){var r;return n(e,(function(e,n,i){if(t(e,n,i))return r=n,!1})),r}function gt(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function yt(e,t,n){return t==t?function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):gt(e,xt,n)}function _t(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1}function xt(e){return e!=e}function bt(e,t){var n=null==e?0:e.length;return n?Tt(e,t)/n:NaN}function wt(e){return function(t){return null==t?void 0:t[e]}}function St(e){return function(t){return null==e?void 0:e[t]}}function Et(e,t,n,r,i){return i(e,(function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)})),n}function Tt(e,t){for(var n,r=-1,i=e.length;++r<i;){var o=t(e[r]);void 0!==o&&(n=void 0===n?o:n+o)}return n}function Mt(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function Ct(e){return function(t){return e(t)}}function At(e,t){return ct(t,(function(t){return e[t]}))}function Rt(e,t){return e.has(t)}function Pt(e,t){for(var n=-1,r=e.length;++n<r&&yt(t,e[n],0)>-1;);return n}function kt(e,t){for(var n=e.length;n--&&yt(t,e[n],0)>-1;);return n}function Lt(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}var Nt=St({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),It=St({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Ot(e){return"\\"+Be[e]}function Dt(e){return Ne.test(e)}function zt(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function Ft(e,t){return function(n){return e(t(n))}}function Bt(e,t){for(var n=-1,r=e.length,i=0,a=[];++n<r;){var s=e[n];s!==t&&s!==o||(e[n]=o,a[i++]=n)}return a}function Ut(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function Vt(e){return Dt(e)?function(e){for(var t=ke.lastIndex=0;ke.test(e);)++t;return t}(e):mt(e)}function Gt(e){return Dt(e)?function(e){return e.match(ke)||[]}(e):function(e){return e.split("")}(e)}var jt=St({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),Ht=function e(t){var i,he=(t=null==t?He:Ht.defaults(He.Object(),t,Ht.pick(He,Oe))).Array,de=t.Date,fe=t.Error,pe=t.Function,me=t.Math,ve=t.Object,ge=t.RegExp,ye=t.String,_e=t.TypeError,xe=he.prototype,be=pe.prototype,we=ve.prototype,Se=t["__core-js_shared__"],Ee=be.toString,Te=we.hasOwnProperty,Me=0,Ce=(i=/[^.]+$/.exec(Se&&Se.keys&&Se.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",Ae=we.toString,ke=Ee.call(ve),Ne=He._,Be=ge("^"+Ee.call(Te).replace(W,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ge=Ye?t.Buffer:void 0,je=t.Symbol,We=t.Uint8Array,qe=Ge?Ge.allocUnsafe:void 0,Xe=Ft(ve.getPrototypeOf,ve),Ze=ve.create,mt=we.propertyIsEnumerable,St=xe.splice,Wt=je?je.isConcatSpreadable:void 0,qt=je?je.iterator:void 0,Yt=je?je.toStringTag:void 0,Xt=function(){try{var e=Ji(ve,"defineProperty");return e({},"",{}),e}catch(e){}}(),Zt=t.clearTimeout!==He.clearTimeout&&t.clearTimeout,$t=de&&de.now!==He.Date.now&&de.now,Kt=t.setTimeout!==He.setTimeout&&t.setTimeout,Jt=me.ceil,Qt=me.floor,en=ve.getOwnPropertySymbols,tn=Ge?Ge.isBuffer:void 0,nn=t.isFinite,rn=xe.join,on=Ft(ve.keys,ve),an=me.max,sn=me.min,ln=de.now,un=t.parseInt,cn=me.random,hn=xe.reverse,dn=Ji(t,"DataView"),fn=Ji(t,"Map"),pn=Ji(t,"Promise"),mn=Ji(t,"Set"),vn=Ji(t,"WeakMap"),gn=Ji(ve,"create"),yn=vn&&new vn,_n={},xn=Mo(dn),bn=Mo(fn),wn=Mo(pn),Sn=Mo(mn),En=Mo(vn),Tn=je?je.prototype:void 0,Mn=Tn?Tn.valueOf:void 0,Cn=Tn?Tn.toString:void 0;function An(e){if(ja(e)&&!La(e)&&!(e instanceof Ln)){if(e instanceof kn)return e;if(Te.call(e,"__wrapped__"))return Co(e)}return new kn(e)}var Rn=function(){function e(){}return function(t){if(!Ga(t))return{};if(Ze)return Ze(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function Pn(){}function kn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}function Ln(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Nn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function In(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function On(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Dn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new On;++t<n;)this.add(e[t])}function zn(e){var t=this.__data__=new In(e);this.size=t.size}function Fn(e,t){var n=La(e),r=!n&&ka(e),i=!n&&!r&&Da(e),o=!n&&!r&&!i&&Ka(e),a=n||r||i||o,s=a?Mt(e.length,ye):[],l=s.length;for(var u in e)!t&&!Te.call(e,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||oo(u,l))||s.push(u);return s}function Bn(e){var t=e.length;return t?e[Or(0,t-1)]:void 0}function Un(e,t){return So(vi(e),Zn(t,0,e.length))}function Vn(e){return So(vi(e))}function Gn(e,t,n){(void 0===n||Aa(e[t],n))&&(void 0!==n||t in e)||Yn(e,t,n)}function jn(e,t,n){var r=e[t];Te.call(e,t)&&Aa(r,n)&&(void 0!==n||t in e)||Yn(e,t,n)}function Hn(e,t){for(var n=e.length;n--;)if(Aa(e[n][0],t))return n;return-1}function Wn(e,t,n,r){return er(e,(function(e,i,o){t(r,e,n(e),o)})),r}function qn(e,t){return e&&gi(t,_s(t),e)}function Yn(e,t,n){"__proto__"==t&&Xt?Xt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Xn(e,t){for(var n=-1,r=t.length,i=he(r),o=null==e;++n<r;)i[n]=o?void 0:ps(e,t[n]);return i}function Zn(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e}function $n(e,t,n,r,i,o){var a,l=1&t,h=2&t,b=4&t;if(n&&(a=i?n(e,r,i,o):n(e)),void 0!==a)return a;if(!Ga(e))return e;var L=La(e);if(L){if(a=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Te.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!l)return vi(e,a)}else{var N=to(e),I=N==d||N==f;if(Da(e))return ci(e,l);if(N==v||N==s||I&&!i){if(a=h||I?{}:ro(e),!l)return h?function(e,t){return gi(e,eo(e),t)}(e,function(e,t){return e&&gi(t,xs(t),e)}(a,e)):function(e,t){return gi(e,Qi(e),t)}(e,qn(a,e))}else{if(!Fe[N])return i?e:{};a=function(e,t,n){var r,i=e.constructor;switch(t){case w:return hi(e);case u:case c:return new i(+e);case S:return function(e,t){var n=t?hi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case E:case T:case M:case C:case A:case R:case"[object Uint8ClampedArray]":case P:case k:return di(e,n);case p:return new i;case m:case _:return new i(e);case g:return function(e){var t=new e.constructor(e.source,ne.exec(e));return t.lastIndex=e.lastIndex,t}(e);case y:return new i;case x:return r=e,Mn?ve(Mn.call(r)):{}}}(e,N,l)}}o||(o=new zn);var O=o.get(e);if(O)return O;o.set(e,a),Xa(e)?e.forEach((function(r){a.add($n(r,t,n,r,e,o))})):Ha(e)&&e.forEach((function(r,i){a.set(i,$n(r,t,n,i,e,o))}));var D=L?void 0:(b?h?Wi:Hi:h?xs:_s)(e);return it(D||e,(function(r,i){D&&(r=e[i=r]),jn(a,i,$n(r,t,n,i,e,o))})),a}function Kn(e,t,n){var r=n.length;if(null==e)return!r;for(e=ve(e);r--;){var i=n[r],o=t[i],a=e[i];if(void 0===a&&!(i in e)||!o(a))return!1}return!0}function Jn(e,t,n){if("function"!=typeof e)throw new _e(r);return _o((function(){e.apply(void 0,n)}),t)}function Qn(e,t,n,r){var i=-1,o=lt,a=!0,s=e.length,l=[],u=t.length;if(!s)return l;n&&(t=ct(t,Ct(n))),r?(o=ut,a=!1):t.length>=200&&(o=Rt,a=!1,t=new Dn(t));e:for(;++i<s;){var c=e[i],h=null==n?c:n(c);if(c=r||0!==c?c:0,a&&h==h){for(var d=u;d--;)if(t[d]===h)continue e;l.push(c)}else o(t,h,r)||l.push(c)}return l}An.templateSettings={escape:B,evaluate:U,interpolate:V,variable:"",imports:{_:An}},An.prototype=Pn.prototype,An.prototype.constructor=An,kn.prototype=Rn(Pn.prototype),kn.prototype.constructor=kn,Ln.prototype=Rn(Pn.prototype),Ln.prototype.constructor=Ln,Nn.prototype.clear=function(){this.__data__=gn?gn(null):{},this.size=0},Nn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Nn.prototype.get=function(e){var t=this.__data__;if(gn){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Te.call(t,e)?t[e]:void 0},Nn.prototype.has=function(e){var t=this.__data__;return gn?void 0!==t[e]:Te.call(t,e)},Nn.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=gn&&void 0===t?"__lodash_hash_undefined__":t,this},In.prototype.clear=function(){this.__data__=[],this.size=0},In.prototype.delete=function(e){var t=this.__data__,n=Hn(t,e);return!(n<0||(n==t.length-1?t.pop():St.call(t,n,1),--this.size,0))},In.prototype.get=function(e){var t=this.__data__,n=Hn(t,e);return n<0?void 0:t[n][1]},In.prototype.has=function(e){return Hn(this.__data__,e)>-1},In.prototype.set=function(e,t){var n=this.__data__,r=Hn(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},On.prototype.clear=function(){this.size=0,this.__data__={hash:new Nn,map:new(fn||In),string:new Nn}},On.prototype.delete=function(e){var t=$i(this,e).delete(e);return this.size-=t?1:0,t},On.prototype.get=function(e){return $i(this,e).get(e)},On.prototype.has=function(e){return $i(this,e).has(e)},On.prototype.set=function(e,t){var n=$i(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Dn.prototype.add=Dn.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Dn.prototype.has=function(e){return this.__data__.has(e)},zn.prototype.clear=function(){this.__data__=new In,this.size=0},zn.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},zn.prototype.get=function(e){return this.__data__.get(e)},zn.prototype.has=function(e){return this.__data__.has(e)},zn.prototype.set=function(e,t){var n=this.__data__;if(n instanceof In){var r=n.__data__;if(!fn||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new On(r)}return n.set(e,t),this.size=n.size,this};var er=xi(lr),tr=xi(ur,!0);function nr(e,t){var n=!0;return er(e,(function(e,r,i){return n=!!t(e,r,i)})),n}function rr(e,t,n){for(var r=-1,i=e.length;++r<i;){var o=e[r],a=t(o);if(null!=a&&(void 0===s?a==a&&!$a(a):n(a,s)))var s=a,l=o}return l}function ir(e,t){var n=[];return er(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}function or(e,t,n,r,i){var o=-1,a=e.length;for(n||(n=io),i||(i=[]);++o<a;){var s=e[o];t>0&&n(s)?t>1?or(s,t-1,n,r,i):ht(i,s):r||(i[i.length]=s)}return i}var ar=bi(),sr=bi(!0);function lr(e,t){return e&&ar(e,t,_s)}function ur(e,t){return e&&sr(e,t,_s)}function cr(e,t){return st(t,(function(t){return Ba(e[t])}))}function hr(e,t){for(var n=0,r=(t=ai(t,e)).length;null!=e&&n<r;)e=e[To(t[n++])];return n&&n==r?e:void 0}function dr(e,t,n){var r=t(e);return La(e)?r:ht(r,n(e))}function fr(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Yt&&Yt in ve(e)?function(e){var t=Te.call(e,Yt),n=e[Yt];try{e[Yt]=void 0;var r=!0}catch(e){}var i=Ae.call(e);return r&&(t?e[Yt]=n:delete e[Yt]),i}(e):function(e){return Ae.call(e)}(e)}function pr(e,t){return e>t}function mr(e,t){return null!=e&&Te.call(e,t)}function vr(e,t){return null!=e&&t in ve(e)}function gr(e,t,n){for(var r=n?ut:lt,i=e[0].length,o=e.length,a=o,s=he(o),l=1/0,u=[];a--;){var c=e[a];a&&t&&(c=ct(c,Ct(t))),l=sn(c.length,l),s[a]=!n&&(t||i>=120&&c.length>=120)?new Dn(a&&c):void 0}c=e[0];var h=-1,d=s[0];e:for(;++h<i&&u.length<l;){var f=c[h],p=t?t(f):f;if(f=n||0!==f?f:0,!(d?Rt(d,p):r(u,p,n))){for(a=o;--a;){var m=s[a];if(!(m?Rt(m,p):r(e[a],p,n)))continue e}d&&d.push(p),u.push(f)}}return u}function yr(e,t,n){var r=null==(e=mo(e,t=ai(t,e)))?e:e[To(Fo(t))];return null==r?void 0:nt(r,e,n)}function _r(e){return ja(e)&&fr(e)==s}function xr(e,t,n,r,i){return e===t||(null==e||null==t||!ja(e)&&!ja(t)?e!=e&&t!=t:function(e,t,n,r,i,o){var a=La(e),d=La(t),f=a?l:to(e),b=d?l:to(t),E=(f=f==s?v:f)==v,T=(b=b==s?v:b)==v,M=f==b;if(M&&Da(e)){if(!Da(t))return!1;a=!0,E=!1}if(M&&!E)return o||(o=new zn),a||Ka(e)?Gi(e,t,n,r,i,o):function(e,t,n,r,i,o,a){switch(n){case S:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case w:return!(e.byteLength!=t.byteLength||!o(new We(e),new We(t)));case u:case c:case m:return Aa(+e,+t);case h:return e.name==t.name&&e.message==t.message;case g:case _:return e==t+"";case p:var s=zt;case y:var l=1&r;if(s||(s=Ut),e.size!=t.size&&!l)return!1;var d=a.get(e);if(d)return d==t;r|=2,a.set(e,t);var f=Gi(s(e),s(t),r,i,o,a);return a.delete(e),f;case x:if(Mn)return Mn.call(e)==Mn.call(t)}return!1}(e,t,f,n,r,i,o);if(!(1&n)){var C=E&&Te.call(e,"__wrapped__"),A=T&&Te.call(t,"__wrapped__");if(C||A){var R=C?e.value():e,P=A?t.value():t;return o||(o=new zn),i(R,P,n,r,o)}}return!!M&&(o||(o=new zn),function(e,t,n,r,i,o){var a=1&n,s=Hi(e),l=s.length;if(l!=Hi(t).length&&!a)return!1;for(var u=l;u--;){var c=s[u];if(!(a?c in t:Te.call(t,c)))return!1}var h=o.get(e);if(h&&o.get(t))return h==t;var d=!0;o.set(e,t),o.set(t,e);for(var f=a;++u<l;){var p=e[c=s[u]],m=t[c];if(r)var v=a?r(m,p,c,t,e,o):r(p,m,c,e,t,o);if(!(void 0===v?p===m||i(p,m,n,r,o):v)){d=!1;break}f||(f="constructor"==c)}if(d&&!f){var g=e.constructor,y=t.constructor;g!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof y&&y instanceof y)&&(d=!1)}return o.delete(e),o.delete(t),d}(e,t,n,r,i,o))}(e,t,n,r,xr,i))}function br(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=ve(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var l=(s=n[i])[0],u=e[l],c=s[1];if(a&&s[2]){if(void 0===u&&!(l in e))return!1}else{var h=new zn;if(r)var d=r(u,c,l,e,t,h);if(!(void 0===d?xr(c,u,3,r,h):d))return!1}}return!0}function wr(e){return!(!Ga(e)||(t=e,Ce&&Ce in t))&&(Ba(e)?Be:oe).test(Mo(e));var t}function Sr(e){return"function"==typeof e?e:null==e?Ws:"object"==n(e)?La(e)?Ar(e[0],e[1]):Cr(e):el(e)}function Er(e){if(!co(e))return on(e);var t=[];for(var n in ve(e))Te.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Tr(e,t){return e<t}function Mr(e,t){var n=-1,r=Ia(e)?he(e.length):[];return er(e,(function(e,i,o){r[++n]=t(e,i,o)})),r}function Cr(e){var t=Ki(e);return 1==t.length&&t[0][2]?fo(t[0][0],t[0][1]):function(n){return n===e||br(n,e,t)}}function Ar(e,t){return so(e)&&ho(t)?fo(To(e),t):function(n){var r=ps(n,e);return void 0===r&&r===t?ms(n,e):xr(t,r,3)}}function Rr(e,t,n,r,i){e!==t&&ar(t,(function(o,a){if(i||(i=new zn),Ga(o))!function(e,t,n,r,i,o,a){var s=go(e,n),l=go(t,n),u=a.get(l);if(u)Gn(e,n,u);else{var c=o?o(s,l,n+"",e,t,a):void 0,h=void 0===c;if(h){var d=La(l),f=!d&&Da(l),p=!d&&!f&&Ka(l);c=l,d||f||p?La(s)?c=s:Oa(s)?c=vi(s):f?(h=!1,c=ci(l,!0)):p?(h=!1,c=di(l,!0)):c=[]:qa(l)||ka(l)?(c=s,ka(s)?c=os(s):Ga(s)&&!Ba(s)||(c=ro(l))):h=!1}h&&(a.set(l,c),i(c,l,r,o,a),a.delete(l)),Gn(e,n,c)}}(e,t,a,n,Rr,r,i);else{var s=r?r(go(e,a),o,a+"",e,t,i):void 0;void 0===s&&(s=o),Gn(e,a,s)}}),xs)}function Pr(e,t){var n=e.length;if(n)return oo(t+=t<0?n:0,n)?e[t]:void 0}function kr(e,t,n){var r=-1;return t=ct(t.length?t:[Ws],Ct(Zi())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(Mr(e,(function(e,n,i){return{criteria:ct(t,(function(t){return t(e)})),index:++r,value:e}})),(function(e,t){return function(e,t,n){for(var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;++r<a;){var l=fi(i[r],o[r]);if(l)return r>=s?l:l*("desc"==n[r]?-1:1)}return e.index-t.index}(e,t,n)}))}function Lr(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var a=t[r],s=hr(e,a);n(s,a)&&Ur(o,ai(a,e),s)}return o}function Nr(e,t,n,r){var i=r?_t:yt,o=-1,a=t.length,s=e;for(e===t&&(t=vi(t)),n&&(s=ct(e,Ct(n)));++o<a;)for(var l=0,u=t[o],c=n?n(u):u;(l=i(s,c,l,r))>-1;)s!==e&&St.call(s,l,1),St.call(e,l,1);return e}function Ir(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==o){var o=i;oo(i)?St.call(e,i,1):Jr(e,i)}}return e}function Or(e,t){return e+Qt(cn()*(t-e+1))}function Dr(e,t){var n="";if(!e||t<1||t>9007199254740991)return n;do{t%2&&(n+=e),(t=Qt(t/2))&&(e+=e)}while(t);return n}function zr(e,t){return xo(po(e,t,Ws),e+"")}function Fr(e){return Bn(As(e))}function Br(e,t){var n=As(e);return So(n,Zn(t,0,n.length))}function Ur(e,t,n,r){if(!Ga(e))return e;for(var i=-1,o=(t=ai(t,e)).length,a=o-1,s=e;null!=s&&++i<o;){var l=To(t[i]),u=n;if(i!=a){var c=s[l];void 0===(u=r?r(c,l,s):void 0)&&(u=Ga(c)?c:oo(t[i+1])?[]:{})}jn(s,l,u),s=s[l]}return e}var Vr=yn?function(e,t){return yn.set(e,t),e}:Ws,Gr=Xt?function(e,t){return Xt(e,"toString",{configurable:!0,enumerable:!1,value:Gs(t),writable:!0})}:Ws;function jr(e){return So(As(e))}function Hr(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=he(i);++r<i;)o[r]=e[r+t];return o}function Wr(e,t){var n;return er(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n}function qr(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;r<i;){var o=r+i>>>1,a=e[o];null!==a&&!$a(a)&&(n?a<=t:a<t)?r=o+1:i=o}return i}return Yr(e,t,Ws,n)}function Yr(e,t,n,r){t=n(t);for(var i=0,o=null==e?0:e.length,a=t!=t,s=null===t,l=$a(t),u=void 0===t;i<o;){var c=Qt((i+o)/2),h=n(e[c]),d=void 0!==h,f=null===h,p=h==h,m=$a(h);if(a)var v=r||p;else v=u?p&&(r||d):s?p&&d&&(r||!f):l?p&&d&&!f&&(r||!m):!f&&!m&&(r?h<=t:h<t);v?i=c+1:o=c}return sn(o,4294967294)}function Xr(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var a=e[n],s=t?t(a):a;if(!n||!Aa(s,l)){var l=s;o[i++]=0===a?0:a}}return o}function Zr(e){return"number"==typeof e?e:$a(e)?NaN:+e}function $r(e){if("string"==typeof e)return e;if(La(e))return ct(e,$r)+"";if($a(e))return Cn?Cn.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Kr(e,t,n){var r=-1,i=lt,o=e.length,a=!0,s=[],l=s;if(n)a=!1,i=ut;else if(o>=200){var u=t?null:Di(e);if(u)return Ut(u);a=!1,i=Rt,l=new Dn}else l=t?[]:s;e:for(;++r<o;){var c=e[r],h=t?t(c):c;if(c=n||0!==c?c:0,a&&h==h){for(var d=l.length;d--;)if(l[d]===h)continue e;t&&l.push(h),s.push(c)}else i(l,h,n)||(l!==s&&l.push(h),s.push(c))}return s}function Jr(e,t){return null==(e=mo(e,t=ai(t,e)))||delete e[To(Fo(t))]}function Qr(e,t,n,r){return Ur(e,t,n(hr(e,t)),r)}function ei(e,t,n,r){for(var i=e.length,o=r?i:-1;(r?o--:++o<i)&&t(e[o],o,e););return n?Hr(e,r?0:o,r?o+1:i):Hr(e,r?o+1:0,r?i:o)}function ti(e,t){var n=e;return n instanceof Ln&&(n=n.value()),dt(t,(function(e,t){return t.func.apply(t.thisArg,ht([e],t.args))}),n)}function ni(e,t,n){var r=e.length;if(r<2)return r?Kr(e[0]):[];for(var i=-1,o=he(r);++i<r;)for(var a=e[i],s=-1;++s<r;)s!=i&&(o[i]=Qn(o[i]||a,e[s],t,n));return Kr(or(o,1),t,n)}function ri(e,t,n){for(var r=-1,i=e.length,o=t.length,a={};++r<i;){var s=r<o?t[r]:void 0;n(a,e[r],s)}return a}function ii(e){return Oa(e)?e:[]}function oi(e){return"function"==typeof e?e:Ws}function ai(e,t){return La(e)?e:so(e,t)?[e]:Eo(as(e))}var si=zr;function li(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:Hr(e,t,n)}var ui=Zt||function(e){return He.clearTimeout(e)};function ci(e,t){if(t)return e.slice();var n=e.length,r=qe?qe(n):new e.constructor(n);return e.copy(r),r}function hi(e){var t=new e.constructor(e.byteLength);return new We(t).set(new We(e)),t}function di(e,t){var n=t?hi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function fi(e,t){if(e!==t){var n=void 0!==e,r=null===e,i=e==e,o=$a(e),a=void 0!==t,s=null===t,l=t==t,u=$a(t);if(!s&&!u&&!o&&e>t||o&&a&&l&&!s&&!u||r&&a&&l||!n&&l||!i)return 1;if(!r&&!o&&!u&&e<t||u&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!l)return-1}return 0}function pi(e,t,n,r){for(var i=-1,o=e.length,a=n.length,s=-1,l=t.length,u=an(o-a,0),c=he(l+u),h=!r;++s<l;)c[s]=t[s];for(;++i<a;)(h||i<o)&&(c[n[i]]=e[i]);for(;u--;)c[s++]=e[i++];return c}function mi(e,t,n,r){for(var i=-1,o=e.length,a=-1,s=n.length,l=-1,u=t.length,c=an(o-s,0),h=he(c+u),d=!r;++i<c;)h[i]=e[i];for(var f=i;++l<u;)h[f+l]=t[l];for(;++a<s;)(d||i<o)&&(h[f+n[a]]=e[i++]);return h}function vi(e,t){var n=-1,r=e.length;for(t||(t=he(r));++n<r;)t[n]=e[n];return t}function gi(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],l=r?r(n[s],e[s],s,n,e):void 0;void 0===l&&(l=e[s]),i?Yn(n,s,l):jn(n,s,l)}return n}function yi(e,t){return function(n,r){var i=La(n)?rt:Wn,o=t?t():{};return i(n,e,Zi(r,2),o)}}function _i(e){return zr((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&ao(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=ve(t);++r<i;){var s=n[r];s&&e(t,s,r,o)}return t}))}function xi(e,t){return function(n,r){if(null==n)return n;if(!Ia(n))return e(n,r);for(var i=n.length,o=t?i:-1,a=ve(n);(t?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function bi(e){return function(t,n,r){for(var i=-1,o=ve(t),a=r(t),s=a.length;s--;){var l=a[e?s:++i];if(!1===n(o[l],l,o))break}return t}}function wi(e){return function(t){var n=Dt(t=as(t))?Gt(t):void 0,r=n?n[0]:t.charAt(0),i=n?li(n,1).join(""):t.slice(1);return r[e]()+i}}function Si(e){return function(t){return dt(Bs(ks(t).replace(Re,"")),e,"")}}function Ei(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Rn(e.prototype),r=e.apply(n,t);return Ga(r)?r:n}}function Ti(e){return function(t,n,r){var i=ve(t);if(!Ia(t)){var o=Zi(n,3);t=_s(t),n=function(e){return o(i[e],e,i)}}var a=e(t,n,r);return a>-1?i[o?t[a]:a]:void 0}}function Mi(e){return ji((function(t){var n=t.length,i=n,o=kn.prototype.thru;for(e&&t.reverse();i--;){var a=t[i];if("function"!=typeof a)throw new _e(r);if(o&&!s&&"wrapper"==Yi(a))var s=new kn([],!0)}for(i=s?i:n;++i<n;){var l=Yi(a=t[i]),u="wrapper"==l?qi(a):void 0;s=u&&lo(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?s[Yi(u[0])].apply(s,u[3]):1==a.length&&lo(a)?s[l]():s.thru(a)}return function(){var e=arguments,r=e[0];if(s&&1==e.length&&La(r))return s.plant(r).value();for(var i=0,o=n?t[i].apply(this,e):r;++i<n;)o=t[i].call(this,o);return o}}))}function Ci(e,t,n,r,i,o,a,s,l,u){var c=128&t,h=1&t,d=2&t,f=24&t,p=512&t,m=d?void 0:Ei(e);return function v(){for(var g=arguments.length,y=he(g),_=g;_--;)y[_]=arguments[_];if(f)var x=Xi(v),b=Lt(y,x);if(r&&(y=pi(y,r,i,f)),o&&(y=mi(y,o,a,f)),g-=b,f&&g<u){var w=Bt(y,x);return Ii(e,t,Ci,v.placeholder,n,y,w,s,l,u-g)}var S=h?n:this,E=d?S[e]:e;return g=y.length,s?y=vo(y,s):p&&g>1&&y.reverse(),c&&l<g&&(y.length=l),this&&this!==He&&this instanceof v&&(E=m||Ei(E)),E.apply(S,y)}}function Ai(e,t){return function(n,r){return function(e,t,n,r){return lr(e,(function(e,i,o){t(r,n(e),i,o)})),r}(n,e,t(r),{})}}function Ri(e,t){return function(n,r){var i;if(void 0===n&&void 0===r)return t;if(void 0!==n&&(i=n),void 0!==r){if(void 0===i)return r;"string"==typeof n||"string"==typeof r?(n=$r(n),r=$r(r)):(n=Zr(n),r=Zr(r)),i=e(n,r)}return i}}function Pi(e){return ji((function(t){return t=ct(t,Ct(Zi())),zr((function(n){var r=this;return e(t,(function(e){return nt(e,r,n)}))}))}))}function ki(e,t){var n=(t=void 0===t?" ":$r(t)).length;if(n<2)return n?Dr(t,e):t;var r=Dr(t,Jt(e/Vt(t)));return Dt(t)?li(Gt(r),0,e).join(""):r.slice(0,e)}function Li(e){return function(t,n,r){return r&&"number"!=typeof r&&ao(t,n,r)&&(n=r=void 0),t=ts(t),void 0===n?(n=t,t=0):n=ts(n),function(e,t,n,r){for(var i=-1,o=an(Jt((t-e)/(n||1)),0),a=he(o);o--;)a[r?o:++i]=e,e+=n;return a}(t,n,r=void 0===r?t<n?1:-1:ts(r),e)}}function Ni(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=is(t),n=is(n)),e(t,n)}}function Ii(e,t,n,r,i,o,a,s,l,u){var c=8&t;t|=c?32:64,4&(t&=~(c?64:32))||(t&=-4);var h=[e,t,i,c?o:void 0,c?a:void 0,c?void 0:o,c?void 0:a,s,l,u],d=n.apply(void 0,h);return lo(e)&&yo(d,h),d.placeholder=r,bo(d,e,t)}function Oi(e){var t=me[e];return function(e,n){if(e=is(e),(n=null==n?0:sn(ns(n),292))&&nn(e)){var r=(as(e)+"e").split("e");return+((r=(as(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var Di=mn&&1/Ut(new mn([,-0]))[1]==1/0?function(e){return new mn(e)}:$s;function zi(e){return function(t){var n=to(t);return n==p?zt(t):n==y?function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}(t):function(e,t){return ct(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Fi(e,t,n,i,a,s,l,u){var c=2&t;if(!c&&"function"!=typeof e)throw new _e(r);var h=i?i.length:0;if(h||(t&=-97,i=a=void 0),l=void 0===l?l:an(ns(l),0),u=void 0===u?u:ns(u),h-=a?a.length:0,64&t){var d=i,f=a;i=a=void 0}var p=c?void 0:qi(e),m=[e,t,n,i,a,d,f,s,l,u];if(p&&function(e,t){var n=e[1],r=t[1],i=n|r,a=i<131,s=128==r&&8==n||128==r&&256==n&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==n;if(!a&&!s)return e;1&r&&(e[2]=t[2],i|=1&n?0:4);var l=t[3];if(l){var u=e[3];e[3]=u?pi(u,l,t[4]):l,e[4]=u?Bt(e[3],o):t[4]}(l=t[5])&&(u=e[5],e[5]=u?mi(u,l,t[6]):l,e[6]=u?Bt(e[5],o):t[6]),(l=t[7])&&(e[7]=l),128&r&&(e[8]=null==e[8]?t[8]:sn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(m,p),e=m[0],t=m[1],n=m[2],i=m[3],a=m[4],!(u=m[9]=void 0===m[9]?c?0:e.length:an(m[9]-h,0))&&24&t&&(t&=-25),t&&1!=t)v=8==t||16==t?function(e,t,n){var r=Ei(e);return function i(){for(var o=arguments.length,a=he(o),s=o,l=Xi(i);s--;)a[s]=arguments[s];var u=o<3&&a[0]!==l&&a[o-1]!==l?[]:Bt(a,l);if((o-=u.length)<n)return Ii(e,t,Ci,i.placeholder,void 0,a,u,void 0,void 0,n-o);var c=this&&this!==He&&this instanceof i?r:e;return nt(c,this,a)}}(e,t,u):32!=t&&33!=t||a.length?Ci.apply(void 0,m):function(e,t,n,r){var i=1&t,o=Ei(e);return function t(){for(var a=-1,s=arguments.length,l=-1,u=r.length,c=he(u+s),h=this&&this!==He&&this instanceof t?o:e;++l<u;)c[l]=r[l];for(;s--;)c[l++]=arguments[++a];return nt(h,i?n:this,c)}}(e,t,n,i);else var v=function(e,t,n){var r=1&t,i=Ei(e);return function t(){var o=this&&this!==He&&this instanceof t?i:e;return o.apply(r?n:this,arguments)}}(e,t,n);return bo((p?Vr:yo)(v,m),e,t)}function Bi(e,t,n,r){return void 0===e||Aa(e,we[n])&&!Te.call(r,n)?t:e}function Ui(e,t,n,r,i,o){return Ga(e)&&Ga(t)&&(o.set(t,e),Rr(e,t,void 0,Ui,o),o.delete(t)),e}function Vi(e){return qa(e)?void 0:e}function Gi(e,t,n,r,i,o){var a=1&n,s=e.length,l=t.length;if(s!=l&&!(a&&l>s))return!1;var u=o.get(e);if(u&&o.get(t))return u==t;var c=-1,h=!0,d=2&n?new Dn:void 0;for(o.set(e,t),o.set(t,e);++c<s;){var f=e[c],p=t[c];if(r)var m=a?r(p,f,c,t,e,o):r(f,p,c,e,t,o);if(void 0!==m){if(m)continue;h=!1;break}if(d){if(!pt(t,(function(e,t){if(!Rt(d,t)&&(f===e||i(f,e,n,r,o)))return d.push(t)}))){h=!1;break}}else if(f!==p&&!i(f,p,n,r,o)){h=!1;break}}return o.delete(e),o.delete(t),h}function ji(e){return xo(po(e,void 0,No),e+"")}function Hi(e){return dr(e,_s,Qi)}function Wi(e){return dr(e,xs,eo)}var qi=yn?function(e){return yn.get(e)}:$s;function Yi(e){for(var t=e.name+"",n=_n[t],r=Te.call(_n,t)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t}function Xi(e){return(Te.call(An,"placeholder")?An:e).placeholder}function Zi(){var e=An.iteratee||qs;return e=e===qs?Sr:e,arguments.length?e(arguments[0],arguments[1]):e}function $i(e,t){var r=e.__data__;return function(e){var t=n(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?r["string"==typeof t?"string":"hash"]:r.map}function Ki(e){for(var t=_s(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,ho(i)]}return t}function Ji(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return wr(n)?n:void 0}var Qi=en?function(e){return null==e?[]:(e=ve(e),st(en(e),(function(t){return mt.call(e,t)})))}:rl,eo=en?function(e){for(var t=[];e;)ht(t,Qi(e)),e=Xe(e);return t}:rl,to=fr;function no(e,t,n){for(var r=-1,i=(t=ai(t,e)).length,o=!1;++r<i;){var a=To(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&Va(i)&&oo(a,i)&&(La(e)||ka(e))}function ro(e){return"function"!=typeof e.constructor||co(e)?{}:Rn(Xe(e))}function io(e){return La(e)||ka(e)||!!(Wt&&e&&e[Wt])}function oo(e,t){var r=n(e);return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&se.test(e))&&e>-1&&e%1==0&&e<t}function ao(e,t,r){if(!Ga(r))return!1;var i=n(t);return!!("number"==i?Ia(r)&&oo(t,r.length):"string"==i&&t in r)&&Aa(r[t],e)}function so(e,t){if(La(e))return!1;var r=n(e);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!$a(e))||j.test(e)||!G.test(e)||null!=t&&e in ve(t)}function lo(e){var t=Yi(e),n=An[t];if("function"!=typeof n||!(t in Ln.prototype))return!1;if(e===n)return!0;var r=qi(n);return!!r&&e===r[0]}(dn&&to(new dn(new ArrayBuffer(1)))!=S||fn&&to(new fn)!=p||pn&&"[object Promise]"!=to(pn.resolve())||mn&&to(new mn)!=y||vn&&to(new vn)!=b)&&(to=function(e){var t=fr(e),n=t==v?e.constructor:void 0,r=n?Mo(n):"";if(r)switch(r){case xn:return S;case bn:return p;case wn:return"[object Promise]";case Sn:return y;case En:return b}return t});var uo=Se?Ba:il;function co(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||we)}function ho(e){return e==e&&!Ga(e)}function fo(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in ve(n))}}function po(e,t,n){return t=an(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=an(r.length-t,0),a=he(o);++i<o;)a[i]=r[t+i];i=-1;for(var s=he(t+1);++i<t;)s[i]=r[i];return s[t]=n(a),nt(e,this,s)}}function mo(e,t){return t.length<2?e:hr(e,Hr(t,0,-1))}function vo(e,t){for(var n=e.length,r=sn(t.length,n),i=vi(e);r--;){var o=t[r];e[r]=oo(o,n)?i[o]:void 0}return e}function go(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var yo=wo(Vr),_o=Kt||function(e,t){return He.setTimeout(e,t)},xo=wo(Gr);function bo(e,t,n){var r=t+"";return xo(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace($,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return it(a,(function(n){var r="_."+n[0];t&n[1]&&!lt(e,r)&&e.push(r)})),e.sort()}(function(e){var t=e.match(K);return t?t[1].split(J):[]}(r),n)))}function wo(e){var t=0,n=0;return function(){var r=ln(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function So(e,t){var n=-1,r=e.length,i=r-1;for(t=void 0===t?r:t;++n<t;){var o=Or(n,i),a=e[o];e[o]=e[n],e[n]=a}return e.length=t,e}var Eo=function(e){var t=wa((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(H,(function(e,n,r,i){t.push(r?i.replace(ee,"$1"):n||e)})),t}),(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}();function To(e){if("string"==typeof e||$a(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Mo(e){if(null!=e){try{return Ee.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Co(e){if(e instanceof Ln)return e.clone();var t=new kn(e.__wrapped__,e.__chain__);return t.__actions__=vi(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Ao=zr((function(e,t){return Oa(e)?Qn(e,or(t,1,Oa,!0)):[]})),Ro=zr((function(e,t){var n=Fo(t);return Oa(n)&&(n=void 0),Oa(e)?Qn(e,or(t,1,Oa,!0),Zi(n,2)):[]})),Po=zr((function(e,t){var n=Fo(t);return Oa(n)&&(n=void 0),Oa(e)?Qn(e,or(t,1,Oa,!0),void 0,n):[]}));function ko(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:ns(n);return i<0&&(i=an(r+i,0)),gt(e,Zi(t,3),i)}function Lo(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r-1;return void 0!==n&&(i=ns(n),i=n<0?an(r+i,0):sn(i,r-1)),gt(e,Zi(t,3),i,!0)}function No(e){return null!=e&&e.length?or(e,1):[]}function Io(e){return e&&e.length?e[0]:void 0}var Oo=zr((function(e){var t=ct(e,ii);return t.length&&t[0]===e[0]?gr(t):[]})),Do=zr((function(e){var t=Fo(e),n=ct(e,ii);return t===Fo(n)?t=void 0:n.pop(),n.length&&n[0]===e[0]?gr(n,Zi(t,2)):[]})),zo=zr((function(e){var t=Fo(e),n=ct(e,ii);return(t="function"==typeof t?t:void 0)&&n.pop(),n.length&&n[0]===e[0]?gr(n,void 0,t):[]}));function Fo(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var Bo=zr(Uo);function Uo(e,t){return e&&e.length&&t&&t.length?Nr(e,t):e}var Vo=ji((function(e,t){var n=null==e?0:e.length,r=Xn(e,t);return Ir(e,ct(t,(function(e){return oo(e,n)?+e:e})).sort(fi)),r}));function Go(e){return null==e?e:hn.call(e)}var jo=zr((function(e){return Kr(or(e,1,Oa,!0))})),Ho=zr((function(e){var t=Fo(e);return Oa(t)&&(t=void 0),Kr(or(e,1,Oa,!0),Zi(t,2))})),Wo=zr((function(e){var t=Fo(e);return t="function"==typeof t?t:void 0,Kr(or(e,1,Oa,!0),void 0,t)}));function qo(e){if(!e||!e.length)return[];var t=0;return e=st(e,(function(e){if(Oa(e))return t=an(e.length,t),!0})),Mt(t,(function(t){return ct(e,wt(t))}))}function Yo(e,t){if(!e||!e.length)return[];var n=qo(e);return null==t?n:ct(n,(function(e){return nt(t,void 0,e)}))}var Xo=zr((function(e,t){return Oa(e)?Qn(e,t):[]})),Zo=zr((function(e){return ni(st(e,Oa))})),$o=zr((function(e){var t=Fo(e);return Oa(t)&&(t=void 0),ni(st(e,Oa),Zi(t,2))})),Ko=zr((function(e){var t=Fo(e);return t="function"==typeof t?t:void 0,ni(st(e,Oa),void 0,t)})),Jo=zr(qo),Qo=zr((function(e){var t=e.length,n=t>1?e[t-1]:void 0;return n="function"==typeof n?(e.pop(),n):void 0,Yo(e,n)}));function ea(e){var t=An(e);return t.__chain__=!0,t}function ta(e,t){return t(e)}var na=ji((function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,i=function(t){return Xn(t,e)};return!(t>1||this.__actions__.length)&&r instanceof Ln&&oo(n)?((r=r.slice(n,+n+(t?1:0))).__actions__.push({func:ta,args:[i],thisArg:void 0}),new kn(r,this.__chain__).thru((function(e){return t&&!e.length&&e.push(void 0),e}))):this.thru(i)})),ra=yi((function(e,t,n){Te.call(e,n)?++e[n]:Yn(e,n,1)})),ia=Ti(ko),oa=Ti(Lo);function aa(e,t){return(La(e)?it:er)(e,Zi(t,3))}function sa(e,t){return(La(e)?ot:tr)(e,Zi(t,3))}var la=yi((function(e,t,n){Te.call(e,n)?e[n].push(t):Yn(e,n,[t])})),ua=zr((function(e,t,n){var r=-1,i="function"==typeof t,o=Ia(e)?he(e.length):[];return er(e,(function(e){o[++r]=i?nt(t,e,n):yr(e,t,n)})),o})),ca=yi((function(e,t,n){Yn(e,n,t)}));function ha(e,t){return(La(e)?ct:Mr)(e,Zi(t,3))}var da=yi((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]})),fa=zr((function(e,t){if(null==e)return[];var n=t.length;return n>1&&ao(e,t[0],t[1])?t=[]:n>2&&ao(t[0],t[1],t[2])&&(t=[t[0]]),kr(e,or(t,1),[])})),pa=$t||function(){return He.Date.now()};function ma(e,t,n){return t=n?void 0:t,Fi(e,128,void 0,void 0,void 0,void 0,t=e&&null==t?e.length:t)}function va(e,t){var n;if("function"!=typeof t)throw new _e(r);return e=ns(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}var ga=zr((function(e,t,n){var r=1;if(n.length){var i=Bt(n,Xi(ga));r|=32}return Fi(e,r,t,n,i)})),ya=zr((function(e,t,n){var r=3;if(n.length){var i=Bt(n,Xi(ya));r|=32}return Fi(t,r,e,n,i)}));function _a(e,t,n){var i,o,a,s,l,u,c=0,h=!1,d=!1,f=!0;if("function"!=typeof e)throw new _e(r);function p(t){var n=i,r=o;return i=o=void 0,c=t,s=e.apply(r,n)}function m(e){return c=e,l=_o(g,t),h?p(e):s}function v(e){var n=e-u;return void 0===u||n>=t||n<0||d&&e-c>=a}function g(){var e=pa();if(v(e))return y(e);l=_o(g,function(e){var n=t-(e-u);return d?sn(n,a-(e-c)):n}(e))}function y(e){return l=void 0,f&&i?p(e):(i=o=void 0,s)}function _(){var e=pa(),n=v(e);if(i=arguments,o=this,u=e,n){if(void 0===l)return m(u);if(d)return ui(l),l=_o(g,t),p(u)}return void 0===l&&(l=_o(g,t)),s}return t=is(t)||0,Ga(n)&&(h=!!n.leading,a=(d="maxWait"in n)?an(is(n.maxWait)||0,t):a,f="trailing"in n?!!n.trailing:f),_.cancel=function(){void 0!==l&&ui(l),c=0,i=u=o=l=void 0},_.flush=function(){return void 0===l?s:y(pa())},_}var xa=zr((function(e,t){return Jn(e,1,t)})),ba=zr((function(e,t,n){return Jn(e,is(t)||0,n)}));function wa(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new _e(r);var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(wa.Cache||On),n}function Sa(e){if("function"!=typeof e)throw new _e(r);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}wa.Cache=On;var Ea=si((function(e,t){var n=(t=1==t.length&&La(t[0])?ct(t[0],Ct(Zi())):ct(or(t,1),Ct(Zi()))).length;return zr((function(r){for(var i=-1,o=sn(r.length,n);++i<o;)r[i]=t[i].call(this,r[i]);return nt(e,this,r)}))})),Ta=zr((function(e,t){return Fi(e,32,void 0,t,Bt(t,Xi(Ta)))})),Ma=zr((function(e,t){return Fi(e,64,void 0,t,Bt(t,Xi(Ma)))})),Ca=ji((function(e,t){return Fi(e,256,void 0,void 0,void 0,t)}));function Aa(e,t){return e===t||e!=e&&t!=t}var Ra=Ni(pr),Pa=Ni((function(e,t){return e>=t})),ka=_r(function(){return arguments}())?_r:function(e){return ja(e)&&Te.call(e,"callee")&&!mt.call(e,"callee")},La=he.isArray,Na=$e?Ct($e):function(e){return ja(e)&&fr(e)==w};function Ia(e){return null!=e&&Va(e.length)&&!Ba(e)}function Oa(e){return ja(e)&&Ia(e)}var Da=tn||il,za=Ke?Ct(Ke):function(e){return ja(e)&&fr(e)==c};function Fa(e){if(!ja(e))return!1;var t=fr(e);return t==h||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!qa(e)}function Ba(e){if(!Ga(e))return!1;var t=fr(e);return t==d||t==f||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ua(e){return"number"==typeof e&&e==ns(e)}function Va(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function Ga(e){var t=n(e);return null!=e&&("object"==t||"function"==t)}function ja(e){return null!=e&&"object"==n(e)}var Ha=Je?Ct(Je):function(e){return ja(e)&&to(e)==p};function Wa(e){return"number"==typeof e||ja(e)&&fr(e)==m}function qa(e){if(!ja(e)||fr(e)!=v)return!1;var t=Xe(e);if(null===t)return!0;var n=Te.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Ee.call(n)==ke}var Ya=Qe?Ct(Qe):function(e){return ja(e)&&fr(e)==g},Xa=et?Ct(et):function(e){return ja(e)&&to(e)==y};function Za(e){return"string"==typeof e||!La(e)&&ja(e)&&fr(e)==_}function $a(e){return"symbol"==n(e)||ja(e)&&fr(e)==x}var Ka=tt?Ct(tt):function(e){return ja(e)&&Va(e.length)&&!!ze[fr(e)]},Ja=Ni(Tr),Qa=Ni((function(e,t){return e<=t}));function es(e){if(!e)return[];if(Ia(e))return Za(e)?Gt(e):vi(e);if(qt&&e[qt])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[qt]());var t=to(e);return(t==p?zt:t==y?Ut:As)(e)}function ts(e){return e?(e=is(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function ns(e){var t=ts(e),n=t%1;return t==t?n?t-n:t:0}function rs(e){return e?Zn(ns(e),0,4294967295):0}function is(e){if("number"==typeof e)return e;if($a(e))return NaN;if(Ga(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Ga(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Y,"");var n=ie.test(e);return n||ae.test(e)?Ve(e.slice(2),n?2:8):re.test(e)?NaN:+e}function os(e){return gi(e,xs(e))}function as(e){return null==e?"":$r(e)}var ss=_i((function(e,t){if(co(t)||Ia(t))gi(t,_s(t),e);else for(var n in t)Te.call(t,n)&&jn(e,n,t[n])})),ls=_i((function(e,t){gi(t,xs(t),e)})),us=_i((function(e,t,n,r){gi(t,xs(t),e,r)})),cs=_i((function(e,t,n,r){gi(t,_s(t),e,r)})),hs=ji(Xn),ds=zr((function(e,t){e=ve(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&ao(t[0],t[1],i)&&(r=1);++n<r;)for(var o=t[n],a=xs(o),s=-1,l=a.length;++s<l;){var u=a[s],c=e[u];(void 0===c||Aa(c,we[u])&&!Te.call(e,u))&&(e[u]=o[u])}return e})),fs=zr((function(e){return e.push(void 0,Ui),nt(ws,void 0,e)}));function ps(e,t,n){var r=null==e?void 0:hr(e,t);return void 0===r?n:r}function ms(e,t){return null!=e&&no(e,t,vr)}var vs=Ai((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ae.call(t)),e[t]=n}),Gs(Ws)),gs=Ai((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ae.call(t)),Te.call(e,t)?e[t].push(n):e[t]=[n]}),Zi),ys=zr(yr);function _s(e){return Ia(e)?Fn(e):Er(e)}function xs(e){return Ia(e)?Fn(e,!0):function(e){if(!Ga(e))return function(e){var t=[];if(null!=e)for(var n in ve(e))t.push(n);return t}(e);var t=co(e),n=[];for(var r in e)("constructor"!=r||!t&&Te.call(e,r))&&n.push(r);return n}(e)}var bs=_i((function(e,t,n){Rr(e,t,n)})),ws=_i((function(e,t,n,r){Rr(e,t,n,r)})),Ss=ji((function(e,t){var n={};if(null==e)return n;var r=!1;t=ct(t,(function(t){return t=ai(t,e),r||(r=t.length>1),t})),gi(e,Wi(e),n),r&&(n=$n(n,7,Vi));for(var i=t.length;i--;)Jr(n,t[i]);return n})),Es=ji((function(e,t){return null==e?{}:function(e,t){return Lr(e,t,(function(t,n){return ms(e,n)}))}(e,t)}));function Ts(e,t){if(null==e)return{};var n=ct(Wi(e),(function(e){return[e]}));return t=Zi(t),Lr(e,n,(function(e,n){return t(e,n[0])}))}var Ms=zi(_s),Cs=zi(xs);function As(e){return null==e?[]:At(e,_s(e))}var Rs=Si((function(e,t,n){return t=t.toLowerCase(),e+(n?Ps(t):t)}));function Ps(e){return Fs(as(e).toLowerCase())}function ks(e){return(e=as(e))&&e.replace(le,Nt).replace(Pe,"")}var Ls=Si((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),Ns=Si((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),Is=wi("toLowerCase"),Os=Si((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()})),Ds=Si((function(e,t,n){return e+(n?" ":"")+Fs(t)})),zs=Si((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Fs=wi("toUpperCase");function Bs(e,t,n){return e=as(e),void 0===(t=n?void 0:t)?function(e){return Ie.test(e)}(e)?function(e){return e.match(Le)||[]}(e):function(e){return e.match(Q)||[]}(e):e.match(t)||[]}var Us=zr((function(e,t){try{return nt(e,void 0,t)}catch(e){return Fa(e)?e:new fe(e)}})),Vs=ji((function(e,t){return it(t,(function(t){t=To(t),Yn(e,t,ga(e[t],e))})),e}));function Gs(e){return function(){return e}}var js=Mi(),Hs=Mi(!0);function Ws(e){return e}function qs(e){return Sr("function"==typeof e?e:$n(e,1))}var Ys=zr((function(e,t){return function(n){return yr(n,e,t)}})),Xs=zr((function(e,t){return function(n){return yr(e,n,t)}}));function Zs(e,t,n){var r=_s(t),i=cr(t,r);null!=n||Ga(t)&&(i.length||!r.length)||(n=t,t=e,e=this,i=cr(t,_s(t)));var o=!(Ga(n)&&"chain"in n&&!n.chain),a=Ba(e);return it(i,(function(n){var r=t[n];e[n]=r,a&&(e.prototype[n]=function(){var t=this.__chain__;if(o||t){var n=e(this.__wrapped__),i=n.__actions__=vi(this.__actions__);return i.push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,ht([this.value()],arguments))})})),e}function $s(){}var Ks=Pi(ct),Js=Pi(at),Qs=Pi(pt);function el(e){return so(e)?wt(To(e)):function(e){return function(t){return hr(t,e)}}(e)}var tl=Li(),nl=Li(!0);function rl(){return[]}function il(){return!1}var ol,al=Ri((function(e,t){return e+t}),0),sl=Oi("ceil"),ll=Ri((function(e,t){return e/t}),1),ul=Oi("floor"),cl=Ri((function(e,t){return e*t}),1),hl=Oi("round"),dl=Ri((function(e,t){return e-t}),0);return An.after=function(e,t){if("function"!=typeof t)throw new _e(r);return e=ns(e),function(){if(--e<1)return t.apply(this,arguments)}},An.ary=ma,An.assign=ss,An.assignIn=ls,An.assignInWith=us,An.assignWith=cs,An.at=hs,An.before=va,An.bind=ga,An.bindAll=Vs,An.bindKey=ya,An.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return La(e)?e:[e]},An.chain=ea,An.chunk=function(e,t,n){t=(n?ao(e,t,n):void 0===t)?1:an(ns(t),0);var r=null==e?0:e.length;if(!r||t<1)return[];for(var i=0,o=0,a=he(Jt(r/t));i<r;)a[o++]=Hr(e,i,i+=t);return a},An.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i},An.concat=function(){var e=arguments.length;if(!e)return[];for(var t=he(e-1),n=arguments[0],r=e;r--;)t[r-1]=arguments[r];return ht(La(n)?vi(n):[n],or(t,1))},An.cond=function(e){var t=null==e?0:e.length,n=Zi();return e=t?ct(e,(function(e){if("function"!=typeof e[1])throw new _e(r);return[n(e[0]),e[1]]})):[],zr((function(n){for(var r=-1;++r<t;){var i=e[r];if(nt(i[0],this,n))return nt(i[1],this,n)}}))},An.conforms=function(e){return function(e){var t=_s(e);return function(n){return Kn(n,e,t)}}($n(e,1))},An.constant=Gs,An.countBy=ra,An.create=function(e,t){var n=Rn(e);return null==t?n:qn(n,t)},An.curry=function e(t,n,r){var i=Fi(t,8,void 0,void 0,void 0,void 0,void 0,n=r?void 0:n);return i.placeholder=e.placeholder,i},An.curryRight=function e(t,n,r){var i=Fi(t,16,void 0,void 0,void 0,void 0,void 0,n=r?void 0:n);return i.placeholder=e.placeholder,i},An.debounce=_a,An.defaults=ds,An.defaultsDeep=fs,An.defer=xa,An.delay=ba,An.difference=Ao,An.differenceBy=Ro,An.differenceWith=Po,An.drop=function(e,t,n){var r=null==e?0:e.length;return r?Hr(e,(t=n||void 0===t?1:ns(t))<0?0:t,r):[]},An.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?Hr(e,0,(t=r-(t=n||void 0===t?1:ns(t)))<0?0:t):[]},An.dropRightWhile=function(e,t){return e&&e.length?ei(e,Zi(t,3),!0,!0):[]},An.dropWhile=function(e,t){return e&&e.length?ei(e,Zi(t,3),!0):[]},An.fill=function(e,t,n,r){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&ao(e,t,n)&&(n=0,r=i),function(e,t,n,r){var i=e.length;for((n=ns(n))<0&&(n=-n>i?0:i+n),(r=void 0===r||r>i?i:ns(r))<0&&(r+=i),r=n>r?0:rs(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},An.filter=function(e,t){return(La(e)?st:ir)(e,Zi(t,3))},An.flatMap=function(e,t){return or(ha(e,t),1)},An.flatMapDeep=function(e,t){return or(ha(e,t),1/0)},An.flatMapDepth=function(e,t,n){return n=void 0===n?1:ns(n),or(ha(e,t),n)},An.flatten=No,An.flattenDeep=function(e){return null!=e&&e.length?or(e,1/0):[]},An.flattenDepth=function(e,t){return null!=e&&e.length?or(e,t=void 0===t?1:ns(t)):[]},An.flip=function(e){return Fi(e,512)},An.flow=js,An.flowRight=Hs,An.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},An.functions=function(e){return null==e?[]:cr(e,_s(e))},An.functionsIn=function(e){return null==e?[]:cr(e,xs(e))},An.groupBy=la,An.initial=function(e){return null!=e&&e.length?Hr(e,0,-1):[]},An.intersection=Oo,An.intersectionBy=Do,An.intersectionWith=zo,An.invert=vs,An.invertBy=gs,An.invokeMap=ua,An.iteratee=qs,An.keyBy=ca,An.keys=_s,An.keysIn=xs,An.map=ha,An.mapKeys=function(e,t){var n={};return t=Zi(t,3),lr(e,(function(e,r,i){Yn(n,t(e,r,i),e)})),n},An.mapValues=function(e,t){var n={};return t=Zi(t,3),lr(e,(function(e,r,i){Yn(n,r,t(e,r,i))})),n},An.matches=function(e){return Cr($n(e,1))},An.matchesProperty=function(e,t){return Ar(e,$n(t,1))},An.memoize=wa,An.merge=bs,An.mergeWith=ws,An.method=Ys,An.methodOf=Xs,An.mixin=Zs,An.negate=Sa,An.nthArg=function(e){return e=ns(e),zr((function(t){return Pr(t,e)}))},An.omit=Ss,An.omitBy=function(e,t){return Ts(e,Sa(Zi(t)))},An.once=function(e){return va(2,e)},An.orderBy=function(e,t,n,r){return null==e?[]:(La(t)||(t=null==t?[]:[t]),La(n=r?void 0:n)||(n=null==n?[]:[n]),kr(e,t,n))},An.over=Ks,An.overArgs=Ea,An.overEvery=Js,An.overSome=Qs,An.partial=Ta,An.partialRight=Ma,An.partition=da,An.pick=Es,An.pickBy=Ts,An.property=el,An.propertyOf=function(e){return function(t){return null==e?void 0:hr(e,t)}},An.pull=Bo,An.pullAll=Uo,An.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?Nr(e,t,Zi(n,2)):e},An.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?Nr(e,t,void 0,n):e},An.pullAt=Vo,An.range=tl,An.rangeRight=nl,An.rearg=Ca,An.reject=function(e,t){return(La(e)?st:ir)(e,Sa(Zi(t,3)))},An.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],o=e.length;for(t=Zi(t,3);++r<o;){var a=e[r];t(a,r,e)&&(n.push(a),i.push(r))}return Ir(e,i),n},An.rest=function(e,t){if("function"!=typeof e)throw new _e(r);return zr(e,t=void 0===t?t:ns(t))},An.reverse=Go,An.sampleSize=function(e,t,n){return t=(n?ao(e,t,n):void 0===t)?1:ns(t),(La(e)?Un:Br)(e,t)},An.set=function(e,t,n){return null==e?e:Ur(e,t,n)},An.setWith=function(e,t,n,r){return r="function"==typeof r?r:void 0,null==e?e:Ur(e,t,n,r)},An.shuffle=function(e){return(La(e)?Vn:jr)(e)},An.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&ao(e,t,n)?(t=0,n=r):(t=null==t?0:ns(t),n=void 0===n?r:ns(n)),Hr(e,t,n)):[]},An.sortBy=fa,An.sortedUniq=function(e){return e&&e.length?Xr(e):[]},An.sortedUniqBy=function(e,t){return e&&e.length?Xr(e,Zi(t,2)):[]},An.split=function(e,t,n){return n&&"number"!=typeof n&&ao(e,t,n)&&(t=n=void 0),(n=void 0===n?4294967295:n>>>0)?(e=as(e))&&("string"==typeof t||null!=t&&!Ya(t))&&!(t=$r(t))&&Dt(e)?li(Gt(e),0,n):e.split(t,n):[]},An.spread=function(e,t){if("function"!=typeof e)throw new _e(r);return t=null==t?0:an(ns(t),0),zr((function(n){var r=n[t],i=li(n,0,t);return r&&ht(i,r),nt(e,this,i)}))},An.tail=function(e){var t=null==e?0:e.length;return t?Hr(e,1,t):[]},An.take=function(e,t,n){return e&&e.length?Hr(e,0,(t=n||void 0===t?1:ns(t))<0?0:t):[]},An.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?Hr(e,(t=r-(t=n||void 0===t?1:ns(t)))<0?0:t,r):[]},An.takeRightWhile=function(e,t){return e&&e.length?ei(e,Zi(t,3),!1,!0):[]},An.takeWhile=function(e,t){return e&&e.length?ei(e,Zi(t,3)):[]},An.tap=function(e,t){return t(e),e},An.throttle=function(e,t,n){var i=!0,o=!0;if("function"!=typeof e)throw new _e(r);return Ga(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),_a(e,t,{leading:i,maxWait:t,trailing:o})},An.thru=ta,An.toArray=es,An.toPairs=Ms,An.toPairsIn=Cs,An.toPath=function(e){return La(e)?ct(e,To):$a(e)?[e]:vi(Eo(as(e)))},An.toPlainObject=os,An.transform=function(e,t,n){var r=La(e),i=r||Da(e)||Ka(e);if(t=Zi(t,4),null==n){var o=e&&e.constructor;n=i?r?new o:[]:Ga(e)&&Ba(o)?Rn(Xe(e)):{}}return(i?it:lr)(e,(function(e,r,i){return t(n,e,r,i)})),n},An.unary=function(e){return ma(e,1)},An.union=jo,An.unionBy=Ho,An.unionWith=Wo,An.uniq=function(e){return e&&e.length?Kr(e):[]},An.uniqBy=function(e,t){return e&&e.length?Kr(e,Zi(t,2)):[]},An.uniqWith=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?Kr(e,void 0,t):[]},An.unset=function(e,t){return null==e||Jr(e,t)},An.unzip=qo,An.unzipWith=Yo,An.update=function(e,t,n){return null==e?e:Qr(e,t,oi(n))},An.updateWith=function(e,t,n,r){return r="function"==typeof r?r:void 0,null==e?e:Qr(e,t,oi(n),r)},An.values=As,An.valuesIn=function(e){return null==e?[]:At(e,xs(e))},An.without=Xo,An.words=Bs,An.wrap=function(e,t){return Ta(oi(t),e)},An.xor=Zo,An.xorBy=$o,An.xorWith=Ko,An.zip=Jo,An.zipObject=function(e,t){return ri(e||[],t||[],jn)},An.zipObjectDeep=function(e,t){return ri(e||[],t||[],Ur)},An.zipWith=Qo,An.entries=Ms,An.entriesIn=Cs,An.extend=ls,An.extendWith=us,Zs(An,An),An.add=al,An.attempt=Us,An.camelCase=Rs,An.capitalize=Ps,An.ceil=sl,An.clamp=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=is(n))==n?n:0),void 0!==t&&(t=(t=is(t))==t?t:0),Zn(is(e),t,n)},An.clone=function(e){return $n(e,4)},An.cloneDeep=function(e){return $n(e,5)},An.cloneDeepWith=function(e,t){return $n(e,5,t="function"==typeof t?t:void 0)},An.cloneWith=function(e,t){return $n(e,4,t="function"==typeof t?t:void 0)},An.conformsTo=function(e,t){return null==t||Kn(e,t,_s(t))},An.deburr=ks,An.defaultTo=function(e,t){return null==e||e!=e?t:e},An.divide=ll,An.endsWith=function(e,t,n){e=as(e),t=$r(t);var r=e.length,i=n=void 0===n?r:Zn(ns(n),0,r);return(n-=t.length)>=0&&e.slice(n,i)==t},An.eq=Aa,An.escape=function(e){return(e=as(e))&&F.test(e)?e.replace(D,It):e},An.escapeRegExp=function(e){return(e=as(e))&&q.test(e)?e.replace(W,"\\$&"):e},An.every=function(e,t,n){var r=La(e)?at:nr;return n&&ao(e,t,n)&&(t=void 0),r(e,Zi(t,3))},An.find=ia,An.findIndex=ko,An.findKey=function(e,t){return vt(e,Zi(t,3),lr)},An.findLast=oa,An.findLastIndex=Lo,An.findLastKey=function(e,t){return vt(e,Zi(t,3),ur)},An.floor=ul,An.forEach=aa,An.forEachRight=sa,An.forIn=function(e,t){return null==e?e:ar(e,Zi(t,3),xs)},An.forInRight=function(e,t){return null==e?e:sr(e,Zi(t,3),xs)},An.forOwn=function(e,t){return e&&lr(e,Zi(t,3))},An.forOwnRight=function(e,t){return e&&ur(e,Zi(t,3))},An.get=ps,An.gt=Ra,An.gte=Pa,An.has=function(e,t){return null!=e&&no(e,t,mr)},An.hasIn=ms,An.head=Io,An.identity=Ws,An.includes=function(e,t,n,r){e=Ia(e)?e:As(e),n=n&&!r?ns(n):0;var i=e.length;return n<0&&(n=an(i+n,0)),Za(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&yt(e,t,n)>-1},An.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:ns(n);return i<0&&(i=an(r+i,0)),yt(e,t,i)},An.inRange=function(e,t,n){return t=ts(t),void 0===n?(n=t,t=0):n=ts(n),function(e,t,n){return e>=sn(t,n)&&e<an(t,n)}(e=is(e),t,n)},An.invoke=ys,An.isArguments=ka,An.isArray=La,An.isArrayBuffer=Na,An.isArrayLike=Ia,An.isArrayLikeObject=Oa,An.isBoolean=function(e){return!0===e||!1===e||ja(e)&&fr(e)==u},An.isBuffer=Da,An.isDate=za,An.isElement=function(e){return ja(e)&&1===e.nodeType&&!qa(e)},An.isEmpty=function(e){if(null==e)return!0;if(Ia(e)&&(La(e)||"string"==typeof e||"function"==typeof e.splice||Da(e)||Ka(e)||ka(e)))return!e.length;var t=to(e);if(t==p||t==y)return!e.size;if(co(e))return!Er(e).length;for(var n in e)if(Te.call(e,n))return!1;return!0},An.isEqual=function(e,t){return xr(e,t)},An.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:void 0)?n(e,t):void 0;return void 0===r?xr(e,t,void 0,n):!!r},An.isError=Fa,An.isFinite=function(e){return"number"==typeof e&&nn(e)},An.isFunction=Ba,An.isInteger=Ua,An.isLength=Va,An.isMap=Ha,An.isMatch=function(e,t){return e===t||br(e,t,Ki(t))},An.isMatchWith=function(e,t,n){return n="function"==typeof n?n:void 0,br(e,t,Ki(t),n)},An.isNaN=function(e){return Wa(e)&&e!=+e},An.isNative=function(e){if(uo(e))throw new fe("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return wr(e)},An.isNil=function(e){return null==e},An.isNull=function(e){return null===e},An.isNumber=Wa,An.isObject=Ga,An.isObjectLike=ja,An.isPlainObject=qa,An.isRegExp=Ya,An.isSafeInteger=function(e){return Ua(e)&&e>=-9007199254740991&&e<=9007199254740991},An.isSet=Xa,An.isString=Za,An.isSymbol=$a,An.isTypedArray=Ka,An.isUndefined=function(e){return void 0===e},An.isWeakMap=function(e){return ja(e)&&to(e)==b},An.isWeakSet=function(e){return ja(e)&&"[object WeakSet]"==fr(e)},An.join=function(e,t){return null==e?"":rn.call(e,t)},An.kebabCase=Ls,An.last=Fo,An.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r;return void 0!==n&&(i=(i=ns(n))<0?an(r+i,0):sn(i,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,i):gt(e,xt,i,!0)},An.lowerCase=Ns,An.lowerFirst=Is,An.lt=Ja,An.lte=Qa,An.max=function(e){return e&&e.length?rr(e,Ws,pr):void 0},An.maxBy=function(e,t){return e&&e.length?rr(e,Zi(t,2),pr):void 0},An.mean=function(e){return bt(e,Ws)},An.meanBy=function(e,t){return bt(e,Zi(t,2))},An.min=function(e){return e&&e.length?rr(e,Ws,Tr):void 0},An.minBy=function(e,t){return e&&e.length?rr(e,Zi(t,2),Tr):void 0},An.stubArray=rl,An.stubFalse=il,An.stubObject=function(){return{}},An.stubString=function(){return""},An.stubTrue=function(){return!0},An.multiply=cl,An.nth=function(e,t){return e&&e.length?Pr(e,ns(t)):void 0},An.noConflict=function(){return He._===this&&(He._=Ne),this},An.noop=$s,An.now=pa,An.pad=function(e,t,n){e=as(e);var r=(t=ns(t))?Vt(e):0;if(!t||r>=t)return e;var i=(t-r)/2;return ki(Qt(i),n)+e+ki(Jt(i),n)},An.padEnd=function(e,t,n){e=as(e);var r=(t=ns(t))?Vt(e):0;return t&&r<t?e+ki(t-r,n):e},An.padStart=function(e,t,n){e=as(e);var r=(t=ns(t))?Vt(e):0;return t&&r<t?ki(t-r,n)+e:e},An.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),un(as(e).replace(X,""),t||0)},An.random=function(e,t,n){if(n&&"boolean"!=typeof n&&ao(e,t,n)&&(t=n=void 0),void 0===n&&("boolean"==typeof t?(n=t,t=void 0):"boolean"==typeof e&&(n=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=ts(e),void 0===t?(t=e,e=0):t=ts(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var i=cn();return sn(e+i*(t-e+Ue("1e-"+((i+"").length-1))),t)}return Or(e,t)},An.reduce=function(e,t,n){var r=La(e)?dt:Et,i=arguments.length<3;return r(e,Zi(t,4),n,i,er)},An.reduceRight=function(e,t,n){var r=La(e)?ft:Et,i=arguments.length<3;return r(e,Zi(t,4),n,i,tr)},An.repeat=function(e,t,n){return t=(n?ao(e,t,n):void 0===t)?1:ns(t),Dr(as(e),t)},An.replace=function(){var e=arguments,t=as(e[0]);return e.length<3?t:t.replace(e[1],e[2])},An.result=function(e,t,n){var r=-1,i=(t=ai(t,e)).length;for(i||(i=1,e=void 0);++r<i;){var o=null==e?void 0:e[To(t[r])];void 0===o&&(r=i,o=n),e=Ba(o)?o.call(e):o}return e},An.round=hl,An.runInContext=e,An.sample=function(e){return(La(e)?Bn:Fr)(e)},An.size=function(e){if(null==e)return 0;if(Ia(e))return Za(e)?Vt(e):e.length;var t=to(e);return t==p||t==y?e.size:Er(e).length},An.snakeCase=Os,An.some=function(e,t,n){var r=La(e)?pt:Wr;return n&&ao(e,t,n)&&(t=void 0),r(e,Zi(t,3))},An.sortedIndex=function(e,t){return qr(e,t)},An.sortedIndexBy=function(e,t,n){return Yr(e,t,Zi(n,2))},An.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=qr(e,t);if(r<n&&Aa(e[r],t))return r}return-1},An.sortedLastIndex=function(e,t){return qr(e,t,!0)},An.sortedLastIndexBy=function(e,t,n){return Yr(e,t,Zi(n,2),!0)},An.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=qr(e,t,!0)-1;if(Aa(e[n],t))return n}return-1},An.startCase=Ds,An.startsWith=function(e,t,n){return e=as(e),n=null==n?0:Zn(ns(n),0,e.length),t=$r(t),e.slice(n,n+t.length)==t},An.subtract=dl,An.sum=function(e){return e&&e.length?Tt(e,Ws):0},An.sumBy=function(e,t){return e&&e.length?Tt(e,Zi(t,2)):0},An.template=function(e,t,n){var r=An.templateSettings;n&&ao(e,t,n)&&(t=void 0),e=as(e),t=us({},t,r,Bi);var i,o,a=us({},t.imports,r.imports,Bi),s=_s(a),l=At(a,s),u=0,c=t.interpolate||ue,h="__p += '",d=ge((t.escape||ue).source+"|"+c.source+"|"+(c===V?te:ue).source+"|"+(t.evaluate||ue).source+"|$","g"),f="//# sourceURL="+(Te.call(t,"sourceURL")?(t.sourceURL+"").replace(/[\r\n]/g," "):"lodash.templateSources["+ ++De+"]")+"\n";e.replace(d,(function(t,n,r,a,s,l){return r||(r=a),h+=e.slice(u,l).replace(ce,Ot),n&&(i=!0,h+="' +\n__e("+n+") +\n'"),s&&(o=!0,h+="';\n"+s+";\n__p += '"),r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+t.length,t})),h+="';\n";var p=Te.call(t,"variable")&&t.variable;p||(h="with (obj) {\n"+h+"\n}\n"),h=(o?h.replace(L,""):h).replace(N,"$1").replace(I,"$1;"),h="function("+(p||"obj")+") {\n"+(p?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var m=Us((function(){return pe(s,f+"return "+h).apply(void 0,l)}));if(m.source=h,Fa(m))throw m;return m},An.times=function(e,t){if((e=ns(e))<1||e>9007199254740991)return[];var n=4294967295,r=sn(e,4294967295);e-=4294967295;for(var i=Mt(r,t=Zi(t));++n<e;)t(n);return i},An.toFinite=ts,An.toInteger=ns,An.toLength=rs,An.toLower=function(e){return as(e).toLowerCase()},An.toNumber=is,An.toSafeInteger=function(e){return e?Zn(ns(e),-9007199254740991,9007199254740991):0===e?e:0},An.toString=as,An.toUpper=function(e){return as(e).toUpperCase()},An.trim=function(e,t,n){if((e=as(e))&&(n||void 0===t))return e.replace(Y,"");if(!e||!(t=$r(t)))return e;var r=Gt(e),i=Gt(t);return li(r,Pt(r,i),kt(r,i)+1).join("")},An.trimEnd=function(e,t,n){if((e=as(e))&&(n||void 0===t))return e.replace(Z,"");if(!e||!(t=$r(t)))return e;var r=Gt(e);return li(r,0,kt(r,Gt(t))+1).join("")},An.trimStart=function(e,t,n){if((e=as(e))&&(n||void 0===t))return e.replace(X,"");if(!e||!(t=$r(t)))return e;var r=Gt(e);return li(r,Pt(r,Gt(t))).join("")},An.truncate=function(e,t){var n=30,r="...";if(Ga(t)){var i="separator"in t?t.separator:i;n="length"in t?ns(t.length):n,r="omission"in t?$r(t.omission):r}var o=(e=as(e)).length;if(Dt(e)){var a=Gt(e);o=a.length}if(n>=o)return e;var s=n-Vt(r);if(s<1)return r;var l=a?li(a,0,s).join(""):e.slice(0,s);if(void 0===i)return l+r;if(a&&(s+=l.length-s),Ya(i)){if(e.slice(s).search(i)){var u,c=l;for(i.global||(i=ge(i.source,as(ne.exec(i))+"g")),i.lastIndex=0;u=i.exec(c);)var h=u.index;l=l.slice(0,void 0===h?s:h)}}else if(e.indexOf($r(i),s)!=s){var d=l.lastIndexOf(i);d>-1&&(l=l.slice(0,d))}return l+r},An.unescape=function(e){return(e=as(e))&&z.test(e)?e.replace(O,jt):e},An.uniqueId=function(e){var t=++Me;return as(e)+t},An.upperCase=zs,An.upperFirst=Fs,An.each=aa,An.eachRight=sa,An.first=Io,Zs(An,(ol={},lr(An,(function(e,t){Te.call(An.prototype,t)||(ol[t]=e)})),ol),{chain:!1}),An.VERSION="4.17.15",it(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){An[e].placeholder=An})),it(["drop","take"],(function(e,t){Ln.prototype[e]=function(n){n=void 0===n?1:an(ns(n),0);var r=this.__filtered__&&!t?new Ln(this):this.clone();return r.__filtered__?r.__takeCount__=sn(n,r.__takeCount__):r.__views__.push({size:sn(n,4294967295),type:e+(r.__dir__<0?"Right":"")}),r},Ln.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),it(["filter","map","takeWhile"],(function(e,t){var n=t+1,r=1==n||3==n;Ln.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Zi(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}})),it(["head","last"],(function(e,t){var n="take"+(t?"Right":"");Ln.prototype[e]=function(){return this[n](1).value()[0]}})),it(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");Ln.prototype[e]=function(){return this.__filtered__?new Ln(this):this[n](1)}})),Ln.prototype.compact=function(){return this.filter(Ws)},Ln.prototype.find=function(e){return this.filter(e).head()},Ln.prototype.findLast=function(e){return this.reverse().find(e)},Ln.prototype.invokeMap=zr((function(e,t){return"function"==typeof e?new Ln(this):this.map((function(n){return yr(n,e,t)}))})),Ln.prototype.reject=function(e){return this.filter(Sa(Zi(e)))},Ln.prototype.slice=function(e,t){e=ns(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Ln(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),void 0!==t&&(n=(t=ns(t))<0?n.dropRight(-t):n.take(t-e)),n)},Ln.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Ln.prototype.toArray=function(){return this.take(4294967295)},lr(Ln.prototype,(function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),i=An[r?"take"+("last"==t?"Right":""):t],o=r||/^find/.test(t);i&&(An.prototype[t]=function(){var t=this.__wrapped__,a=r?[1]:arguments,s=t instanceof Ln,l=a[0],u=s||La(t),c=function(e){var t=i.apply(An,ht([e],a));return r&&h?t[0]:t};u&&n&&"function"==typeof l&&1!=l.length&&(s=u=!1);var h=this.__chain__,d=!!this.__actions__.length,f=o&&!h,p=s&&!d;if(!o&&u){t=p?t:new Ln(this);var m=e.apply(t,a);return m.__actions__.push({func:ta,args:[c],thisArg:void 0}),new kn(m,h)}return f&&p?e.apply(this,a):(m=this.thru(c),f?r?m.value()[0]:m.value():m)})})),it(["pop","push","shift","sort","splice","unshift"],(function(e){var t=xe[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);An.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(La(i)?i:[],e)}return this[n]((function(n){return t.apply(La(n)?n:[],e)}))}})),lr(Ln.prototype,(function(e,t){var n=An[t];if(n){var r=n.name+"";Te.call(_n,r)||(_n[r]=[]),_n[r].push({name:t,func:n})}})),_n[Ci(void 0,2).name]=[{name:"wrapper",func:void 0}],Ln.prototype.clone=function(){var e=new Ln(this.__wrapped__);return e.__actions__=vi(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=vi(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=vi(this.__views__),e},Ln.prototype.reverse=function(){if(this.__filtered__){var e=new Ln(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Ln.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=La(e),r=t<0,i=n?e.length:0,o=function(e,t,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=sn(t,e+a);break;case"takeRight":e=an(e,t-a)}}return{start:e,end:t}}(0,i,this.__views__),a=o.start,s=o.end,l=s-a,u=r?s:a-1,c=this.__iteratees__,h=c.length,d=0,f=sn(l,this.__takeCount__);if(!n||!r&&i==l&&f==l)return ti(e,this.__actions__);var p=[];e:for(;l--&&d<f;){for(var m=-1,v=e[u+=t];++m<h;){var g=c[m],y=g.iteratee,_=g.type,x=y(v);if(2==_)v=x;else if(!x){if(1==_)continue e;break e}}p[d++]=v}return p},An.prototype.at=na,An.prototype.chain=function(){return ea(this)},An.prototype.commit=function(){return new kn(this.value(),this.__chain__)},An.prototype.next=function(){void 0===this.__values__&&(this.__values__=es(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?void 0:this.__values__[this.__index__++]}},An.prototype.plant=function(e){for(var t,n=this;n instanceof Pn;){var r=Co(n);r.__index__=0,r.__values__=void 0,t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}return i.__wrapped__=e,t},An.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Ln){var t=e;return this.__actions__.length&&(t=new Ln(this)),(t=t.reverse()).__actions__.push({func:ta,args:[Go],thisArg:void 0}),new kn(t,this.__chain__)}return this.thru(Go)},An.prototype.toJSON=An.prototype.valueOf=An.prototype.value=function(){return ti(this.__wrapped__,this.__actions__)},An.prototype.first=An.prototype.head,qt&&(An.prototype[qt]=function(){return this}),An}();qe?((qe.exports=Ht)._=Ht,We._=Ht):He._=Ht}).call(i)})),l=o((function(e){function t(r){return"function"==typeof Symbol&&"symbol"==n(Symbol.iterator)?e.exports=t=function(e){return n(e)}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},t(r)}e.exports=t})),u=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},c=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},h=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},d=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?c(e):t},f=o((function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(n)}e.exports=t})),p=o((function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(n,r)}e.exports=t})),m=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)};function v(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}),Object.assign(v.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}}}});for(var g=[],y=0;y<256;y++)g[y]=(y<16?"0":"")+y.toString(16);var _={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(g[255&e]+g[e>>8&255]+g[e>>16&255]+g[e>>24&255]+"-"+g[255&t]+g[t>>8&255]+"-"+g[t>>16&15|64]+g[t>>24&255]+"-"+g[63&n|128]+g[n>>8&255]+"-"+g[n>>16&255]+g[n>>24&255]+g[255&r]+g[r>>8&255]+g[r>>16&255]+g[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*_.DEG2RAD},radToDeg:function(e){return e*_.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function x(e,t){this.x=e||0,this.y=t||0}function b(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1}Object.defineProperties(x.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(x.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}}),Object.assign(b,{slerp:function(e,t,n,r){return n.copy(e).slerp(t,r)},slerpFlat:function(e,t,n,r,i,o,a){var s=n[r+0],l=n[r+1],u=n[r+2],c=n[r+3],h=i[o+0],d=i[o+1],f=i[o+2],p=i[o+3];if(c!==p||s!==h||l!==d||u!==f){var m=1-a,v=s*h+l*d+u*f+c*p,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var _=Math.sqrt(y),x=Math.atan2(_,v*g);m=Math.sin(m*x)/_,a=Math.sin(a*x)/_}var b=a*g;if(s=s*m+h*b,l=l*m+d*b,u=u*m+f*b,c=c*m+p*b,m===1-a){var w=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=w,l*=w,u*=w,c*=w}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}}),Object.defineProperties(b.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(b.prototype,{isQuaternion:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(n/2),u=a(r/2),c=a(i/2),h=s(n/2),d=s(r/2),f=s(i/2);return"XYZ"===o?(this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f):"YXZ"===o?(this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f):"ZXY"===o?(this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f):"ZYX"===o?(this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f):"YZX"===o?(this._x=h*u*c+l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c-h*d*f):"XZY"===o&&(this._x=h*u*c-l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c+h*d*f),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,r=n[0],i=n[4],o=n[8],a=n[1],s=n[5],l=n[9],u=n[2],c=n[6],h=n[10],d=r+s+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(a-i)*t):r>s&&r>h?(t=2*Math.sqrt(1+r-s-h),this._w=(c-l)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(o+u)/t):s>h?(t=2*Math.sqrt(1+s-r-h),this._w=(o-u)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-r-s),this._w=(a-i)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(_.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,o=e._w,a=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+o*a+r*l-i*s,this._y=r*u+o*s+i*a-n*l,this._z=i*u+o*l+n*s-r*a,this._w=o*u-n*a-r*s-i*l,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*e._w+n*e._x+r*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-t;return this._w=l*o+t*this._w,this._x=l*n+t*this._x,this._y=l*r+t*this._y,this._z=l*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),c=Math.atan2(u,a),h=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=o*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=i*h+this._z*d,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var w=new E,S=new b;function E(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}Object.assign(E.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(S.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(S.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*n,u=s*n+a*t-i*r,c=s*r+i*n-o*t,h=-i*t-o*n-a*r;return this.x=l*s+h*-i+u*-a-c*-o,this.y=u*s+h*-o+c*-i-l*-a,this.z=c*s+h*-a+l*-o-u*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(e){return w.copy(this).projectOnVector(e),this.sub(w)},reflect:function(e){return this.sub(w.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());0===t&&console.error("THREE.Vector3: angleTo() can't handle zero length vectors.");var n=this.dot(e)/t;return Math.acos(_.clamp(n,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var T,M=new E;function C(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(C.prototype,{isMatrix3:!0,set:function(e,t,n,r,i,o,a,s,l){var u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=i,u[5]=s,u[6]=n,u[7]=o,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(e){for(var t=0,n=e.count;t<n;t++)M.x=e.getX(t),M.y=e.getY(t),M.z=e.getZ(t),M.applyMatrix3(this),e.setXYZ(t,M.x,M.y,M.z);return e},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],u=n[4],c=n[7],h=n[2],d=n[5],f=n[8],p=r[0],m=r[3],v=r[6],g=r[1],y=r[4],_=r[7],x=r[2],b=r[5],w=r[8];return i[0]=o*p+a*g+s*x,i[3]=o*m+a*y+s*b,i[6]=o*v+a*_+s*w,i[1]=l*p+u*g+c*x,i[4]=l*m+u*y+c*b,i[7]=l*v+u*_+c*w,i[2]=h*p+d*g+f*x,i[5]=h*m+d*y+f*b,i[8]=h*v+d*_+f*w,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-n*i*u+n*a*s+r*i*l-r*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,r=this.elements,i=n[0],o=n[1],a=n[2],s=n[3],l=n[4],u=n[5],c=n[6],h=n[7],d=n[8],f=d*l-u*h,p=u*c-d*s,m=h*s-l*c,v=i*f+o*p+a*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return r[0]=f*y,r[1]=(a*h-d*o)*y,r[2]=(u*o-a*l)*y,r[3]=p*y,r[4]=(d*i-a*c)*y,r[5]=(a*s-u*i)*y,r[6]=m*y,r[7]=(o*c-h*i)*y,r[8]=(l*i-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,r,i,o,a){var s=Math.cos(i),l=Math.sin(i);this.set(n*s,n*l,-n*(s*o+l*a)+o+e,-r*l,r*s,-r*(-l*o+s*a)+a+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],l=r[4],u=r[7];return r[0]=t*i+n*s,r[3]=t*o+n*l,r[6]=t*a+n*u,r[1]=-n*i+t*s,r[4]=-n*o+t*l,r[7]=-n*a+t*u,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var A={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===T&&(T=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),T.width=e.width,T.height=e.height;var n=T.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=T}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},R=0;function P(e,t,n,r,i,o,a,s,l,u){Object.defineProperty(this,"id",{value:R++}),this.uuid=_.generateUUID(),this.name="",this.image=void 0!==e?e:P.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:P.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:1001,this.wrapT=void 0!==r?r:1001,this.magFilter=void 0!==i?i:1006,this.minFilter=void 0!==o?o:1008,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:1023,this.internalFormat=null,this.type=void 0!==s?s:1009,this.offset=new x(0,0),this.repeat=new x(1,1),this.center=new x(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new C,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:3e3,this.version=0,this.onUpdate=null}function k(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1}function L(e,t,n){this.width=e,this.height=t,this.scissor=new k(0,0,e,t),this.scissorTest=!1,this.viewport=new k(0,0,e,t),n=n||{},this.texture=new P(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function N(e,t,n){L.call(this,e,t,n),this.samples=4}P.DEFAULT_IMAGE=void 0,P.DEFAULT_MAPPING=300,P.prototype=Object.assign(Object.create(v.prototype),{constructor:P,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=_.generateUUID()),!t&&void 0===e.images[r.uuid]){var i;if(Array.isArray(r)){i=[];for(var o=0,a=r.length;o<a;o++)i.push(A.getDataURL(r[o]))}else i=A.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(P.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(k.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(k.prototype,{isVector4:!0,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,o=e.elements,a=o[0],s=o[4],l=o[8],u=o[1],c=o[5],h=o[9],d=o[2],f=o[6],p=o[10];if(Math.abs(s-u)<.01&&Math.abs(l-d)<.01&&Math.abs(h-f)<.01){if(Math.abs(s+u)<.1&&Math.abs(l+d)<.1&&Math.abs(h+f)<.1&&Math.abs(a+c+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,v=(c+1)/2,g=(p+1)/2,y=(s+u)/4,_=(l+d)/4,x=(h+f)/4;return m>v&&m>g?m<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(m)),i=_/n):v>g?v<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(v)),i=x/r):g<.01?(n=.707106781,r=.707106781,i=0):(n=_/(i=Math.sqrt(g)),r=x/i),this.set(n,r,i,t),this}var b=Math.sqrt((f-h)*(f-h)+(l-d)*(l-d)+(u-s)*(u-s));return Math.abs(b)<.001&&(b=1),this.x=(f-h)/b,this.y=(l-d)/b,this.z=(u-s)/b,this.w=Math.acos((a+c+p-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),L.prototype=Object.assign(Object.create(v.prototype),{constructor:L,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),N.prototype=Object.assign(Object.create(L.prototype),{constructor:N,isWebGLMultisampleRenderTarget:!0,copy:function(e){return L.prototype.copy.call(this,e),this.samples=e.samples,this}});var I=new E,O=new V,D=new E(0,0,0),z=new E(1,1,1),F=new E,B=new E,U=new E;function V(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(V.prototype,{isMatrix4:!0,set:function(e,t,n,r,i,o,a,s,l,u,c,h,d,f,p,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=l,v[6]=u,v[10]=c,v[14]=h,v[3]=d,v[7]=f,v[11]=p,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new V).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,n=e.elements,r=1/I.setFromMatrixColumn(e,0).length(),i=1/I.setFromMatrixColumn(e,1).length(),o=1/I.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),l=Math.sin(r),u=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){var h=o*u,d=o*c,f=a*u,p=a*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=d+f*l,t[5]=h-p*l,t[9]=-a*s,t[2]=p-h*l,t[6]=f+d*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*u,v=s*c,g=l*u,y=l*c;t[0]=m+y*a,t[4]=g*a-v,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-a,t[2]=v*a-g,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order)m=s*u,v=s*c,g=l*u,y=l*c,t[0]=m-y*a,t[4]=-o*c,t[8]=g+v*a,t[1]=v+g*a,t[5]=o*u,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s;else if("ZYX"===e.order)h=o*u,d=o*c,f=a*u,p=a*c,t[0]=s*u,t[4]=f*l-d,t[8]=h*l+p,t[1]=s*c,t[5]=p*l+h,t[9]=d*l-f,t[2]=-l,t[6]=a*s,t[10]=o*s;else if("YZX"===e.order){var _=o*s,x=o*l,b=a*s,w=a*l;t[0]=s*u,t[4]=w-_*c,t[8]=b*c+x,t[1]=c,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=x*c+b,t[10]=_-w*c}else"XZY"===e.order&&(_=o*s,x=o*l,b=a*s,w=a*l,t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=_*c+w,t[5]=o*u,t[9]=x*c-b,t[2]=b*c-x,t[6]=a*u,t[10]=w*c+_);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(D,e,z)},lookAt:function(e,t,n){var r=this.elements;return U.subVectors(e,t),0===U.lengthSq()&&(U.z=1),U.normalize(),F.crossVectors(n,U),0===F.lengthSq()&&(1===Math.abs(n.z)?U.x+=1e-4:U.z+=1e-4,U.normalize(),F.crossVectors(n,U)),F.normalize(),B.crossVectors(U,F),r[0]=F.x,r[4]=B.x,r[8]=U.x,r[1]=F.y,r[5]=B.y,r[9]=U.y,r[2]=F.z,r[6]=B.z,r[10]=U.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],d=n[13],f=n[2],p=n[6],m=n[10],v=n[14],g=n[3],y=n[7],_=n[11],x=n[15],b=r[0],w=r[4],S=r[8],E=r[12],T=r[1],M=r[5],C=r[9],A=r[13],R=r[2],P=r[6],k=r[10],L=r[14],N=r[3],I=r[7],O=r[11],D=r[15];return i[0]=o*b+a*T+s*R+l*N,i[4]=o*w+a*M+s*P+l*I,i[8]=o*S+a*C+s*k+l*O,i[12]=o*E+a*A+s*L+l*D,i[1]=u*b+c*T+h*R+d*N,i[5]=u*w+c*M+h*P+d*I,i[9]=u*S+c*C+h*k+d*O,i[13]=u*E+c*A+h*L+d*D,i[2]=f*b+p*T+m*R+v*N,i[6]=f*w+p*M+m*P+v*I,i[10]=f*S+p*C+m*k+v*O,i[14]=f*E+p*A+m*L+v*D,i[3]=g*b+y*T+_*R+x*N,i[7]=g*w+y*M+_*P+x*I,i[11]=g*S+y*C+_*k+x*O,i[15]=g*E+y*A+_*L+x*D,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(e){for(var t=0,n=e.count;t<n;t++)I.x=e.getX(t),I.y=e.getY(t),I.z=e.getZ(t),I.applyMatrix4(this),e.setXYZ(t,I.x,I.y,I.z);return e},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],a=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+i*s*c-r*l*c-i*a*h+n*l*h+r*a*d-n*s*d)+e[7]*(+t*s*d-t*l*h+i*o*h-r*o*d+r*l*u-i*s*u)+e[11]*(+t*l*c-t*a*d-i*o*c+n*o*d+i*a*u-n*l*u)+e[15]*(-r*a*u-t*s*c+t*a*h+r*o*c-n*o*h+n*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],o=r[1],a=r[2],s=r[3],l=r[4],u=r[5],c=r[6],h=r[7],d=r[8],f=r[9],p=r[10],m=r[11],v=r[12],g=r[13],y=r[14],_=r[15],x=f*y*h-g*p*h+g*c*m-u*y*m-f*c*_+u*p*_,b=v*p*h-d*y*h-v*c*m+l*y*m+d*c*_-l*p*_,w=d*g*h-v*f*h+v*u*m-l*g*m-d*u*_+l*f*_,S=v*f*c-d*g*c-v*u*p+l*g*p+d*u*y-l*f*y,E=i*x+o*b+a*w+s*S;if(0===E){var T="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(T);return console.warn(T),this.identity()}var M=1/E;return n[0]=x*M,n[1]=(g*p*s-f*y*s-g*a*m+o*y*m+f*a*_-o*p*_)*M,n[2]=(u*y*s-g*c*s+g*a*h-o*y*h-u*a*_+o*c*_)*M,n[3]=(f*c*s-u*p*s-f*a*h+o*p*h+u*a*m-o*c*m)*M,n[4]=b*M,n[5]=(d*y*s-v*p*s+v*a*m-i*y*m-d*a*_+i*p*_)*M,n[6]=(v*c*s-l*y*s-v*a*h+i*y*h+l*a*_-i*c*_)*M,n[7]=(l*p*s-d*c*s+d*a*h-i*p*h-l*a*m+i*c*m)*M,n[8]=w*M,n[9]=(v*f*s-d*g*s-v*o*m+i*g*m+d*o*_-i*f*_)*M,n[10]=(l*g*s-v*u*s+v*o*h-i*g*h-l*o*_+i*u*_)*M,n[11]=(d*u*s-l*f*s-d*o*h+i*f*h+l*o*m-i*u*m)*M,n[12]=S*M,n[13]=(d*g*a-v*f*a+v*o*p-i*g*p-d*o*y+i*f*y)*M,n[14]=(v*u*a-l*g*a-v*o*c+i*g*c+l*o*y-i*u*y)*M,n[15]=(l*f*a-d*u*a+d*o*c-i*f*c-l*o*p+i*u*p)*M,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,a=e.y,s=e.z,l=i*o,u=i*a;return this.set(l*o+n,l*a-r*s,l*s+r*a,0,l*a+r*s,u*a+n,u*s-r*o,0,l*s-r*a,u*s+r*o,i*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var r=this.elements,i=t._x,o=t._y,a=t._z,s=t._w,l=i+i,u=o+o,c=a+a,h=i*l,d=i*u,f=i*c,p=o*u,m=o*c,v=a*c,g=s*l,y=s*u,_=s*c,x=n.x,b=n.y,w=n.z;return r[0]=(1-(p+v))*x,r[1]=(d+_)*x,r[2]=(f-y)*x,r[3]=0,r[4]=(d-_)*b,r[5]=(1-(h+v))*b,r[6]=(m+g)*b,r[7]=0,r[8]=(f+y)*w,r[9]=(m-g)*w,r[10]=(1-(h+p))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:function(e,t,n){var r=this.elements,i=I.set(r[0],r[1],r[2]).length(),o=I.set(r[4],r[5],r[6]).length(),a=I.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],O.copy(this);var s=1/i,l=1/o,u=1/a;return O.elements[0]*=s,O.elements[1]*=s,O.elements[2]*=s,O.elements[4]*=l,O.elements[5]*=l,O.elements[6]*=l,O.elements[8]*=u,O.elements[9]*=u,O.elements[10]*=u,t.setFromRotationMatrix(O),n.x=i,n.y=o,n.z=a,this},makePerspective:function(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(t-e),l=2*i/(n-r),u=(t+e)/(t-e),c=(n+r)/(n-r),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,n,r,i,o){var a=this.elements,s=1/(t-e),l=1/(n-r),u=1/(o-i),c=(t+e)*s,h=(n+r)*l,d=(o+i)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});var G=new V,j=new b;function H(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||H.DefaultOrder}function W(){this.mask=1}H.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],H.DefaultOrder="XYZ",Object.defineProperties(H.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(H.prototype,{isEuler:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=_.clamp,i=e.elements,o=i[0],a=i[4],s=i[8],l=i[1],u=i[5],c=i[9],h=i[2],d=i[6],f=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,f),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,u))):"YZX"===t?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===t?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,n){return G.makeRotationFromQuaternion(e),this.setFromRotationMatrix(G,t,n)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return j.setFromEuler(this),this.setFromQuaternion(j,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new E(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(W.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!=(this.mask&e.mask)}});var q=0,Y=new E,X=new b,Z=new V,$=new E,K=new E,J=new E,Q=new b,ee=new E(1,0,0),te=new E(0,1,0),ne=new E(0,0,1),re={type:"added"},ie={type:"removed"};function oe(){Object.defineProperty(this,"id",{value:q++}),this.uuid=_.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=oe.DefaultUp.clone();var e=new E,t=new H,n=new b,r=new E(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new V},normalMatrix:{value:new C}}),this.matrix=new V,this.matrixWorld=new V,this.matrixAutoUpdate=oe.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new W,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function ae(){oe.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}oe.DefaultUp=new E(0,1,0),oe.DefaultMatrixAutoUpdate=!0,oe.prototype=Object.assign(Object.create(v.prototype),{constructor:oe,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return X.setFromAxisAngle(e,t),this.quaternion.multiply(X),this},rotateOnWorldAxis:function(e,t){return X.setFromAxisAngle(e,t),this.quaternion.premultiply(X),this},rotateX:function(e){return this.rotateOnAxis(ee,e)},rotateY:function(e){return this.rotateOnAxis(te,e)},rotateZ:function(e){return this.rotateOnAxis(ne,e)},translateOnAxis:function(e,t){return Y.copy(e).applyQuaternion(this.quaternion),this.position.add(Y.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(ee,e)},translateY:function(e){return this.translateOnAxis(te,e)},translateZ:function(e){return this.translateOnAxis(ne,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(Z.getInverse(this.matrixWorld))},lookAt:function(e,t,n){e.isVector3?$.copy(e):$.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),K.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Z.lookAt(K,$,this.up):Z.lookAt($,K,this.up),this.quaternion.setFromRotationMatrix(Z),r&&(Z.extractRotation(r.matrixWorld),X.setFromRotationMatrix(Z),this.quaternion.premultiply(X.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(re)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(ie)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),Z.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Z.multiply(e.parent.matrixWorld)),e.applyMatrix(Z),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new E),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new b),this.updateMatrixWorld(!0),this.matrixWorld.decompose(K,e,J),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new E),this.updateMatrixWorld(!0),this.matrixWorld.decompose(K,Q,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new E),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,o=r.length;i<o;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++){var u=a[s];i(e.shapes,u)}else i(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(s=0,l=this.material.length;s<l;s++)c.push(i(e.materials,this.material[s]));r.material=c}else r.material=i(e.materials,this.material);if(this.children.length>0)for(r.children=[],s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(e).object);if(t){var h=m(e.geometries),d=m(e.materials),f=m(e.textures),p=m(e.images);a=m(e.shapes),h.length>0&&(n.geometries=h),d.length>0&&(n.materials=d),f.length>0&&(n.textures=f),p.length>0&&(n.images=p),a.length>0&&(n.shapes=a)}return n.object=r,n;function m(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}),ae.prototype=Object.assign(Object.create(oe.prototype),{constructor:ae,isScene:!0,copy:function(e,t){return oe.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=oe.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var se=[new E,new E,new E,new E,new E,new E,new E,new E],le=new E,ue=new xe,ce=new E,he=new E,de=new E,fe=new E,pe=new E,me=new E,ve=new E,ge=new E,ye=new E,_e=new E;function xe(e,t){this.min=void 0!==e?e:new E(1/0,1/0,1/0),this.max=void 0!==t?t:new E(-1/0,-1/0,-1/0)}function be(e,t,n,r,i){var o,a;for(o=0,a=e.length-3;o<=a;o+=3){_e.fromArray(e,o);var s=i.x*Math.abs(_e.x)+i.y*Math.abs(_e.y)+i.z*Math.abs(_e.z),l=t.dot(_e),u=n.dot(_e),c=r.dot(_e);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>s)return!1}return!0}Object.assign(xe.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],h=e[s+2];u<t&&(t=u),c<n&&(n=c),h<r&&(r=h),u>i&&(i=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,n,r),this.max.set(i,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),h=e.getZ(s);u<t&&(t=u),c<n&&(n=c),h<r&&(r=h),u>i&&(i=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,n,r),this.max.set(i,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=le.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new E),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new E),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),ue.copy(t.boundingBox),ue.applyMatrix4(e.matrixWorld),this.expandByPoint(ue.min),this.expandByPoint(ue.max));for(var n=e.children,r=0,i=n.length;r<i;r++)this.expandByObject(n[r]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new E),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,le),le.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(ve),ge.subVectors(this.max,ve),ce.subVectors(e.a,ve),he.subVectors(e.b,ve),de.subVectors(e.c,ve),fe.subVectors(he,ce),pe.subVectors(de,he),me.subVectors(ce,de);var t=[0,-fe.z,fe.y,0,-pe.z,pe.y,0,-me.z,me.y,fe.z,0,-fe.x,pe.z,0,-pe.x,me.z,0,-me.x,-fe.y,fe.x,0,-pe.y,pe.x,0,-me.y,me.x,0];return!!be(t,ce,he,de,ge)&&!!be(t=[1,0,0,0,1,0,0,0,1],ce,he,de,ge)&&(ye.crossVectors(fe,pe),be(t=[ye.x,ye.y,ye.z],ce,he,de,ge))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new E),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return le.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(le).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(se[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),se[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),se[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),se[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),se[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),se[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),se[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),se[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(se)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var we=new xe;function Se(e,t){this.center=void 0!==e?e:new E,this.radius=void 0!==t?t:0}Object.assign(Se.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var n=this.center;void 0!==t?n.copy(t):we.setFromPoints(e).getCenter(n);for(var r=0,i=0,o=e.length;i<o;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new E),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new xe),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var Ee=new E,Te=new E,Me=new E,Ce=new E,Ae=new E,Re=new E,Pe=new E;function ke(e,t){this.origin=void 0!==e?e:new E,this.direction=void 0!==t?t:new E(0,0,-1)}Object.assign(ke.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new E),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,Ee)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new E),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=Ee.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ee.copy(this.direction).multiplyScalar(t).add(this.origin),Ee.distanceToSquared(e))},distanceSqToSegment:function(e,t,n,r){Te.copy(e).add(t).multiplyScalar(.5),Me.copy(t).sub(e).normalize(),Ce.copy(this.origin).sub(Te);var i,o,a,s,l=.5*e.distanceTo(t),u=-this.direction.dot(Me),c=Ce.dot(this.direction),h=-Ce.dot(Me),d=Ce.lengthSq(),f=Math.abs(1-u*u);if(f>0)if(o=u*c-h,s=l*f,(i=u*h-c)>=0)if(o>=-s)if(o<=s){var p=1/f;a=(i*=p)*(i+u*(o*=p)+2*c)+o*(u*i+o+2*h)+d}else o=l,a=-(i=Math.max(0,-(u*o+c)))*i+o*(o+2*h)+d;else o=-l,a=-(i=Math.max(0,-(u*o+c)))*i+o*(o+2*h)+d;else o<=-s?a=-(i=Math.max(0,-(-u*l+c)))*i+(o=i>0?-l:Math.min(Math.max(-l,-h),l))*(o+2*h)+d:o<=s?(i=0,a=(o=Math.min(Math.max(-l,-h),l))*(o+2*h)+d):a=-(i=Math.max(0,-(u*l+c)))*i+(o=i>0?l:Math.min(Math.max(-l,-h),l))*(o+2*h)+d;else o=u>0?-l:l,a=-(i=Math.max(0,-(u*o+c)))*i+o*(o+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(Me).multiplyScalar(o).add(Te),a},intersectSphere:function(e,t){Ee.subVectors(e.center,this.origin);var n=Ee.dot(this.direction),r=Ee.dot(Ee)-n*n,i=e.radius*e.radius;if(r>i)return null;var o=Math.sqrt(i-r),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var n,r,i,o,a,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),u>=0?(i=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(i=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),c>=0?(a=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(a=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,Ee)},intersectTriangle:function(e,t,n,r,i){Ae.subVectors(t,e),Re.subVectors(n,e),Pe.crossVectors(Ae,Re);var o,a=this.direction.dot(Pe);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Ce.subVectors(this.origin,e);var s=o*this.direction.dot(Re.crossVectors(Ce,Re));if(s<0)return null;var l=o*this.direction.dot(Ae.cross(Ce));if(l<0)return null;if(s+l>a)return null;var u=-o*Ce.dot(Pe);return u<0?null:this.at(u/a,i)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var Le=new E,Ne=new E,Ie=new C;function Oe(e,t){this.normal=void 0!==e?e:new E(1,0,0),this.constant=void 0!==t?t:0}Object.assign(Oe.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,n){var r=Le.subVectors(n,t).cross(Ne.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new E),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new E);var n=e.delta(Le),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:t.copy(n).multiplyScalar(i).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new E),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var n=t||Ie.getNormalMatrix(e),r=this.coplanarPoint(Le).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var De=new E,ze=new E,Fe=new E,Be=new E,Ue=new E,Ve=new E,Ge=new E,je=new E,He=new E,We=new E;function qe(e,t,n){this.a=void 0!==e?e:new E,this.b=void 0!==t?t:new E,this.c=void 0!==n?n:new E}Object.assign(qe,{getNormal:function(e,t,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new E),r.subVectors(n,t),De.subVectors(e,t),r.cross(De);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)},getBarycoord:function(e,t,n,r,i){De.subVectors(r,t),ze.subVectors(n,t),Fe.subVectors(e,t);var o=De.dot(De),a=De.dot(ze),s=De.dot(Fe),l=ze.dot(ze),u=ze.dot(Fe),c=o*l-a*a;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new E),0===c)return i.set(-2,-1,-1);var h=1/c,d=(l*s-a*u)*h,f=(o*u-a*s)*h;return i.set(1-d-f,f,d)},containsPoint:function(e,t,n,r){return qe.getBarycoord(e,t,n,r,Be),Be.x>=0&&Be.y>=0&&Be.x+Be.y<=1},getUV:function(e,t,n,r,i,o,a,s){return this.getBarycoord(e,t,n,r,Be),s.set(0,0),s.addScaledVector(i,Be.x),s.addScaledVector(o,Be.y),s.addScaledVector(a,Be.z),s},isFrontFacing:function(e,t,n,r){return De.subVectors(n,t),ze.subVectors(e,t),De.cross(ze).dot(r)<0}}),Object.assign(qe.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return De.subVectors(this.c,this.b),ze.subVectors(this.a,this.b),.5*De.cross(ze).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new E),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return qe.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Oe),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return qe.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,r,i){return qe.getUV(e,this.a,this.b,this.c,t,n,r,i)},containsPoint:function(e){return qe.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return qe.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new E);var n,r,i=this.a,o=this.b,a=this.c;Ue.subVectors(o,i),Ve.subVectors(a,i),je.subVectors(e,i);var s=Ue.dot(je),l=Ve.dot(je);if(s<=0&&l<=0)return t.copy(i);He.subVectors(e,o);var u=Ue.dot(He),c=Ve.dot(He);if(u>=0&&c<=u)return t.copy(o);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return n=s/(s-u),t.copy(i).addScaledVector(Ue,n);We.subVectors(e,a);var d=Ue.dot(We),f=Ve.dot(We);if(f>=0&&d<=f)return t.copy(a);var p=d*l-s*f;if(p<=0&&l>=0&&f<=0)return r=l/(l-f),t.copy(i).addScaledVector(Ve,r);var m=u*f-d*c;if(m<=0&&c-u>=0&&d-f>=0)return Ge.subVectors(a,o),r=(c-u)/(c-u+(d-f)),t.copy(o).addScaledVector(Ge,r);var v=1/(m+p+h);return n=p*v,r=h*v,t.copy(i).addScaledVector(Ue,n).addScaledVector(Ve,r)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var Ye={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xe={h:0,s:0,l:0},Ze={h:0,s:0,l:0};function $e(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}function Ke(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Je(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Qe(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function et(e,t,n,r,i,o){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new E,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new $e,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}Object.assign($e.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(e=_.euclideanModulo(e,1),t=_.clamp(t,0,1),n=_.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Ke(i,r,e+1/3),this.g=Ke(i,r,e),this.b=Ke(i,r,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(a,s,l)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var u=n[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=Ye[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=Je(e.r),this.g=Je(e.g),this.b=Je(e.b),this},copyLinearToSRGB:function(e){return this.r=Qe(e.r),this.g=Qe(e.g),this.b=Qe(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,r=this.r,i=this.g,o=this.b,a=Math.max(r,i,o),s=Math.min(r,i,o),l=(s+a)/2;if(s===a)t=0,n=0;else{var u=a-s;switch(n=l<=.5?u/(a+s):u/(2-a-s),a){case r:t=(i-o)/u+(i<o?6:0);break;case i:t=(o-r)/u+2;break;case o:t=(r-i)/u+4}t/=6}return e.h=t,e.s=n,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){return this.getHSL(Xe),Xe.h+=e,Xe.s+=t,Xe.l+=n,this.setHSL(Xe.h,Xe.s,Xe.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(Xe),e.getHSL(Ze);var n=_.lerp(Xe.h,Ze.h,t),r=_.lerp(Xe.s,Ze.s,t),i=_.lerp(Xe.l,Ze.l,t);return this.setHSL(n,r,i),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),$e.NAMES=Ye,Object.assign(et.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var tt=0;function nt(){Object.defineProperty(this,"id",{value:tt++}),this.uuid=_.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function rt(e){nt.call(this),this.type="MeshBasicMaterial",this.color=new $e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}nt.prototype=Object.assign(Object.create(v.prototype),{constructor:nt,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),0!==this.vertexColors&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var i=r(e.textures),o=r(e.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(nt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),rt.prototype=Object.create(nt.prototype),rt.prototype.constructor=rt,rt.prototype.isMeshBasicMaterial=!0,rt.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var it=new E;function ot(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function at(e,t,n){ot.call(this,new Int8Array(e),t,n)}function st(e,t,n){ot.call(this,new Uint8Array(e),t,n)}function lt(e,t,n){ot.call(this,new Uint8ClampedArray(e),t,n)}function ut(e,t,n){ot.call(this,new Int16Array(e),t,n)}function ct(e,t,n){ot.call(this,new Uint16Array(e),t,n)}function ht(e,t,n){ot.call(this,new Int32Array(e),t,n)}function dt(e,t,n){ot.call(this,new Uint32Array(e),t,n)}function ft(e,t,n){ot.call(this,new Float32Array(e),t,n)}function pt(e,t,n){ot.call(this,new Float64Array(e),t,n)}function mt(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function vt(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}Object.defineProperty(ot.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ot.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new $e),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new x),t[n++]=o.x,t[n++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new E),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new k),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this},applyMatrix3:function(e){for(var t=0,n=this.count;t<n;t++)it.x=this.getX(t),it.y=this.getY(t),it.z=this.getZ(t),it.applyMatrix3(e),this.setXYZ(t,it.x,it.y,it.z);return this},applyMatrix4:function(e){for(var t=0,n=this.count;t<n;t++)it.x=this.getX(t),it.y=this.getY(t),it.z=this.getZ(t),it.applyMatrix4(e),this.setXYZ(t,it.x,it.y,it.z);return this},applyNormalMatrix:function(e){for(var t=0,n=this.count;t<n;t++)it.x=this.getX(t),it.y=this.getY(t),it.z=this.getZ(t),it.applyNormalMatrix(e),this.setXYZ(t,it.x,it.y,it.z);return this},transformDirection:function(e){for(var t=0,n=this.count;t<n;t++)it.x=this.getX(t),it.y=this.getY(t),it.z=this.getZ(t),it.transformDirection(e),this.setXYZ(t,it.x,it.y,it.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),at.prototype=Object.create(ot.prototype),at.prototype.constructor=at,st.prototype=Object.create(ot.prototype),st.prototype.constructor=st,lt.prototype=Object.create(ot.prototype),lt.prototype.constructor=lt,ut.prototype=Object.create(ot.prototype),ut.prototype.constructor=ut,ct.prototype=Object.create(ot.prototype),ct.prototype.constructor=ct,ht.prototype=Object.create(ot.prototype),ht.prototype.constructor=ht,dt.prototype=Object.create(ot.prototype),dt.prototype.constructor=dt,ft.prototype=Object.create(ot.prototype),ft.prototype.constructor=ft,pt.prototype=Object.create(ot.prototype),pt.prototype.constructor=pt,Object.assign(mt.prototype,{computeGroups:function(e){for(var t,n=[],r=void 0,i=e.faces,o=0;o<i.length;o++){var a=i[o];a.materialIndex!==r&&(r=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,n.push(t)),t={start:3*o,materialIndex:r})}void 0!==t&&(t.count=3*o-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,n=e.faces,r=e.vertices,i=e.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var u=0;u<l;u++)t[u]={name:s[u].name,data:[]};this.morphTargets.position=t}var c,h=e.morphNormals,d=h.length;if(d>0){for(c=[],u=0;u<d;u++)c[u]={name:h[u].name,data:[]};this.morphTargets.normal=c}var f=e.skinIndices,p=e.skinWeights,m=f.length===r.length,v=p.length===r.length;for(r.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),u=0;u<n.length;u++){var g=n[u];this.vertices.push(r[g.a],r[g.b],r[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var _=g.normal;this.normals.push(_,_,_)}var b,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var S=g.color;this.colors.push(S,S,S)}!0===o&&(void 0!==(b=i[0][u])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new x,new x,new x))),!0===a&&(void 0!==(b=i[1][u])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new x,new x,new x)));for(var E=0;E<l;E++){var T=s[E].vertices;t[E].data.push(T[g.a],T[g.b],T[g.c])}for(E=0;E<d;E++){var M=h[E].vertexNormals[u];c[E].data.push(M.a,M.b,M.c)}m&&this.skinIndices.push(f[g.a],f[g.b],f[g.c]),v&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var gt=1,yt=new V,_t=new oe,xt=new E,bt=new xe,wt=new xe,St=new E;function Et(){Object.defineProperty(this,"id",{value:gt+=2}),this.uuid=_.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Et.prototype=Object.assign(Object.create(v.prototype),{constructor:Et,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(vt(e)>65535?dt:ct)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new C).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return yt.makeRotationX(e),this.applyMatrix(yt),this},rotateY:function(e){return yt.makeRotationY(e),this.applyMatrix(yt),this},rotateZ:function(e){return yt.makeRotationZ(e),this.applyMatrix(yt),this},translate:function(e,t,n){return yt.makeTranslation(e,t,n),this.applyMatrix(yt),this},scale:function(e,t,n){return yt.makeScale(e,t,n),this.applyMatrix(yt),this},lookAt:function(e){return _t.lookAt(e),_t.updateMatrix(),this.applyMatrix(_t.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(xt).negate(),this.translate(xt.x,xt.y,xt.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new ft(3*t.vertices.length,3),r=new ft(3*t.colors.length,3);if(this.setAttribute("position",n.copyVector3sArray(t.vertices)),this.setAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new ft(t.lineDistances.length,1);this.setAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new ft(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var r=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(r=void 0,n.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(n);r.verticesNeedUpdate=n.verticesNeedUpdate,r.normalsNeedUpdate=n.normalsNeedUpdate,r.colorsNeedUpdate=n.colorsNeedUpdate,r.uvsNeedUpdate=n.uvsNeedUpdate,r.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=r}return!0===n.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new mt).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new ot(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.setAttribute("normal",new ot(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.setAttribute("color",new ot(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new ot(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new ot(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[a],u=0,c=l.length;u<c;u++){var h=l[u],d=new ft(3*h.data.length,3);d.name=h.name,s.push(d.copyVector3sArray(h.data))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var f=new ft(4*e.skinIndices.length,4);this.setAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var p=new ft(4*e.skinWeights.length,4);this.setAttribute("skinWeight",p.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new xe);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var i=t[n];bt.setFromBufferAttribute(i),this.morphTargetsRelative?(St.addVectors(this.boundingBox.min,bt.min),this.boundingBox.expandByPoint(St),St.addVectors(this.boundingBox.max,bt.max),this.boundingBox.expandByPoint(St)):(this.boundingBox.expandByPoint(bt.min),this.boundingBox.expandByPoint(bt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Se);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var n=this.boundingSphere.center;if(bt.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var o=t[r];wt.setFromBufferAttribute(o),this.morphTargetsRelative?(St.addVectors(bt.min,wt.min),bt.expandByPoint(St),St.addVectors(bt.max,wt.max),bt.expandByPoint(St)):(bt.expandByPoint(wt.min),bt.expandByPoint(wt.max))}bt.getCenter(n);var a=0;for(r=0,i=e.count;r<i;r++)St.fromBufferAttribute(e,r),a=Math.max(a,n.distanceToSquared(St));if(t)for(r=0,i=t.length;r<i;r++){o=t[r];for(var s=this.morphTargetsRelative,l=0,u=o.count;l<u;l++)St.fromBufferAttribute(o,l),s&&(xt.fromBufferAttribute(e,l),St.add(xt)),a=Math.max(a,n.distanceToSquared(St))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new ot(new Float32Array(n.length),3));else for(var r=t.normal.array,i=0,o=r.length;i<o;i++)r[i]=0;var a,s,l,u=t.normal.array,c=new E,h=new E,d=new E,f=new E,p=new E;if(e){var m=e.array;for(i=0,o=e.count;i<o;i+=3)a=3*m[i+0],s=3*m[i+1],l=3*m[i+2],c.fromArray(n,a),h.fromArray(n,s),d.fromArray(n,l),f.subVectors(d,h),p.subVectors(c,h),f.cross(p),u[a]+=f.x,u[a+1]+=f.y,u[a+2]+=f.z,u[s]+=f.x,u[s+1]+=f.y,u[s+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z}else for(i=0,o=n.length;i<o;i+=9)c.fromArray(n,i),h.fromArray(n,i+3),d.fromArray(n,i+6),f.subVectors(d,h),p.subVectors(c,h),f.cross(p),u[i]=f.x,u[i+1]=f.y,u[i+2]=f.z,u[i+3]=f.x,u[i+4]=f.y,u[i+5]=f.z,u[i+6]=f.x,u[i+7]=f.y,u[i+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,o=e.attributes[r],a=o.array,s=o.itemSize*t,l=Math.min(a.length,i.length-s),u=0,c=s;u<l;u++,c++)i[c]=a[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)St.x=e.getX(t),St.y=e.getY(t),St.z=e.getZ(t),St.normalize(),e.setXYZ(t,St.x,St.y,St.z)},toNonIndexed:function(){function e(e,t){for(var n=e.array,r=e.itemSize,i=new n.constructor(t.length*r),o=0,a=0,s=0,l=t.length;s<l;s++){o=t[s]*r;for(var u=0;u<r;u++)i[a++]=n[o++]}return new ot(i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Et,n=this.index.array,r=this.attributes;for(var i in r){var o=e(r[i],n);t.setAttribute(i,o)}var a=this.morphAttributes;for(i in a){for(var s=[],l=a[i],u=0,c=l.length;u<c;u++)o=e(l[u],n),s.push(o);t.morphAttributes[i]=s}t.morphTargetsRelative=this.morphTargetsRelative;for(var h=this.groups,d=(u=0,h.length);u<d;u++){var f=h[u];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var n in i){var o=(d=i[n]).toJSON();""!==d.name&&(o.name=d.name),e.data.attributes[n]=o}var a={},s=!1;for(var n in this.morphAttributes){for(var l=this.morphAttributes[n],u=[],c=0,h=l.length;c<h;c++){var d;o=(d=l[c]).toJSON(),""!==d.name&&(o.name=d.name),u.push(o)}u.length>0&&(a[n]=u,s=!0)}s&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);var f=this.groups;f.length>0&&(e.data.groups=JSON.parse(JSON.stringify(f)));var p=this.boundingSphere;return null!==p&&(e.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),e},clone:function(){return(new Et).copy(this)},copy:function(e){var t,n,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var o=e.attributes;for(t in o){var a=o[t];this.setAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var l=[],u=s[t];for(n=0,r=u.length;n<r;n++)l.push(u[n].clone());this.morphAttributes[t]=l}this.morphTargetsRelative=e.morphTargetsRelative;var c=e.groups;for(n=0,r=c.length;n<r;n++){var h=c[n];this.addGroup(h.start,h.count,h.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Tt=new V,Mt=new ke,Ct=new Se,At=new E,Rt=new E,Pt=new E,kt=new E,Lt=new E,Nt=new E,It=new E,Ot=new E,Dt=new E,zt=new x,Ft=new x,Bt=new x,Ut=new E,Vt=new E;function Gt(e,t){oe.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Et,this.material=void 0!==t?t:new rt({color:16777215*Math.random()}),this.updateMorphTargets()}function jt(e,t,n,r,i,o,a,s){if(null===(1===t.side?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,2!==t.side,s)))return null;Vt.copy(s),Vt.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(Vt);return l<n.near||l>n.far?null:{distance:l,point:Vt.clone(),object:e}}function Ht(e,t,n,r,i,o,a,s,l,u,c,h){At.fromBufferAttribute(i,u),Rt.fromBufferAttribute(i,c),Pt.fromBufferAttribute(i,h);var d=e.morphTargetInfluences;if(t.morphTargets&&o&&d){It.set(0,0,0),Ot.set(0,0,0),Dt.set(0,0,0);for(var f=0,p=o.length;f<p;f++){var m=d[f],v=o[f];0!==m&&(kt.fromBufferAttribute(v,u),Lt.fromBufferAttribute(v,c),Nt.fromBufferAttribute(v,h),a?(It.addScaledVector(kt,m),Ot.addScaledVector(Lt,m),Dt.addScaledVector(Nt,m)):(It.addScaledVector(kt.sub(At),m),Ot.addScaledVector(Lt.sub(Rt),m),Dt.addScaledVector(Nt.sub(Pt),m)))}At.add(It),Rt.add(Ot),Pt.add(Dt)}var g=jt(e,t,n,r,At,Rt,Pt,Ut);if(g){s&&(zt.fromBufferAttribute(s,u),Ft.fromBufferAttribute(s,c),Bt.fromBufferAttribute(s,h),g.uv=qe.getUV(Ut,At,Rt,Pt,zt,Ft,Bt,new x)),l&&(zt.fromBufferAttribute(l,u),Ft.fromBufferAttribute(l,c),Bt.fromBufferAttribute(l,h),g.uv2=qe.getUV(Ut,At,Rt,Pt,zt,Ft,Bt,new x));var y=new et(u,c,h);qe.getNormal(At,Rt,Pt,y.normal),g.face=y}return g}Gt.prototype=Object.assign(Object.create(oe.prototype),{constructor:Gt,isMesh:!0,copy:function(e){return oe.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)n=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=r.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var n,r=this.geometry,i=this.material,o=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),Ct.copy(r.boundingSphere),Ct.applyMatrix4(o),!1!==e.ray.intersectsSphere(Ct)&&(Tt.getInverse(o),Mt.copy(e.ray).applyMatrix4(Tt),null===r.boundingBox||!1!==Mt.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var a,s,l,u,c,h,d,f,p,m=r.index,v=r.attributes.position,g=r.morphAttributes.position,y=r.morphTargetsRelative,_=r.attributes.uv,b=r.attributes.uv2,w=r.groups,S=r.drawRange;if(null!==m)if(Array.isArray(i))for(u=0,h=w.length;u<h;u++)for(p=i[(f=w[u]).materialIndex],c=Math.max(f.start,S.start),d=Math.min(f.start+f.count,S.start+S.count);c<d;c+=3)a=m.getX(c),s=m.getX(c+1),l=m.getX(c+2),(n=Ht(this,p,e,Mt,v,g,y,_,b,a,s,l))&&(n.faceIndex=Math.floor(c/3),n.face.materialIndex=f.materialIndex,t.push(n));else for(u=Math.max(0,S.start),h=Math.min(m.count,S.start+S.count);u<h;u+=3)a=m.getX(u),s=m.getX(u+1),l=m.getX(u+2),(n=Ht(this,i,e,Mt,v,g,y,_,b,a,s,l))&&(n.faceIndex=Math.floor(u/3),t.push(n));else if(void 0!==v)if(Array.isArray(i))for(u=0,h=w.length;u<h;u++)for(p=i[(f=w[u]).materialIndex],c=Math.max(f.start,S.start),d=Math.min(f.start+f.count,S.start+S.count);c<d;c+=3)(n=Ht(this,p,e,Mt,v,g,y,_,b,a=c,s=c+1,l=c+2))&&(n.faceIndex=Math.floor(c/3),n.face.materialIndex=f.materialIndex,t.push(n));else for(u=Math.max(0,S.start),h=Math.min(v.count,S.start+S.count);u<h;u+=3)(n=Ht(this,i,e,Mt,v,g,y,_,b,a=u,s=u+1,l=u+2))&&(n.faceIndex=Math.floor(u/3),t.push(n))}else if(r.isGeometry){var E,T,M,C,A=Array.isArray(i),R=r.vertices,P=r.faces,k=r.faceVertexUvs[0];k.length>0&&(C=k);for(var L=0,N=P.length;L<N;L++){var I=P[L],O=A?i[I.materialIndex]:i;if(void 0!==O&&(E=R[I.a],T=R[I.b],M=R[I.c],n=jt(this,O,e,Mt,E,T,M,Ut))){if(C&&C[L]){var D=C[L];zt.copy(D[0]),Ft.copy(D[1]),Bt.copy(D[2]),n.uv=qe.getUV(Ut,E,T,M,zt,Ft,Bt,new x)}n.face=I,n.faceIndex=L,t.push(n)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Wt=0,qt=new V,Yt=new oe,Xt=new E;function Zt(){Object.defineProperty(this,"id",{value:Wt+=2}),this.uuid=_.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Zt.prototype=Object.assign(Object.create(v.prototype),{constructor:Zt,isGeometry:!0,applyMatrix:function(e){for(var t=(new C).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++)this.vertices[n].applyMatrix4(e);for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(t).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return qt.makeRotationX(e),this.applyMatrix(qt),this},rotateY:function(e){return qt.makeRotationY(e),this.applyMatrix(qt),this},rotateZ:function(e){return qt.makeRotationZ(e),this.applyMatrix(qt),this},translate:function(e,t,n){return qt.makeTranslation(e,t,n),this.applyMatrix(qt),this},scale:function(e,t,n){return qt.makeScale(e,t,n),this.applyMatrix(qt),this},lookAt:function(e){return Yt.lookAt(e),Yt.updateMatrix(),this.applyMatrix(Yt.matrix),this},fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index.array:void 0,r=e.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=r.position.array,o=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,l=void 0!==r.uv2?r.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var u=0;u<i.length;u+=3)t.vertices.push((new E).fromArray(i,u)),void 0!==a&&t.colors.push((new $e).fromArray(a,u));function c(e,n,r,i){var u=void 0===a?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()],c=new et(e,n,r,void 0===o?[]:[(new E).fromArray(o,3*e),(new E).fromArray(o,3*n),(new E).fromArray(o,3*r)],u,i);t.faces.push(c),void 0!==s&&t.faceVertexUvs[0].push([(new x).fromArray(s,2*e),(new x).fromArray(s,2*n),(new x).fromArray(s,2*r)]),void 0!==l&&t.faceVertexUvs[1].push([(new x).fromArray(l,2*e),(new x).fromArray(l,2*n),(new x).fromArray(l,2*r)])}var h=e.groups;if(h.length>0)for(u=0;u<h.length;u++)for(var d=h[u],f=d.start,p=f,m=f+d.count;p<m;p+=3)void 0!==n?c(n[p],n[p+1],n[p+2],d.materialIndex):c(p,p+1,p+2,d.materialIndex);else if(void 0!==n)for(u=0;u<n.length;u+=3)c(n[u],n[u+1],n[u+2]);else for(u=0;u<i.length/3;u+=3)c(u,u+1,u+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Xt).negate(),this.translate(Xt.x,Xt.y,Xt.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new V;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new E,t=new E,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,i,o,a;for(void 0===e&&(e=!0),a=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)a[t]=new E;if(e){var s,l,u,c=new E,h=new E;for(r=0,i=this.faces.length;r<i;r++)o=this.faces[r],s=this.vertices[o.a],l=this.vertices[o.b],u=this.vertices[o.c],c.subVectors(u,l),h.subVectors(s,l),c.cross(h),a[o.a].add(c),a[o.b].add(c),a[o.c].add(c)}else for(this.computeFaceNormals(),r=0,i=this.faces.length;r<i;r++)a[(o=this.faces[r]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,n=this.vertices.length;t<n;t++)a[t].normalize();for(r=0,i=this.faces.length;r<i;r++){var d=(o=this.faces[r]).vertexNormals;3===d.length?(d[0].copy(a[o.a]),d[1].copy(a[o.b]),d[2].copy(a[o.c])):(d[0]=a[o.a].clone(),d[1]=a[o.b].clone(),d[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var r=(n=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for((i=this.faces[n]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new Zt;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)l=new E,u={a:new E,b:new E,c:new E},a.push(l),s.push(u)}var l,u,c=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)i=this.faces[n],l=c.faceNormals[n],u=c.vertexNormals[n],l.copy(i.normal),u.a.copy(i.vertexNormals[0]),u.b.copy(i.vertexNormals[1]),u.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)(i=this.faces[n]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new xe),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Se),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var r,i=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,u=this.colors,c=e.colors;void 0===n&&(n=0),void 0!==t&&(r=(new C).getNormalMatrix(t));for(var h=0,d=a.length;h<d;h++){var f=a[h].clone();void 0!==t&&f.applyMatrix4(t),o.push(f)}for(h=0,d=c.length;h<d;h++)u.push(c[h].clone());for(h=0,d=l.length;h<d;h++){var p,m,v,g=l[h],y=g.vertexNormals,_=g.vertexColors;(p=new et(g.a+i,g.b+i,g.c+i)).normal.copy(g.normal),void 0!==r&&p.normal.applyMatrix3(r).normalize();for(var x=0,b=y.length;x<b;x++)m=y[x].clone(),void 0!==r&&m.applyMatrix3(r).normalize(),p.vertexNormals.push(m);for(p.color.copy(g.color),x=0,b=_.length;x<b;x++)v=_[x],p.vertexColors.push(v.clone());p.materialIndex=g.materialIndex+n,s.push(p)}for(h=0,d=e.faceVertexUvs.length;h<d;h++){var w=e.faceVertexUvs[h];for(void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]),x=0,b=w.length;x<b;x++){for(var S=w[x],E=[],T=0,M=S.length;T<M;T++)E.push(S[T].clone());this.faceVertexUvs[h].push(E)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,r,i,o,a,s,l={},u=[],c=[],h=Math.pow(10,4);for(n=0,r=this.vertices.length;n<r;n++)e=this.vertices[n],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=n,u.push(this.vertices[n]),c[n]=u.length-1):c[n]=c[l[t]];var d=[];for(n=0,r=this.faces.length;n<r;n++){(i=this.faces[n]).a=c[i.a],i.b=c[i.b],i.c=c[i.c],o=[i.a,i.b,i.c];for(var f=0;f<3;f++)if(o[f]===o[(f+1)%3]){d.push(n);break}}for(n=d.length-1;n>=0;n--){var p=d[n];for(this.faces.splice(p,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(p,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new E(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var r,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];for(o&&o.length===t&&(r=[]),a&&a.length===t&&(i=[]),n=0;n<t;n++){var s=e[n]._id;r&&r.push(o[s]),i&&i.push(a[s])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];r.push(o.x,o.y,o.z)}var a=[],s=[],l={},u=[],c={},h=[],d={};for(i=0;i<this.faces.length;i++){var f=this.faces[i],p=void 0!==this.faceVertexUvs[0][i],m=f.normal.length()>0,v=f.vertexNormals.length>0,g=1!==f.color.r||1!==f.color.g||1!==f.color.b,y=f.vertexColors.length>0,_=0;if(_=S(_,0,0),_=S(_,1,!0),_=S(_,2,!1),_=S(_,3,p),_=S(_,4,m),_=S(_,5,v),_=S(_,6,g),_=S(_,7,y),a.push(_),a.push(f.a,f.b,f.c),a.push(f.materialIndex),p){var x=this.faceVertexUvs[0][i];a.push(M(x[0]),M(x[1]),M(x[2]))}if(m&&a.push(E(f.normal)),v){var b=f.vertexNormals;a.push(E(b[0]),E(b[1]),E(b[2]))}if(g&&a.push(T(f.color)),y){var w=f.vertexColors;a.push(T(w[0]),T(w[1]),T(w[2]))}}function S(e,t,n){return n?e|1<<t:e&~(1<<t)}function E(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=s.length/3,s.push(e.x,e.y,e.z)),l[t]}function T(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=u.length,u.push(e.getHex())),c[t]}function M(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=h.length/2,h.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=r,e.data.normals=s,u.length>0&&(e.data.colors=u),h.length>0&&(e.data.uvs=[h]),e.data.faces=a,e},clone:function(){return(new Zt).copy(this)},copy:function(e){var t,n,r,i,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,n=s.length;t<n;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,n=l.length;t<n;t++)this.colors.push(l[t].clone());var u=e.faces;for(t=0,n=u.length;t<n;t++)this.faces.push(u[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var c=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,i=c.length;r<i;r++){var h=c[r],d=[];for(o=0,a=h.length;o<a;o++){var f=h[o];d.push(f.clone())}this.faceVertexUvs[t].push(d)}}var p=e.morphTargets;for(t=0,n=p.length;t<n;t++){var m={};if(m.name=p[t].name,void 0!==p[t].vertices)for(m.vertices=[],r=0,i=p[t].vertices.length;r<i;r++)m.vertices.push(p[t].vertices[r].clone());if(void 0!==p[t].normals)for(m.normals=[],r=0,i=p[t].normals.length;r<i;r++)m.normals.push(p[t].normals[r].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,n=v.length;t<n;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],r=0,i=v[t].vertexNormals.length;r<i;r++){var y=v[t].vertexNormals[r],_={};_.a=y.a.clone(),_.b=y.b.clone(),_.c=y.c.clone(),g.vertexNormals.push(_)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],r=0,i=v[t].faceNormals.length;r<i;r++)g.faceNormals.push(v[t].faceNormals[r].clone());this.morphNormals.push(g)}var x=e.skinWeights;for(t=0,n=x.length;t<n;t++)this.skinWeights.push(x[t].clone());var b=e.skinIndices;for(t=0,n=b.length;t<n;t++)this.skinIndices.push(b[t].clone());var w=e.lineDistances;for(t=0,n=w.length;t<n;t++)this.lineDistances.push(w[t]);var S=e.boundingBox;null!==S&&(this.boundingBox=S.clone());var E=e.boundingSphere;return null!==E&&(this.boundingSphere=E.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var $t=function(e){function t(e,n,r,i,o,a){var s;return h(this,t),(s=d(this,f(t).call(this))).type="BoxGeometry",s.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:o,depthSegments:a},s.fromBufferGeometry(new Kt(e,n,r,i,o,a)),s.mergeVertices(),s}return m(t,e),t}(Zt),Kt=function(e){function t(e,n,r,i,o,a){var s;h(this,t),(s=d(this,f(t).call(this))).type="BoxBufferGeometry",s.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:o,depthSegments:a};var l=c(s);e=e||1,n=n||1,r=r||1,i=Math.floor(i)||1,o=Math.floor(o)||1,a=Math.floor(a)||1;var u=[],p=[],m=[],v=[],g=0,y=0;function _(e,t,n,r,i,o,a,s,c,h,d){var f,_,x=o/c,b=a/h,w=o/2,S=a/2,T=s/2,M=c+1,C=h+1,A=0,R=0,P=new E;for(_=0;_<C;_++){var k=_*b-S;for(f=0;f<M;f++){var L=f*x-w;P[e]=L*r,P[t]=k*i,P[n]=T,p.push(P.x,P.y,P.z),P[e]=0,P[t]=0,P[n]=s>0?1:-1,m.push(P.x,P.y,P.z),v.push(f/c),v.push(1-_/h),A+=1}}for(_=0;_<h;_++)for(f=0;f<c;f++){var N=g+f+M*_,I=g+f+M*(_+1),O=g+(f+1)+M*(_+1),D=g+(f+1)+M*_;u.push(N,I,D),u.push(I,O,D),R+=6}l.addGroup(y,R,d),y+=R,g+=A}return _("z","y","x",-1,-1,r,n,e,a,o,0),_("z","y","x",1,-1,r,n,-e,a,o,1),_("x","z","y",1,1,e,r,n,i,a,2),_("x","z","y",1,-1,e,r,-n,i,a,3),_("x","y","z",1,-1,e,n,r,i,o,4),_("x","y","z",-1,-1,e,n,-r,i,o,5),s.setIndex(u),s.setAttribute("position",new ft(p,3)),s.setAttribute("normal",new ft(m,3)),s.setAttribute("uv",new ft(v,2)),s}return m(t,e),t}(Et);function Jt(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}function Qt(e){for(var t={},n=0;n<e.length;n++){var r=Jt(e[n]);for(var i in r)t[i]=r[i]}return t}var en={clone:Jt,merge:Qt};function tn(e){nt.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function nn(){oe.call(this),this.type="Camera",this.matrixWorldInverse=new V,this.projectionMatrix=new V,this.projectionMatrixInverse=new V}function rn(e,t,n,r){nn.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function on(e,t,n,r){oe.call(this),this.type="CubeCamera";var i=new rn(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new E(1,0,0)),this.add(i);var o=new rn(90,1,e,t);o.up.set(0,-1,0),o.lookAt(new E(-1,0,0)),this.add(o);var a=new rn(90,1,e,t);a.up.set(0,0,1),a.lookAt(new E(0,1,0)),this.add(a);var s=new rn(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new E(0,-1,0)),this.add(s);var l=new rn(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new E(0,0,1)),this.add(l);var u=new rn(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new E(0,0,-1)),this.add(u),r=r||{format:1022,magFilter:1006,minFilter:1006},this.renderTarget=new an(n,n,r),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=e.getRenderTarget(),r=this.renderTarget,c=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,i),e.setRenderTarget(r,1),e.render(t,o),e.setRenderTarget(r,2),e.render(t,a),e.setRenderTarget(r,3),e.render(t,s),e.setRenderTarget(r,4),e.render(t,l),r.texture.generateMipmaps=c,e.setRenderTarget(r,5),e.render(t,u),e.setRenderTarget(n)},this.clear=function(e,t,n,r){for(var i=e.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)e.setRenderTarget(o,a),e.clear(t,n,r);e.setRenderTarget(i)}}function an(e,t,n){L.call(this,e,t,n)}function sn(e,t,n,r,i,o,a,s,l,u,c,h){P.call(this,null,o,a,s,l,u,r,i,c,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:1003,this.minFilter=void 0!==u?u:1003,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}tn.prototype=Object.create(nt.prototype),tn.prototype.constructor=tn,tn.prototype.isShaderMaterial=!0,tn.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Jt(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},tn.prototype.toJSON=function(e){var t=nt.prototype.toJSON.call(this,e);for(var n in t.uniforms={},this.uniforms){var r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var i={};for(var o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t},nn.prototype=Object.assign(Object.create(oe.prototype),{constructor:nn,isCamera:!0,copy:function(e,t){return oe.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new E),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){oe.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),rn.prototype=Object.assign(Object.create(nn.prototype),{constructor:rn,isPerspectiveCamera:!0,copy:function(e,t){return nn.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*_.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*_.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*_.RAD2DEG*Math.atan(Math.tan(.5*_.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*_.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/a,t-=o.offsetY*n/s,r*=o.width/a,n*=o.height/s}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=oe.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),on.prototype=Object.create(oe.prototype),on.prototype.constructor=on,an.prototype=Object.create(L.prototype),an.prototype.constructor=an,an.prototype.isWebGLRenderTargetCube=!0,an.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var n=new ae,r={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},i=new tn({type:"CubemapFromEquirect",uniforms:Jt(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=t;var o=new Gt(new Kt(5,5,5),i);n.add(o);var a=new on(1,10,1);return a.renderTarget=this,a.renderTarget.texture.name="CubeCameraTexture",a.update(e,n),o.geometry.dispose(),o.material.dispose(),this},sn.prototype=Object.create(P.prototype),sn.prototype.constructor=sn,sn.prototype.isDataTexture=!0;var ln=new Se,un=new E;function cn(e,t,n,r,i,o){this.planes=[void 0!==e?e:new Oe,void 0!==t?t:new Oe,void 0!==n?n:new Oe,void 0!==r?r:new Oe,void 0!==i?i:new Oe,void 0!==o?o:new Oe]}Object.assign(cn.prototype,{set:function(e,t,n,r,i,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],u=n[6],c=n[7],h=n[8],d=n[9],f=n[10],p=n[11],m=n[12],v=n[13],g=n[14],y=n[15];return t[0].setComponents(a-r,c-s,p-h,y-m).normalize(),t[1].setComponents(a+r,c+s,p+h,y+m).normalize(),t[2].setComponents(a+i,c+l,p+d,y+v).normalize(),t[3].setComponents(a-i,c-l,p-d,y-v).normalize(),t[4].setComponents(a-o,c-u,p-f,y-g).normalize(),t[5].setComponents(a+o,c+u,p+f,y+g).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),ln.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ln)},intersectsSprite:function(e){return ln.center.set(0,0,0),ln.radius=.7071067811865476,ln.applyMatrix4(e.matrixWorld),this.intersectsSphere(ln)},intersectsSphere:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++)if(t[i].distanceToPoint(n)<r)return!1;return!0},intersectsBox:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(un.x=r.normal.x>0?e.max.x:e.min.x,un.y=r.normal.y>0?e.max.y:e.min.y,un.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(un)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});var hn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ), 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},dn={common:{diffuse:{value:new $e(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new C},uv2Transform:{value:new C},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new x(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new $e(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new $e(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new C}},sprite:{diffuse:{value:new $e(15658734)},opacity:{value:1},center:{value:new x(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new C}}},fn={basic:{uniforms:Qt([dn.common,dn.specularmap,dn.envmap,dn.aomap,dn.lightmap,dn.fog]),vertexShader:hn.meshbasic_vert,fragmentShader:hn.meshbasic_frag},lambert:{uniforms:Qt([dn.common,dn.specularmap,dn.envmap,dn.aomap,dn.lightmap,dn.emissivemap,dn.fog,dn.lights,{emissive:{value:new $e(0)}}]),vertexShader:hn.meshlambert_vert,fragmentShader:hn.meshlambert_frag},phong:{uniforms:Qt([dn.common,dn.specularmap,dn.envmap,dn.aomap,dn.lightmap,dn.emissivemap,dn.bumpmap,dn.normalmap,dn.displacementmap,dn.fog,dn.lights,{emissive:{value:new $e(0)},specular:{value:new $e(1118481)},shininess:{value:30}}]),vertexShader:hn.meshphong_vert,fragmentShader:hn.meshphong_frag},standard:{uniforms:Qt([dn.common,dn.envmap,dn.aomap,dn.lightmap,dn.emissivemap,dn.bumpmap,dn.normalmap,dn.displacementmap,dn.roughnessmap,dn.metalnessmap,dn.fog,dn.lights,{emissive:{value:new $e(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:hn.meshphysical_vert,fragmentShader:hn.meshphysical_frag},toon:{uniforms:Qt([dn.common,dn.specularmap,dn.aomap,dn.lightmap,dn.emissivemap,dn.bumpmap,dn.normalmap,dn.displacementmap,dn.gradientmap,dn.fog,dn.lights,{emissive:{value:new $e(0)},specular:{value:new $e(1118481)},shininess:{value:30}}]),vertexShader:hn.meshtoon_vert,fragmentShader:hn.meshtoon_frag},matcap:{uniforms:Qt([dn.common,dn.bumpmap,dn.normalmap,dn.displacementmap,dn.fog,{matcap:{value:null}}]),vertexShader:hn.meshmatcap_vert,fragmentShader:hn.meshmatcap_frag},points:{uniforms:Qt([dn.points,dn.fog]),vertexShader:hn.points_vert,fragmentShader:hn.points_frag},dashed:{uniforms:Qt([dn.common,dn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:hn.linedashed_vert,fragmentShader:hn.linedashed_frag},depth:{uniforms:Qt([dn.common,dn.displacementmap]),vertexShader:hn.depth_vert,fragmentShader:hn.depth_frag},normal:{uniforms:Qt([dn.common,dn.bumpmap,dn.normalmap,dn.displacementmap,{opacity:{value:1}}]),vertexShader:hn.normal_vert,fragmentShader:hn.normal_frag},sprite:{uniforms:Qt([dn.sprite,dn.fog]),vertexShader:hn.sprite_vert,fragmentShader:hn.sprite_frag},background:{uniforms:{uvTransform:{value:new C},t2D:{value:null}},vertexShader:hn.background_vert,fragmentShader:hn.background_frag},cube:{uniforms:Qt([dn.envmap,{opacity:{value:1}}]),vertexShader:hn.cube_vert,fragmentShader:hn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:hn.equirect_vert,fragmentShader:hn.equirect_frag},distanceRGBA:{uniforms:Qt([dn.common,dn.displacementmap,{referencePosition:{value:new E},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:hn.distanceRGBA_vert,fragmentShader:hn.distanceRGBA_frag},shadow:{uniforms:Qt([dn.lights,dn.fog,{color:{value:new $e(0)},opacity:{value:1}}]),vertexShader:hn.shadow_vert,fragmentShader:hn.shadow_frag}};function pn(){var e=null,t=!1,n=null;function r(i,o){!1!==t&&(n(i,o),e.requestAnimationFrame(r))}return{start:function(){!0!==t&&null!==n&&(e.requestAnimationFrame(r),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function mn(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);var r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function(n,r){n.isInterleavedBufferAttribute&&(n=n.data);var i=t.get(n);void 0===i?t.set(n,function(t,n){var r=t.array,i=t.usage,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,r,i),t.onUploadCallback();var a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:r instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(n,r)):i.version<n.version&&(function(t,n,r){var i=n.array,o=n.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,i):(e.bufferSubData(r,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1)}(i.buffer,n,r),i.version=n.version)}}}function vn(e,t,n,r){Zt.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new gn(e,t,n,r)),this.mergeVertices()}function gn(e,t,n,r){Et.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var i,o,a=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(n)||1,u=Math.floor(r)||1,c=l+1,h=u+1,d=e/l,f=t/u,p=[],m=[],v=[],g=[];for(o=0;o<h;o++){var y=o*f-s;for(i=0;i<c;i++){var _=i*d-a;m.push(_,-y,0),v.push(0,0,1),g.push(i/l),g.push(1-o/u)}}for(o=0;o<u;o++)for(i=0;i<l;i++){var x=i+c*o,b=i+c*(o+1),w=i+1+c*(o+1),S=i+1+c*o;p.push(x,b,S),p.push(b,w,S)}this.setIndex(p),this.setAttribute("position",new ft(m,3)),this.setAttribute("normal",new ft(v,3)),this.setAttribute("uv",new ft(g,2))}function yn(e,t,n,r){var i,o,a=new $e(0),s=0,l=null,u=0;function c(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,r)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),c(a,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){c(a,s=e)},render:function(t,r,h,d){var f=r.background,p=e.xr,m=p.getSession&&p.getSession();if(m&&"additive"===m.environmentBlendMode&&(f=null),null===f?(c(a,s),l=null,u=0):f&&f.isColor&&(c(f,1),d=!0,l=null,u=0),(e.autoClear||d)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&(f.isCubeTexture||f.isWebGLRenderTargetCube||306===f.mapping)){void 0===o&&((o=new Gt(new Kt(1,1,1),new tn({type:"BackgroundCubeMaterial",uniforms:Jt(fn.cube.uniforms),vertexShader:fn.cube.vertexShader,fragmentShader:fn.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(o));var v=f.isWebGLRenderTargetCube?f.texture:f;o.material.uniforms.envMap.value=v,o.material.uniforms.flipEnvMap.value=v.isCubeTexture?-1:1,l===f&&u===v.version||(o.material.needsUpdate=!0,l=f,u=v.version),t.unshift(o,o.geometry,o.material,0,0,null)}else f&&f.isTexture&&(void 0===i&&((i=new Gt(new gn(2,2),new tn({type:"BackgroundMaterial",uniforms:Jt(fn.background.uniforms),vertexShader:fn.background.vertexShader,fragmentShader:fn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(i)),i.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),i.material.uniforms.uvTransform.value.copy(f.matrix),l===f&&u===f.version||(i.material.needsUpdate=!0,l=f,u=f.version),t.unshift(i,i.geometry,i.material,0,0,null))}}}function _n(e,t,n,r){var i,o=r.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i)},this.renderInstances=function(r,a,s,l){if(0!==l){var u,c;if(o)u=e,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[c](i,a,s,l),n.update(s,i,l)}}}function xn(e,t,n){var r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,a=void 0!==n.precision?n.precision:"highp",s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),c=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),f=e.getParameter(34921),p=e.getParameter(36347),m=e.getParameter(36348),v=e.getParameter(36349),g=c>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;var n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y,maxSamples:o?e.getParameter(36183):0}}function bn(){var e=this,t=null,n=0,r=!1,i=!1,o=new Oe,a=new C,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(t,n,r,i){var l=null!==t?t.length:0,u=null;if(0!==l){if(u=s.value,!0!==i||null===u){var c=r+4*l,h=n.matrixWorldInverse;a.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var d=0,f=r;d!==l;++d,f+=4)o.copy(t[d]).applyMatrix4(h,a),o.normal.toArray(u,f),u[f+3]=o.constant}s.value=u,s.needsUpdate=!0}return e.numPlanes=l,u}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,o){var a=0!==e.length||i||0!==n||r;return r=i,t=u(e,o,0),n=e.length,a},this.beginShadows=function(){i=!0,u(null)},this.endShadows=function(){i=!1,l()},this.setState=function(e,o,a,c,h,d){if(!r||null===e||0===e.length||i&&!a)i?u(null):l();else{var f=i?0:n,p=4*f,m=h.clippingState||null;s.value=m,m=u(e,c,p,d);for(var v=0;v!==p;++v)m[v]=t[v];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=f}}}function wn(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=r,r}}}function Sn(e,t,n){var r=new WeakMap,i=new WeakMap;function o(e){var a=e.target,s=r.get(a);for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);a.removeEventListener("dispose",o),r.delete(a);var u=i.get(s);u&&(t.remove(u),i.delete(s)),n.memory.geometries--}function a(e){var n=[],r=e.index,o=e.attributes.position,a=0;if(null!==r){var s=r.array;a=r.version;for(var l=0,u=s.length;l<u;l+=3){var c=s[l+0],h=s[l+1],d=s[l+2];n.push(c,h,h,d,d,c)}}else for(s=o.array,a=o.version,l=0,u=s.length/3-1;l<u;l+=3)c=l+0,h=l+1,d=l+2,n.push(c,h,h,d,d,c);var f=new(vt(n)>65535?dt:ct)(n,1);f.version=a,t.update(f,34963);var p=i.get(e);p&&t.remove(p),i.set(e,f)}return{get:function(e,t){var i=r.get(t);return i||(t.addEventListener("dispose",o),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Et).setFromObject(e)),i=t._bufferGeometry),r.set(t,i),n.memory.geometries++,i)},update:function(e){var n=e.index,r=e.attributes;for(var i in null!==n&&t.update(n,34963),r)t.update(r[i],34962);var o=e.morphAttributes;for(var i in o)for(var a=o[i],s=0,l=a.length;s<l;s++)t.update(a[s],34962)},getWireframeAttribute:function(e){var t=i.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return i.get(e)}}}function En(e,t,n,r){var i,o,a,s=r.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(i,r,o,t*a),n.update(r,i)},this.renderInstances=function(r,l,u,c){if(0!==c){var h,d;if(s)h=e,d="drawElementsInstanced";else if(d="drawElementsInstancedANGLE",null===(h=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[d](i,u,o,l*a,c),n.update(u,i,c)}}}function Tn(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(r=r||1,t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Mn(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Cn(e){var t={},n=new Float32Array(8);return{update:function(r,i,o,a){var s=r.morphTargetInfluences,l=void 0===s?0:s.length,u=t[i.id];if(void 0===u){u=[];for(var c=0;c<l;c++)u[c]=[c,0];t[i.id]=u}var h=o.morphTargets&&i.morphAttributes.position,d=o.morphNormals&&i.morphAttributes.normal;for(c=0;c<l;c++)0!==(p=u[c])[1]&&(h&&i.deleteAttribute("morphTarget"+c),d&&i.deleteAttribute("morphNormal"+c));for(c=0;c<l;c++)(p=u[c])[0]=c,p[1]=s[c];u.sort(Mn);var f=0;for(c=0;c<8;c++){var p;if(p=u[c]){var m=p[0],v=p[1];if(v){h&&i.setAttribute("morphTarget"+c,h[m]),d&&i.setAttribute("morphNormal"+c,d[m]),n[c]=v,f+=v;continue}}n[c]=0}var g=i.morphTargetsRelative?1:1-f;a.getUniforms().setValue(e,"morphTargetBaseInfluence",g),a.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function An(e,t,n,r){var i={};return{update:function(e){var o=r.render.frame,a=e.geometry,s=t.get(e,a);return i[s.id]!==o&&(a.isGeometry&&s.updateFromObject(e),t.update(s),i[s.id]=o),e.isInstancedMesh&&n.update(e.instanceMatrix,34962),s},dispose:function(){i={}}}}function Rn(e,t,n,r,i,o,a,s,l,u){e=void 0!==e?e:[],t=void 0!==t?t:301,a=void 0!==a?a:1022,P.call(this,e,t,n,r,i,o,a,s,l,u),this.flipY=!1}function Pn(e,t,n,r){P.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:r||1},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function kn(e,t,n,r){P.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:r||1},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}fn.physical={uniforms:Qt([fn.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new $e(0)},clearcoatNormalScale:{value:new x(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:hn.meshphysical_vert,fragmentShader:hn.meshphysical_frag},vn.prototype=Object.create(Zt.prototype),vn.prototype.constructor=vn,gn.prototype=Object.create(Et.prototype),gn.prototype.constructor=gn,Rn.prototype=Object.create(P.prototype),Rn.prototype.constructor=Rn,Rn.prototype.isCubeTexture=!0,Object.defineProperty(Rn.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),Pn.prototype=Object.create(P.prototype),Pn.prototype.constructor=Pn,Pn.prototype.isDataTexture2DArray=!0,kn.prototype=Object.create(P.prototype),kn.prototype.constructor=kn,kn.prototype.isDataTexture3D=!0;var Ln=new P,Nn=new Pn,In=new kn,On=new Rn,Dn=[],zn=[],Fn=new Float32Array(16),Bn=new Float32Array(9),Un=new Float32Array(4);function Vn(e,t,n){var r=e[0];if(r<=0||r>0)return e;var i=t*n,o=Dn[i];if(void 0===o&&(o=new Float32Array(i),Dn[i]=o),0!==t){r.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=n,e[a].toArray(o,s)}return o}function Gn(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function jn(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function Hn(e,t){var n=zn[t];void 0===n&&(n=new Int32Array(t),zn[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Wn(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function qn(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Gn(n,t))return;e.uniform2fv(this.addr,t),jn(n,t)}}function Yn(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Gn(n,t))return;e.uniform3fv(this.addr,t),jn(n,t)}}function Xn(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Gn(n,t))return;e.uniform4fv(this.addr,t),jn(n,t)}}function Zn(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Gn(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),jn(n,t)}else{if(Gn(n,r))return;Un.set(r),e.uniformMatrix2fv(this.addr,!1,Un),jn(n,r)}}function $n(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Gn(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),jn(n,t)}else{if(Gn(n,r))return;Bn.set(r),e.uniformMatrix3fv(this.addr,!1,Bn),jn(n,r)}}function Kn(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Gn(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),jn(n,t)}else{if(Gn(n,r))return;Fn.set(r),e.uniformMatrix4fv(this.addr,!1,Fn),jn(n,r)}}function Jn(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||Ln,i)}function Qn(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Nn,i)}function er(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||In,i)}function tr(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||On,i)}function nr(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function rr(e,t){var n=this.cache;Gn(n,t)||(e.uniform2iv(this.addr,t),jn(n,t))}function ir(e,t){var n=this.cache;Gn(n,t)||(e.uniform3iv(this.addr,t),jn(n,t))}function or(e,t){var n=this.cache;Gn(n,t)||(e.uniform4iv(this.addr,t),jn(n,t))}function ar(e,t){e.uniform1fv(this.addr,t)}function sr(e,t){e.uniform1iv(this.addr,t)}function lr(e,t){e.uniform2iv(this.addr,t)}function ur(e,t){e.uniform3iv(this.addr,t)}function cr(e,t){e.uniform4iv(this.addr,t)}function hr(e,t){var n=Vn(t,this.size,2);e.uniform2fv(this.addr,n)}function dr(e,t){var n=Vn(t,this.size,3);e.uniform3fv(this.addr,n)}function fr(e,t){var n=Vn(t,this.size,4);e.uniform4fv(this.addr,n)}function pr(e,t){var n=Vn(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function mr(e,t){var n=Vn(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function vr(e,t){var n=Vn(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function gr(e,t,n){var r=t.length,i=Hn(n,r);e.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTexture2D(t[o]||Ln,i[o])}function yr(e,t,n){var r=t.length,i=Hn(n,r);e.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTextureCube(t[o]||On,i[o])}function _r(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Wn;case 35664:return qn;case 35665:return Yn;case 35666:return Xn;case 35674:return Zn;case 35675:return $n;case 35676:return Kn;case 35678:case 36198:return Jn;case 35679:return er;case 35680:return tr;case 36289:return Qn;case 5124:case 35670:return nr;case 35667:case 35671:return rr;case 35668:case 35672:return ir;case 35669:case 35673:return or}}(t.type)}function xr(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return ar;case 35664:return hr;case 35665:return dr;case 35666:return fr;case 35674:return pr;case 35675:return mr;case 35676:return vr;case 35678:case 36198:case 36298:case 36306:return gr;case 35680:case 36300:case 36308:return yr;case 5124:case 35670:return sr;case 35667:case 35671:return lr;case 35668:case 35672:return ur;case 35669:case 35673:return cr}}(t.type)}function br(e){this.id=e,this.seq=[],this.map={}}xr.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),jn(t,e)},br.prototype.setValue=function(e,t,n){for(var r=this.seq,i=0,o=r.length;i!==o;++i){var a=r[i];a.setValue(e,t[a.id],n)}};var wr=/([\w\d_]+)(\])?(\[|\.)?/g;function Sr(e,t){e.seq.push(t),e.map[t.id]=t}function Er(e,t,n){var r=e.name,i=r.length;for(wr.lastIndex=0;;){var o=wr.exec(r),a=wr.lastIndex,s=o[1],l="]"===o[2],u=o[3];if(l&&(s|=0),void 0===u||"["===u&&a+2===i){Sr(n,void 0===u?new _r(s,e,t):new xr(s,e,t));break}var c=n.map[s];void 0===c&&Sr(n,c=new br(s)),n=c}}function Tr(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),r=0;r<n;++r){var i=e.getActiveUniform(t,r);Er(i,e.getUniformLocation(t,i.name),this)}}function Mr(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}Tr.prototype.setValue=function(e,t,n,r){var i=this.map[t];void 0!==i&&i.setValue(e,n,r)},Tr.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},Tr.upload=function(e,t,n,r){for(var i=0,o=t.length;i!==o;++i){var a=t[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}},Tr.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var o=e[r];o.id in t&&n.push(o)}return n};var Cr=0;function Ar(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function Rr(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function Pr(e,t){var n=Ar(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function kr(e,t){var n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Uncharted2";break;case 4:n="OptimizedCineon";break;case 5:n="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Lr(e){return""!==e}function Nr(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ir(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Or=/^[ \t]*#include +<([\w\d./]+)>/gm;function Dr(e){return e.replace(Or,zr)}function zr(e,t){var n=hn[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Dr(n)}var Fr=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function Br(e){return e.replace(Fr,Ur)}function Ur(e,t,n,r){for(var i="",o=parseInt(t);o<parseInt(n);o++)i+=r.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function Vr(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Gr(e,t,n,r,i,o){var a,s,l,u,c=e.getContext(),h=r.defines,d=i.vertexShader,f=i.fragmentShader,p=function(e){var t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(o),m=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:t="ENVMAP_TYPE_EQUIREC";break;case 305:t="ENVMAP_TYPE_SPHERE"}return t}(o),v=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:case 304:t="ENVMAP_MODE_REFRACTION"}return t}(o),g=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(o),y=e.gammaFactor>0?e.gammaFactor:1,_=o.isWebGL2?"":function(e,t,n){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Lr).join("\n")}(r.extensions,o,t),x=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(h),b=c.createProgram(),w=o.numMultiviewViews;if(r.isRawShaderMaterial?((a=[x].filter(Lr).join("\n")).length>0&&(a+="\n"),(s=[_,x].filter(Lr).join("\n")).length>0&&(s+="\n")):(a=[Vr(o),"#define SHADER_NAME "+i.name,x,o.instancing?"#define USE_INSTANCING":"",o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+y,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+v:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexUvs?"#define USE_UV":"",o.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+p:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Lr).join("\n"),s=[_,Vr(o),"#define SHADER_NAME "+i.name,x,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+y,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+m:"",o.envMap?"#define "+v:"",o.envMap?"#define "+g:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.sheen?"#define USE_SHEEN":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexUvs?"#define USE_UV":"",o.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+p:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensions&&r.extensions.shaderTextureLOD||o.envMap)&&(o.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==o.toneMapping?"#define TONE_MAPPING":"",0!==o.toneMapping?hn.tonemapping_pars_fragment:"",0!==o.toneMapping?kr("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.matcapEncoding||o.envMapEncoding||o.emissiveMapEncoding||o.lightMapEncoding?hn.encodings_pars_fragment:"",o.mapEncoding?Pr("mapTexelToLinear",o.mapEncoding):"",o.matcapEncoding?Pr("matcapTexelToLinear",o.matcapEncoding):"",o.envMapEncoding?Pr("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?Pr("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.lightMapEncoding?Pr("lightMapTexelToLinear",o.lightMapEncoding):"",o.outputEncoding?("linearToOutputTexel",l=o.outputEncoding,u=Ar(l),"vec4 linearToOutputTexel( vec4 value ) { return LinearTo"+u[0]+u[1]+"; }"):"",o.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(Lr).join("\n")),d=Ir(d=Nr(d=Dr(d),o),o),f=Ir(f=Nr(f=Dr(f),o),o),d=Br(d),f=Br(f),o.isWebGL2&&!r.isRawShaderMaterial){var S=!1,E=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&null!==d.match(E)&&null!==f.match(E)&&(S=!0,d=d.replace(E,""),f=f.replace(E,"")),a=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+a,s=["#version 300 es\n","#define varying in",S?"":"out highp vec4 pc_fragColor;",S?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+s,w>0&&(a=(a=a.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+w+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+w+"];","uniform mat4 projectionMatrices["+w+"];","uniform mat4 viewMatrices["+w+"];","uniform mat3 normalMatrices["+w+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),s=(s=s.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+w+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))}var T,M,C=s+f,A=Mr(c,35633,a+d),R=Mr(c,35632,C);if(c.attachShader(b,A),c.attachShader(b,R),void 0!==r.index0AttributeName?c.bindAttribLocation(b,0,r.index0AttributeName):!0===o.morphTargets&&c.bindAttribLocation(b,0,"position"),c.linkProgram(b),e.debug.checkShaderErrors){var P=c.getProgramInfoLog(b).trim(),k=c.getShaderInfoLog(A).trim(),L=c.getShaderInfoLog(R).trim(),N=!0,I=!0;if(!1===c.getProgramParameter(b,35714)){N=!1;var O=Rr(c,A,"vertex"),D=Rr(c,R,"fragment");console.error("THREE.WebGLProgram: shader error: ",c.getError(),"35715",c.getProgramParameter(b,35715),"gl.getProgramInfoLog",P,O,D)}else""!==P?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",P):""!==k&&""!==L||(I=!1);I&&(this.diagnostics={runnable:N,material:r,programLog:P,vertexShader:{log:k,prefix:a},fragmentShader:{log:L,prefix:s}})}return c.deleteShader(A),c.deleteShader(R),this.getUniforms=function(){return void 0===T&&(T=new Tr(c,b)),T},this.getAttributes=function(){return void 0===M&&(M=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var o=e.getActiveAttrib(t,i).name;n[o]=e.getAttribLocation(t,o)}return n}(c,b)),M},this.destroy=function(){c.deleteProgram(b),this.program=void 0},this.name=i.name,this.id=Cr++,this.cacheKey=n,this.usedTimes=1,this.program=b,this.vertexShader=A,this.fragmentShader=R,this.numMultiviewViews=w,this}function jr(e,t,n){var r=[],i=n.isWebGL2,o=n.logarithmicDepthBuffer,a=n.floatVertexTextures,s=n.precision,l=n.maxVertexUniforms,u=n.vertexTextures,c={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},h=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function d(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=3e3,t}this.getParameters=function(t,r,h,f,p,m,v){var g=f.fog,y=t.isMeshStandardMaterial?f.environment:null,_=t.envMap||y,x=c[t.type],b=v.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(a)return 1024;var n=l,r=Math.floor((n-20)/4),i=Math.min(r,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}(v):0;null!==t.precision&&(s=n.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",s,"instead.");var w=e.getRenderTarget(),S=w&&w.isWebGLMultiviewRenderTarget?w.numViews:0;return{isWebGL2:i,shaderID:x,precision:s,instancing:!0===v.isInstancedMesh,supportsVertexTextures:u,numMultiviewViews:S,outputEncoding:null!==w?d(w.texture):e.outputEncoding,map:!!t.map,mapEncoding:d(t.map),matcap:!!t.matcap,matcapEncoding:d(t.matcap),envMap:!!_,envMapMode:_&&_.mapping,envMapEncoding:d(_),envMapCubeUV:!!_&&(306===_.mapping||307===_.mapping),lightMap:!!t.lightMap,lightMapEncoding:d(t.lightMap),aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:d(t.emissiveMap),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:1===t.normalMapType,tangentSpaceNormalMap:0===t.normalMapType,clearcoatNormalMap:!!t.clearcoatNormalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,sheen:!!t.sheen,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,vertexUvs:!!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||t.displacementMap),uvsVertexOnly:!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||!t.displacementMap),fog:!!g,useFog:t.fog,fogExp2:g&&g.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:o,skinning:t.skinning&&b>0,maxBones:b,useVertexTexture:a,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numDirLightShadows:r.directionalShadowMap.length,numPointLightShadows:r.pointShadowMap.length,numSpotLightShadows:r.spotShadowMap.length,numClippingPlanes:p,numClipIntersection:m,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.length>0,shadowMapType:e.shadowMap.type,toneMapping:t.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:2===t.side,flipSided:1===t.side,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCacheKey=function(t,n){var r=[];if(n.shaderID?r.push(n.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)r.push(i),r.push(t.defines[i]);if(void 0===t.isRawShaderMaterial){for(var o=0;o<h.length;o++)r.push(n[h[o]]);r.push(e.outputEncoding),r.push(e.gammaFactor)}return r.push(t.onBeforeCompile.toString()),r.join()},this.acquireProgram=function(n,i,o,a){for(var s,l=0,u=r.length;l<u;l++){var c=r[l];if(c.cacheKey===a){++(s=c).usedTimes;break}}return void 0===s&&(s=new Gr(e,t,a,n,i,o),r.push(s)),s},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function Hr(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Wr(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function qr(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Yr(){var e=[],t=0,n=[],r=[],i={id:-1};function o(n,r,o,a,s,l){var u=e[t];return void 0===u?(u={id:n.id,object:n,geometry:r,material:o,program:o.program||i,groupOrder:a,renderOrder:n.renderOrder,z:s,group:l},e[t]=u):(u.id=n.id,u.object=n,u.geometry=r,u.material=o,u.program=o.program||i,u.groupOrder=a,u.renderOrder=n.renderOrder,u.z=s,u.group=l),t++,u}return{opaque:n,transparent:r,init:function(){t=0,n.length=0,r.length=0},push:function(e,t,i,a,s,l){var u=o(e,t,i,a,s,l);(!0===i.transparent?r:n).push(u)},unshift:function(e,t,i,a,s,l){var u=o(e,t,i,a,s,l);(!0===i.transparent?r:n).unshift(u)},sort:function(e,t){n.length>1&&n.sort(e||Wr),r.length>1&&r.sort(t||qr)}}}function Xr(){var e=new WeakMap;function t(n){var r=n.target;r.removeEventListener("dispose",t),e.delete(r)}return{get:function(n,r){var i,o=e.get(n);return void 0===o?(i=new Yr,e.set(n,new WeakMap),e.get(n).set(r,i),n.addEventListener("dispose",t)):void 0===(i=o.get(r))&&(i=new Yr,o.set(r,i)),i},dispose:function(){e=new WeakMap}}}function Zr(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new E,color:new $e,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new x};break;case"SpotLight":n={position:new E,direction:new E,color:new $e,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new x};break;case"PointLight":n={position:new E,color:new $e,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new x,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new E,skyColor:new $e,groundColor:new $e};break;case"RectAreaLight":n={color:new $e,position:new E,halfWidth:new E,halfHeight:new E}}return e[t.id]=n,n}}}var $r=0;function Kr(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Jr(){for(var e=new Zr,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},n=0;n<9;n++)t.probe.push(new E);var r=new E,i=new V,o=new V;return{setup:function(n,a,s){for(var l=0,u=0,c=0,h=0;h<9;h++)t.probe[h].set(0,0,0);var d=0,f=0,p=0,m=0,v=0,g=0,y=0,_=0,x=s.matrixWorldInverse;n.sort(Kr),h=0;for(var b=n.length;h<b;h++){var w=n[h],S=w.color,E=w.intensity,T=w.distance,M=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)l+=S.r*E,u+=S.g*E,c+=S.b*E;else if(w.isLightProbe)for(var C=0;C<9;C++)t.probe[C].addScaledVector(w.sh.coefficients[C],E);else if(w.isDirectionalLight){if((R=e.get(w)).color.copy(w.color).multiplyScalar(w.intensity),R.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),R.direction.sub(r),R.direction.transformDirection(x),R.shadow=w.castShadow,w.castShadow){var A=w.shadow;R.shadowBias=A.bias,R.shadowRadius=A.radius,R.shadowMapSize=A.mapSize,t.directionalShadowMap[d]=M,t.directionalShadowMatrix[d]=w.shadow.matrix,g++}t.directional[d]=R,d++}else if(w.isSpotLight)(R=e.get(w)).position.setFromMatrixPosition(w.matrixWorld),R.position.applyMatrix4(x),R.color.copy(S).multiplyScalar(E),R.distance=T,R.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),R.direction.sub(r),R.direction.transformDirection(x),R.coneCos=Math.cos(w.angle),R.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),R.decay=w.decay,R.shadow=w.castShadow,w.castShadow&&(A=w.shadow,R.shadowBias=A.bias,R.shadowRadius=A.radius,R.shadowMapSize=A.mapSize,t.spotShadowMap[p]=M,t.spotShadowMatrix[p]=w.shadow.matrix,_++),t.spot[p]=R,p++;else if(w.isRectAreaLight)(R=e.get(w)).color.copy(S).multiplyScalar(E),R.position.setFromMatrixPosition(w.matrixWorld),R.position.applyMatrix4(x),o.identity(),i.copy(w.matrixWorld),i.premultiply(x),o.extractRotation(i),R.halfWidth.set(.5*w.width,0,0),R.halfHeight.set(0,.5*w.height,0),R.halfWidth.applyMatrix4(o),R.halfHeight.applyMatrix4(o),t.rectArea[m]=R,m++;else if(w.isPointLight)(R=e.get(w)).position.setFromMatrixPosition(w.matrixWorld),R.position.applyMatrix4(x),R.color.copy(w.color).multiplyScalar(w.intensity),R.distance=w.distance,R.decay=w.decay,R.shadow=w.castShadow,w.castShadow&&(A=w.shadow,R.shadowBias=A.bias,R.shadowRadius=A.radius,R.shadowMapSize=A.mapSize,R.shadowCameraNear=A.camera.near,R.shadowCameraFar=A.camera.far,t.pointShadowMap[f]=M,t.pointShadowMatrix[f]=w.shadow.matrix,y++),t.point[f]=R,f++;else if(w.isHemisphereLight){var R;(R=e.get(w)).direction.setFromMatrixPosition(w.matrixWorld),R.direction.transformDirection(x),R.direction.normalize(),R.skyColor.copy(w.color).multiplyScalar(E),R.groundColor.copy(w.groundColor).multiplyScalar(E),t.hemi[v]=R,v++}}t.ambient[0]=l,t.ambient[1]=u,t.ambient[2]=c;var P=t.hash;P.directionalLength===d&&P.pointLength===f&&P.spotLength===p&&P.rectAreaLength===m&&P.hemiLength===v&&P.numDirectionalShadows===g&&P.numPointShadows===y&&P.numSpotShadows===_||(t.directional.length=d,t.spot.length=p,t.rectArea.length=m,t.point.length=f,t.hemi.length=v,t.directionalShadowMap.length=g,t.pointShadowMap.length=y,t.spotShadowMap.length=_,t.directionalShadowMatrix.length=g,t.pointShadowMatrix.length=y,t.spotShadowMatrix.length=_,P.directionalLength=d,P.pointLength=f,P.spotLength=p,P.rectAreaLength=m,P.hemiLength=v,P.numDirectionalShadows=g,P.numPointShadows=y,P.numSpotShadows=_,t.version=$r++)},state:t}}function Qr(){var e=new Jr,t=[],n=[];return{init:function(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function(r){e.setup(t,n,r)},pushLight:function(e){t.push(e)},pushShadow:function(e){n.push(e)}}}function ei(){var e=new WeakMap;function t(n){var r=n.target;r.removeEventListener("dispose",t),e.delete(r)}return{get:function(n,r){var i;return!1===e.has(n)?(i=new Qr,e.set(n,new WeakMap),e.get(n).set(r,i),n.addEventListener("dispose",t)):!1===e.get(n).has(r)?(i=new Qr,e.get(n).set(r,i)):i=e.get(n).get(r),i},dispose:function(){e=new WeakMap}}}function ti(e){nt.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function ni(e){nt.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new E,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}function ri(e,t,n){var r=new cn,i=new x,o=new x,a=new k,s=[],l=[],u={},c={0:1,1:0,2:2},h=new tn({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new x},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=h.clone();d.defines.HORIZONAL_PASS=1;var f=new Et;f.setAttribute("position",new ot(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var p=new Gt(f,h),m=this;function v(n,r){var i=t.update(p);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,h,p,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,d,p,null)}function g(e,t,n){var r=e<<0|t<<1|n<<2,i=s[r];return void 0===i&&(i=new ti({depthPacking:3201,morphTargets:e,skinning:t}),s[r]=i),i}function y(e,t,n){var r=e<<0|t<<1|n<<2,i=l[r];return void 0===i&&(i=new ni({morphTargets:e,skinning:t}),l[r]=i),i}function _(t,n,r,i,o,a){var s=t.geometry,l=null,h=g,d=t.customDepthMaterial;if(!0===r.isPointLight&&(h=y,d=t.customDistanceMaterial),void 0===d){var f=!1;!0===n.morphTargets&&(!0===s.isBufferGeometry?f=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:!0===s.isGeometry&&(f=s.morphTargets&&s.morphTargets.length>0));var p=!1;!0===t.isSkinnedMesh&&(!0===n.skinning?p=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),l=h(f,p,!0===t.isInstancedMesh)}else l=d;if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){var m=l.uuid,v=n.uuid,_=u[m];void 0===_&&(_={},u[m]=_);var x=_[v];void 0===x&&(x=l.clone(),_[v]=x),l=x}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=3===a?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:c[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=i,l.farDistance=o),l}function b(n,i,o,a,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);var l=t.update(n),u=n.material;if(Array.isArray(u))for(var c=l.groups,h=0,d=c.length;h<d;h++){var f=c[h],p=u[f.materialIndex];if(p&&p.visible){var m=_(n,p,a,o.near,o.far,s);e.renderBufferDirect(o,null,l,m,n,f)}}else u.visible&&(m=_(n,u,a,o.near,o.far,s),e.renderBufferDirect(o,null,l,m,n,null))}for(var v=n.children,g=0,y=v.length;g<y;g++)b(v[g],i,o,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,s,l){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var f=0,p=t.length;f<p;f++){var g=t[f],y=g.shadow;if(void 0!==y){i.copy(y.mapSize);var _=y.getFrameExtents();if(i.multiply(_),o.copy(y.mapSize),(i.x>n||i.y>n)&&(console.warn("THREE.WebGLShadowMap:",g,"has shadow exceeding max texture size, reducing"),i.x>n&&(o.x=Math.floor(n/_.x),i.x=o.x*_.x,y.mapSize.x=o.x),i.y>n&&(o.y=Math.floor(n/_.y),i.y=o.y*_.y,y.mapSize.y=o.y)),null===y.map&&!y.isPointLightShadow&&3===this.type){var x={minFilter:1006,magFilter:1006,format:1023};y.map=new L(i.x,i.y,x),y.map.texture.name=g.name+".shadowMap",y.mapPass=new L(i.x,i.y,x),y.camera.updateProjectionMatrix()}null===y.map&&(x={minFilter:1003,magFilter:1003,format:1023},y.map=new L(i.x,i.y,x),y.map.texture.name=g.name+".shadowMap",y.camera.updateProjectionMatrix()),e.setRenderTarget(y.map),e.clear();for(var w=y.getViewportCount(),S=0;S<w;S++){var E=y.getViewport(S);a.set(o.x*E.x,o.y*E.y,o.x*E.z,o.y*E.w),d.viewport(a),y.updateMatrices(g,S),r=y.getFrustum(),b(s,l,y.camera,g,this.type)}y.isPointLightShadow||3!==this.type||v(y,l)}else console.warn("THREE.WebGLShadowMap:",g,"has no shadow.")}m.needsUpdate=!1,e.setRenderTarget(u,c,h)}}}function ii(e,t,n){var r,i,o=n.isWebGL2,a=new function(){var t=!1,n=new k,r=null,i=new k(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),n.set(t,r,o,a),!1===i.equals(n)&&(e.clearColor(t,r,o,a),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,r=null,i=null;return{setTest:function(e){e?G(2929):j(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},l=new function(){var t=!1,n=null,r=null,i=null,o=null,a=null,s=null,l=null,u=null;return{setTest:function(e){t||(e?G(2960):j(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,a){r===t&&i===n&&o===a||(e.stencilFunc(t,n,a),r=t,i=n,o=a)},setOp:function(t,n,r){a===t&&s===n&&l===r||(e.stencilOp(t,n,r),a=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,a=null,s=null,l=null,u=null}}},c=e.getParameter(34921),h=new Uint8Array(c),d=new Uint8Array(c),f=new Uint8Array(c),p={},m=null,v=null,g=null,y=null,_=null,x=null,b=null,w=null,S=null,E=!1,T=null,M=null,C=null,A=null,R=null,P=e.getParameter(35661),L=!1,N=0,I=e.getParameter(7938);-1!==I.indexOf("WebGL")?(N=parseFloat(/^WebGL\ ([0-9])/.exec(I)[1]),L=N>=1):-1!==I.indexOf("OpenGL ES")&&(N=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(I)[1]),L=N>=2);var O=null,D={},z=new k,F=new k;function B(t,n,r){var i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var a=0;a<r;a++)e.texImage2D(n+a,0,6408,1,1,0,6408,5121,i);return o}var U={};function V(n,r){h[n]=1,0===d[n]&&(e.enableVertexAttribArray(n),d[n]=1),f[n]!==r&&((o?e:t.get("ANGLE_instanced_arrays"))[o?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),f[n]=r)}function G(t){!0!==p[t]&&(e.enable(t),p[t]=!0)}function j(t){!1!==p[t]&&(e.disable(t),p[t]=!1)}U[3553]=B(3553,3553,1),U[34067]=B(34067,34069,6),a.setClear(0,0,0,1),s.setClear(1),l.setClear(0),G(2929),s.setFunc(3),X(!1),Z(1),G(2884),Y(0);var H=(u(r={},100,32774),u(r,101,32778),u(r,102,32779),r);if(o)H[103]=32775,H[104]=32776;else{var W=t.get("EXT_blend_minmax");null!==W&&(H[103]=W.MIN_EXT,H[104]=W.MAX_EXT)}var q=(u(i={},200,0),u(i,201,1),u(i,202,768),u(i,204,770),u(i,210,776),u(i,208,774),u(i,206,772),u(i,203,769),u(i,205,771),u(i,209,775),u(i,207,773),i);function Y(t,n,r,i,o,a,s,l){if(0!==t){if(v||(G(3042),v=!0),5===t)o=o||n,a=a||r,s=s||i,n===y&&o===b||(e.blendEquationSeparate(H[n],H[o]),y=n,b=o),r===_&&i===x&&a===w&&s===S||(e.blendFuncSeparate(q[r],q[i],q[a],q[s]),_=r,x=i,w=a,S=s),g=t,E=null;else if(t!==g||l!==E){if(100===y&&100===b||(e.blendEquation(32774),y=100,b=100),l)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}_=null,x=null,w=null,S=null,g=t,E=l}}else v&&(j(3042),v=!1)}function X(t){T!==t&&(t?e.frontFace(2304):e.frontFace(2305),T=t)}function Z(t){0!==t?(G(2884),t!==M&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):j(2884),M=t}function $(t,n,r){t?(G(32823),A===n&&R===r||(e.polygonOffset(n,r),A=n,R=r)):j(32823)}function K(t){void 0===t&&(t=33984+P-1),O!==t&&(e.activeTexture(t),O=t)}return{buffers:{color:a,depth:s,stencil:l},initAttributes:function(){for(var e=0,t=h.length;e<t;e++)h[e]=0},enableAttribute:function(e){V(e,0)},enableAttributeAndDivisor:V,disableUnusedAttributes:function(){for(var t=0,n=d.length;t!==n;++t)d[t]!==h[t]&&(e.disableVertexAttribArray(t),d[t]=0)},enable:G,disable:j,useProgram:function(t){return m!==t&&(e.useProgram(t),m=t,!0)},setBlending:Y,setMaterial:function(e,t){2===e.side?j(2884):G(2884);var n=1===e.side;t&&(n=!n),X(n),1===e.blending&&!1===e.transparent?Y(0):Y(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),a.setMask(e.colorWrite);var r=e.stencilWrite;l.setTest(r),r&&(l.setMask(e.stencilWriteMask),l.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),l.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),$(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:X,setCullFace:Z,setLineWidth:function(t){t!==C&&(L&&e.lineWidth(t),C=t)},setPolygonOffset:$,setScissorTest:function(e){e?G(3089):j(3089)},activeTexture:K,bindTexture:function(t,n){null===O&&K();var r=D[O];void 0===r&&(r={type:void 0,texture:void 0},D[O]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||U[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=D[O];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===z.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),z.copy(t))},viewport:function(t){!1===F.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),F.copy(t))},reset:function(){for(var t=0;t<d.length;t++)1===d[t]&&(e.disableVertexAttribArray(t),d[t]=0);p={},O=null,D={},m=null,g=null,T=null,M=null,a.reset(),s.reset(),l.reset()}}}function oi(e,t,n,r,i,o,a){var s,l,c,h=i.isWebGL2,d=i.maxTextures,f=i.maxCubemapSize,p=i.maxTextureSize,m=i.maxSamples,v=new WeakMap,g=!1;try{g="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function y(e,t){return g?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function x(e,t,n,r){var i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var o=t?_.floorPowerOfTwo:Math.floor,a=o(i*e.width),s=o(i*e.height);void 0===c&&(c=y(a,s));var l=n?y(a,s):c;return l.width=a,l.height=s,l.getContext("2d").drawImage(e,0,0,a,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+s+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function b(e){return _.isPowerOfTwo(e.width)&&_.isPowerOfTwo(e.height)}function w(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function S(t,n,i,o){e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function E(n,r,i){if(!1===h)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325===o||33326===o||34842===o||34836===o?t.get("EXT_color_buffer_float"):34843!==o&&34837!==o||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),o}function T(e){return 1003===e||1004===e||1005===e?9728:9729}function M(t){var n=t.target;n.removeEventListener("dispose",M),function(t){var n=r.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),r.remove(t))}(n),n.isVideoTexture&&v.delete(n),a.memory.textures--}function C(t){var n=t.target;n.removeEventListener("dispose",C),function(t){var n=r.get(t),i=r.get(t.texture);if(t){if(void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(n.__webglFramebuffer[o]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[o]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);if(t.isWebGLMultiviewRenderTarget){e.deleteTexture(n.__webglColorTexture),e.deleteTexture(n.__webglDepthStencilTexture),a.memory.textures-=2,o=0;for(var s=n.__webglViewFramebuffers.length;o<s;o++)e.deleteFramebuffer(n.__webglViewFramebuffers[o])}r.remove(t.texture),r.remove(t)}}(n),a.memory.textures--}var A=0;function R(e,t){var i=r.get(e);if(e.isVideoTexture&&function(e){var t=a.render.frame;v.get(e)!==t&&(v.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){var o=e.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void D(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function P(t,i){if(6===t.image.length){var a=r.get(t);if(t.version>0&&a.__version!==t.version){O(a,t),n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture),e.pixelStorei(37440,t.flipY);for(var s=t&&t.isCompressedTexture,l=t.image[0]&&t.image[0].isDataTexture,u=[],c=0;c<6;c++)u[c]=s||l?l?t.image[c].image:t.image[c]:x(t.image[c],!1,!0,f);var d,p=u[0],m=b(p)||h,v=o.convert(t.format),g=o.convert(t.type),y=E(t.internalFormat,v,g);if(I(34067,t,m),s){for(c=0;c<6;c++){d=u[c].mipmaps;for(var _=0;_<d.length;_++){var T=d[_];1023!==t.format&&1022!==t.format?null!==v?n.compressedTexImage2D(34069+c,_,y,T.width,T.height,0,T.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+c,_,y,T.width,T.height,0,v,g,T.data)}}a.__maxMipLevel=d.length-1}else{for(d=t.mipmaps,c=0;c<6;c++)if(l)for(n.texImage2D(34069+c,0,y,u[c].width,u[c].height,0,v,g,u[c].data),_=0;_<d.length;_++){var M=(T=d[_]).image[c].image;n.texImage2D(34069+c,_+1,y,M.width,M.height,0,v,g,M.data)}else for(n.texImage2D(34069+c,0,y,v,g,u[c]),_=0;_<d.length;_++)T=d[_],n.texImage2D(34069+c,_+1,y,v,g,T.image[c]);a.__maxMipLevel=d.length}w(t,m)&&S(34067,t,p.width,p.height),a.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture)}}function k(e,t){n.activeTexture(33984+t),n.bindTexture(34067,r.get(e).__webglTexture)}var L=(u(s={},1e3,10497),u(s,1001,33071),u(s,1002,33648),s),N=(u(l={},1003,9728),u(l,1004,9984),u(l,1005,9986),u(l,1006,9729),u(l,1007,9985),u(l,1008,9987),l);function I(n,o,a){a?(e.texParameteri(n,10242,L[o.wrapS]),e.texParameteri(n,10243,L[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,L[o.wrapR]),e.texParameteri(n,10240,N[o.magFilter]),e.texParameteri(n,10241,N[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),1001===o.wrapS&&1001===o.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,T(o.magFilter)),e.texParameteri(n,10241,T(o.minFilter)),1003!==o.minFilter&&1006!==o.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(1015===o.type&&null===t.get("OES_texture_float_linear"))return;if(1016===o.type&&null===(h||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function O(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",M),t.__webglTexture=e.createTexture(),a.memory.textures++)}function D(t,r,i){var a=3553;r.isDataTexture2DArray&&(a=35866),r.isDataTexture3D&&(a=32879),O(t,r),n.activeTexture(33984+i),n.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);var s=function(e){return!h&&(1001!==e.wrapS||1001!==e.wrapT||1003!==e.minFilter&&1006!==e.minFilter)}(r)&&!1===b(r.image),l=x(r.image,s,!1,p),u=b(l)||h,c=o.convert(r.format),d=o.convert(r.type),f=E(r.internalFormat,c,d);I(a,r,u);var m,v=r.mipmaps;if(r.isDepthTexture){if(f=6402,1015===r.type){if(!1===h)throw new Error("Float Depth Texture only supported in WebGL2.0");f=36012}else h&&(f=33189);1026===r.format&&6402===f&&1012!==r.type&&1014!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=1012,d=o.convert(r.type)),1027===r.format&&(f=34041,1020!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=1020,d=o.convert(r.type))),n.texImage2D(3553,0,f,l.width,l.height,0,c,d,null)}else if(r.isDataTexture)if(v.length>0&&u){for(var g=0,y=v.length;g<y;g++)m=v[g],n.texImage2D(3553,g,f,m.width,m.height,0,c,d,m.data);r.generateMipmaps=!1,t.__maxMipLevel=v.length-1}else n.texImage2D(3553,0,f,l.width,l.height,0,c,d,l.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(g=0,y=v.length;g<y;g++)m=v[g],1023!==r.format&&1022!==r.format?null!==c?n.compressedTexImage2D(3553,g,f,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,g,f,m.width,m.height,0,c,d,m.data);t.__maxMipLevel=v.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,f,l.width,l.height,l.depth,0,c,d,l.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,f,l.width,l.height,l.depth,0,c,d,l.data),t.__maxMipLevel=0;else if(v.length>0&&u){for(g=0,y=v.length;g<y;g++)m=v[g],n.texImage2D(3553,g,f,c,d,m);r.generateMipmaps=!1,t.__maxMipLevel=v.length-1}else n.texImage2D(3553,0,f,c,d,l),t.__maxMipLevel=0;w(r,u)&&S(a,r,l.width,l.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function z(t,i,a,s){var l=o.convert(i.texture.format),u=o.convert(i.texture.type),c=E(i.texture.internalFormat,l,u);n.texImage2D(s,0,c,i.width,i.height,0,l,u,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function F(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){if(r){var i=U(n);e.renderbufferStorageMultisample(36161,i,33189,n.width,n.height)}else e.renderbufferStorage(36161,33189,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer)r?(i=U(n),e.renderbufferStorageMultisample(36161,i,35056,n.width,n.height)):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t);else{var a=o.convert(n.texture.format),s=o.convert(n.texture.type),l=E(n.texture.internalFormat,a,s);r?(i=U(n),e.renderbufferStorageMultisample(36161,i,l,n.width,n.height)):e.renderbufferStorage(36161,l,n.width,n.height)}e.bindRenderbuffer(36161,null)}function B(t){var n=r.get(t),i=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),R(n.depthTexture,0);var i=r.get(n.depthTexture).__webglTexture;if(1026===n.depthTexture.format)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(1027!==n.depthTexture.format)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(36160,n.__webglFramebuffer[o]),n.__webglDepthbuffer[o]=e.createRenderbuffer(),F(n.__webglDepthbuffer[o],t)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),F(n.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function U(e){return h&&e.isWebGLMultisampleRenderTarget?Math.min(m,e.samples):0}var V=!1,G=!1;this.allocateTextureUnit=function(){var e=A;return e>=d&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+d),A+=1,e},this.resetTextureUnits=function(){A=0},this.setTexture2D=R,this.setTexture2DArray=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?D(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?D(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=P,this.setTextureCubeDynamic=k,this.setupRenderTarget=function(i){var s=r.get(i),l=r.get(i.texture);i.addEventListener("dispose",C),l.__webglTexture=e.createTexture(),a.memory.textures++;var u=!0===i.isWebGLRenderTargetCube,c=!0===i.isWebGLMultisampleRenderTarget,d=!0===i.isWebGLMultiviewRenderTarget,f=b(i)||h;if(u){s.__webglFramebuffer=[];for(var p=0;p<6;p++)s.__webglFramebuffer[p]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),c)if(h){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var m=o.convert(i.texture.format),v=o.convert(i.texture.type),g=E(i.texture.internalFormat,m,v),y=U(i);e.renderbufferStorageMultisample(36161,y,g,i.width,i.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),i.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),F(s.__webglDepthRenderbuffer,i,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(d){var _=i.width,x=i.height,T=i.numViews;e.bindFramebuffer(36160,s.__webglFramebuffer);var M=t.get("OVR_multiview2");a.memory.textures+=2;var A=e.createTexture();e.bindTexture(35866,A),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,32856,_,x,T,0,6408,5121,null),M.framebufferTextureMultiviewOVR(36160,36064,A,0,0,T);var R=e.createTexture();e.bindTexture(35866,R),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,35056,_,x,T,0,34041,34042,null),M.framebufferTextureMultiviewOVR(36160,33306,R,0,0,T);var P=new Array(T);for(p=0;p<T;++p)P[p]=e.createFramebuffer(),e.bindFramebuffer(36160,P[p]),e.framebufferTextureLayer(36160,36064,A,0,p);s.__webglColorTexture=A,s.__webglDepthStencilTexture=R,s.__webglViewFramebuffers=P,e.bindFramebuffer(36160,null),e.bindTexture(35866,null)}if(u){for(n.bindTexture(34067,l.__webglTexture),I(34067,i.texture,f),p=0;p<6;p++)z(s.__webglFramebuffer[p],i,36064,34069+p);w(i.texture,f)&&S(34067,i.texture,i.width,i.height),n.bindTexture(34067,null)}else d||(n.bindTexture(3553,l.__webglTexture),I(3553,i.texture,f),z(s.__webglFramebuffer,i,36064,3553),w(i.texture,f)&&S(3553,i.texture,i.width,i.height),n.bindTexture(3553,null));i.depthBuffer&&B(i)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(w(t,b(e)||h)){var i=e.isWebGLRenderTargetCube?34067:3553,o=r.get(t).__webglTexture;n.bindTexture(i,o),S(i,t,e.width,e.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(h){var n=r.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);var i=t.width,o=t.height,a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024),e.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===V&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),V=!0),e=e.texture),R(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===G&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),G=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?P(e,t):k(e,t)}}function ai(e,t,n){var r=n.isWebGL2;return{convert:function(e){var n;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(1012===e)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(1015===e)return 5126;if(1016===e)return r?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(1021===e)return 6406;if(1022===e)return 6407;if(1023===e)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(1026===e)return 6402;if(1027===e)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===e)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return 36196===e?null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null:37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:1020===e?r?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function si(e,t,n,r){L.call(this,e,t,r),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=n}function li(e,t){var n,r,i,o,a,s,l,u=e.extensions,c=e.properties,h=0;function d(e){return e.isArrayCamera?e.cameras:(a[0]=e,a)}this.isAvailable=function(){if(void 0===l){var e=u.get("OVR_multiview2");if(l=null!==e&&!1===t.getContextAttributes().antialias){h=t.getParameter(e.MAX_VIEWS_OVR),n=new si(0,0,2),s=new x,o=[],i=[],a=[];for(var r=0;r<h;r++)o[r]=new V,i[r]=new C}}return l},this.attachCamera=function(t){!1!==function(e){if(void 0===e.isArrayCamera)return!0;var t=e.cameras;if(t.length>h)return!1;for(var n=1,r=t.length;n<r;n++)if(t[0].viewport.z!==t[n].viewport.z||t[0].viewport.w!==t[n].viewport.w)return!1;return!0}(t)&&(r=e.getRenderTarget(),function(t){if(r?s.set(r.width,r.height):e.getDrawingBufferSize(s),t.isArrayCamera){var i=t.cameras[0].viewport;n.setSize(i.z,i.w),n.setNumViews(t.cameras.length)}else n.setSize(s.x,s.y),n.setNumViews(2)}(t),e.setRenderTarget(n))},this.detachCamera=function(i){n===e.getRenderTarget()&&(e.setRenderTarget(r),function(e){var r=n,i=r.numViews,o=c.get(r).__webglViewFramebuffers,a=r.width,l=r.height;if(e.isArrayCamera)for(var u=0;u<i;u++){var h=e.cameras[u].viewport,d=h.x,f=h.y,p=d+h.z,m=f+h.w;t.bindFramebuffer(36008,o[u]),t.blitFramebuffer(0,0,a,l,d,f,p,m,16384,9728)}else t.bindFramebuffer(36008,o[0]),t.blitFramebuffer(0,0,a,l,0,0,s.x,s.y,16384,9728)}(i))},this.updateCameraProjectionMatricesUniform=function(e,n){for(var r=d(e),i=0;i<r.length;i++)o[i].copy(r[i].projectionMatrix);n.setValue(t,"projectionMatrices",o)},this.updateCameraViewMatricesUniform=function(e,n){for(var r=d(e),i=0;i<r.length;i++)o[i].copy(r[i].matrixWorldInverse);n.setValue(t,"viewMatrices",o)},this.updateObjectMatricesUniforms=function(e,n,r){for(var a=d(n),s=0;s<a.length;s++)o[s].multiplyMatrices(a[s].matrixWorldInverse,e.matrixWorld),i[s].getNormalMatrix(o[s]);r.setValue(t,"modelViewMatrices",o),r.setValue(t,"normalMatrices",i)}}function ui(e){rn.call(this),this.cameras=e||[]}function ci(){oe.call(this),this.type="Group"}function hi(e,t){var n=this,r=null,i=null,o="local-floor",a=null,s=[],l=new Map,u=new rn;u.layers.enable(1),u.viewport=new k;var c=new rn;c.layers.enable(2),c.viewport=new k;var h=new ui([u,c]);function d(e){var t=l.get(e.inputSource);t&&t.dispatchEvent({type:e.type})}function f(){l.forEach((function(e,t){e.dispatchEvent({type:"disconnected",data:t}),e.visible=!1})),l.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),x.stop(),n.dispatchEvent({type:"sessionend"}),n.isPresenting=!1}function p(e){i=e,x.setContext(r),x.start(),n.dispatchEvent({type:"sessionstart"}),n.isPresenting=!0}function m(e){for(var t=r.inputSources,n=0;n<s.length;n++)l.set(t[n],s[n]);for(n=0;n<e.removed.length;n++){var i=e.removed[n];(o=l.get(i))&&(o.dispatchEvent({type:"disconnected",data:i}),l.delete(i))}for(n=0;n<e.added.length;n++){var o;i=e.added[n],(o=l.get(i))&&o.dispatchEvent({type:"connected",data:i})}}h.layers.enable(1),h.layers.enable(2),this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new ci).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(e){o=e},this.getReferenceSpace=function(){return i},this.getSession=function(){return r},this.setSession=function(e){if(null!==(r=e)){r.addEventListener("select",d),r.addEventListener("selectstart",d),r.addEventListener("selectend",d),r.addEventListener("squeeze",d),r.addEventListener("squeezestart",d),r.addEventListener("squeezeend",d),r.addEventListener("end",f);var n=t.getContextAttributes(),i={antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil},a=new XRWebGLLayer(r,t,i);r.updateRenderState({baseLayer:a}),r.requestReferenceSpace(o).then(p),r.addEventListener("inputsourceschange",m)}};var v=new E,g=new E;function y(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){var t=e.parent,n=h.cameras;y(h,t);for(var r=0;r<n.length;r++)y(n[r],t);e.matrixWorld.copy(h.matrixWorld);for(var i=e.children,o=(r=0,i.length);r<o;r++)i[r].updateMatrixWorld(!0);return function(e,t,n){v.setFromMatrixPosition(t.matrixWorld),g.setFromMatrixPosition(n.matrixWorld);var r=v.distanceTo(g),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(o[8]+1)/o[0],d=a*c,f=a*h,p=r/(-c+h),m=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var y=a+p,_=s+p,x=d-m,b=f+(r-m),w=l*s/_*y,S=u*s/_*y;e.projectionMatrix.makePerspective(x,b,w,S,y,_)}(h,u,c),h};var _=null,x=new pn;x.setAnimationLoop((function(t,n){if(null!==(a=n.getViewerPose(i))){var o=a.views,l=r.renderState.baseLayer;e.setFramebuffer(l.framebuffer);for(var u=0;u<o.length;u++){var c=o[u],d=l.getViewport(c),f=c.transform.inverse.matrix,p=h.cameras[u];p.matrix.fromArray(f).getInverse(p.matrix),p.projectionMatrix.fromArray(c.projectionMatrix),p.viewport.set(d.x,d.y,d.width,d.height),0===u&&h.matrix.copy(p.matrix)}}var m=r.inputSources;for(u=0;u<s.length;u++){var v=s[u],g=m[u];if(g){var y=n.getPose(g.targetRaySpace,i);if(null!==y){v.matrix.fromArray(y.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.visible=!0;continue}}v.visible=!1}_&&_(t,n)})),this.setAnimationLoop=function(e){_=e},this.dispose=function(){}}function di(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,h=null,d=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=1,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var f,p,m,v,g,y,b,w,S,T,M,C,A,R,P,L,N,I,O=this,D=!1,z=null,F=0,B=0,U=null,G=null,j=-1,H={geometry:null,program:null,wireframe:!1},W=null,q=null,Y=new k,X=new k,Z=null,$=t.width,K=t.height,J=1,Q=null,ee=null,te=new k(0,0,$,K),ne=new k(0,0,$,K),re=!1,ie=new cn,oe=new bn,se=!1,le=!1,ue=new V,ce=new E;function he(){return null===U?J:1}try{var de={alpha:r,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:c,xrCompatible:!0};if(t.addEventListener("webglcontextlost",ge,!1),t.addEventListener("webglcontextrestored",ye,!1),null===(f=n||t.getContext("webgl",de)||t.getContext("experimental-webgl",de)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===f.getShaderPrecisionFormat&&(f.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function fe(){p=new wn(f),!1===(m=new xn(f,p,e)).isWebGL2&&(p.get("WEBGL_depth_texture"),p.get("OES_texture_float"),p.get("OES_texture_half_float"),p.get("OES_texture_half_float_linear"),p.get("OES_standard_derivatives"),p.get("OES_element_index_uint"),p.get("ANGLE_instanced_arrays")),p.get("OES_texture_float_linear"),I=new ai(f,p,m),(v=new ii(f,p,m)).scissor(X.copy(ne).multiplyScalar(J).floor()),v.viewport(Y.copy(te).multiplyScalar(J).floor()),g=new Tn(f),y=new Hr,b=new oi(f,p,v,y,m,I,g),w=new mn(f),S=new Sn(f,w,g),T=new An(f,S,w,g),P=new Cn(f),M=new jr(O,p,m),C=new Xr,A=new ei,R=new yn(O,v,T,s),L=new _n(f,p,g,m),N=new En(f,p,g,m),g.programs=M.programs,O.capabilities=m,O.extensions=p,O.properties=y,O.renderLists=C,O.state=v,O.info=g}fe();var pe=new hi(O,f);this.xr=pe;var me=new li(O,f),ve=new ri(O,T,m.maxTextureSize);function ge(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),D=!0}function ye(){console.log("THREE.WebGLRenderer: Context Restored."),D=!1,fe()}function _e(e){var t=e.target;t.removeEventListener("dispose",_e),function(e){xe(e),y.remove(e)}(t)}function xe(e){var t=y.get(e).program;e.program=void 0,void 0!==t&&M.releaseProgram(t)}this.shadowMap=ve,this.getContext=function(){return f},this.getContextAttributes=function(){return f.getContextAttributes()},this.forceContextLoss=function(){var e=p.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=p.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return J},this.setPixelRatio=function(e){void 0!==e&&(J=e,this.setSize($,K,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new x),e.set($,K)},this.setSize=function(e,n,r){pe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):($=e,K=n,t.width=Math.floor(e*J),t.height=Math.floor(n*J),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new x),e.set($*J,K*J).floor()},this.setDrawingBufferSize=function(e,n,r){$=e,K=n,J=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new k),e.copy(Y)},this.getViewport=function(e){return e.copy(te)},this.setViewport=function(e,t,n,r){e.isVector4?te.set(e.x,e.y,e.z,e.w):te.set(e,t,n,r),v.viewport(Y.copy(te).multiplyScalar(J).floor())},this.getScissor=function(e){return e.copy(ne)},this.setScissor=function(e,t,n,r){e.isVector4?ne.set(e.x,e.y,e.z,e.w):ne.set(e,t,n,r),v.scissor(X.copy(ne).multiplyScalar(J).floor())},this.getScissorTest=function(){return re},this.setScissorTest=function(e){v.setScissorTest(re=e)},this.setOpaqueSort=function(e){Q=e},this.setTransparentSort=function(e){ee=e},this.getClearColor=function(){return R.getClearColor()},this.setClearColor=function(){R.setClearColor.apply(R,arguments)},this.getClearAlpha=function(){return R.getClearAlpha()},this.setClearAlpha=function(){R.setClearAlpha.apply(R,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),f.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ge,!1),t.removeEventListener("webglcontextrestored",ye,!1),C.dispose(),A.dispose(),y.dispose(),T.dispose(),pe.dispose(),Se.stop()},this.renderBufferImmediate=function(e,t){v.initAttributes();var n=y.get(e);e.hasPositions&&!n.position&&(n.position=f.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=f.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=f.createBuffer()),e.hasColors&&!n.color&&(n.color=f.createBuffer());var r=t.getAttributes();e.hasPositions&&(f.bindBuffer(34962,n.position),f.bufferData(34962,e.positionArray,35048),v.enableAttribute(r.position),f.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(f.bindBuffer(34962,n.normal),f.bufferData(34962,e.normalArray,35048),v.enableAttribute(r.normal),f.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(f.bindBuffer(34962,n.uv),f.bufferData(34962,e.uvArray,35048),v.enableAttribute(r.uv),f.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(f.bindBuffer(34962,n.color),f.bufferData(34962,e.colorArray,35048),v.enableAttribute(r.color),f.vertexAttribPointer(r.color,3,5126,!1,0,0)),v.disableUnusedAttributes(),f.drawArrays(4,0,e.count),e.count=0};var be=new ae;this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=be);var a=i.isMesh&&i.matrixWorld.determinant()<0,s=Ae(e,t,r,i);v.setMaterial(r,a);var l=!1;H.geometry===n.id&&H.program===s.id&&H.wireframe===(!0===r.wireframe)||(H.geometry=n.id,H.program=s.id,H.wireframe=!0===r.wireframe,l=!0),(r.morphTargets||r.morphNormals)&&(P.update(i,n,r,s),l=!0);var u=n.index,c=n.attributes.position;if(null===u){if(void 0===c||0===c.count)return}else if(0===u.count)return;var h,d=1;!0===r.wireframe&&(u=S.getWireframeAttribute(n),d=2);var g=L;null!==u&&(h=w.get(u),(g=N).setIndex(h)),l&&(function(e,t,n,r){if(!1!==m.isWebGL2||!e.isInstancedMesh&&!t.isInstancedBufferGeometry||null!==p.get("ANGLE_instanced_arrays")){v.initAttributes();var i=t.attributes,o=r.getAttributes(),a=n.defaultAttributeValues;for(var s in o){var l=o[s];if(l>=0){var u=i[s];if(void 0!==u){var c=u.normalized,h=u.itemSize;if(void 0===(S=w.get(u)))continue;var d=S.buffer,g=S.type,y=S.bytesPerElement;if(u.isInterleavedBufferAttribute){var _=u.data,x=_.stride,b=u.offset;_&&_.isInstancedInterleavedBuffer?(v.enableAttributeAndDivisor(l,_.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=_.meshPerAttribute*_.count)):v.enableAttribute(l),f.bindBuffer(34962,d),f.vertexAttribPointer(l,h,g,c,x*y,b*y)}else u.isInstancedBufferAttribute?(v.enableAttributeAndDivisor(l,u.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=u.meshPerAttribute*u.count)):v.enableAttribute(l),f.bindBuffer(34962,d),f.vertexAttribPointer(l,h,g,c,0,0)}else if("instanceMatrix"===s){var S;if(void 0===(S=w.get(e.instanceMatrix)))continue;d=S.buffer,g=S.type,v.enableAttributeAndDivisor(l+0,1),v.enableAttributeAndDivisor(l+1,1),v.enableAttributeAndDivisor(l+2,1),v.enableAttributeAndDivisor(l+3,1),f.bindBuffer(34962,d),f.vertexAttribPointer(l+0,4,g,!1,64,0),f.vertexAttribPointer(l+1,4,g,!1,64,16),f.vertexAttribPointer(l+2,4,g,!1,64,32),f.vertexAttribPointer(l+3,4,g,!1,64,48)}else if(void 0!==a){var E=a[s];if(void 0!==E)switch(E.length){case 2:f.vertexAttrib2fv(l,E);break;case 3:f.vertexAttrib3fv(l,E);break;case 4:f.vertexAttrib4fv(l,E);break;default:f.vertexAttrib1fv(l,E)}}}}v.disableUnusedAttributes()}}(i,n,r,s),null!==u&&f.bindBuffer(34963,h.buffer));var y=null!==u?u.count:c.count,_=n.drawRange.start*d,x=n.drawRange.count*d,b=null!==o?o.start*d:0,E=null!==o?o.count*d:1/0,T=Math.max(_,b),M=Math.min(y,_+x,b+E)-1,C=Math.max(0,M-T+1);if(0!==C){if(i.isMesh)!0===r.wireframe?(v.setLineWidth(r.wireframeLinewidth*he()),g.setMode(1)):g.setMode(4);else if(i.isLine){var A=r.linewidth;void 0===A&&(A=1),v.setLineWidth(A*he()),i.isLineSegments?g.setMode(1):i.isLineLoop?g.setMode(2):g.setMode(3)}else i.isPoints?g.setMode(0):i.isSprite&&g.setMode(4);i.isInstancedMesh?g.renderInstances(n,T,C,i.count):n.isInstancedBufferGeometry?g.renderInstances(n,T,C,n.maxInstancedCount):g.render(T,C)}},this.compile=function(e,t){(d=A.get(e,t)).init(),e.traverse((function(e){e.isLight&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(t),e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)Ce(t.material[n],e,t);else Ce(t.material,e,t)}))};var we=null,Se=new pn;function Ee(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ie.intersectsSprite(e)){r&&ce.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ue);var i=T.update(e);(o=e.material).visible&&h.push(e,i,o,n,ce.z,null)}}else if(e.isImmediateRenderObject)r&&ce.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ue),h.push(e,null,e.material,n,ce.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==g.render.frame&&(e.skeleton.update(),e.skeleton.frame=g.render.frame),!e.frustumCulled||ie.intersectsObject(e))){r&&ce.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ue),i=T.update(e);var o=e.material;if(Array.isArray(o))for(var a=i.groups,s=0,l=a.length;s<l;s++){var u=a[s],c=o[u.materialIndex];c&&c.visible&&h.push(e,i,c,n,ce.z,u)}else o.visible&&h.push(e,i,o,n,ce.z,null)}var f=e.children;for(s=0,l=f.length;s<l;s++)Ee(f[s],t,n,r)}}function Te(e,t,n,r){for(var i=0,o=e.length;i<o;i++){var a=e[i],s=a.object,l=a.geometry,u=void 0===r?a.material:r,c=a.group;if(n.isArrayCamera)if(q=n,pe.enabled&&me.isAvailable())Me(s,t,n,l,u,c);else for(var h=n.cameras,f=0,p=h.length;f<p;f++){var m=h[f];s.layers.test(m.layers)&&(v.viewport(Y.copy(m.viewport)),d.setupLights(m),Me(s,t,m,l,u,c))}else q=null,Me(s,t,n,l,u,c)}}function Me(e,t,n,r,i,o){if(e.onBeforeRender(O,t,n,r,i,o),d=A.get(t,q||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var a=Ae(n,t,i,e);v.setMaterial(i),H.geometry=null,H.program=null,H.wireframe=!1,function(e,t){e.render((function(e){O.renderBufferImmediate(e,t)}))}(e,a)}else O.renderBufferDirect(n,t,r,i,e,o);e.onAfterRender(O,t,n,r,i,o),d=A.get(t,q||n)}function Ce(e,t,n){var r=y.get(e),i=d.state.lights,o=d.state.shadowsArray,a=i.state.version,s=M.getParameters(e,i.state,o,t,oe.numPlanes,oe.numIntersection,n),l=M.getProgramCacheKey(e,s),u=r.program,c=!0;if(void 0===u)e.addEventListener("dispose",_e);else if(u.cacheKey!==l)xe(e);else if(r.lightsStateVersion!==a)r.lightsStateVersion=a,c=!1;else{if(void 0!==s.shaderID)return;c=!1}if(c){if(s.shaderID){var h=fn[s.shaderID];r.shader={name:e.type,uniforms:Jt(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}}else r.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(r.shader,O),l=M.getProgramCacheKey(e,s),u=M.acquireProgram(e,r.shader,s,l),r.program=u,r.environment=e.isMeshStandardMaterial?t.environment:null,r.outputEncoding=O.outputEncoding,e.program=u}var f=u.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var p=0;p<O.maxMorphTargets;p++)f["morphTarget"+p]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals)for(e.numSupportedMorphNormals=0,p=0;p<O.maxMorphNormals;p++)f["morphNormal"+p]>=0&&e.numSupportedMorphNormals++;var m=r.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=oe.numPlanes,r.numIntersection=oe.numIntersection,m.clippingPlanes=oe.uniform),r.fog=t.fog,r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(m.ambientLightColor.value=i.state.ambient,m.lightProbe.value=i.state.probe,m.directionalLights.value=i.state.directional,m.spotLights.value=i.state.spot,m.rectAreaLights.value=i.state.rectArea,m.pointLights.value=i.state.point,m.hemisphereLights.value=i.state.hemi,m.directionalShadowMap.value=i.state.directionalShadowMap,m.directionalShadowMatrix.value=i.state.directionalShadowMatrix,m.spotShadowMap.value=i.state.spotShadowMap,m.spotShadowMatrix.value=i.state.spotShadowMatrix,m.pointShadowMap.value=i.state.pointShadowMap,m.pointShadowMatrix.value=i.state.pointShadowMatrix);var v=r.program.getUniforms(),g=Tr.seqWithValue(v.seq,m);r.uniformsList=g}function Ae(e,t,n,r){b.resetTextureUnits();var i=t.fog,o=n.isMeshStandardMaterial?t.environment:null,a=y.get(n),s=d.state.lights;if(se&&(le||e!==W)){var l=e===W&&n.id===j;oe.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,a,l)}n.version===a.__version&&(void 0===a.program||n.fog&&a.fog!==i||a.environment!==o||a.needsLights&&a.lightsStateVersion!==s.state.version?n.needsUpdate=!0:void 0===a.numClippingPlanes||a.numClippingPlanes===oe.numPlanes&&a.numIntersection===oe.numIntersection?a.outputEncoding!==O.outputEncoding&&(n.needsUpdate=!0):n.needsUpdate=!0),n.version!==a.__version&&(Ce(n,t,r),a.__version=n.version);var u=!1,c=!1,h=!1,p=a.program,g=p.getUniforms(),x=a.shader.uniforms;if(v.useProgram(p.program)&&(u=!0,c=!0,h=!0),n.id!==j&&(j=n.id,c=!0),u||W!==e){if(p.numMultiviewViews>0?me.updateCameraProjectionMatricesUniform(e,g):g.setValue(f,"projectionMatrix",e.projectionMatrix),m.logarithmicDepthBuffer&&g.setValue(f,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),W!==e&&(W=e,c=!0,h=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var w=g.map.cameraPosition;void 0!==w&&w.setValue(f,ce.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&g.setValue(f,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&(p.numMultiviewViews>0?me.updateCameraViewMatricesUniform(e,g):g.setValue(f,"viewMatrix",e.matrixWorldInverse))}if(n.skinning){g.setOptional(f,r,"bindMatrix"),g.setOptional(f,r,"bindMatrixInverse");var S=r.skeleton;if(S){var E=S.bones;if(m.floatVertexTextures){if(void 0===S.boneTexture){var T=Math.sqrt(4*E.length);T=_.ceilPowerOfTwo(T),T=Math.max(T,4);var M=new Float32Array(T*T*4);M.set(S.boneMatrices);var C=new sn(M,T,T,1023,1015);S.boneMatrices=M,S.boneTexture=C,S.boneTextureSize=T}g.setValue(f,"boneTexture",S.boneTexture,b),g.setValue(f,"boneTextureSize",S.boneTextureSize)}else g.setOptional(f,S,"boneMatrices")}}return(c||a.receiveShadow!==r.receiveShadow)&&(a.receiveShadow=r.receiveShadow,g.setValue(f,"receiveShadow",r.receiveShadow)),c&&(g.setValue(f,"toneMappingExposure",O.toneMappingExposure),g.setValue(f,"toneMappingWhitePoint",O.toneMappingWhitePoint),a.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(x,h),i&&n.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(x,i),n.isMeshBasicMaterial?Re(x,n):n.isMeshLambertMaterial?(Re(x,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(x,n)):n.isMeshToonMaterial?(Re(x,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,n)):n.isMeshPhongMaterial?(Re(x,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,n)):n.isMeshStandardMaterial?(Re(x,n,o),n.isMeshPhysicalMaterial?function(e,t,n){Pe(e,t,n),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()),e.transparency.value=t.transparency}(x,n,o):Pe(x,n,o)):n.isMeshMatcapMaterial?(Re(x,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,n)):n.isMeshDepthMaterial?(Re(x,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,n)):n.isMeshDistanceMaterial?(Re(x,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(x,n)):n.isMeshNormalMaterial?(Re(x,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(x,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(x,n)):n.isPointsMaterial?function(e,t){var n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*J,e.scale.value=.5*K,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(x,n):n.isSpriteMaterial?function(e,t){var n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(x,n):n.isShadowMaterial&&(x.color.value.copy(n.color),x.opacity.value=n.opacity),void 0!==x.ltc_1&&(x.ltc_1.value=dn.LTC_1),void 0!==x.ltc_2&&(x.ltc_2.value=dn.LTC_2),Tr.upload(f,a.uniformsList,x,b),n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Tr.upload(f,a.uniformsList,x,b),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&g.setValue(f,"center",r.center),p.numMultiviewViews>0?me.updateObjectMatricesUniforms(r,e,g):(g.setValue(f,"modelViewMatrix",r.modelViewMatrix),g.setValue(f,"normalMatrix",r.normalMatrix)),g.setValue(f,"modelMatrix",r.matrixWorld),p}function Re(e,t,n){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap);var r,i,o=t.envMap||n;o&&(e.envMap.value=o,e.flipEnvMap.value=o.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=y.get(o).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),t.aoMap?i=t.aoMap:t.lightMap&&(i=t.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uv2Transform.value.copy(i.matrix))}function Pe(e,t,n){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),(t.envMap||n)&&(e.envMapIntensity.value=t.envMapIntensity)}Se.setAnimationLoop((function(e){pe.isPresenting||we&&we(e)})),"undefined"!=typeof window&&Se.setContext(window),this.setAnimationLoop=function(e){we=e,pe.setAnimationLoop(e),Se.start()},this.render=function(e,t){var n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),t&&t.isCamera){if(!D){H.geometry=null,H.program=null,H.wireframe=!1,j=-1,W=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),pe.enabled&&pe.isPresenting&&(t=pe.getCamera(t)),(d=A.get(e,t)).init(),e.onBeforeRender(O,e,t,n||U),ue.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ie.setFromMatrix(ue),le=this.localClippingEnabled,se=oe.init(this.clippingPlanes,le,t),(h=C.get(e,t)).init(),Ee(e,t,0,O.sortObjects),!0===O.sortObjects&&h.sort(Q,ee),se&&oe.beginShadows();var i=d.state.shadowsArray;ve.render(i,e,t),d.setupLights(t),se&&oe.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),pe.enabled&&me.isAvailable()&&me.attachCamera(t),R.render(h,e,t,r);var o=h.opaque,a=h.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;o.length&&Te(o,e,t,s),a.length&&Te(a,e,t,s)}else o.length&&Te(o,e,t),a.length&&Te(a,e,t);e.onAfterRender(O,e,t),null!==U&&(b.updateRenderTargetMipmap(U),b.updateMultisampleRenderTarget(U)),v.buffers.depth.setTest(!0),v.buffers.depth.setMask(!0),v.buffers.color.setMask(!0),v.setPolygonOffset(!1),pe.enabled&&me.isAvailable()&&me.detachCamera(t),h=null,d=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){z!==e&&null===U&&f.bindFramebuffer(36160,e),z=e},this.getActiveCubeFace=function(){return F},this.getActiveMipmapLevel=function(){return B},this.getRenderTarget=function(){return U},this.setRenderTarget=function(e,t,n){U=e,F=t,B=n,e&&void 0===y.get(e).__webglFramebuffer&&b.setupRenderTarget(e);var r=z,i=!1;if(e){var o=y.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(r=o[t||0],i=!0):r=e.isWebGLMultisampleRenderTarget?y.get(e).__webglMultisampledFramebuffer:o,Y.copy(e.viewport),X.copy(e.scissor),Z=e.scissorTest}else Y.copy(te).multiplyScalar(J).floor(),X.copy(ne).multiplyScalar(J).floor(),Z=re;if(G!==r&&(f.bindFramebuffer(36160,r),G=r),v.viewport(Y),v.scissor(X),v.setScissorTest(Z),i){var a=y.get(e.texture);f.framebufferTexture2D(36160,36064,34069+(t||0),a.__webglTexture,n||0)}},this.readRenderTargetPixels=function(e,t,n,r,i,o,a){if(e&&e.isWebGLRenderTarget){var s=y.get(e).__webglFramebuffer;if(e.isWebGLRenderTargetCube&&void 0!==a&&(s=s[a]),s){var l=!1;s!==G&&(f.bindFramebuffer(36160,s),l=!0);try{var u=e.texture,c=u.format,h=u.type;if(1023!==c&&I.convert(c)!==f.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(1009===h||I.convert(h)===f.getParameter(35738)||1015===h&&(m.isWebGL2||p.get("OES_texture_float")||p.get("WEBGL_color_buffer_float"))||1016===h&&(m.isWebGL2?p.get("EXT_color_buffer_float"):p.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===f.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&f.readPixels(t,n,r,i,I.convert(c),I.convert(h),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&f.bindFramebuffer(36160,G)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){void 0===n&&(n=0);var r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r),a=I.convert(t.format);b.setTexture2D(t,0),f.copyTexImage2D(3553,n,a,e.x,e.y,i,o,0),v.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r){var i=t.image.width,o=t.image.height,a=I.convert(n.format),s=I.convert(n.type);b.setTexture2D(n,0),t.isDataTexture?f.texSubImage2D(3553,r||0,e.x,e.y,i,o,a,s,t.image.data):f.texSubImage2D(3553,r||0,e.x,e.y,a,s,t.image),v.unbindTexture()},this.initTexture=function(e){b.setTexture2D(e,0),v.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function fi(e,t){this.name="",this.color=new $e(e),this.density=void 0!==t?t:25e-5}function pi(e,t,n){this.name="",this.color=new $e(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}function mi(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}ti.prototype=Object.create(nt.prototype),ti.prototype.constructor=ti,ti.prototype.isMeshDepthMaterial=!0,ti.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},ni.prototype=Object.create(nt.prototype),ni.prototype.constructor=ni,ni.prototype.isMeshDistanceMaterial=!0,ni.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},si.prototype=Object.assign(Object.create(L.prototype),{constructor:si,isWebGLMultiviewRenderTarget:!0,copy:function(e){return L.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),ui.prototype=Object.assign(Object.create(rn.prototype),{constructor:ui,isArrayCamera:!0}),ci.prototype=Object.assign(Object.create(oe.prototype),{constructor:ci,isGroup:!0}),Object.assign(hi.prototype,v.prototype),Object.assign(fi.prototype,{isFogExp2:!0,clone:function(){return new fi(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(pi.prototype,{isFog:!0,clone:function(){return new pi(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(mi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(mi.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var vi,gi=new E;function yi(e,t,n,r){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function _i(e){nt.call(this),this.type="SpriteMaterial",this.color=new $e(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(yi.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(yi.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,n=this.data.count;t<n;t++)gi.x=this.getX(t),gi.y=this.getY(t),gi.z=this.getZ(t),gi.applyMatrix4(e),this.setXYZ(t,gi.x,gi.y,gi.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}}),_i.prototype=Object.create(nt.prototype),_i.prototype.constructor=_i,_i.prototype.isSpriteMaterial=!0,_i.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var xi=new E,bi=new E,wi=new E,Si=new x,Ei=new x,Ti=new V,Mi=new E,Ci=new E,Ai=new E,Ri=new x,Pi=new x,ki=new x;function Li(e){if(oe.call(this),this.type="Sprite",void 0===vi){vi=new Et;var t=new mi(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);vi.setIndex([0,1,2,0,2,3]),vi.setAttribute("position",new yi(t,3,0,!1)),vi.setAttribute("uv",new yi(t,2,3,!1))}this.geometry=vi,this.material=void 0!==e?e:new _i,this.center=new x(.5,.5)}function Ni(e,t,n,r,i,o){Si.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(Ei.x=o*Si.x-i*Si.y,Ei.y=i*Si.x+o*Si.y):Ei.copy(Si),e.copy(t),e.x+=Ei.x,e.y+=Ei.y,e.applyMatrix4(Ti)}Li.prototype=Object.assign(Object.create(oe.prototype),{constructor:Li,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),bi.setFromMatrixScale(this.matrixWorld),Ti.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),wi.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&bi.multiplyScalar(-wi.z);var n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));var o=this.center;Ni(Mi.set(-.5,-.5,0),wi,o,bi,n,r),Ni(Ci.set(.5,-.5,0),wi,o,bi,n,r),Ni(Ai.set(.5,.5,0),wi,o,bi,n,r),Ri.set(0,0),Pi.set(1,0),ki.set(1,1);var a=e.ray.intersectTriangle(Mi,Ci,Ai,!1,xi);if(null!==a||(Ni(Ci.set(-.5,.5,0),wi,o,bi,n,r),Pi.set(0,1),null!==(a=e.ray.intersectTriangle(Mi,Ai,Ci,!1,xi)))){var s=e.ray.origin.distanceTo(xi);s<e.near||s>e.far||t.push({distance:s,point:xi.clone(),uv:qe.getUV(xi,Mi,Ci,Ai,Ri,Pi,ki,new x),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return oe.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var Ii=new E,Oi=new E;function Di(){oe.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function zi(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Gt.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new V,this.bindMatrixInverse=new V}Di.prototype=Object.assign(Object.create(oe.prototype),{constructor:Di,isLOD:!0,copy:function(e){oe.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,r=t.length;n<r;n++){var i=t[n];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Ii.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(Ii);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){Ii.setFromMatrixPosition(e.matrixWorld),Oi.setFromMatrixPosition(this.matrixWorld);var n=Ii.distanceTo(Oi);t[0].object.visible=!0;for(var r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(;r<i;r++)t[r].object.visible=!1}},toJSON:function(e){var t=oe.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var o=n[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),zi.prototype=Object.assign(Object.create(Gt.prototype),{constructor:zi,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new k,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Gt.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Fi=new V,Bi=new V;function Ui(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new V)}}function Vi(){oe.call(this),this.type="Bone"}Object.assign(Ui.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new V;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,o=e.length;i<o;i++){var a=e[i]?e[i].matrixWorld:Bi;Fi.multiplyMatrices(a,t[i]),Fi.toArray(n,16*i)}void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new Ui(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}}}),Vi.prototype=Object.assign(Object.create(oe.prototype),{constructor:Vi,isBone:!0});var Gi=new V,ji=new V,Hi=[],Wi=new Gt;function qi(e,t,n){Gt.call(this,e,t),this.instanceMatrix=new ot(new Float32Array(16*n),16),this.count=n}function Yi(e){nt.call(this),this.type="LineBasicMaterial",this.color=new $e(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}qi.prototype=Object.assign(Object.create(Gt.prototype),{constructor:qi,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var n=this.matrixWorld,r=this.count;if(Wi.geometry=this.geometry,Wi.material=this.material,void 0!==Wi.material)for(var i=0;i<r;i++)this.getMatrixAt(i,Gi),ji.multiplyMatrices(n,Gi),Wi.matrixWorld=ji,Wi.raycast(e,Hi),Hi.length>0&&(Hi[0].instanceId=i,Hi[0].object=this,t.push(Hi[0]),Hi.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),Yi.prototype=Object.create(nt.prototype),Yi.prototype.constructor=Yi,Yi.prototype.isLineBasicMaterial=!0,Yi.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var Xi=new E,Zi=new E,$i=new V,Ki=new ke,Ji=new Se;function Qi(e,t,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),oe.call(this),this.type="Line",this.geometry=void 0!==e?e:new Et,this.material=void 0!==t?t:new Yi({color:16777215*Math.random()})}Qi.prototype=Object.assign(Object.create(oe.prototype),{constructor:Qi,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,i=t.count;r<i;r++)Xi.fromBufferAttribute(t,r-1),Zi.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=Xi.distanceTo(Zi);e.setAttribute("lineDistance",new ft(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for((n=e.lineDistances)[0]=0,r=1,i=o.length;r<i;r++)n[r]=n[r-1],n[r]+=o[r-1].distanceTo(o[r])}return this},raycast:function(e,t){var n=e.linePrecision,r=this.geometry,i=this.matrixWorld;if(null===r.boundingSphere&&r.computeBoundingSphere(),Ji.copy(r.boundingSphere),Ji.applyMatrix4(i),Ji.radius+=n,!1!==e.ray.intersectsSphere(Ji)){$i.getInverse(i),Ki.copy(e.ray).applyMatrix4($i);var o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new E,l=new E,u=new E,c=new E,h=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var d=r.index,f=r.attributes.position.array;if(null!==d)for(var p=d.array,m=0,v=p.length-1;m<v;m+=h){var g=p[m],y=p[m+1];s.fromArray(f,3*g),l.fromArray(f,3*y),Ki.distanceSqToSegment(s,l,c,u)>a||(c.applyMatrix4(this.matrixWorld),(b=e.ray.origin.distanceTo(c))<e.near||b>e.far||t.push({distance:b,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else for(m=0,v=f.length/3-1;m<v;m+=h)s.fromArray(f,3*m),l.fromArray(f,3*m+3),Ki.distanceSqToSegment(s,l,c,u)>a||(c.applyMatrix4(this.matrixWorld),(b=e.ray.origin.distanceTo(c))<e.near||b>e.far||t.push({distance:b,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else if(r.isGeometry){var _=r.vertices,x=_.length;for(m=0;m<x-1;m+=h){var b;Ki.distanceSqToSegment(_[m],_[m+1],c,u)>a||(c.applyMatrix4(this.matrixWorld),(b=e.ray.origin.distanceTo(c))<e.near||b>e.far||t.push({distance:b,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var eo=new E,to=new E;function no(e,t){Qi.call(this,e,t),this.type="LineSegments"}function ro(e,t){Qi.call(this,e,t),this.type="LineLoop"}function io(e){nt.call(this),this.type="PointsMaterial",this.color=new $e(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}no.prototype=Object.assign(Object.create(Qi.prototype),{constructor:no,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],r=0,i=t.count;r<i;r+=2)eo.fromBufferAttribute(t,r),to.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+eo.distanceTo(to);e.setAttribute("lineDistance",new ft(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for(n=e.lineDistances,r=0,i=o.length;r<i;r+=2)eo.copy(o[r]),to.copy(o[r+1]),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+eo.distanceTo(to)}return this}}),ro.prototype=Object.assign(Object.create(Qi.prototype),{constructor:ro,isLineLoop:!0}),io.prototype=Object.create(nt.prototype),io.prototype.constructor=io,io.prototype.isPointsMaterial=!0,io.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var oo=new V,ao=new ke,so=new Se,lo=new E;function uo(e,t){oe.call(this),this.type="Points",this.geometry=void 0!==e?e:new Et,this.material=void 0!==t?t:new io({color:16777215*Math.random()}),this.updateMorphTargets()}function co(e,t,n,r,i,o,a){var s=ao.distanceSqToPoint(e);if(s<n){var l=new E;ao.closestPointToPoint(e,l),l.applyMatrix4(r);var u=i.ray.origin.distanceTo(l);if(u<i.near||u>i.far)return;o.push({distance:u,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:a})}}function ho(e,t,n,r,i,o,a,s,l){P.call(this,e,t,n,r,i,o,a,s,l),this.format=void 0!==a?a:1022,this.minFilter=void 0!==o?o:1006,this.magFilter=void 0!==i?i:1006,this.generateMipmaps=!1}function fo(e,t,n,r,i,o,a,s,l,u,c,h){P.call(this,null,o,a,s,l,u,r,i,c,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function po(e,t,n,r,i,o,a,s,l){P.call(this,e,t,n,r,i,o,a,s,l),this.needsUpdate=!0}function mo(e,t,n,r,i,o,a,s,l,u){if(1026!==(u=void 0!==u?u:1026)&&1027!==u)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===u&&(n=1012),void 0===n&&1027===u&&(n=1020),P.call(this,null,r,i,o,a,s,u,n,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:1003,this.minFilter=void 0!==s?s:1003,this.flipY=!1,this.generateMipmaps=!1}function vo(e){Et.call(this),this.type="WireframeGeometry";var t,n,r,i,o,a,s,l,u,c,h=[],d=[0,0],f={},p=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,r=m.length;t<r;t++){var v=m[t];for(n=0;n<3;n++)s=v[p[n]],l=v[p[(n+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===f[u=d[0]+","+d[1]]&&(f[u]={index1:d[0],index2:d[1]})}for(u in f)a=f[u],c=e.vertices[a.index1],h.push(c.x,c.y,c.z),c=e.vertices[a.index2],h.push(c.x,c.y,c.z)}else if(e&&e.isBufferGeometry){var g,y,_,x,b,w,S;if(c=new E,null!==e.index){for(g=e.attributes.position,y=e.index,0===(_=e.groups).length&&(_=[{start:0,count:y.count,materialIndex:0}]),i=0,o=_.length;i<o;++i)for(t=b=(x=_[i]).start,r=b+x.count;t<r;t+=3)for(n=0;n<3;n++)s=y.getX(t+n),l=y.getX(t+(n+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===f[u=d[0]+","+d[1]]&&(f[u]={index1:d[0],index2:d[1]});for(u in f)a=f[u],c.fromBufferAttribute(g,a.index1),h.push(c.x,c.y,c.z),c.fromBufferAttribute(g,a.index2),h.push(c.x,c.y,c.z)}else for(t=0,r=(g=e.attributes.position).count/3;t<r;t++)for(n=0;n<3;n++)w=3*t+n,c.fromBufferAttribute(g,w),h.push(c.x,c.y,c.z),S=3*t+(n+1)%3,c.fromBufferAttribute(g,S),h.push(c.x,c.y,c.z)}this.setAttribute("position",new ft(h,3))}function go(e,t,n){Zt.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new yo(e,t,n)),this.mergeVertices()}function yo(e,t,n){Et.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var r,i,o=[],a=[],s=[],l=[],u=new E,c=new E,h=new E,d=new E,f=new E;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var p=t+1;for(r=0;r<=n;r++){var m=r/n;for(i=0;i<=t;i++){var v=i/t;e(v,m,c),a.push(c.x,c.y,c.z),v-1e-5>=0?(e(v-1e-5,m,h),d.subVectors(c,h)):(e(v+1e-5,m,h),d.subVectors(h,c)),m-1e-5>=0?(e(v,m-1e-5,h),f.subVectors(c,h)):(e(v,m+1e-5,h),f.subVectors(h,c)),u.crossVectors(d,f).normalize(),s.push(u.x,u.y,u.z),l.push(v,m)}}for(r=0;r<n;r++)for(i=0;i<t;i++){var g=r*p+i,y=r*p+i+1,_=(r+1)*p+i+1,x=(r+1)*p+i;o.push(g,y,x),o.push(y,_,x)}this.setIndex(o),this.setAttribute("position",new ft(a,3)),this.setAttribute("normal",new ft(s,3)),this.setAttribute("uv",new ft(l,2))}function _o(e,t,n,r){Zt.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},this.fromBufferGeometry(new xo(e,t,n,r)),this.mergeVertices()}function xo(e,t,n,r){Et.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},n=n||1;var i=[],o=[];function a(e,t,n,r){var i,o,a=Math.pow(2,r),l=[];for(i=0;i<=a;i++){l[i]=[];var u=e.clone().lerp(n,i/a),c=t.clone().lerp(n,i/a),h=a-i;for(o=0;o<=h;o++)l[i][o]=0===o&&i===a?u:u.clone().lerp(c,o/h)}for(i=0;i<a;i++)for(o=0;o<2*(a-i)-1;o++){var d=Math.floor(o/2);o%2==0?(s(l[i][d+1]),s(l[i+1][d]),s(l[i][d])):(s(l[i][d+1]),s(l[i+1][d+1]),s(l[i+1][d]))}}function s(e){i.push(e.x,e.y,e.z)}function l(t,n){var r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function u(e,t,n,r){r<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=r/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}!function(e){for(var n=new E,r=new E,i=new E,o=0;o<t.length;o+=3)l(t[o+0],n),l(t[o+1],r),l(t[o+2],i),a(n,r,i,e)}(r=r||0),function(e){for(var t=new E,n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){for(var e=new E,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var n=c(e)/2/Math.PI+.5,r=(a=e,Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5);o.push(n,1-r)}var a;(function(){for(var e=new E,t=new E,n=new E,r=new E,a=new x,s=new x,l=new x,h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),a.set(o[d+0],o[d+1]),s.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),r.copy(e).add(t).add(n).divideScalar(3);var f=c(r);u(a,d+0,e,f),u(s,d+2,t,f),u(l,d+4,n,f)}})(),function(){for(var e=0;e<o.length;e+=6){var t=o[e+0],n=o[e+2],r=o[e+4],i=Math.max(t,n,r),a=Math.min(t,n,r);i>.9&&a<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new ft(i,3)),this.setAttribute("normal",new ft(i.slice(),3)),this.setAttribute("uv",new ft(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function bo(e,t){Zt.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new wo(e,t)),this.mergeVertices()}function wo(e,t){xo.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function So(e,t){Zt.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Eo(e,t)),this.mergeVertices()}function Eo(e,t){xo.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function To(e,t){Zt.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Mo(e,t)),this.mergeVertices()}function Mo(e,t){var n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];xo.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Co(e,t){Zt.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ao(e,t)),this.mergeVertices()}function Ao(e,t){var n=(1+Math.sqrt(5))/2,r=1/n,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r];xo.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ro(e,t,n,r,i,o){Zt.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Po(e,t,n,r,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Po(e,t,n,r,i){Et.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},t=t||64,n=n||1,r=r||8,i=i||!1;var o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,l=new E,u=new E,c=new x,h=new E,d=[],f=[],p=[],m=[];function v(i){h=e.getPointAt(i/t,h);var a=o.normals[i],c=o.binormals[i];for(s=0;s<=r;s++){var p=s/r*Math.PI*2,m=Math.sin(p),v=-Math.cos(p);u.x=v*a.x+m*c.x,u.y=v*a.y+m*c.y,u.z=v*a.z+m*c.z,u.normalize(),f.push(u.x,u.y,u.z),l.x=h.x+n*u.x,l.y=h.y+n*u.y,l.z=h.z+n*u.z,d.push(l.x,l.y,l.z)}}!function(){for(a=0;a<t;a++)v(a);v(!1===i?t:0),function(){for(a=0;a<=t;a++)for(s=0;s<=r;s++)c.x=a/t,c.y=s/r,p.push(c.x,c.y)}(),function(){for(s=1;s<=t;s++)for(a=1;a<=r;a++){var e=(r+1)*(s-1)+(a-1),n=(r+1)*s+(a-1),i=(r+1)*s+a,o=(r+1)*(s-1)+a;m.push(e,n,o),m.push(n,i,o)}}()}(),this.setIndex(m),this.setAttribute("position",new ft(d,3)),this.setAttribute("normal",new ft(f,3)),this.setAttribute("uv",new ft(p,2))}function ko(e,t,n,r,i,o,a){Zt.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Lo(e,t,n,r,i,o)),this.mergeVertices()}function Lo(e,t,n,r,i,o){Et.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},e=e||1,t=t||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,o=o||3;var a,s,l=[],u=[],c=[],h=[],d=new E,f=new E,p=new E,m=new E,v=new E,g=new E,y=new E;for(a=0;a<=n;++a){var _=a/n*i*Math.PI*2;for(A(_,i,o,e,p),A(_+.01,i,o,e,m),g.subVectors(m,p),y.addVectors(m,p),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=r;++s){var x=s/r*Math.PI*2,b=-t*Math.cos(x),w=t*Math.sin(x);d.x=p.x+(b*y.x+w*v.x),d.y=p.y+(b*y.y+w*v.y),d.z=p.z+(b*y.z+w*v.z),u.push(d.x,d.y,d.z),f.subVectors(d,p).normalize(),c.push(f.x,f.y,f.z),h.push(a/n),h.push(s/r)}}for(s=1;s<=n;s++)for(a=1;a<=r;a++){var S=(r+1)*(s-1)+(a-1),T=(r+1)*s+(a-1),M=(r+1)*s+a,C=(r+1)*(s-1)+a;l.push(S,T,C),l.push(T,M,C)}function A(e,t,n,r,i){var o=Math.cos(e),a=Math.sin(e),s=n/t*e,l=Math.cos(s);i.x=r*(2+l)*.5*o,i.y=r*(2+l)*a*.5,i.z=r*Math.sin(s)*.5}this.setIndex(l),this.setAttribute("position",new ft(u,3)),this.setAttribute("normal",new ft(c,3)),this.setAttribute("uv",new ft(h,2))}function No(e,t,n,r,i){Zt.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new Io(e,t,n,r,i)),this.mergeVertices()}function Io(e,t,n,r,i){Et.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},e=e||1,t=t||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||2*Math.PI;var o,a,s=[],l=[],u=[],c=[],h=new E,d=new E,f=new E;for(o=0;o<=n;o++)for(a=0;a<=r;a++){var p=a/r*i,m=o/n*Math.PI*2;d.x=(e+t*Math.cos(m))*Math.cos(p),d.y=(e+t*Math.cos(m))*Math.sin(p),d.z=t*Math.sin(m),l.push(d.x,d.y,d.z),h.x=e*Math.cos(p),h.y=e*Math.sin(p),f.subVectors(d,h).normalize(),u.push(f.x,f.y,f.z),c.push(a/r),c.push(o/n)}for(o=1;o<=n;o++)for(a=1;a<=r;a++){var v=(r+1)*o+a-1,g=(r+1)*(o-1)+a-1,y=(r+1)*(o-1)+a,_=(r+1)*o+a;s.push(v,g,_),s.push(g,y,_)}this.setIndex(s),this.setAttribute("position",new ft(l,3)),this.setAttribute("normal",new ft(u,3)),this.setAttribute("uv",new ft(c,2))}uo.prototype=Object.assign(Object.create(oe.prototype),{constructor:uo,isPoints:!0,raycast:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),so.copy(n.boundingSphere),so.applyMatrix4(r),so.radius+=i,!1!==e.ray.intersectsSphere(so)){oo.getInverse(r),ao.copy(e.ray).applyMatrix4(oo);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){var s=n.index,l=n.attributes.position.array;if(null!==s)for(var u=s.array,c=0,h=u.length;c<h;c++){var d=u[c];lo.fromArray(l,3*d),co(lo,d,a,r,e,t,this)}else{c=0;for(var f=l.length/3;c<f;c++)lo.fromArray(l,3*c),co(lo,c,a,r,e,t,this)}}else{var p=n.vertices;for(c=0,f=p.length;c<f;c++)co(p[c],c,a,r,e,t,this)}}},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)n=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=r.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ho.prototype=Object.assign(Object.create(P.prototype),{constructor:ho,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),fo.prototype=Object.create(P.prototype),fo.prototype.constructor=fo,fo.prototype.isCompressedTexture=!0,po.prototype=Object.create(P.prototype),po.prototype.constructor=po,po.prototype.isCanvasTexture=!0,mo.prototype=Object.create(P.prototype),mo.prototype.constructor=mo,mo.prototype.isDepthTexture=!0,vo.prototype=Object.create(Et.prototype),vo.prototype.constructor=vo,go.prototype=Object.create(Zt.prototype),go.prototype.constructor=go,yo.prototype=Object.create(Et.prototype),yo.prototype.constructor=yo,_o.prototype=Object.create(Zt.prototype),_o.prototype.constructor=_o,xo.prototype=Object.create(Et.prototype),xo.prototype.constructor=xo,bo.prototype=Object.create(Zt.prototype),bo.prototype.constructor=bo,wo.prototype=Object.create(xo.prototype),wo.prototype.constructor=wo,So.prototype=Object.create(Zt.prototype),So.prototype.constructor=So,Eo.prototype=Object.create(xo.prototype),Eo.prototype.constructor=Eo,To.prototype=Object.create(Zt.prototype),To.prototype.constructor=To,Mo.prototype=Object.create(xo.prototype),Mo.prototype.constructor=Mo,Co.prototype=Object.create(Zt.prototype),Co.prototype.constructor=Co,Ao.prototype=Object.create(xo.prototype),Ao.prototype.constructor=Ao,Ro.prototype=Object.create(Zt.prototype),Ro.prototype.constructor=Ro,Po.prototype=Object.create(Et.prototype),Po.prototype.constructor=Po,Po.prototype.toJSON=function(){var e=Et.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},ko.prototype=Object.create(Zt.prototype),ko.prototype.constructor=ko,Lo.prototype=Object.create(Et.prototype),Lo.prototype.constructor=Lo,No.prototype=Object.create(Zt.prototype),No.prototype.constructor=No,Io.prototype=Object.create(Et.prototype),Io.prototype.constructor=Io;function Oo(e,t,n,r,i){var o,a;if(i===function(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)a=Qo(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=Qo(o,e[o],e[o+1],a);return a&&Zo(a,a.next)&&(ea(a),a=a.next),a}function Do(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!Zo(r,r.next)&&0!==Xo(r.prev,r,r.next))r=r.next;else{if(ea(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function zo(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=Ho(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,l,u=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(a>1)}(i)}(e,r,i,o);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?Bo(e,r,i,o):Fo(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),ea(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?zo(e=Uo(e,t,n),t,n,r,i,o,2):2===a&&Vo(e,t,n,r,i,o):zo(Do(e),t,n,r,i,o,1);break}}}function Fo(e){var t=e.prev,n=e,r=e.next;if(Xo(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(qo(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Xo(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Bo(e,t,n,r){var i=e.prev,o=e,a=e.next;if(Xo(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,l=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,u=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=Ho(s,l,t,n,r),d=Ho(u,c,t,n,r),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&qo(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Xo(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&qo(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Xo(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&qo(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Xo(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&qo(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Xo(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Uo(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!Zo(i,o)&&$o(i,r,r.next,o)&&Ko(i,o)&&Ko(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),ea(r),ea(r.next),r=e=o),r=r.next}while(r!==e);return r}function Vo(e,t,n,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Yo(a,s)){var l=Jo(a,s);return a=Do(a,a.next),l=Do(l,l.next),zo(a,t,n,r,i,o),void zo(l,t,n,r,i,o)}s=s.next}a=a.next}while(a!==e)}function Go(e,t){return e.x-t.x}function jo(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n.prev;var l,u=n,c=n.x,h=n.y,d=1/0;for(r=n.next;r!==u;)i>=r.x&&r.x>=c&&i!==r.x&&qo(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(i-r.x))<d||l===d&&r.x>n.x)&&Ko(r,e)&&(n=r,d=l),r=r.next;return n}(e,t)){var n=Jo(t,e);Do(n,n.next)}}function Ho(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Wo(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function qo(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Yo(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&$o(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&Ko(e,t)&&Ko(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)}function Xo(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Zo(e,t){return e.x===t.x&&e.y===t.y}function $o(e,t,n,r){return!!(Zo(e,n)&&Zo(t,r)||Zo(e,r)&&Zo(n,t))||Xo(e,t,n)>0!=Xo(e,t,r)>0&&Xo(n,r,e)>0!=Xo(n,r,t)>0}function Ko(e,t){return Xo(e.prev,e,e.next)<0?Xo(e,t,e.next)>=0&&Xo(e,e.prev,t)>=0:Xo(e,t,e.prev)<0||Xo(e,e.next,t)<0}function Jo(e,t){var n=new ta(e.i,e.x,e.y),r=new ta(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Qo(e,t,n,r){var i=new ta(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ea(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ta(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var na={area:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return na.area(e)<0},triangulateShape:function(e,t){var n=[],r=[],i=[];ra(e),ia(n,e);var o=e.length;t.forEach(ra);for(var a=0;a<t.length;a++)r.push(o),o+=t[a].length,ia(n,t[a]);var s=function(e,t,n){n=n||2;var r,i,o,a,s,l,u,c=t&&t.length,h=c?t[0]*n:e.length,d=Oo(e,0,h,n,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(e,t,n,r){var i,o,a,s=[];for(i=0,o=t.length;i<o;i++)(a=Oo(e,t[i]*r,i<o-1?t[i+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),s.push(Wo(a));for(s.sort(Go),i=0;i<s.length;i++)jo(s[i],n),n=Do(n,n.next);return n}(e,t,d,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var p=n;p<h;p+=n)(s=e[p])<r&&(r=s),(l=e[p+1])<i&&(i=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-r,a-i))?1/u:0}return zo(d,f,n,r,i,u),f}(n,r);for(a=0;a<s.length;a+=3)i.push(s.slice(a,a+3));return i}};function ra(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function ia(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function oa(e,t){Zt.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new aa(e,t)),this.mergeVertices()}function aa(e,t){Et.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var n=this,r=[],i=[],o=0,a=e.length;o<a;o++)s(e[o]);function s(e){var o=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:100,u=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:c-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,f=void 0!==t.bevelSegments?t.bevelSegments:3,p=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:sa;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);var v,g,y,_,b,w,S,T,M=!1;p&&(v=p.getSpacedPoints(s),M=!0,u=!1,g=p.computeFrenetFrames(s,!1),y=new E,_=new E,b=new E),u||(f=0,c=0,h=0,d=0);var C=e.extractPoints(a),A=C.shape,R=C.holes;if(!na.isClockWise(A))for(A=A.reverse(),S=0,T=R.length;S<T;S++)w=R[S],na.isClockWise(w)&&(R[S]=w.reverse());var P=na.triangulateShape(A,R),k=A;for(S=0,T=R.length;S<T;S++)w=R[S],A=A.concat(w);function L(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var N,I,O,D,z,F,B=A.length,U=P.length;function V(e,t,n){var r,i,o,a=e.x-t.x,s=e.y-t.y,l=n.x-e.x,u=n.y-e.y,c=a*a+s*s,h=a*u-s*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(c),f=Math.sqrt(l*l+u*u),p=t.x-s/d,m=t.y+a/d,v=((n.x-u/f-p)*u-(n.y+l/f-m)*l)/(a*u-s*l),g=(r=p+a*v-e.x)*r+(i=m+s*v-e.y)*i;if(g<=2)return new x(r,i);o=Math.sqrt(g/2)}else{var y=!1;a>Number.EPSILON?l>Number.EPSILON&&(y=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(u)&&(y=!0),y?(r=-s,i=a,o=Math.sqrt(c)):(r=a,i=s,o=Math.sqrt(c/2))}return new x(r/o,i/o)}for(var G=[],j=0,H=k.length,W=H-1,q=j+1;j<H;j++,W++,q++)W===H&&(W=0),q===H&&(q=0),G[j]=V(k[j],k[W],k[q]);var Y,X,Z=[],$=G.concat();for(S=0,T=R.length;S<T;S++){for(w=R[S],Y=[],j=0,W=(H=w.length)-1,q=j+1;j<H;j++,W++,q++)W===H&&(W=0),q===H&&(q=0),Y[j]=V(w[j],w[W],w[q]);Z.push(Y),$=$.concat(Y)}for(N=0;N<f;N++){for(O=N/f,D=c*Math.cos(O*Math.PI/2),I=h*Math.sin(O*Math.PI/2)+d,j=0,H=k.length;j<H;j++)J((z=L(k[j],G[j],I)).x,z.y,-D);for(S=0,T=R.length;S<T;S++)for(w=R[S],Y=Z[S],j=0,H=w.length;j<H;j++)J((z=L(w[j],Y[j],I)).x,z.y,-D)}for(I=h+d,j=0;j<B;j++)z=u?L(A[j],$[j],I):A[j],M?(_.copy(g.normals[0]).multiplyScalar(z.x),y.copy(g.binormals[0]).multiplyScalar(z.y),b.copy(v[0]).add(_).add(y),J(b.x,b.y,b.z)):J(z.x,z.y,0);for(X=1;X<=s;X++)for(j=0;j<B;j++)z=u?L(A[j],$[j],I):A[j],M?(_.copy(g.normals[X]).multiplyScalar(z.x),y.copy(g.binormals[X]).multiplyScalar(z.y),b.copy(v[X]).add(_).add(y),J(b.x,b.y,b.z)):J(z.x,z.y,l/s*X);for(N=f-1;N>=0;N--){for(O=N/f,D=c*Math.cos(O*Math.PI/2),I=h*Math.sin(O*Math.PI/2)+d,j=0,H=k.length;j<H;j++)J((z=L(k[j],G[j],I)).x,z.y,l+D);for(S=0,T=R.length;S<T;S++)for(w=R[S],Y=Z[S],j=0,H=w.length;j<H;j++)z=L(w[j],Y[j],I),M?J(z.x,z.y+v[s-1].y,v[s-1].x+D):J(z.x,z.y,l+D)}function K(e,t){var n,r;for(j=e.length;--j>=0;){n=j,(r=j-1)<0&&(r=e.length-1);var i=0,o=s+2*f;for(i=0;i<o;i++){var a=B*i,l=B*(i+1);ee(t+n+a,t+r+a,t+r+l,t+n+l)}}}function J(e,t,n){o.push(e),o.push(t),o.push(n)}function Q(e,t,i){te(e),te(t),te(i);var o=r.length/3,a=m.generateTopUV(n,r,o-3,o-2,o-1);ne(a[0]),ne(a[1]),ne(a[2])}function ee(e,t,i,o){te(e),te(t),te(o),te(t),te(i),te(o);var a=r.length/3,s=m.generateSideWallUV(n,r,a-6,a-3,a-2,a-1);ne(s[0]),ne(s[1]),ne(s[3]),ne(s[1]),ne(s[2]),ne(s[3])}function te(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function ne(e){i.push(e.x),i.push(e.y)}!function(){var e=r.length/3;if(u){var t=0,i=B*t;for(j=0;j<U;j++)Q((F=P[j])[2]+i,F[1]+i,F[0]+i);for(i=B*(t=s+2*f),j=0;j<U;j++)Q((F=P[j])[0]+i,F[1]+i,F[2]+i)}else{for(j=0;j<U;j++)Q((F=P[j])[2],F[1],F[0]);for(j=0;j<U;j++)Q((F=P[j])[0]+B*s,F[1]+B*s,F[2]+B*s)}n.addGroup(e,r.length/3-e,0)}(),function(){var e=r.length/3,t=0;for(K(k,t),t+=k.length,S=0,T=R.length;S<T;S++)K(w=R[S],t),t+=w.length;n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new ft(r,3)),this.setAttribute("uv",new ft(i,2)),this.computeVertexNormals()}oa.prototype=Object.create(Zt.prototype),oa.prototype.constructor=oa,oa.prototype.toJSON=function(){var e=Zt.prototype.toJSON.call(this);return la(this.parameters.shapes,this.parameters.options,e)},aa.prototype=Object.create(Et.prototype),aa.prototype.constructor=aa,aa.prototype.toJSON=function(){var e=Et.prototype.toJSON.call(this);return la(this.parameters.shapes,this.parameters.options,e)};var sa={generateTopUV:function(e,t,n,r,i){var o=t[3*n],a=t[3*n+1],s=t[3*r],l=t[3*r+1],u=t[3*i],c=t[3*i+1];return[new x(o,a),new x(s,l),new x(u,c)]},generateSideWallUV:function(e,t,n,r,i,o){var a=t[3*n],s=t[3*n+1],l=t[3*n+2],u=t[3*r],c=t[3*r+1],h=t[3*r+2],d=t[3*i],f=t[3*i+1],p=t[3*i+2],m=t[3*o],v=t[3*o+1],g=t[3*o+2];return Math.abs(s-c)<.01?[new x(a,1-l),new x(u,1-h),new x(d,1-p),new x(m,1-g)]:[new x(s,1-l),new x(c,1-h),new x(f,1-p),new x(v,1-g)]}};function la(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var o=e[r];n.shapes.push(o.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function ua(e,t){Zt.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new ca(e,t)),this.mergeVertices()}function ca(e,t){var n=(t=t||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Zt;var r=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),aa.call(this,r,t),this.type="TextBufferGeometry"}function ha(e,t,n,r,i,o,a){Zt.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new da(e,t,n,r,i,o,a)),this.mergeVertices()}function da(e,t,n,r,i,o,a){Et.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,l,u=Math.min(o+a,Math.PI),c=0,h=[],d=new E,f=new E,p=[],m=[],v=[],g=[];for(l=0;l<=n;l++){var y=[],_=l/n,x=0;for(0==l&&0==o?x=.5/t:l==n&&u==Math.PI&&(x=-.5/t),s=0;s<=t;s++){var b=s/t;d.x=-e*Math.cos(r+b*i)*Math.sin(o+_*a),d.y=e*Math.cos(o+_*a),d.z=e*Math.sin(r+b*i)*Math.sin(o+_*a),m.push(d.x,d.y,d.z),f.copy(d).normalize(),v.push(f.x,f.y,f.z),g.push(b+x,1-_),y.push(c++)}h.push(y)}for(l=0;l<n;l++)for(s=0;s<t;s++){var w=h[l][s+1],S=h[l][s],T=h[l+1][s],M=h[l+1][s+1];(0!==l||o>0)&&p.push(w,S,M),(l!==n-1||u<Math.PI)&&p.push(S,T,M)}this.setIndex(p),this.setAttribute("position",new ft(m,3)),this.setAttribute("normal",new ft(v,3)),this.setAttribute("uv",new ft(g,2))}function fa(e,t,n,r,i,o){Zt.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new pa(e,t,n,r,i,o)),this.mergeVertices()}function pa(e,t,n,r,i,o){Et.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},e=e||.5,t=t||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var a,s,l,u=[],c=[],h=[],d=[],f=e,p=(t-e)/(r=void 0!==r?Math.max(1,r):1),m=new E,v=new x;for(s=0;s<=r;s++){for(l=0;l<=n;l++)a=i+l/n*o,m.x=f*Math.cos(a),m.y=f*Math.sin(a),c.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,d.push(v.x,v.y);f+=p}for(s=0;s<r;s++){var g=s*(n+1);for(l=0;l<n;l++){var y=a=l+g,_=a+n+1,b=a+n+2,w=a+1;u.push(y,_,w),u.push(_,b,w)}}this.setIndex(u),this.setAttribute("position",new ft(c,3)),this.setAttribute("normal",new ft(h,3)),this.setAttribute("uv",new ft(d,2))}function ma(e,t,n,r){Zt.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},this.fromBufferGeometry(new va(e,t,n,r)),this.mergeVertices()}function va(e,t,n,r){Et.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t)||12,n=n||0,r=r||2*Math.PI,r=_.clamp(r,0,2*Math.PI);var i,o,a,s=[],l=[],u=[],c=1/t,h=new E,d=new x;for(o=0;o<=t;o++){var f=n+o*c*r,p=Math.sin(f),m=Math.cos(f);for(a=0;a<=e.length-1;a++)h.x=e[a].x*p,h.y=e[a].y,h.z=e[a].x*m,l.push(h.x,h.y,h.z),d.x=o/t,d.y=a/(e.length-1),u.push(d.x,d.y)}for(o=0;o<t;o++)for(a=0;a<e.length-1;a++){var v=i=a+o*e.length,g=i+e.length,y=i+e.length+1,b=i+1;s.push(v,g,b),s.push(g,y,b)}if(this.setIndex(s),this.setAttribute("position",new ft(l,3)),this.setAttribute("uv",new ft(u,2)),this.computeVertexNormals(),r===2*Math.PI){var w=this.attributes.normal.array,S=new E,T=new E,M=new E;for(i=t*e.length*3,o=0,a=0;o<e.length;o++,a+=3)S.x=w[a+0],S.y=w[a+1],S.z=w[a+2],T.x=w[i+a+0],T.y=w[i+a+1],T.z=w[i+a+2],M.addVectors(S,T).normalize(),w[a+0]=w[i+a+0]=M.x,w[a+1]=w[i+a+1]=M.y,w[a+2]=w[i+a+2]=M.z}}function ga(e,t){Zt.call(this),this.type="ShapeGeometry","object"===l(t)&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new ya(e,t)),this.mergeVertices()}function ya(e,t){Et.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var n=[],r=[],i=[],o=[],a=0,s=0;if(!1===Array.isArray(e))u(e);else for(var l=0;l<e.length;l++)u(e[l]),this.addGroup(a,s,l),a+=s,s=0;function u(e){var a,l,u,c=r.length/3,h=e.extractPoints(t),d=h.shape,f=h.holes;for(!1===na.isClockWise(d)&&(d=d.reverse()),a=0,l=f.length;a<l;a++)u=f[a],!0===na.isClockWise(u)&&(f[a]=u.reverse());var p=na.triangulateShape(d,f);for(a=0,l=f.length;a<l;a++)u=f[a],d=d.concat(u);for(a=0,l=d.length;a<l;a++){var m=d[a];r.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(a=0,l=p.length;a<l;a++){var v=p[a],g=v[0]+c,y=v[1]+c,_=v[2]+c;n.push(g,y,_),s+=3}}this.setIndex(n),this.setAttribute("position",new ft(r,3)),this.setAttribute("normal",new ft(i,3)),this.setAttribute("uv",new ft(o,2))}function _a(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function xa(e,t){Et.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var n,r,i,o,a=[],s=Math.cos(_.DEG2RAD*t),l=[0,0],u={},c=["a","b","c"];e.isBufferGeometry?(o=new Zt).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,d=o.faces,f=0,p=d.length;f<p;f++)for(var m=d[f],v=0;v<3;v++)n=m[c[v]],r=m[c[(v+1)%3]],l[0]=Math.min(n,r),l[1]=Math.max(n,r),void 0===u[i=l[0]+","+l[1]]?u[i]={index1:l[0],index2:l[1],face1:f,face2:void 0}:u[i].face2=f;for(i in u){var g=u[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=s){var y=h[g.index1];a.push(y.x,y.y,y.z),y=h[g.index2],a.push(y.x,y.y,y.z)}}this.setAttribute("position",new ft(a,3))}function ba(e,t,n,r,i,o,a,s){Zt.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new wa(e,t,n,r,i,o,a,s)),this.mergeVertices()}function wa(e,t,n,r,i,o,a,s){Et.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,r=Math.floor(r)||8,i=Math.floor(i)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var u=[],c=[],h=[],d=[],f=0,p=[],m=n/2,v=0;function g(n){var i,o,p,g=new x,y=new E,_=0,b=!0===n?e:t,w=!0===n?1:-1;for(o=f,i=1;i<=r;i++)c.push(0,m*w,0),h.push(0,w,0),d.push(.5,.5),f++;for(p=f,i=0;i<=r;i++){var S=i/r*s+a,T=Math.cos(S),M=Math.sin(S);y.x=b*M,y.y=m*w,y.z=b*T,c.push(y.x,y.y,y.z),h.push(0,w,0),g.x=.5*T+.5,g.y=.5*M*w+.5,d.push(g.x,g.y),f++}for(i=0;i<r;i++){var C=o+i,A=p+i;!0===n?u.push(A,A+1,C):u.push(A+1,A,C),_+=3}l.addGroup(v,_,!0===n?1:2),v+=_}!function(){var o,g,y=new E,_=new E,x=0,b=(t-e)/n;for(g=0;g<=i;g++){var w=[],S=g/i,T=S*(t-e)+e;for(o=0;o<=r;o++){var M=o/r,C=M*s+a,A=Math.sin(C),R=Math.cos(C);_.x=T*A,_.y=-S*n+m,_.z=T*R,c.push(_.x,_.y,_.z),y.set(A,b,R).normalize(),h.push(y.x,y.y,y.z),d.push(M,1-S),w.push(f++)}p.push(w)}for(o=0;o<r;o++)for(g=0;g<i;g++){var P=p[g][o],k=p[g+1][o],L=p[g+1][o+1],N=p[g][o+1];u.push(P,k,N),u.push(k,L,N),x+=6}l.addGroup(v,x,0),v+=x}(),!1===o&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(u),this.setAttribute("position",new ft(c,3)),this.setAttribute("normal",new ft(h,3)),this.setAttribute("uv",new ft(d,2))}function Sa(e,t,n,r,i,o,a){ba.call(this,0,e,t,n,r,i,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function Ea(e,t,n,r,i,o,a){wa.call(this,0,e,t,n,r,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function Ta(e,t,n,r){Zt.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new Ma(e,t,n,r)),this.mergeVertices()}function Ma(e,t,n,r){Et.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var i,o,a=[],s=[],l=[],u=[],c=new E,h=new x;for(s.push(0,0,0),l.push(0,0,1),u.push(.5,.5),o=0,i=3;o<=t;o++,i+=3){var d=n+o/t*r;c.x=e*Math.cos(d),c.y=e*Math.sin(d),s.push(c.x,c.y,c.z),l.push(0,0,1),h.x=(s[i]/e+1)/2,h.y=(s[i+1]/e+1)/2,u.push(h.x,h.y)}for(i=1;i<=t;i++)a.push(i,i+1,0);this.setIndex(a),this.setAttribute("position",new ft(s,3)),this.setAttribute("normal",new ft(l,3)),this.setAttribute("uv",new ft(u,2))}ua.prototype=Object.create(Zt.prototype),ua.prototype.constructor=ua,ca.prototype=Object.create(aa.prototype),ca.prototype.constructor=ca,ha.prototype=Object.create(Zt.prototype),ha.prototype.constructor=ha,da.prototype=Object.create(Et.prototype),da.prototype.constructor=da,fa.prototype=Object.create(Zt.prototype),fa.prototype.constructor=fa,pa.prototype=Object.create(Et.prototype),pa.prototype.constructor=pa,ma.prototype=Object.create(Zt.prototype),ma.prototype.constructor=ma,va.prototype=Object.create(Et.prototype),va.prototype.constructor=va,ga.prototype=Object.create(Zt.prototype),ga.prototype.constructor=ga,ga.prototype.toJSON=function(){var e=Zt.prototype.toJSON.call(this);return _a(this.parameters.shapes,e)},ya.prototype=Object.create(Et.prototype),ya.prototype.constructor=ya,ya.prototype.toJSON=function(){var e=Et.prototype.toJSON.call(this);return _a(this.parameters.shapes,e)},xa.prototype=Object.create(Et.prototype),xa.prototype.constructor=xa,ba.prototype=Object.create(Zt.prototype),ba.prototype.constructor=ba,wa.prototype=Object.create(Et.prototype),wa.prototype.constructor=wa,Sa.prototype=Object.create(ba.prototype),Sa.prototype.constructor=Sa,Ea.prototype=Object.create(wa.prototype),Ea.prototype.constructor=Ea,Ta.prototype=Object.create(Zt.prototype),Ta.prototype.constructor=Ta,Ma.prototype=Object.create(Et.prototype),Ma.prototype.constructor=Ma;var Ca=Object.freeze({__proto__:null,WireframeGeometry:vo,ParametricGeometry:go,ParametricBufferGeometry:yo,TetrahedronGeometry:bo,TetrahedronBufferGeometry:wo,OctahedronGeometry:So,OctahedronBufferGeometry:Eo,IcosahedronGeometry:To,IcosahedronBufferGeometry:Mo,DodecahedronGeometry:Co,DodecahedronBufferGeometry:Ao,PolyhedronGeometry:_o,PolyhedronBufferGeometry:xo,TubeGeometry:Ro,TubeBufferGeometry:Po,TorusKnotGeometry:ko,TorusKnotBufferGeometry:Lo,TorusGeometry:No,TorusBufferGeometry:Io,TextGeometry:ua,TextBufferGeometry:ca,SphereGeometry:ha,SphereBufferGeometry:da,RingGeometry:fa,RingBufferGeometry:pa,PlaneGeometry:vn,PlaneBufferGeometry:gn,LatheGeometry:ma,LatheBufferGeometry:va,ShapeGeometry:ga,ShapeBufferGeometry:ya,ExtrudeGeometry:oa,ExtrudeBufferGeometry:aa,EdgesGeometry:xa,ConeGeometry:Sa,ConeBufferGeometry:Ea,CylinderGeometry:ba,CylinderBufferGeometry:wa,CircleGeometry:Ta,CircleBufferGeometry:Ma,BoxGeometry:$t,BoxBufferGeometry:Kt});function Aa(e){nt.call(this),this.type="ShadowMaterial",this.color=new $e(0),this.transparent=!0,this.setValues(e)}function Ra(e){tn.call(this,e),this.type="RawShaderMaterial"}function Pa(e){nt.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new $e(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new x(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ka(e){Pa.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new x(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function La(e){nt.call(this),this.type="MeshPhongMaterial",this.color=new $e(16777215),this.specular=new $e(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new x(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Na(e){nt.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new $e(16777215),this.specular=new $e(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new x(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ia(e){nt.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new x(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Oa(e){nt.call(this),this.type="MeshLambertMaterial",this.color=new $e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Da(e){nt.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new $e(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new x(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function za(e){Yi.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Aa.prototype=Object.create(nt.prototype),Aa.prototype.constructor=Aa,Aa.prototype.isShadowMaterial=!0,Aa.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.color.copy(e.color),this},Ra.prototype=Object.create(tn.prototype),Ra.prototype.constructor=Ra,Ra.prototype.isRawShaderMaterial=!0,Pa.prototype=Object.create(nt.prototype),Pa.prototype.constructor=Pa,Pa.prototype.isMeshStandardMaterial=!0,Pa.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ka.prototype=Object.create(Pa.prototype),ka.prototype.constructor=ka,ka.prototype.isMeshPhysicalMaterial=!0,ka.prototype.copy=function(e){return Pa.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new $e).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},La.prototype=Object.create(nt.prototype),La.prototype.constructor=La,La.prototype.isMeshPhongMaterial=!0,La.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Na.prototype=Object.create(nt.prototype),Na.prototype.constructor=Na,Na.prototype.isMeshToonMaterial=!0,Na.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ia.prototype=Object.create(nt.prototype),Ia.prototype.constructor=Ia,Ia.prototype.isMeshNormalMaterial=!0,Ia.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Oa.prototype=Object.create(nt.prototype),Oa.prototype.constructor=Oa,Oa.prototype.isMeshLambertMaterial=!0,Oa.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Da.prototype=Object.create(nt.prototype),Da.prototype.constructor=Da,Da.prototype.isMeshMatcapMaterial=!0,Da.prototype.copy=function(e){return nt.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},za.prototype=Object.create(Yi.prototype),za.prototype.constructor=za,za.prototype.isLineDashedMaterial=!0,za.prototype.copy=function(e){return Yi.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Fa=Object.freeze({__proto__:null,ShadowMaterial:Aa,SpriteMaterial:_i,RawShaderMaterial:Ra,ShaderMaterial:tn,PointsMaterial:io,MeshPhysicalMaterial:ka,MeshStandardMaterial:Pa,MeshPhongMaterial:La,MeshToonMaterial:Na,MeshNormalMaterial:Ia,MeshLambertMaterial:Oa,MeshDepthMaterial:ti,MeshDistanceMaterial:ni,MeshBasicMaterial:rt,MeshMatcapMaterial:Da,LineDashedMaterial:za,LineBasicMaterial:Yi,Material:nt}),Ba={arraySlice:function(e,t,n){return Ba.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),o=0,a=0;a!==r;++o)for(var s=n[o]*t,l=0;l!==t;++l)i[a++]=e[s+l];return i},flattenJSON:function(e,t,n,r){for(var i=1,o=e[0];void 0!==o&&void 0===o[r];)o=e[i++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(t.push(o.time),n.push.apply(n,a)),o=e[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(t.push(o.time),a.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(t.push(o.time),n.push(a)),o=e[i++]}while(void 0!==o)}},subclip:function(e,t,n,r,i){i=i||30;var o=e.clone();o.name=t;for(var a=[],s=0;s<o.tracks.length;++s){for(var l=o.tracks[s],u=l.getValueSize(),c=[],h=[],d=0;d<l.times.length;++d){var f=l.times[d]*i;if(!(f<n||f>=r)){c.push(l.times[d]);for(var p=0;p<u;++p)h.push(l.values[d*u+p])}}0!==c.length&&(l.times=Ba.convertArray(c,l.times.constructor),l.values=Ba.convertArray(h,l.values.constructor),a.push(l))}o.tracks=a;var m=1/0;for(s=0;s<o.tracks.length;++s)m>o.tracks[s].times[0]&&(m=o.tracks[s].times[0]);for(s=0;s<o.tracks.length;++s)o.tracks[s].shift(-1*m);return o.resetDuration(),o}};function Ua(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function Va(e,t,n,r){Ua.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Ga(e,t,n,r){Ua.call(this,e,t,n,r)}function ja(e,t,n,r){Ua.call(this,e,t,n,r)}function Ha(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ba.convertArray(t,this.TimeBufferType),this.values=Ba.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function Wa(e,t,n){Ha.call(this,e,t,n)}function qa(e,t,n,r){Ha.call(this,e,t,n,r)}function Ya(e,t,n,r){Ha.call(this,e,t,n,r)}function Xa(e,t,n,r){Ua.call(this,e,t,n,r)}function Za(e,t,n,r){Ha.call(this,e,t,n,r)}function $a(e,t,n,r){Ha.call(this,e,t,n,r)}function Ka(e,t,n,r){Ha.call(this,e,t,n,r)}function Ja(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=_.generateUUID(),this.duration<0&&this.resetDuration()}function Qa(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ya;case"vector":case"vector2":case"vector3":case"vector4":return Ka;case"color":return qa;case"quaternion":return Za;case"bool":case"boolean":return Wa;case"string":return $a}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];Ba.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Ua.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var o;n:{r:if(!(e<r)){for(var a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===a)break;if(i=r,e<(r=t[++n]))break t}o=t.length;break n}if(e>=i)break e;var s=t[1];for(e<s&&(n=2,i=s),a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===a)break;if(r=i,e>=(i=t[--n-1]))break t}o=n,n=0}for(;n<o;){var l=n+o>>>1;e<t[l]?o=l:n=l+1}if(r=t[n],void 0===(i=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,o=0;o!==r;++o)t[o]=n[i+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Ua.prototype,{beforeStart_:Ua.prototype.copySampleValue_,afterEnd_:Ua.prototype.copySampleValue_}),Va.prototype=Object.assign(Object.create(Ua.prototype),{constructor:Va,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,n){var r=this.parameterPositions,i=e-2,o=e+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=e,a=2*t-n;break;case 2402:a=t+r[i=r.length-2]-r[i+1];break;default:i=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*n-t;break;case 2402:o=1,s=n+r[1]-r[0];break;default:o=e-1,s=t}var l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-n),this._offsetPrev=i*u,this._offsetNext=o*u},interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(r-t),p=f*f,m=p*f,v=-h*m+2*h*p-h*f,g=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,_=d*m-d*p,x=0;x!==a;++x)i[x]=v*o[u+x]+g*o[l+x]+y*o[s+x]+_*o[c+x];return i}}),Ga.prototype=Object.assign(Object.create(Ua.prototype),{constructor:Ga,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,u=(n-t)/(r-t),c=1-u,h=0;h!==a;++h)i[h]=o[l+h]*c+o[s+h]*u;return i}}),ja.prototype=Object.assign(Object.create(Ua.prototype),{constructor:ja,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Ha,{toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Ba.convertArray(e.times,Array),values:Ba.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(Ha.prototype,{constructor:Ha,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new ja(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Ga(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Va(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,r=n.length,i=0,o=r-1;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=Ba.arraySlice(n,i,o),this.values=Ba.arraySlice(this.values,i*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==i;a++){var s=n[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==r&&Ba.isTypedArray(r)){a=0;for(var l=r.length;a!==l;++a){var u=r[a];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,u),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,n=this.getValueSize(),r=2302===this.getInterpolation(),i=1,o=e.length-1,a=1;a<o;++a){var s=!1,l=e[a];if(l!==e[a+1]&&(1!==a||l!==l[0]))if(r)s=!0;else for(var u=a*n,c=u-n,h=u+n,d=0;d!==n;++d){var f=t[u+d];if(f!==t[c+d]||f!==t[h+d]){s=!0;break}}if(s){if(a!==i){e[i]=e[a];var p=a*n,m=i*n;for(d=0;d!==n;++d)t[m+d]=t[p+d]}++i}}if(o>0){for(e[i]=e[o],p=o*n,m=i*n,d=0;d!==n;++d)t[m+d]=t[p+d];++i}return i!==e.length&&(this.times=Ba.arraySlice(e,0,i),this.values=Ba.arraySlice(t,0,i*n)),this},clone:function(){var e=Ba.arraySlice(this.times,0),t=Ba.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),Wa.prototype=Object.assign(Object.create(Ha.prototype),{constructor:Wa,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),qa.prototype=Object.assign(Object.create(Ha.prototype),{constructor:qa,ValueTypeName:"color"}),Ya.prototype=Object.assign(Object.create(Ha.prototype),{constructor:Ya,ValueTypeName:"number"}),Xa.prototype=Object.assign(Object.create(Ua.prototype),{constructor:Xa,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=(n-t)/(r-t),u=s+a;s!==u;s+=4)b.slerpFlat(i,0,o,s-a,o,s,l);return i}}),Za.prototype=Object.assign(Object.create(Ha.prototype),{constructor:Za,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new Xa(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),$a.prototype=Object.assign(Object.create(Ha.prototype),{constructor:$a,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ka.prototype=Object.assign(Object.create(Ha.prototype),{constructor:Ka,ValueTypeName:"vector"}),Object.assign(Ja,{parse:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),i=0,o=n.length;i!==o;++i)t.push(Qa(n[i]).scale(r));return new Ja(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},i=0,o=n.length;i!==o;++i)t.push(Ha.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(e,t,n,r){for(var i=t.length,o=[],a=0;a<i;a++){var s=[],l=[];s.push((a+i-1)%i,a,(a+1)%i),l.push(0,1,0);var u=Ba.getKeyframeOrder(s);s=Ba.sortedArray(s,1,u),l=Ba.sortedArray(l,1,u),r||0!==s[0]||(s.push(i),l.push(l[0])),o.push(new Ya(".morphTargetInfluences["+t[a].name+"]",s,l).scale(1/n))}return new Ja(e,-1,o)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],l=s.name.match(i);if(l&&l.length>1){var u=r[h=l[1]];u||(r[h]=u=[]),u.push(s)}}var c=[];for(var h in r)c.push(Ja.CreateFromMorphTargetSequence(h,r[h],t,n));return c},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,i){if(0!==n.length){var o=[],a=[];Ba.flattenJSON(n,o,a,r),0!==o.length&&i.push(new e(t,o,a))}},r=[],i=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var u=s[l].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var c={},h=0;h<u.length;h++)if(u[h].morphTargets)for(var d=0;d<u[h].morphTargets.length;d++)c[u[h].morphTargets[d]]=-1;for(var f in c){var p=[],m=[];for(d=0;d!==u[h].morphTargets.length;++d){var v=u[h];p.push(v.time),m.push(v.morphTarget===f?1:0)}r.push(new Ya(".morphTargetInfluence["+f+"]",p,m))}o=c.length*(a||1)}else{var g=".bones["+t[l].name+"]";n(Ka,g+".position",u,"pos",r),n(Za,g+".quaternion",u,"rot",r),n(Ka,g+".scale",u,"scl",r)}}return 0===r.length?null:new Ja(i,o,r)}}),Object.assign(Ja.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Ja(this.name,this.duration,e)}});var es={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function ts(e,t,n){var r=this,i=!1,o=0,a=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===i&&void 0!==r.onStart&&r.onStart(e,o,a),i=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,a),o===a&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=l.length;t<n;t+=2){var r=l[t],i=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}}var ns=new ts;function rs(e){this.manager=void 0!==e?e:ns,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(rs.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var is={};function os(e){rs.call(this,e)}function as(e){rs.call(this,e)}function ss(e){rs.call(this,e)}function ls(e){rs.call(this,e)}function us(e){rs.call(this,e)}function cs(e){rs.call(this,e)}function hs(e){rs.call(this,e)}function ds(){this.type="Curve",this.arcLengthDivisions=200}function fs(e,t,n,r,i,o,a,s){ds.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function ps(e,t,n,r,i,o){fs.call(this,e,t,n,n,r,i,o),this.type="ArcCurve"}function ms(){var e=0,t=0,n=0,r=0;function i(i,o,a,s){e=i,t=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,a,s){var l=(t-e)/o-(n-e)/(o+a)+(n-t)/a,u=(n-t)/a-(r-t)/(a+s)+(r-n)/s;i(t,n,l*=a,u*=a)},calc:function(i){var o=i*i;return e+t*i+n*o+r*(o*i)}}}os.prototype=Object.assign(Object.create(rs.prototype),{constructor:os,load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=es.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;if(void 0===is[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],u=a[3];u=decodeURIComponent(u),l&&(u=atob(u));try{var c,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(u.length),f=0;f<u.length;f++)d[f]=u.charCodeAt(f);c="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var p=new DOMParser;c=p.parseFromString(u,s);break;case"json":c=JSON.parse(u);break;default:c=u}setTimeout((function(){t&&t(c),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{is[e]=[],is[e].push({onLoad:t,onProgress:n,onError:r});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",(function(t){var n=this.response,r=is[e];if(delete is[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),es.add(e,n);for(var o=0,a=r.length;o<a;o++)(s=r[o]).onLoad&&s.onLoad(n);i.manager.itemEnd(e)}else{for(o=0,a=r.length;o<a;o++){var s;(s=r[o]).onError&&s.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),m.addEventListener("progress",(function(t){for(var n=is[e],r=0,i=n.length;r<i;r++){var o=n[r];o.onProgress&&o.onProgress(t)}}),!1),m.addEventListener("error",(function(t){var n=is[e];delete is[e];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),m.addEventListener("abort",(function(t){var n=is[e];delete is[e];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(e),m}is[e].push({onLoad:t,onProgress:n,onError:r})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),as.prototype=Object.assign(Object.create(rs.prototype),{constructor:as,load:function(e,t,n,r){var i=this,o=new os(i.manager);o.setPath(i.path),o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var r=Ja.parse(e[n]);t.push(r)}return t}}),ss.prototype=Object.assign(Object.create(rs.prototype),{constructor:ss,load:function(e,t,n,r){var i=this,o=[],a=new fo;a.image=o;var s=new os(this.manager);function l(l){s.load(e[l],(function(e){var n=i.parse(e,!0);o[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(u+=1)&&(1===n.mipmapCount&&(a.minFilter=1006),a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,r)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var u=0,c=0,h=e.length;c<h;++c)l(c);else s.load(e,(function(e){var n=i.parse(e,!0);if(n.isCubemap)for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)o[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),o[s].format=n.format,o[s].width=n.width,o[s].height=n.height}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=1006),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,r);return a}}),ls.prototype=Object.assign(Object.create(rs.prototype),{constructor:ls,load:function(e,t,n,r){var i=this,o=new sn,a=new os(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,(function(e){var n=i.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:1001,o.wrapT=void 0!==n.wrapT?n.wrapT:1001,o.magFilter=void 0!==n.magFilter?n.magFilter:1006,o.minFilter=void 0!==n.minFilter?n.minFilter:1006,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=1008),1===n.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}}),us.prototype=Object.assign(Object.create(rs.prototype),{constructor:us,load:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=es.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),es.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}}),cs.prototype=Object.assign(Object.create(rs.prototype),{constructor:cs,load:function(e,t,n,r){var i=new Rn,o=new us(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(n){o.load(e[n],(function(e){i.images[n]=e,6==++a&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(var l=0;l<e.length;++l)s(l);return i}}),hs.prototype=Object.assign(Object.create(rs.prototype),{constructor:hs,load:function(e,t,n,r){var i=new P,o=new us(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){i.image=n;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?1022:1023,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}),Object.assign(ds.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,r=[],i=this.getPoint(0),o=0;for(r.push(0),n=1;n<=e;n++)o+=(t=this.getPoint(n/e)).distanceTo(i),r.push(o),i=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,r=this.getLengths(),i=0,o=r.length;n=t||e*r[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=r[i=Math.floor(s+(l-s)/2)]-n)<0)s=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(r[i=l]===n)return i/(o-1);var u=r[i];return(i+(n-u)/(r[i+1]-u))/(o-1)},getTangent:function(e){var t=e-1e-4,n=e+1e-4;t<0&&(t=0),n>1&&(n=1);var r=this.getPoint(t);return this.getPoint(n).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var n,r,i,o=new E,a=[],s=[],l=[],u=new E,c=new V;for(n=0;n<=e;n++)r=n/e,a[n]=this.getTangentAt(r),a[n].normalize();s[0]=new E,l[0]=new E;var h=Number.MAX_VALUE,d=Math.abs(a[0].x),f=Math.abs(a[0].y),p=Math.abs(a[0].z);for(d<=h&&(h=d,o.set(1,0,0)),f<=h&&(h=f,o.set(0,1,0)),p<=h&&o.set(0,0,1),u.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],u),l[0].crossVectors(a[0],s[0]),n=1;n<=e;n++)s[n]=s[n-1].clone(),l[n]=l[n-1].clone(),u.crossVectors(a[n-1],a[n]),u.length()>Number.EPSILON&&(u.normalize(),i=Math.acos(_.clamp(a[n-1].dot(a[n]),-1,1)),s[n].applyMatrix4(c.makeRotationAxis(u,i))),l[n].crossVectors(a[n],s[n]);if(!0===t)for(i=Math.acos(_.clamp(s[0].dot(s[e]),-1,1)),i/=e,a[0].dot(u.crossVectors(s[0],s[e]))>0&&(i=-i),n=1;n<=e;n++)s[n].applyMatrix4(c.makeRotationAxis(a[n],i*n)),l[n].crossVectors(a[n],s[n]);return{tangents:a,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),fs.prototype=Object.create(ds.prototype),fs.prototype.constructor=fs,fs.prototype.isEllipseCurve=!0,fs.prototype.getPoint=function(e,t){for(var n=t||new x,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);var a=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;s=h*u-d*c+this.aX,l=h*c+d*u+this.aY}return n.set(s,l)},fs.prototype.copy=function(e){return ds.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},fs.prototype.toJSON=function(){var e=ds.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},fs.prototype.fromJSON=function(e){return ds.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ps.prototype=Object.create(fs.prototype),ps.prototype.constructor=ps,ps.prototype.isArcCurve=!0;var vs=new E,gs=new ms,ys=new ms,_s=new ms;function xs(e,t,n,r){ds.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=r||.5}function bs(e,t,n,r,i){var o=.5*(r-t),a=.5*(i-n),s=e*e;return(2*n-2*r+o+a)*(e*s)+(-3*n+3*r-2*o-a)*s+o*e+n}function ws(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Ss(e,t,n,r,i){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}function Es(e,t,n,r){ds.call(this),this.type="CubicBezierCurve",this.v0=e||new x,this.v1=t||new x,this.v2=n||new x,this.v3=r||new x}function Ts(e,t,n,r){ds.call(this),this.type="CubicBezierCurve3",this.v0=e||new E,this.v1=t||new E,this.v2=n||new E,this.v3=r||new E}function Ms(e,t){ds.call(this),this.type="LineCurve",this.v1=e||new x,this.v2=t||new x}function Cs(e,t){ds.call(this),this.type="LineCurve3",this.v1=e||new E,this.v2=t||new E}function As(e,t,n){ds.call(this),this.type="QuadraticBezierCurve",this.v0=e||new x,this.v1=t||new x,this.v2=n||new x}function Rs(e,t,n){ds.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new E,this.v1=t||new E,this.v2=n||new E}function Ps(e){ds.call(this),this.type="SplineCurve",this.points=e||[]}xs.prototype=Object.create(ds.prototype),xs.prototype.constructor=xs,xs.prototype.isCatmullRomCurve3=!0,xs.prototype.getPoint=function(e,t){var n,r,i,o,a=t||new E,s=this.points,l=s.length,u=(l-(this.closed?0:1))*e,c=Math.floor(u),h=u-c;if(this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/l)+1)*l:0===h&&c===l-1&&(c=l-2,h=1),this.closed||c>0?n=s[(c-1)%l]:(vs.subVectors(s[0],s[1]).add(s[0]),n=vs),r=s[c%l],i=s[(c+1)%l],this.closed||c+2<l?o=s[(c+2)%l]:(vs.subVectors(s[l-1],s[l-2]).add(s[l-1]),o=vs),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,f=Math.pow(n.distanceToSquared(r),d),p=Math.pow(r.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(o),d);p<1e-4&&(p=1),f<1e-4&&(f=p),m<1e-4&&(m=p),gs.initNonuniformCatmullRom(n.x,r.x,i.x,o.x,f,p,m),ys.initNonuniformCatmullRom(n.y,r.y,i.y,o.y,f,p,m),_s.initNonuniformCatmullRom(n.z,r.z,i.z,o.z,f,p,m)}else"catmullrom"===this.curveType&&(gs.initCatmullRom(n.x,r.x,i.x,o.x,this.tension),ys.initCatmullRom(n.y,r.y,i.y,o.y,this.tension),_s.initCatmullRom(n.z,r.z,i.z,o.z,this.tension));return a.set(gs.calc(h),ys.calc(h),_s.calc(h)),a},xs.prototype.copy=function(e){ds.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},xs.prototype.toJSON=function(){var e=ds.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},xs.prototype.fromJSON=function(e){ds.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new E).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Es.prototype=Object.create(ds.prototype),Es.prototype.constructor=Es,Es.prototype.isCubicBezierCurve=!0,Es.prototype.getPoint=function(e,t){var n=t||new x,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Ss(e,r.x,i.x,o.x,a.x),Ss(e,r.y,i.y,o.y,a.y)),n},Es.prototype.copy=function(e){return ds.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Es.prototype.toJSON=function(){var e=ds.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Es.prototype.fromJSON=function(e){return ds.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Ts.prototype=Object.create(ds.prototype),Ts.prototype.constructor=Ts,Ts.prototype.isCubicBezierCurve3=!0,Ts.prototype.getPoint=function(e,t){var n=t||new E,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Ss(e,r.x,i.x,o.x,a.x),Ss(e,r.y,i.y,o.y,a.y),Ss(e,r.z,i.z,o.z,a.z)),n},Ts.prototype.copy=function(e){return ds.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ts.prototype.toJSON=function(){var e=ds.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ts.prototype.fromJSON=function(e){return ds.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Ms.prototype=Object.create(ds.prototype),Ms.prototype.constructor=Ms,Ms.prototype.isLineCurve=!0,Ms.prototype.getPoint=function(e,t){var n=t||new x;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Ms.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Ms.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Ms.prototype.copy=function(e){return ds.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ms.prototype.toJSON=function(){var e=ds.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ms.prototype.fromJSON=function(e){return ds.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Cs.prototype=Object.create(ds.prototype),Cs.prototype.constructor=Cs,Cs.prototype.isLineCurve3=!0,Cs.prototype.getPoint=function(e,t){var n=t||new E;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Cs.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Cs.prototype.copy=function(e){return ds.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Cs.prototype.toJSON=function(){var e=ds.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Cs.prototype.fromJSON=function(e){return ds.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},As.prototype=Object.create(ds.prototype),As.prototype.constructor=As,As.prototype.isQuadraticBezierCurve=!0,As.prototype.getPoint=function(e,t){var n=t||new x,r=this.v0,i=this.v1,o=this.v2;return n.set(ws(e,r.x,i.x,o.x),ws(e,r.y,i.y,o.y)),n},As.prototype.copy=function(e){return ds.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},As.prototype.toJSON=function(){var e=ds.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},As.prototype.fromJSON=function(e){return ds.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Rs.prototype=Object.create(ds.prototype),Rs.prototype.constructor=Rs,Rs.prototype.isQuadraticBezierCurve3=!0,Rs.prototype.getPoint=function(e,t){var n=t||new E,r=this.v0,i=this.v1,o=this.v2;return n.set(ws(e,r.x,i.x,o.x),ws(e,r.y,i.y,o.y),ws(e,r.z,i.z,o.z)),n},Rs.prototype.copy=function(e){return ds.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Rs.prototype.toJSON=function(){var e=ds.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Rs.prototype.fromJSON=function(e){return ds.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ps.prototype=Object.create(ds.prototype),Ps.prototype.constructor=Ps,Ps.prototype.isSplineCurve=!0,Ps.prototype.getPoint=function(e,t){var n=t||new x,r=this.points,i=(r.length-1)*e,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],l=r[o],u=r[o>r.length-2?r.length-1:o+1],c=r[o>r.length-3?r.length-1:o+2];return n.set(bs(a,s.x,l.x,u.x,c.x),bs(a,s.y,l.y,u.y,c.y)),n},Ps.prototype.copy=function(e){ds.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this},Ps.prototype.toJSON=function(){var e=ds.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e},Ps.prototype.fromJSON=function(e){ds.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new x).fromArray(r))}return this};var ks=Object.freeze({__proto__:null,ArcCurve:ps,CatmullRomCurve3:xs,CubicBezierCurve:Es,CubicBezierCurve3:Ts,EllipseCurve:fs,LineCurve:Ms,LineCurve3:Cs,QuadraticBezierCurve:As,QuadraticBezierCurve3:Rs,SplineCurve:Ps});function Ls(){ds.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Ns(e){Ls.call(this),this.type="Path",this.currentPoint=new x,e&&this.setFromPoints(e)}function Is(e){Ns.call(this,e),this.uuid=_.generateUUID(),this.type="Shape",this.holes=[]}function Os(e,t){oe.call(this),this.type="Light",this.color=new $e(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Ds(e,t,n){Os.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(oe.DefaultUp),this.updateMatrix(),this.groundColor=new $e(t)}function zs(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new x(512,512),this.map=null,this.mapPass=null,this.matrix=new V,this._frustum=new cn,this._frameExtents=new x(1,1),this._viewportCount=1,this._viewports=[new k(0,0,1,1)]}function Fs(){zs.call(this,new rn(50,1,.5,500))}function Bs(e,t,n,r,i,o){Os.call(this,e,t),this.type="SpotLight",this.position.copy(oe.DefaultUp),this.updateMatrix(),this.target=new oe,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new Fs}function Us(){zs.call(this,new rn(90,1,.5,500)),this._frameExtents=new x(4,2),this._viewportCount=6,this._viewports=[new k(2,1,1,1),new k(0,1,1,1),new k(3,1,1,1),new k(1,1,1,1),new k(3,0,1,1),new k(1,0,1,1)],this._cubeDirections=[new E(1,0,0),new E(-1,0,0),new E(0,0,1),new E(0,0,-1),new E(0,1,0),new E(0,-1,0)],this._cubeUps=[new E(0,1,0),new E(0,1,0),new E(0,1,0),new E(0,1,0),new E(0,0,1),new E(0,0,-1)]}function Vs(e,t,n,r){Os.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new Us}function Gs(e,t,n,r,i,o){nn.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function js(){zs.call(this,new Gs(-5,5,5,-5,.5,500))}function Hs(e,t){Os.call(this,e,t),this.type="DirectionalLight",this.position.copy(oe.DefaultUp),this.updateMatrix(),this.target=new oe,this.shadow=new js}function Ws(e,t){Os.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function qs(e,t,n,r){Os.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function Ys(e){rs.call(this,e),this.textures={}}Ls.prototype=Object.assign(Object.create(ds.prototype),{constructor:Ls,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ms(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=t){var i=n[r]-t,o=this.curves[r],a=o.getLength(),s=0===a?0:1-i/a;return o.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],r=0,i=this.curves;r<i.length;r++)for(var o=i[r],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),l=0;l<s.length;l++){var u=s[l];t&&t.equals(u)||(n.push(u),t=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){ds.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=ds.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){ds.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push((new ks[r.type]).fromJSON(r))}return this}}),Ns.prototype=Object.assign(Object.create(Ls.prototype),{constructor:Ns,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var n=new Ms(this.currentPoint.clone(),new x(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,r){var i=new As(this.currentPoint.clone(),new x(e,t),new x(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(e,t,n,r,i,o){var a=new Es(this.currentPoint.clone(),new x(e,t),new x(n,r),new x(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this},splineThru:function(e){var t=new Ps([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,r,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,n,r,i,o),this},absarc:function(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this},ellipse:function(e,t,n,r,i,o,a,s){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,r,i,o,a,s),this},absellipse:function(e,t,n,r,i,o,a,s){var l=new fs(e,t,n,r,i,o,a,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return Ls.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Ls.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Ls.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Is.prototype=Object.assign(Object.create(Ns.prototype),{constructor:Is,getPointsHoles:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Ns.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=Ns.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){Ns.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push((new Ns).fromJSON(r))}return this}}),Os.prototype=Object.assign(Object.create(oe.prototype),{constructor:Os,isLight:!0,copy:function(e){return oe.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=oe.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Ds.prototype=Object.assign(Object.create(Os.prototype),{constructor:Ds,isHemisphereLight:!0,copy:function(e){return Os.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(zs.prototype,{_projScreenMatrix:new V,_lightPositionWorld:new E,_lookTarget:new E,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Fs.prototype=Object.assign(Object.create(zs.prototype),{constructor:Fs,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,n=2*_.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),zs.prototype.updateMatrices.call(this,e)}}),Bs.prototype=Object.assign(Object.create(Os.prototype),{constructor:Bs,isSpotLight:!0,copy:function(e){return Os.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Us.prototype=Object.assign(Object.create(zs.prototype),{constructor:Us,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var n=this.camera,r=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;i.setFromMatrixPosition(e.matrixWorld),n.position.copy(i),o.copy(n.position),o.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(o),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),a.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromMatrix(a)}}),Vs.prototype=Object.assign(Object.create(Os.prototype),{constructor:Vs,isPointLight:!0,copy:function(e){return Os.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Gs.prototype=Object.assign(Object.create(nn.prototype),{constructor:Gs,isOrthographicCamera:!0,copy:function(e,t){return nn.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,o=n+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(i+=c*(this.view.offsetX/l))+c*(this.view.width/l),s=(a-=h*(this.view.offsetY/u))-h*(this.view.height/u)}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=oe.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),js.prototype=Object.assign(Object.create(zs.prototype),{constructor:js,isDirectionalLightShadow:!0,updateMatrices:function(e){zs.prototype.updateMatrices.call(this,e)}}),Hs.prototype=Object.assign(Object.create(Os.prototype),{constructor:Hs,isDirectionalLight:!0,copy:function(e){return Os.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ws.prototype=Object.assign(Object.create(Os.prototype),{constructor:Ws,isAmbientLight:!0}),qs.prototype=Object.assign(Object.create(Os.prototype),{constructor:qs,isRectAreaLight:!0,copy:function(e){return Os.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Os.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Ys.prototype=Object.assign(Object.create(rs.prototype),{constructor:Ys,load:function(e,t,n,r){var i=this,o=new os(i.manager);o.setPath(i.path),o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){var t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new Fa[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new $e).setHex(e.sheen)),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.uniforms)for(var i in e.uniforms){var o=e.uniforms[i];switch(r.uniforms[i]={},o.type){case"t":r.uniforms[i].value=n(o.value);break;case"c":r.uniforms[i].value=(new $e).setHex(o.value);break;case"v2":r.uniforms[i].value=(new x).fromArray(o.value);break;case"v3":r.uniforms[i].value=(new E).fromArray(o.value);break;case"v4":r.uniforms[i].value=(new k).fromArray(o.value);break;case"m3":r.uniforms[i].value=(new C).fromArray(o.value);case"m4":r.uniforms[i].value=(new V).fromArray(o.value);break;default:r.uniforms[i].value=o.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var a in e.extensions)r.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new x).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new x).fromArray(e.clearcoatNormalScale)),r},setTextures:function(e){return this.textures=e,this}});var Xs={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function Zs(){Et.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function $s(e,t,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),ot.call(this,e,t,n),this.meshPerAttribute=r||1}function Ks(e){rs.call(this,e)}Zs.prototype=Object.assign(Object.create(Et.prototype),{constructor:Zs,isInstancedBufferGeometry:!0,copy:function(e){return Et.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=Et.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),$s.prototype=Object.assign(Object.create(ot.prototype),{constructor:$s,isInstancedBufferAttribute:!0,copy:function(e){return ot.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=ot.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Ks.prototype=Object.assign(Object.create(rs.prototype),{constructor:Ks,load:function(e,t,n,r){var i=this,o=new os(i.manager);o.setPath(i.path),o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){var t=e.isInstancedBufferGeometry?new Zs:new Et,n=e.data.index;if(void 0!==n){var r=new Js[n.type](n.array);t.setIndex(new ot(r,1))}var i=e.data.attributes;for(var o in i){var a=i[o],s=(r=new Js[a.type](a.array),new(a.isInstancedBufferAttribute?$s:ot)(r,a.itemSize,a.normalized));void 0!==a.name&&(s.name=a.name),t.setAttribute(o,s)}var l=e.data.morphAttributes;if(l)for(var o in l){for(var u=l[o],c=[],h=0,d=u.length;h<d;h++)a=u[h],s=new ot(r=new Js[a.type](a.array),a.itemSize,a.normalized),void 0!==a.name&&(s.name=a.name),c.push(s);t.morphAttributes[o]=c}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var f=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==f){h=0;for(var p=f.length;h!==p;++h){var m=f[h];t.addGroup(m.start,m.count,m.materialIndex)}}var v=e.data.boundingSphere;if(void 0!==v){var g=new E;void 0!==v.center&&g.fromArray(v.center),t.boundingSphere=new Se(g,v.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var Js={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Qs(e){rs.call(this,e)}Qs.prototype=Object.assign(Object.create(rs.prototype),{constructor:Qs,load:function(e,t,n,r){var i=this,o=""===this.path?Xs.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;var a=new os(i.manager);a.setPath(this.path),a.load(e,(function(n){var o=null;try{o=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,r)},parse:function(e,t){var n=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,n),i=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),o=this.parseTextures(e.textures,i),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,r,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var i=(new Is).fromJSON(e[n]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var n={};if(void 0!==e)for(var r=new Ks,i=0,o=e.length;i<o;i++){var a,s=e[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Ca[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Ca[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Ca[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Ca[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Ca[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Ca[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Ca[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Ca[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Ca[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Ca[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new Ca[s.type]((new ks[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Ca[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Ca[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],u=0,c=s.shapes.length;u<c;u++){var h=t[s.shapes[u]];l.push(h)}a=new Ca[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],u=0,c=s.shapes.length;u<c;u++)h=t[s.shapes[u]],l.push(h);var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new ks[d.type]).fromJSON(d)),a=new Ca[s.type](l,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(s);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?a=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),n[s.uuid]=a}return n},parseMaterials:function(e,t){var n={},r={};if(void 0!==e){var i=new Ys;i.setTextures(t);for(var o=0,a=e.length;o<a;o++){var s=e[o];if("MultiMaterial"===s.type){for(var l=[],u=0;u<s.materials.length;u++){var c=s.materials[u];void 0===n[c.uuid]&&(n[c.uuid]=i.parse(c)),l.push(n[c.uuid])}r[s.uuid]=l}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],i=Ja.parse(r);void 0!==r.uuid&&(i.uuid=r.uuid),t.push(i)}return t},parseImages:function(e,t){var n=this,r={};function i(e){return n.manager.itemStart(e),o.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}if(void 0!==e&&e.length>0){var o=new us(new ts(t));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=e.length;a<s;a++){var l=e[a],u=l.url;if(Array.isArray(u)){r[l.uuid]=[];for(var c=0,h=u.length;c<h;c++){var d=u[c],f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:n.resourcePath+d;r[l.uuid].push(i(f))}}else f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:n.resourcePath+l.url,r[l.uuid]=i(f)}}return r},parseTextures:function(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var i=0,o=e.length;i<o;i++){var a,s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(a=Array.isArray(t[s.image])?new Rn(t[s.image]):new P(t[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=n(s.mapping,tl)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=n(s.wrap[0],nl),a.wrapT=n(s.wrap[1],nl)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=n(s.minFilter,rl)),void 0!==s.magFilter&&(a.magFilter=n(s.magFilter,rl)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),r[s.uuid]=a}return r},parseObject:function(e,t,n){var r;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function o(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,i=e.length;r<i;r++){var o=e[r];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(n[o])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":r=new ae,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new $e(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new pi(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new fi(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new rn(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new Gs(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new Ws(e.color,e.intensity);break;case"DirectionalLight":r=new Hs(e.color,e.intensity);break;case"PointLight":r=new Vs(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new qs(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Bs(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new Ds(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=i(e.geometry),s=o(e.material);r=a.bones&&a.bones.length>0?new zi(a,s):new Gt(a,s);break;case"InstancedMesh":a=i(e.geometry),s=o(e.material);var l=e.count,u=e.instanceMatrix;(r=new qi(a,s,l)).instanceMatrix=new ot(new Float32Array(u.array),16);break;case"LOD":r=new Di;break;case"Line":r=new Qi(i(e.geometry),o(e.material),e.mode);break;case"LineLoop":r=new ro(i(e.geometry),o(e.material));break;case"LineSegments":r=new no(i(e.geometry),o(e.material));break;case"PointCloud":case"Points":r=new uo(i(e.geometry),o(e.material));break;case"Sprite":r=new Li(o(e.material));break;case"Group":r=new ci;break;default:r=new oe}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children)for(var c=e.children,h=0;h<c.length;h++)r.add(this.parseObject(c[h],t,n));if("LOD"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);for(var d=e.levels,f=0;f<d.length;f++){var p=d[f],m=r.getObjectByProperty("uuid",p.object);void 0!==m&&r.addLevel(m,p.distance)}}return r}});var el,tl={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},nl={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},rl={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};function il(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),rs.call(this,e),this.options=void 0}function ol(){this.type="ShapePath",this.color=new $e,this.subPaths=[],this.currentPath=null}function al(e){this.type="Font",this.data=e}function sl(e,t,n,r,i){var o=i.glyphs[e]||i.glyphs["?"];if(o){var a,s,l,u,c,h,d,f,p=new ol;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),v=0,g=m.length;v<g;)switch(m[v++]){case"m":a=m[v++]*t+n,s=m[v++]*t+r,p.moveTo(a,s);break;case"l":a=m[v++]*t+n,s=m[v++]*t+r,p.lineTo(a,s);break;case"q":l=m[v++]*t+n,u=m[v++]*t+r,c=m[v++]*t+n,h=m[v++]*t+r,p.quadraticCurveTo(c,h,l,u);break;case"b":l=m[v++]*t+n,u=m[v++]*t+r,c=m[v++]*t+n,h=m[v++]*t+r,d=m[v++]*t+n,f=m[v++]*t+r,p.bezierCurveTo(c,h,d,f,l,u)}return{offsetX:o.ha*t,path:p}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".")}function ll(e){rs.call(this,e)}il.prototype=Object.assign(Object.create(rs.prototype),{constructor:il,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=es.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;fetch(e).then((function(e){return e.blob()})).then((function(e){return void 0===i.options?createImageBitmap(e):createImageBitmap(e,i.options)})).then((function(n){es.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}),Object.assign(ol.prototype,{moveTo:function(e,t){return this.currentPath=new Ns,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],o=new Is;o.curves=i.curves,t.push(o)}return t}function r(e,t){for(var n=t.length,r=!1,i=n-1,o=0;o<n;i=o++){var a=t[i],s=t[o],l=s.x-a.x,u=s.y-a.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(a=t[o],l=-l,s=t[i],u=-u),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var c=u*(e.x-a.x)-l*(e.y-a.y);if(0===c)return!0;if(c<0)continue;r=!r}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return r}var i=na.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);var a,s,l,u=[];if(1===o.length)return s=o[0],(l=new Is).curves=s.curves,u.push(l),u;var c=!i(o[0].getPoints());c=e?!c:c;var h,d,f=[],p=[],m=[],v=0;p[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)a=i(h=(s=o[g]).getPoints()),(a=e?!a:a)?(!c&&p[v]&&v++,p[v]={s:new Is,p:h},p[v].s.curves=s.curves,c&&v++,m[v]=[]):m[v].push({h:s,p:h[0]});if(!p[0])return n(o);if(p.length>1){for(var _=!1,x=[],b=0,w=p.length;b<w;b++)f[b]=[];for(b=0,w=p.length;b<w;b++)for(var S=m[b],E=0;E<S.length;E++){for(var T=S[E],M=!0,C=0;C<p.length;C++)r(T.p,p[C].p)&&(b!==C&&x.push({froms:b,tos:C,hole:E}),M?(M=!1,f[C].push(T)):_=!0);M&&f[b].push(T)}x.length>0&&(_||(m=f))}g=0;for(var A=p.length;g<A;g++){l=p[g].s,u.push(l);for(var R=0,P=(d=m[g]).length;R<P;R++)l.holes.push(d[R].h)}return u}}),Object.assign(al.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var n=[],r=function(e,t,n){for(var r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,a=[],s=0,l=0,u=0;u<r.length;u++){var c=r[u];if("\n"===c)s=0,l-=o;else{var h=sl(c,i,s,l,n);s+=h.offsetX,a.push(h.path)}}return a}(e,t,this.data),i=0,o=r.length;i<o;i++)Array.prototype.push.apply(n,r[i].toShapes());return n}}),ll.prototype=Object.assign(Object.create(rs.prototype),{constructor:ll,load:function(e,t,n,r){var i=this,o=new os(this.manager);o.setPath(this.path),o.load(e,(function(e){var n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var r=i.parse(n);t&&t(r)}),n,r)},parse:function(e){return new al(e)}});var ul={getContext:function(){return void 0===el&&(el=new(window.AudioContext||window.webkitAudioContext)),el},setContext:function(e){el=e}};function cl(e){rs.call(this,e)}function hl(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new E)}function dl(e,t){Os.call(this,void 0,t),this.sh=void 0!==e?e:new hl}function fl(e,t,n){dl.call(this,void 0,n);var r=(new $e).set(e),i=(new $e).set(t),o=new E(r.r,r.g,r.b),a=new E(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}function pl(e,t){dl.call(this,void 0,t);var n=(new $e).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}cl.prototype=Object.assign(Object.create(rs.prototype),{constructor:cl,load:function(e,t,n,r){var i=new os(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(e,(function(e){var n=e.slice(0);ul.getContext().decodeAudioData(n,(function(e){t(e)}))}),n,r)}}),Object.assign(hl.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScale(o[1],.488603*r),t.addScale(o[2],.488603*i),t.addScale(o[3],.488603*n),t.addScale(o[4],n*r*1.092548),t.addScale(o[5],r*i*1.092548),t.addScale(o[6],.315392*(3*i*i-1)),t.addScale(o[7],n*i*1.092548),t.addScale(o[8],.546274*(n*n-r*r)),t},getIrradianceAt:function(e,t){var n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScale(o[1],1.023328*r),t.addScale(o[2],1.023328*i),t.addScale(o[3],1.023328*n),t.addScale(o[4],.858086*n*r),t.addScale(o[5],.858086*r*i),t.addScale(o[6],.743125*i*i-.247708),t.addScale(o[7],.858086*n*i),t.addScale(o[8],.429043*(n*n-r*r)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}}),Object.assign(hl,{getBasisAt:function(e,t){var n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}),dl.prototype=Object.assign(Object.create(Os.prototype),{constructor:dl,isLightProbe:!0,copy:function(e){return Os.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return Os.prototype.toJSON.call(this,e)}}),fl.prototype=Object.assign(Object.create(dl.prototype),{constructor:fl,isHemisphereLightProbe:!0,copy:function(e){return dl.prototype.copy.call(this,e),this},toJSON:function(e){return dl.prototype.toJSON.call(this,e)}}),pl.prototype=Object.assign(Object.create(dl.prototype),{constructor:pl,isAmbientLightProbe:!0,copy:function(e){return dl.prototype.copy.call(this,e),this},toJSON:function(e){return dl.prototype.toJSON.call(this,e)}});var ml=new V,vl=new V;function gl(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new rn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new rn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function yl(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(gl.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,r,i=e.projectionMatrix.clone(),o=t.eyeSep/2,a=o*t.near/t.focus,s=t.near*Math.tan(_.DEG2RAD*t.fov*.5)/t.zoom;vl.elements[12]=-o,ml.elements[12]=o,n=-s*t.aspect+a,r=s*t.aspect+a,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(i),n=-s*t.aspect-a,r=s*t.aspect-a,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(vl),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(ml)}}),Object.assign(yl.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var _l=new E,xl=new b,bl=new E,wl=new E;function Sl(){oe.call(this),this.type="AudioListener",this.context=ul.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new yl}function El(e){oe.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}Sl.prototype=Object.assign(Object.create(oe.prototype),{constructor:Sl,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){oe.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_l,xl,bl),wl.set(0,0,-1).applyQuaternion(xl),t.positionX){var r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(_l.x,r),t.positionY.linearRampToValueAtTime(_l.y,r),t.positionZ.linearRampToValueAtTime(_l.z,r),t.forwardX.linearRampToValueAtTime(wl.x,r),t.forwardY.linearRampToValueAtTime(wl.y,r),t.forwardZ.linearRampToValueAtTime(wl.z,r),t.upX.linearRampToValueAtTime(n.x,r),t.upY.linearRampToValueAtTime(n.y,r),t.upZ.linearRampToValueAtTime(n.z,r)}else t.setPosition(_l.x,_l.y,_l.z),t.setOrientation(wl.x,wl.y,wl.z,n.x,n.y,n.z)}}),El.prototype=Object.assign(Object.create(oe.prototype),{constructor:El,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var Tl=new E,Ml=new b,Cl=new E,Al=new E;function Rl(e){El.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Pl(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function kl(e,t,n){this.binding=e,this.valueSize=n;var r,i=Float64Array;switch(t){case"quaternion":r=this._slerp;break;case"string":case"bool":i=Array,r=this._select;break;default:r=this._lerp}this.buffer=new i(4*n),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Rl.prototype=Object.assign(Object.create(El.prototype),{constructor:Rl,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(e){if(oe.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Tl,Ml,Cl),Al.set(0,0,1).applyQuaternion(Ml);var t=this.panner;if(t.positionX){var n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Tl.x,n),t.positionY.linearRampToValueAtTime(Tl.y,n),t.positionZ.linearRampToValueAtTime(Tl.z,n),t.orientationX.linearRampToValueAtTime(Al.x,n),t.orientationY.linearRampToValueAtTime(Al.y,n),t.orientationZ.linearRampToValueAtTime(Al.z,n)}else t.setPosition(Tl.x,Tl.y,Tl.z),t.setOrientation(Al.x,Al.y,Al.z)}}}),Object.assign(Pl.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(kl.prototype,{accumulate:function(e,t){var n=this.buffer,r=this.valueSize,i=e*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)n[i+a]=n[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(n,i,0,s,r)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,i<1){var a=3*t;this._mixBufferRegion(n,r,a,1-i,t)}for(var s=t,l=t+t;s!==l;++s)if(n[s]!==n[s+t]){o.setValue(n,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=3*n;e.getValue(t,r);for(var i=n,o=r;i!==o;++i)t[i]=t[r+i%n];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,n,r,i){if(r>=.5)for(var o=0;o!==i;++o)e[t+o]=e[n+o]},_slerp:function(e,t,n,r){b.slerpFlat(e,t,e,t,e,n,r)},_lerp:function(e,t,n,r,i){for(var o=1-r,a=0;a!==i;++a){var s=t+a;e[s]=e[s]*o+e[n+a]*r}}});var Ll=new RegExp("[\\[\\]\\.:\\/]","g"),Nl="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Il=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Ol=/(WCOD+)?/.source.replace("WCOD",Nl),Dl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),zl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Fl=new RegExp("^"+Il+Ol+Dl+zl+"$"),Bl=["material","materials","bones"];function Ul(e,t,n){var r=n||Vl.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function Vl(e,t,n){this.path=t,this.parsedPath=n||Vl.parseTrackName(t),this.node=Vl.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Gl(){this.uuid=_.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats=Object.defineProperties({objects:Object.defineProperties({},{total:{get:function(){return r._objects.length},configurable:!0,enumerable:!0},inUse:{get:function(){return this.total-r.nCachedObjects_},configurable:!0,enumerable:!0}})},{bindingsPerObject:{get:function(){return r._bindings.length},configurable:!0,enumerable:!0}})}function jl(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var r=t.tracks,i=r.length,o=new Array(i),a={endingStart:2400,endingEnd:2400},s=0;s!==i;++s){var l=r[s].createInterpolant(null);o[s]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Hl(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Wl(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function ql(e,t,n){mi.call(this,e,t),this.meshPerAttribute=n||1}function Yl(e,t,n,r){this.ray=new ke(e,t),this.near=n||0,this.far=r||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Xl(e,t){return e.distance-t.distance}function Zl(e,t,n,r){if(!1!==e.visible&&(e.raycast(t,n),!0===r))for(var i=e.children,o=0,a=i.length;o<a;o++)Zl(i[o],t,n,!0)}function $l(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}function Kl(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}Object.assign(Ul.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(Vl,{Composite:Ul,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new Vl.Composite(e,t,n):new Vl(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Ll,"")},parseTrackName:function(e){var t=Fl.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==Bl.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function e(n){for(var r=0;r<n.length;r++){var i=n[r];if(i.name===t||i.uuid===t)return i;var o=e(i.children);if(o)return o}return null}(e.children);if(r)return r}return null}}),Object.assign(Vl.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,i=t.propertyIndex;if(e||(e=Vl.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var o=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[r];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===i){i=a;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===i){i=a;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Vl.prototype,{_getValue_unbound:Vl.prototype.getValue,_setValue_unbound:Vl.prototype.setValue}),Object.assign(Gl.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=void 0,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],d=h.uuid,f=r[d];if(void 0===f){f=t++,r[d]=f,e.push(h);for(var p=0,m=s;p!==m;++p)a[p].push(new Vl(h,i[p],o[p]))}else if(f<n){l=e[f];var v=--n,g=e[v];for(r[g.uuid]=f,e[f]=g,r[d]=v,e[v]=h,p=0,m=s;p!==m;++p){var y=a[p],_=y[v],x=y[f];y[f]=_,void 0===x&&(x=new Vl(h,i[p],o[p])),y[v]=x}}else e[f]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,i=r.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,u=n[l];if(void 0!==u&&u>=t){var c=t++,h=e[c];n[h.uuid]=u,e[u]=h,n[l]=c,e[c]=s;for(var d=0,f=i;d!==f;++d){var p=r[d],m=p[c],v=p[u];p[u]=m,p[c]=v}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a],u=l.uuid,c=r[u];if(void 0!==c)if(delete r[u],c<n){var h=--n,d=e[h],f=e[y=--t];r[d.uuid]=c,e[c]=d,r[f.uuid]=h,e[h]=f,e.pop();for(var p=0,m=o;p!==m;++p){var v=(_=i[p])[h],g=_[y];_[c]=v,_[h]=g,_.pop()}}else{var y;for(r[(f=e[y=--t]).uuid]=c,e[c]=f,e.pop(),p=0,m=o;p!==m;++p){var _;(_=i[p])[c]=_[y],_.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],i=this._bindings;if(void 0!==r)return i[r];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);r=i.length,n[e]=r,o.push(e),a.push(t),i.push(c);for(var h=u,d=s.length;h!==d;++h){var f=s[h];c[h]=new Vl(f,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}}),Object.assign(jl.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,i=e._clip.duration,o=i/r,a=r/i;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var r=this._mixer,i=r.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=i,s[1]=i+n,l[0]=e/a,l[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var o=(e-i)*n;if(o<0||0===n)return;this._startTime=null,t=n*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,u=this._propertyBindings,c=0,h=l.length;c!==h;++c)l[c].evaluate(a),u[c].accumulate(r,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,n=this._clip.duration,r=this.loop,i=this._loopCount,o=2202===r;if(0===e)return-1===i?t:o&&1==(1&i)?n-t:t;if(2200===r){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=n)t=n;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=n||t<0){var a=Math.floor(t/n);t-=n*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?n:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=t;if(o&&1==(1&i))return n-t}return t},_setEndings:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(e,t,n){var r=this._mixer,i=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=t,a[1]=i+e,s[1]=n,this}}),Hl.prototype=Object.assign(Object.create(v.prototype),{constructor:Hl,_bindAction:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,a=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var c=0;c!==i;++c){var h=r[c],d=h.name,f=u[d];if(void 0!==f)o[c]=f;else{if(void 0!==(f=o[c])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,d));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;++(f=new kl(Vl.create(n,d,p),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(f,s,d),o[c]=f}a[c].resultBuffer=f.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(var i=e._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:Object.defineProperties({},{total:{get:function(){return e._actions.length},configurable:!0,enumerable:!0},inUse:{get:function(){return e._nActiveActions},configurable:!0,enumerable:!0}}),bindings:Object.defineProperties({},{total:{get:function(){return e._bindings.length},configurable:!0,enumerable:!0},inUse:{get:function(){return e._nActiveBindings},configurable:!0,enumerable:!0}}),controlInterpolants:Object.defineProperties({},{total:{get:function(){return e._controlInterpolants.length},configurable:!0,enumerable:!0},inUse:{get:function(){return e._nActiveControlInterpolants},configurable:!0,enumerable:!0}})}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var r=this._actions,i=this._actionsByClip,o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_addInactiveBinding:function(e,t,n){var r=this._bindingsByRootAndName,i=r[t],o=this._bindings;void 0===i&&(i={},r[t]=i),i[n]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[i],0===Object.keys(a).length&&delete o[r]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new Ga(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"==typeof e?Ja.findByName(n,e):e,o=null!==i?i.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var l=a.actionByRoot[r];if(void 0!==l)return l;s=a.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var u=new jl(this,i,t);return this._bindAction(u,s),this._addInactiveAction(u,o,r),u},existingAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"==typeof e?Ja.findByName(n,e):e,o=i?i.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(i=0;i!==r;++i)n[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1,a=0;a!==n;++a)t[a]._update(r,e,i,o);var s=this._bindings,l=this._nActiveBindings;for(a=0;a!==l;++a)s[a].apply(o);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),Wl.prototype.clone=function(){return new Wl(void 0===this.value.clone?this.value:this.value.clone())},ql.prototype=Object.assign(Object.create(mi.prototype),{constructor:ql,isInstancedInterleavedBuffer:!0,copy:function(e){return mi.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Yl.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){var r=n||[];return Zl(e,this,r,t),r.sort(Xl),r},intersectObjects:function(e,t,n){var r=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,o=e.length;i<o;i++)Zl(e[i],this,r,t);return r.sort(Xl),r}}),Object.assign($l.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(_.clamp(t/this.radius,-1,1))),this}}),Object.assign(Kl.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}});var Jl=new x;function Ql(e,t){this.min=void 0!==e?e:new x(1/0,1/0),this.max=void 0!==t?t:new x(-1/0,-1/0)}Object.assign(Ql.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=Jl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new x),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new x),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new x),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new x),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Jl.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var eu=new E,tu=new E;function nu(e,t){this.start=void 0!==e?e:new E,this.end=void 0!==t?t:new E}function ru(e){oe.call(this),this.material=e,this.render=function(){}}Object.assign(nu.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new E),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new E),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new E),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){eu.subVectors(e,this.start),tu.subVectors(this.end,this.start);var n=tu.dot(tu),r=tu.dot(eu)/n;return t&&(r=_.clamp(r,0,1)),r},closestPointToPoint:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new E),this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),ru.prototype=Object.create(oe.prototype),ru.prototype.constructor=ru,ru.prototype.isImmediateRenderObject=!0;var iu=new E;function ou(e,t){oe.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var n=new Et,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var a=i/32*Math.PI*2,s=o/32*Math.PI*2;r.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new ft(r,3));var l=new Yi({fog:!1});this.cone=new no(n,l),this.add(this.cone),this.update()}ou.prototype=Object.create(oe.prototype),ou.prototype.constructor=ou,ou.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},ou.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),iu.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(iu),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var au=new E,su=new V,lu=new V;function uu(e){for(var t=function e(t){var n=[];t&&t.isBone&&n.push(t);for(var r=0;r<t.children.length;r++)n.push.apply(n,e(t.children[r]));return n}(e),n=new Et,r=[],i=[],o=new $e(0,0,1),a=new $e(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new ft(r,3)),n.setAttribute("color",new ft(i,3));var u=new Yi({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});no.call(this,n,u),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function cu(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;var r=new da(t,4,2),i=new rt({wireframe:!0,fog:!1});Gt.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}uu.prototype=Object.create(no.prototype),uu.prototype.constructor=uu,uu.prototype.updateMatrixWorld=function(e){var t=this.bones,n=this.geometry,r=n.getAttribute("position");lu.getInverse(this.root.matrixWorld);for(var i=0,o=0;i<t.length;i++){var a=t[i];a.parent&&a.parent.isBone&&(su.multiplyMatrices(lu,a.matrixWorld),au.setFromMatrixPosition(su),r.setXYZ(o,au.x,au.y,au.z),su.multiplyMatrices(lu,a.parent.matrixWorld),au.setFromMatrixPosition(su),r.setXYZ(o+1,au.x,au.y,au.z),o+=2)}n.getAttribute("position").needsUpdate=!0,oe.prototype.updateMatrixWorld.call(this,e)},cu.prototype=Object.create(Gt.prototype),cu.prototype.constructor=cu,cu.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},cu.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var hu=new E,du=new $e,fu=new $e;function pu(e,t,n){oe.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var r=new Eo(t);r.rotateY(.5*Math.PI),this.material=new rt({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2);var i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.setAttribute("color",new ot(o,3)),this.add(new Gt(r,this.material)),this.update()}function mu(e,t,n,r){e=e||10,t=t||10,n=new $e(void 0!==n?n:4473924),r=new $e(void 0!==r?r:8947848);for(var i=t/2,o=e/t,a=e/2,s=[],l=[],u=0,c=0,h=-a;u<=t;u++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var d=u===i?n:r;d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3}var f=new Et;f.setAttribute("position",new ft(s,3)),f.setAttribute("color",new ft(l,3));var p=new Yi({vertexColors:2});no.call(this,f,p)}function vu(e,t,n,r,i,o){e=e||10,t=t||16,n=n||8,r=r||64,i=new $e(void 0!==i?i:4473924),o=new $e(void 0!==o?o:8947848);var a,s,l,u,c,h,d,f=[],p=[];for(u=0;u<=t;u++)l=u/t*(2*Math.PI),a=Math.sin(l)*e,s=Math.cos(l)*e,f.push(0,0,0),f.push(a,0,s),d=1&u?i:o,p.push(d.r,d.g,d.b),p.push(d.r,d.g,d.b);for(u=0;u<=n;u++)for(d=1&u?i:o,h=e-e/n*u,c=0;c<r;c++)l=c/r*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,f.push(a,0,s),p.push(d.r,d.g,d.b),l=(c+1)/r*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,f.push(a,0,s),p.push(d.r,d.g,d.b);var m=new Et;m.setAttribute("position",new ft(f,3)),m.setAttribute("color",new ft(p,3));var v=new Yi({vertexColors:2});no.call(this,m,v)}pu.prototype=Object.create(oe.prototype),pu.prototype.constructor=pu,pu.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},pu.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");du.copy(this.light.color),fu.copy(this.light.groundColor);for(var n=0,r=t.count;n<r;n++){var i=n<r/2?du:fu;t.setXYZ(n,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(hu.setFromMatrixPosition(this.light.matrixWorld).negate())},mu.prototype=Object.assign(Object.create(no.prototype),{constructor:mu,copy:function(e){return no.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),vu.prototype=Object.create(no.prototype),vu.prototype.constructor=vu;var gu=new E,yu=new E,_u=new E;function xu(e,t,n){oe.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);var r=new Et;r.setAttribute("position",new ft([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new Yi({fog:!1});this.lightPlane=new Qi(r,i),this.add(this.lightPlane),(r=new Et).setAttribute("position",new ft([0,0,0,0,0,1],3)),this.targetLine=new Qi(r,i),this.add(this.targetLine),this.update()}xu.prototype=Object.create(oe.prototype),xu.prototype.constructor=xu,xu.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},xu.prototype.update=function(){gu.setFromMatrixPosition(this.light.matrixWorld),yu.setFromMatrixPosition(this.light.target.matrixWorld),_u.subVectors(yu,gu),this.lightPlane.lookAt(yu),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(yu),this.targetLine.scale.z=_u.length()};var bu=new E,wu=new nn;function Su(e){var t=new Et,n=new Yi({color:16777215,vertexColors:1}),r=[],i=[],o={},a=new $e(16755200),s=new $e(16711680),l=new $e(43775),u=new $e(16777215),c=new $e(3355443);function h(e,t,n){d(e,n),d(t,n)}function d(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",u),h("p","c",c),h("cn1","cn2",c),h("cn3","cn4",c),h("cf1","cf2",c),h("cf3","cf4",c),t.setAttribute("position",new ft(r,3)),t.setAttribute("color",new ft(i,3)),no.call(this,t,n),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Eu(e,t,n,r,i,o,a){bu.set(i,o,a).unproject(r);var s=t[e];if(void 0!==s)for(var l=n.getAttribute("position"),u=0,c=s.length;u<c;u++)l.setXYZ(s[u],bu.x,bu.y,bu.z)}Su.prototype=Object.create(no.prototype),Su.prototype.constructor=Su,Su.prototype.update=function(){var e=this.geometry,t=this.pointMap;wu.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Eu("c",t,e,wu,0,0,-1),Eu("t",t,e,wu,0,0,1),Eu("n1",t,e,wu,-1,-1,-1),Eu("n2",t,e,wu,1,-1,-1),Eu("n3",t,e,wu,-1,1,-1),Eu("n4",t,e,wu,1,1,-1),Eu("f1",t,e,wu,-1,-1,1),Eu("f2",t,e,wu,1,-1,1),Eu("f3",t,e,wu,-1,1,1),Eu("f4",t,e,wu,1,1,1),Eu("u1",t,e,wu,.7,1.1,-1),Eu("u2",t,e,wu,-.7,1.1,-1),Eu("u3",t,e,wu,0,2,-1),Eu("cf1",t,e,wu,-1,0,1),Eu("cf2",t,e,wu,1,0,1),Eu("cf3",t,e,wu,0,-1,1),Eu("cf4",t,e,wu,0,1,1),Eu("cn1",t,e,wu,-1,0,-1),Eu("cn2",t,e,wu,1,0,-1),Eu("cn3",t,e,wu,0,-1,-1),Eu("cn4",t,e,wu,0,1,-1),e.getAttribute("position").needsUpdate=!0};var Tu=new xe;function Mu(e,t){this.object=e,void 0===t&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Et;i.setIndex(new ot(n,1)),i.setAttribute("position",new ot(r,3)),no.call(this,i,new Yi({color:t})),this.matrixAutoUpdate=!1,this.update()}function Cu(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Et;r.setIndex(new ot(n,1)),r.setAttribute("position",new ft([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),no.call(this,r,new Yi({color:t})),this.geometry.computeBoundingSphere()}function Au(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var r=void 0!==n?n:16776960,i=new Et;i.setAttribute("position",new ft([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Qi.call(this,i,new Yi({color:r}));var o=new Et;o.setAttribute("position",new ft([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Gt(o,new rt({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}Mu.prototype=Object.create(no.prototype),Mu.prototype.constructor=Mu,Mu.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Tu.setFromObject(this.object),!Tu.isEmpty()){var t=Tu.min,n=Tu.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Mu.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Mu.prototype.copy=function(e){return no.prototype.copy.call(this,e),this.object=e.object,this},Mu.prototype.clone=function(){return(new this.constructor).copy(this)},Cu.prototype=Object.create(no.prototype),Cu.prototype.constructor=Cu,Cu.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),oe.prototype.updateMatrixWorld.call(this,e))},Au.prototype=Object.create(Qi.prototype),Au.prototype.constructor=Au,Au.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?1:0,this.lookAt(this.plane.normal),oe.prototype.updateMatrixWorld.call(this,e)};var Ru,Pu,ku=new E;function Lu(e,t,n,r,i,o){oe.call(this),void 0===e&&(e=new E(0,0,1)),void 0===t&&(t=new E(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===i&&(i=.2*n),void 0===o&&(o=.2*i),void 0===Ru&&((Ru=new Et).setAttribute("position",new ft([0,0,0,0,1,0],3)),(Pu=new wa(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Qi(Ru,new Yi({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Gt(Pu,new rt({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,o)}function Nu(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Et;n.setAttribute("position",new ft(t,3)),n.setAttribute("color",new ft([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new Yi({vertexColors:2});no.call(this,n,r)}Lu.prototype=Object.create(oe.prototype),Lu.prototype.constructor=Lu,Lu.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{ku.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(ku,t)}},Lu.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},Lu.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},Lu.prototype.copy=function(e){return oe.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Lu.prototype.clone=function(){return(new this.constructor).copy(this)},Nu.prototype=Object.create(no.prototype),Nu.prototype.constructor=Nu;var Iu,Ou=Math.pow(2,8),Du=[.125,.215,.35,.446,.526,.582],zu=5+Du.length,Fu=(u(a={},3e3,0),u(a,3001,1),u(a,3002,2),u(a,3004,3),u(a,3005,4),u(a,3006,5),u(a,3007,6),a),Bu=new Gs,Uu=(20,(Iu=new Ra({defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(20)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new E(0,1,0)},inputEncoding:{value:Fu[3e3]},outputEncoding:{value:Fu[3e3]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n".concat("\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t","\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tfor (int i = 0; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfor (int dir = -1; dir < 2; dir += 2) {\n\t\t\tif (i == 0 && dir == 1)\n\t\t\t\tcontinue;\n\t\t\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\t\t\tif (all(equal(axis, vec3(0.0))))\n\t\t\t\taxis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);\n\t\t\taxis = normalize(axis);\n\t\t\tfloat theta = dTheta * float(dir * i);\n\t\t\tfloat cosTheta = cos(theta);\n\t\t\t// Rodrigues' axis-angle rotation\n\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t\t\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\t\t\tgl_FragColor.rgb +=\n\t\t\t\t\tweights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);\n\t\t}\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t"),blending:0,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",Iu),Vu=null,Gu=null,ju=function(){for(var e=[],t=[],n=[],r=8,i=0;i<zu;i++){var o=Math.pow(2,r);t.push(o);var a=1/o;i>4?a=Du[i-8+4-1]:0==i&&(a=0),n.push(a);for(var s=1/(o-1),l=-s/2,u=1+s/2,c=[l,l,u,l,u,u,l,l,u,u,l,u],h=new Float32Array(108),d=new Float32Array(72),f=new Float32Array(36),p=0;p<6;p++){var m=p%3*2/3-1,v=p>2?0:-1,g=[m,v,0,m+2/3,v,0,m+2/3,v+1,0,m,v,0,m+2/3,v+1,0,m,v+1,0];h.set(g,18*p),d.set(c,12*p);var y=[p,p,p,p,p,p];f.set(y,6*p)}var _=new Et;_.setAttribute("position",new ot(h,3)),_.setAttribute("uv",new ot(d,2)),_.setAttribute("faceIndex",new ot(f,1)),e.push(_),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}(),Hu=ju._lodPlanes,Wu=ju._sizeLods,qu=ju._sigmas,Yu=null,Xu=null,Zu=(1+Math.sqrt(5))/2,$u=1/Zu,Ku=[new E(1,1,1),new E(-1,1,1),new E(1,1,-1),new E(-1,1,-1),new E(0,Zu,$u),new E(0,Zu,-$u),new E($u,0,Zu),new E(-$u,0,Zu),new E(Zu,$u,0),new E(-Zu,$u,0)];function Ju(e){Xu=e,nc(Uu)}function Qu(e){var t={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:e?e.type:1009,format:e?e.format:1023,encoding:e?e.encoding:3002,depthBuffer:!1,stencilBuffer:!1},n=rc(t);return n.depthBuffer=!e,Yu=rc(t),n}function ec(){Yu.dispose(),Xu.setRenderTarget(null);var e=Xu.getSize(new x);Xu.setViewport(0,0,e.x,e.y)}function tc(e,t,n,r){var i=new rn(90,1,t,n),o=[1,1,1,1,-1,1],a=[1,1,-1,-1,-1,1],s=Xu.outputEncoding,l=Xu.toneMapping,u=Xu.toneMappingExposure,c=Xu.getClearColor(),h=Xu.getClearAlpha();Xu.toneMapping=1,Xu.toneMappingExposure=1,Xu.outputEncoding=3e3,e.scale.z*=-1;var d=e.background;if(d&&d.isColor){d.convertSRGBToLinear();var f=Math.max(d.r,d.g,d.b),p=Math.min(Math.max(Math.ceil(Math.log2(f)),-128),127);d=d.multiplyScalar(Math.pow(2,-p));var m=(p+128)/255;Xu.setClearColor(d,m),e.background=null}Xu.setRenderTarget(r);for(var v=0;v<6;v++){var g=v%3;0==g?(i.up.set(0,o[v],0),i.lookAt(a[v],0,0)):1==g?(i.up.set(0,0,o[v]),i.lookAt(0,a[v],0)):(i.up.set(0,o[v],0),i.lookAt(0,0,a[v])),ic(g*Ou,v>2?Ou:0,Ou,Ou),Xu.render(e,i)}Xu.toneMapping=l,Xu.toneMappingExposure=u,Xu.outputEncoding=s,Xu.setClearColor(c,h),e.scale.z*=-1}function nc(e){var t=new ae;t.add(new Gt(Hu[0],e)),Xu.compile(t,Bu)}function rc(e){var t=new L(3*Ou,3*Ou,e);return t.texture.mapping=306,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function ic(e,t,n,r){var i=1/Xu.getPixelRatio();e*=i,t*=i,n*=i,r*=i,Xu.setViewport(e,t,n,r),Xu.setScissor(e,t,n,r)}function oc(e){var t=Xu.autoClear;Xu.autoClear=!1;for(var n=1;n<zu;n++)ac(e,n-1,n,Math.sqrt(qu[n]*qu[n]-qu[n-1]*qu[n-1]),Ku[(n-1)%Ku.length]);Xu.autoClear=t}function ac(e,t,n,r,i){sc(e,Yu,t,n,r,"latitudinal",i),sc(Yu,e,n,n,r,"longitudinal",i)}function sc(e,t,n,r,i,o,a){"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");var s=new ae;s.add(new Gt(Hu[r],Uu));var l=Uu.uniforms,u=Wu[n]-1,c=isFinite(i)?Math.PI/(2*u):2*Math.PI/39,h=i/c,d=isFinite(i)?1+Math.floor(3*h):20;d>20&&console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(d," samples when the maximum is set to ").concat(20));for(var f=[],p=0,m=0;m<20;++m){var v=m/h,g=Math.exp(-v*v/2);f.push(g),0==m?p+=g:m<d&&(p+=2*g)}for(m=0;m<f.length;m++)f[m]=f[m]/p;l.envMap.value=e.texture,l.samples.value=d,l.weights.value=f,l.latitudinal.value="latitudinal"===o,a&&(l.poleAxis.value=a),l.dTheta.value=c,l.mipInt.value=8-n,l.inputEncoding.value=Fu[e.texture.encoding],l.outputEncoding.value=Fu[e.texture.encoding];var y=Wu[r],_=(v=3*Math.max(0,Ou-2*y),(0===r?0:2*Ou)+2*y*(r>4?r-8+4:0));Xu.setRenderTarget(t),ic(v,_,3*y,2*y),Xu.render(s,Bu)}function lc(){var e=new Ra({uniforms:{envMap:{value:null},texelSize:{value:new x(1,1)},inputEncoding:{value:Fu[3e3]},outputEncoding:{value:Fu[3e3]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n".concat("\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t","\n\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv;\n\tuv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;\n\tuv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t"),blending:0,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function uc(){var e=new Ra({uniforms:{envMap:{value:null},inputEncoding:{value:Fu[3e3]},outputEncoding:{value:Fu[3e3]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n".concat("\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t","\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t"),blending:0,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function cc(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),xs.call(this,e),this.type="catmullrom",this.closed=!0}function hc(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),xs.call(this,e),this.type="catmullrom"}function dc(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),xs.call(this,e),this.type="catmullrom"}Ju.prototype={constructor:Ju,fromScene:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=Qu();return tc(e,n,r,i),t>0&&ac(i,0,0,t),oc(i),ec(),i.scissorTest=!1,i},fromEquirectangular:function(e){return e.magFilter=1003,e.minFilter=1003,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){var t=Qu(e);return function(e,t){var n=new ae;e.isCubeTexture?null==Gu&&(Gu=uc()):null==Vu&&(Vu=lc());var r=e.isCubeTexture?Gu:Vu;n.add(new Gt(Hu[0],r));var i=r.uniforms;i.envMap.value=e,e.isCubeTexture||i.texelSize.value.set(1/e.image.width,1/e.image.height),i.inputEncoding.value=Fu[e.encoding],i.outputEncoding.value=Fu[e.encoding],Xu.setRenderTarget(t),ic(0,0,3*Ou,2*Ou),Xu.render(n,Bu)}(e,t),oc(t),ec(),t.scissorTest=!1,t},compileCubemapShader:function(){null==Gu&&nc(Gu=uc())},compileEquirectangularShader:function(){null==Vu&&nc(Vu=lc())},dispose:function(){Uu.dispose(),null!=Gu&&Gu.dispose(),null!=Vu&&Vu.dispose();for(var e=0;e<Hu.length;e++)Hu[e].dispose()}},ds.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(ds.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Ls.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Zt,n=0,r=e.length;n<r;n++){var i=e[n];t.vertices.push(new E(i.x,i.y,i.z||0))}return t}}),Object.assign(Ns.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),cc.prototype=Object.create(xs.prototype),hc.prototype=Object.create(xs.prototype),dc.prototype=Object.create(xs.prototype),Object.assign(dc.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),mu.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},uu.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(rs.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Xs.extractUrlBase(e)}}),rs.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Qs.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(Ql.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(xe.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),nu.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(_,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),_.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),_.ceilPowerOfTwo(e)}}),Object.assign(C.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(V.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new E).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)}}),Oe.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},b.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(ke.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(qe.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(qe,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),qe.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),qe.getNormal(e,t,n,r)}}),Object.assign(Is.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new oa(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ga(this,e)}}),Object.assign(x.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(E.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(k.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Zt.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(oe.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(oe.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Gt.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Gt.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Di.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Ui.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),zi.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(ds.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),rn.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Os.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(ot.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(ot.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Et.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new ot(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)}}),Object.defineProperties(Et.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(mi.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(mi.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(aa.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Wl.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(nt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new $e}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(La.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(tn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(di.prototype,{clearTarget:function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(di.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?3001:3e3}}}),Object.defineProperties(ri.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(an.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(L.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(El.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new cl).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Pl.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},on.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var fc={merge:function(e,t,n){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};A.crossOrigin=void 0,A.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new hs;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},A.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new cs;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},A.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},A.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var pc={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"112"}}));var mc=Object.freeze({__proto__:null,ACESFilmicToneMapping:5,AddEquation:100,AddOperation:2,AdditiveBlending:2,AlphaFormat:1021,AlwaysDepth:1,AlwaysStencilFunc:519,AmbientLight:Ws,AmbientLightProbe:pl,AnimationClip:Ja,AnimationLoader:as,AnimationMixer:Hl,AnimationObjectGroup:Gl,AnimationUtils:Ba,ArcCurve:ps,ArrayCamera:ui,ArrowHelper:Lu,Audio:El,AudioAnalyser:Pl,AudioContext:ul,AudioListener:Sl,AudioLoader:cl,AxesHelper:Nu,AxisHelper:function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Nu(e)},BackSide:1,BasicDepthPacking:3200,BasicShadowMap:0,BinaryTextureLoader:function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new ls(e)},Bone:Vi,BooleanKeyframeTrack:Wa,BoundingBoxHelper:function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Mu(e,t)},Box2:Ql,Box3:xe,Box3Helper:Cu,BoxBufferGeometry:Kt,BoxGeometry:$t,BoxHelper:Mu,BufferAttribute:ot,BufferGeometry:Et,BufferGeometryLoader:Ks,ByteType:1010,Cache:es,Camera:nn,CameraHelper:Su,CanvasRenderer:function(){console.error("THREE.CanvasRenderer has been removed")},CanvasTexture:po,CatmullRomCurve3:xs,CineonToneMapping:4,CircleBufferGeometry:Ma,CircleGeometry:Ta,ClampToEdgeWrapping:1001,Clock:yl,ClosedSplineCurve3:cc,Color:$e,ColorKeyframeTrack:qa,CompressedTexture:fo,CompressedTextureLoader:ss,ConeBufferGeometry:Ea,ConeGeometry:Sa,CubeCamera:on,CubeGeometry:$t,CubeReflectionMapping:301,CubeRefractionMapping:302,CubeTexture:Rn,CubeTextureLoader:cs,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307,CubicBezierCurve:Es,CubicBezierCurve3:Ts,CubicInterpolant:Va,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,Curve:ds,CurvePath:Ls,CustomBlending:5,CylinderBufferGeometry:wa,CylinderGeometry:ba,Cylindrical:Kl,DataTexture:sn,DataTexture2DArray:Pn,DataTexture3D:kn,DataTextureLoader:ls,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:ns,DepthFormat:1026,DepthStencilFormat:1027,DepthTexture:mo,DirectionalLight:Hs,DirectionalLightHelper:xu,DirectionalLightShadow:js,DiscreteInterpolant:ja,DodecahedronBufferGeometry:Ao,DodecahedronGeometry:Co,DoubleSide:2,DstAlphaFactor:206,DstColorFactor:208,DynamicBufferAttribute:function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new ot(e,t).setDynamic(!0)},DynamicCopyUsage:35050,DynamicDrawUsage:35048,DynamicReadUsage:35049,EdgesGeometry:xa,EdgesHelper:function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new no(new xa(e.geometry),new Yi({color:void 0!==t?t:16777215}))},EllipseCurve:fs,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,Euler:H,EventDispatcher:v,ExtrudeBufferGeometry:aa,ExtrudeGeometry:oa,Face3:et,Face4:function(e,t,n,r,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new et(e,t,n,i,o,a)},FaceColors:1,FileLoader:os,FlatShading:1,Float32Attribute:function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new ft(e,t)},Float32BufferAttribute:ft,Float64Attribute:function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new pt(e,t)},Float64BufferAttribute:pt,FloatType:1015,Fog:pi,FogExp2:fi,Font:al,FontLoader:ll,FrontFaceDirectionCCW:1,FrontFaceDirectionCW:0,FrontSide:0,Frustum:cn,GammaEncoding:3007,Geometry:Zt,GeometryUtils:fc,GreaterDepth:6,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:mu,Group:ci,HalfFloatType:1016,HemisphereLight:Ds,HemisphereLightHelper:pu,HemisphereLightProbe:fl,IcosahedronBufferGeometry:Mo,IcosahedronGeometry:To,ImageBitmapLoader:il,ImageLoader:us,ImageUtils:A,ImmediateRenderObject:ru,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:$s,InstancedBufferGeometry:Zs,InstancedInterleavedBuffer:ql,InstancedMesh:qi,Int16Attribute:function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new ut(e,t)},Int16BufferAttribute:ut,Int32Attribute:function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new ht(e,t)},Int32BufferAttribute:ht,Int8Attribute:function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new at(e,t)},Int8BufferAttribute:at,IntType:1013,InterleavedBuffer:mi,InterleavedBufferAttribute:yi,Interpolant:Ua,InterpolateDiscrete:2300,InterpolateLinear:2301,InterpolateSmooth:2302,InvertStencilOp:5386,JSONLoader:function(){console.error("THREE.JSONLoader has been removed.")},KeepStencilOp:7680,KeyframeTrack:Ha,LOD:Di,LatheBufferGeometry:va,LatheGeometry:ma,Layers:W,LensFlare:function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},LessDepth:2,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,Light:Os,LightProbe:dl,LightShadow:zs,Line:Qi,Line3:nu,LineBasicMaterial:Yi,LineCurve:Ms,LineCurve3:Cs,LineDashedMaterial:za,LineLoop:ro,LinePieces:1,LineSegments:no,LineStrip:0,LinearEncoding:3e3,LinearFilter:1006,LinearInterpolant:Ga,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:1008,LinearMipmapNearestFilter:1007,LinearToneMapping:1,Loader:rs,LoaderUtils:Xs,LoadingManager:ts,LogLuvEncoding:3003,LoopOnce:2200,LoopPingPong:2202,LoopRepeat:2201,LuminanceAlphaFormat:1025,LuminanceFormat:1024,MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Material:nt,MaterialLoader:Ys,Math:_,Matrix3:C,Matrix4:V,MaxEquation:104,Mesh:Gt,MeshBasicMaterial:rt,MeshDepthMaterial:ti,MeshDistanceMaterial:ni,MeshFaceMaterial:function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},MeshLambertMaterial:Oa,MeshMatcapMaterial:Da,MeshNormalMaterial:Ia,MeshPhongMaterial:La,MeshPhysicalMaterial:ka,MeshStandardMaterial:Pa,MeshToonMaterial:Na,MinEquation:103,MirroredRepeatWrapping:1002,MixOperation:1,MultiMaterial:function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},MultiplyBlending:4,MultiplyOperation:0,NearestFilter:1003,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:1005,NearestMipmapNearestFilter:1004,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColors:0,NoToneMapping:0,NormalBlending:1,NotEqualDepth:7,NotEqualStencilFunc:517,NumberKeyframeTrack:Ya,Object3D:oe,ObjectLoader:Qs,ObjectSpaceNormalMap:1,OctahedronBufferGeometry:Eo,OctahedronGeometry:So,OneFactor:201,OneMinusDstAlphaFactor:207,OneMinusDstColorFactor:209,OneMinusSrcAlphaFactor:205,OneMinusSrcColorFactor:203,OrthographicCamera:Gs,PCFShadowMap:1,PCFSoftShadowMap:2,PMREMGenerator:Ju,ParametricBufferGeometry:yo,ParametricGeometry:go,Particle:function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Li(e)},ParticleBasicMaterial:function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new io(e)},ParticleSystem:function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new uo(e,t)},ParticleSystemMaterial:function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new io(e)},Path:Ns,PerspectiveCamera:rn,Plane:Oe,PlaneBufferGeometry:gn,PlaneGeometry:vn,PlaneHelper:Au,PointCloud:function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new uo(e,t)},PointCloudMaterial:function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new io(e)},PointLight:Vs,PointLightHelper:cu,Points:uo,PointsMaterial:io,PolarGridHelper:vu,PolyhedronBufferGeometry:xo,PolyhedronGeometry:_o,PositionalAudio:Rl,PropertyBinding:Vl,PropertyMixer:kl,QuadraticBezierCurve:As,QuadraticBezierCurve3:Rs,Quaternion:b,QuaternionKeyframeTrack:Za,QuaternionLinearInterpolant:Xa,REVISION:"112",RGBADepthPacking:3201,RGBAFormat:1023,RGBAIntegerFormat:1033,RGBA_ASTC_10x10_Format:37819,RGBA_ASTC_10x5_Format:37816,RGBA_ASTC_10x6_Format:37817,RGBA_ASTC_10x8_Format:37818,RGBA_ASTC_12x10_Format:37820,RGBA_ASTC_12x12_Format:37821,RGBA_ASTC_4x4_Format:37808,RGBA_ASTC_5x4_Format:37809,RGBA_ASTC_5x5_Format:37810,RGBA_ASTC_6x5_Format:37811,RGBA_ASTC_6x6_Format:37812,RGBA_ASTC_8x5_Format:37813,RGBA_ASTC_8x6_Format:37814,RGBA_ASTC_8x8_Format:37815,RGBA_PVRTC_2BPPV1_Format:35843,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT1_Format:33777,RGBA_S3TC_DXT3_Format:33778,RGBA_S3TC_DXT5_Format:33779,RGBDEncoding:3006,RGBEEncoding:3002,RGBEFormat:1023,RGBFormat:1022,RGBIntegerFormat:1032,RGBM16Encoding:3005,RGBM7Encoding:3004,RGB_ETC1_Format:36196,RGB_PVRTC_2BPPV1_Format:35841,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776,RGFormat:1030,RGIntegerFormat:1031,RawShaderMaterial:Ra,Ray:ke,Raycaster:Yl,RectAreaLight:qs,RedFormat:1028,RedIntegerFormat:1029,ReinhardToneMapping:2,RepeatWrapping:1e3,ReplaceStencilOp:7681,ReverseSubtractEquation:102,RingBufferGeometry:pa,RingGeometry:fa,Scene:ae,SceneUtils:pc,ShaderChunk:hn,ShaderLib:fn,ShaderMaterial:tn,ShadowMaterial:Aa,Shape:Is,ShapeBufferGeometry:ya,ShapeGeometry:ga,ShapePath:ol,ShapeUtils:na,ShortType:1011,Skeleton:Ui,SkeletonHelper:uu,SkinnedMesh:zi,SmoothShading:2,Sphere:Se,SphereBufferGeometry:da,SphereGeometry:ha,Spherical:$l,SphericalHarmonics3:hl,SphericalReflectionMapping:305,Spline:dc,SplineCurve:Ps,SplineCurve3:hc,SpotLight:Bs,SpotLightHelper:ou,SpotLightShadow:Fs,Sprite:Li,SpriteMaterial:_i,SrcAlphaFactor:204,SrcAlphaSaturateFactor:210,SrcColorFactor:202,StaticCopyUsage:35046,StaticDrawUsage:35044,StaticReadUsage:35045,StereoCamera:gl,StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:$a,SubtractEquation:101,SubtractiveBlending:3,TOUCH:{ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},TangentSpaceNormalMap:0,TetrahedronBufferGeometry:wo,TetrahedronGeometry:bo,TextBufferGeometry:ca,TextGeometry:ua,Texture:P,TextureLoader:hs,TorusBufferGeometry:Io,TorusGeometry:No,TorusKnotBufferGeometry:Lo,TorusKnotGeometry:ko,Triangle:qe,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeBufferGeometry:Po,TubeGeometry:Ro,UVMapping:300,Uint16Attribute:function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new ct(e,t)},Uint16BufferAttribute:ct,Uint32Attribute:function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new dt(e,t)},Uint32BufferAttribute:dt,Uint8Attribute:function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new st(e,t)},Uint8BufferAttribute:st,Uint8ClampedAttribute:function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new lt(e,t)},Uint8ClampedBufferAttribute:lt,Uncharted2ToneMapping:3,Uniform:Wl,UniformsLib:dn,UniformsUtils:en,UnsignedByteType:1009,UnsignedInt248Type:1020,UnsignedIntType:1014,UnsignedShort4444Type:1017,UnsignedShort5551Type:1018,UnsignedShort565Type:1019,UnsignedShortType:1012,VSMShadowMap:3,Vector2:x,Vector3:E,Vector4:k,VectorKeyframeTrack:Ka,Vertex:function(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new E(e,t,n)},VertexColors:2,VideoTexture:ho,WebGLMultisampleRenderTarget:N,WebGLRenderTarget:L,WebGLRenderTargetCube:an,WebGLRenderer:di,WebGLUtils:ai,WireframeGeometry:vo,WireframeHelper:function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new no(new vo(e.geometry),new Yi({color:void 0!==t?t:16777215}))},WrapAroundEnding:2402,XHRLoader:function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new os(e)},ZeroCurvatureEnding:2400,ZeroFactor:200,ZeroSlopeEnding:2401,ZeroStencilOp:0,sRGBEncoding:3001}),vc=function(){return(vc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},gc={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",fadeColor:"transparent",animation:"spinner-line-fade-default",rotate:0,direction:1,speed:1,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:"0 0 1px transparent",position:"absolute"},yc=function(){function e(e){void 0===e&&(e={}),this.opts=vc(vc({},gc),e)}return e.prototype.spin=function(e){return this.stop(),this.el=document.createElement("div"),this.el.className=this.opts.className,this.el.setAttribute("role","progressbar"),_c(this.el,{position:this.opts.position,width:0,zIndex:this.opts.zIndex,left:this.opts.left,top:this.opts.top,transform:"scale("+this.opts.scale+")"}),e&&e.insertBefore(this.el,e.firstChild||null),function(e,t){var n=Math.round(t.corners*t.width*500)/1e3+"px",r="none";!0===t.shadow?r="0 2px 4px #000":"string"==typeof t.shadow&&(r=t.shadow);for(var i=function(e){for(var t=/^\s*([a-zA-Z]+\s+)?(-?\d+(\.\d+)?)([a-zA-Z]*)\s+(-?\d+(\.\d+)?)([a-zA-Z]*)(.*)$/,n=[],r=0,i=e.split(",");r<i.length;r++){var o=i[r].match(t);if(null!==o){var a=+o[2],s=+o[5],l=o[4],u=o[7];0!==a||l||(l=u),0!==s||u||(u=l),l===u&&n.push({prefix:o[1]||"",x:a,y:s,xUnits:l,yUnits:u,end:o[8]})}}return n}(r),o=0;o<t.lines;o++){var a=~~(360/t.lines*o+t.rotate),s=_c(document.createElement("div"),{position:"absolute",top:-t.width/2+"px",width:t.length+t.width+"px",height:t.width+"px",background:xc(t.fadeColor,o),borderRadius:n,transformOrigin:"left",transform:"rotate("+a+"deg) translateX("+t.radius+"px)"}),l=o*t.direction/t.lines/t.speed;l-=1/t.speed;var u=_c(document.createElement("div"),{width:"100%",height:"100%",background:xc(t.color,o),borderRadius:n,boxShadow:bc(i,a),animation:1/t.speed+"s linear "+l+"s infinite "+t.animation});s.appendChild(u),e.appendChild(s)}}(this.el,this.opts),this},e.prototype.stop=function(){return this.el&&("undefined"!=typeof requestAnimationFrame?cancelAnimationFrame(this.animateId):clearTimeout(this.animateId),this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.el=void 0),this},e}();function _c(e,t){for(var n in t)e.style[n]=t[n];return e}function xc(e,t){return"string"==typeof e?e:e[t%e.length]}function bc(e,t){for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r],a=wc(o.x,o.y,t);n.push(o.prefix+a[0]+o.xUnits+" "+a[1]+o.yUnits+o.end)}return n.join(", ")}function wc(e,t,n){var r=n*Math.PI/180,i=Math.sin(r),o=Math.cos(r);return[Math.round(1e3*(e*o+t*i))/1e3,Math.round(1e3*(-e*i+t*o))/1e3]}function Sc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ec,Tc=function(e,t,n){return t&&Sc(e.prototype,t),n&&Sc(e,n),e},Mc=function(){function e(){h(this,e),this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return Tc(e,[{key:"start",value:function(){this.startTime=e.now(),this.oldTime=this.startTime,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1}},{key:"getElapsedTime",value:function(){return this.update(),this.elapsedTime}},{key:"update",value:function(){var t=0;if(this.running){var n=e.now();t=.001*(n-this.oldTime),this.oldTime=n,this.elapsedTime+=t}return t}}]),e}();Mc.now=(Ec="undefined"!=typeof window&&window.performance)&&Ec.now?Ec.now.bind(Ec):Date.now;var Cc=Mc.now;function Ac(e,t,n){var r=document.createElement(e);return r.id=t,r.style.cssText=n,r}var Rc=function(){function e(){h(this,e),this.domElement=Ac("div","stats","padding:8px"),this._text=Ac("p","fps","margin:0;color:silver;font-size:large"),this.domElement.appendChild(this._text),this._startTime=Cc(),this._prevTime=this._startTime,this._deltas=new Array(20),this._index=0,this._total=0,this._count=0}return Tc(e,[{key:"end",value:function(){var e=Cc(),t=e-this._startTime;return this._count<this._deltas.length?this._count++:this._total-=this._deltas[this._index],this._total+=t,this._deltas[this._index]=t,this._index=(this._index+1)%this._deltas.length,this.ms=this._total/this._count,this.fps=1e3/this.ms,e>this._prevTime+1e3&&(this._text.textContent=this.fps.toPrecision(2),this._prevTime=e),e}},{key:"update",value:function(){this._startTime=this.end()}},{key:"show",value:function(e){void 0===e&&(e=!0),this.domElement.style.display=e?"block":"none"}}]),e}(),Pc=o((function(e){function t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function n(r,i,o){return t()?e.exports=n=Reflect.construct:e.exports=n=function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&p(i,n.prototype),i},n.apply(null,arguments)}e.exports=n})),kc=o((function(e){function t(n){var r="function"==typeof Map?new Map:void 0;return e.exports=t=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return Pc(e,arguments,f(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),p(t,e)},t(n)}e.exports=t}));function Lc(e,t){return!e||e===t}function Nc(){this._handlers={}}Nc.prototype.addEventListener=function(e,t,n){var r=this._handlers[e];r||(this._handlers[e]=[],r=this._handlers[e]);var i=[t,n];void 0===s.find(r,(function(e){return e[0]===i[0]&&e[1]===i[1]}))&&r.push(i)},Nc.prototype.removeEventListener=function(e,t,n){var r=this;s.forEach(r._handlers,(function(i,o){s.remove(i,(function(i){return Lc(e,o)&&Lc(t,i[0])&&Lc(n,i[1]||r)}))})),this._handlers=s.omitBy(r._handlers,(function(e){return 0===e.length}))},Nc.prototype.dispatchEvent=function(e){var t=this;s.forEach(this._handlers[e.type],(function(n){var r=n[1]||t;n[0].apply(r,[e])}))};var Ic={debug:0,info:1,report:2,warn:3,error:4};function Oc(){Nc.call(this),this.console=!1,this._priority=Ic.warn}function Dc(e){if(!s.isNumber(e))throw new Error("Wrong log level specified!");return e}Oc.prototype=Object.create(Nc.prototype),Oc.prototype.constructor=Oc,Oc.prototype.instantiate=function(){return new Oc},Object.defineProperty(Oc.prototype,"level",{get:function(){var e=this;return s.findKey(Ic,(function(t){return t===e._priority}))},set:function(e){this._priority=Dc(Ic[e])}}),Oc.prototype.levels=function(){return Object.keys(Ic)},Oc.prototype.message=function(e,t){var n=Dc(Ic[e]);this._message(n,t)},Oc.prototype.debug=function(e){this._message(Ic.debug,e)},Oc.prototype.info=function(e){this._message(Ic.info,e)},Oc.prototype.report=function(e){this._message(Ic.report,e)},Oc.prototype.warn=function(e){this._message(Ic.warn,e)},Oc.prototype.error=function(e){this._message(Ic.error,e)},Oc.prototype._message=function(e,t){if(!(e<this._priority)){var n=s.findKey(Ic,(function(t){return t===e}));if(t=String(t),this.console){var r="miew:".concat(n,": ").concat(t);"error"===n?console.error(r):"warn"===n?console.warn(r):console.log(r)}this.dispatchEvent({type:"message",level:n,message:t})}};var zc=new Oc,Fc={DEFAULT:0,SAFARI:1};function Bc(e){return decodeURIComponent(e.replace(/\+/g," "))}function Uc(e){for(var t,n=(e=e||window.location.search).substring(e.indexOf("?")+1),r=/([^&=]+)=?([^&]*)/g,i=[];null!==(t=r.exec(n));)i.push([Bc(t[1]),Bc(t[2])]);return i}function Vc(e){var t=!1;this.enable=function(e){t=e};var n=0,r=Object.keys(e);function i(e,r){return function(){var i=Vc.spaces.substr(0,2*n);t&&zc.debug("".concat(i+r," {")),n++;for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];var l=e.apply(this,a);return n--,t&&zc.debug("".concat(i,"} // ").concat(r)),l}}for(var o=0,a=r.length;o<a;++o){var s=r[o],l=e[s];l instanceof Function&&"constructor"!==s&&(e[s]=i(l,s))}}Vc.spaces="                                                                                          ";var Gc=function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this))).name="OutOfMemoryError",n.message=e,n}return m(t,e),t}(kc(Error));function jc(e){for(var t=new Uint8Array(e),n="",r=0;r<t.byteLength;r++)n+=String.fromCharCode(t[r]);return window.btoa(n)}function Hc(e){for(var t=window.atob(e),n=new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=t[r].charCodeAt(0);return n.buffer}function Wc(e){if(s.isPlainObject(e))return!0;var t=e&&Object.getPrototypeOf(e);return!!t&&!t.hasOwnProperty("constructor")&&Wc(t)}function qc(e){return e.slice(Math.max(0,e.lastIndexOf("."))||1/0)}function Yc(e){var t=e.split(/[:;,]/),n=t.length;return n>=3&&"base64"===t[n-2]?new Blob([Hc(t[n-1])]):null}var Xc=/^[a-zA-Z0-9_]*$/,Zc=['"',"",'"'],$c={browserType:Fc,encodeQueryComponent:function(e,t){return encodeURIComponent(e).replace(t,(function(e){return String.fromCharCode(parseInt(e.substr(1),16))})).replace(/%20/g,"+")},decodeQueryComponent:Bc,getUrlParameters:Uc,getUrlParametersAsDict:function(e){for(var t={},n=Uc(e),i=0;i<n.length;++i){var o=r(n[i],2),a=o[0],s=o[1];t[a]=s}return t},resolveURL:function(e){if("undefined"!=typeof URL)try{return"undefined"!=typeof window?new URL(e,window.location).href:new URL(e).href}catch(e){}if("undefined"!=typeof document){var t=document.createElement("a");return t.href=e,t.href}return e},generateRegExp:function(e){for(var t=[],n=0,r=e.length;n<r;++n)t[t.length]=e[n].charCodeAt(0).toString(16);var i=t.join("|");return new RegExp("%(?:".concat(i,")"),"gi")},createElement:function(e,t,n){var r,i,o=document.createElement(e);if(t){var a=Object.keys(t);for(r=0,i=a.length;r<i;++r){var s=a[r];o.setAttribute(s,t[s])}}if(n)for(n instanceof Array||(n=[n]),r=0,i=n.length;r<i;++r){var l=n[r];"string"==typeof l?o.appendChild(document.createTextNode(l)):l instanceof HTMLElement&&o.appendChild(l)}return o},deriveClass:function(e,t,n,r){return e.prototype=s.assign(Object.create(t.prototype),{constructor:e},n),r&&s.assign(e,r),e},deriveDeep:function e(t,n){var r,i,o=t;if(t instanceof Array)for(o=new Array(t.length),r=0,i=t.length;r<i;++r)o[r]=e(t[r]);else if(t instanceof Object){o=Object.create(t);var a=Object.keys(t);for(r=0,i=a.length;r<i;++r){var s=a[r],l=t[s],u=e(l);u!==l&&(o[s]=u)}n&&Object.keys(o).length>0&&(o=Object.create(o))}return o},hexColor:function(e){var t="0000000".concat(e.toString(16)).substr(-6);return"#".concat(t)},DebugTracer:Vc,OutOfMemoryError:Gc,allocateTyped:function(e,t){var n=null;try{n=new e(t)}catch(e){throw e instanceof RangeError?new Gc(e.message):e}return n},bytesFromBase64:Hc,bytesToBase64:jc,arrayFromBase64:function(e,t){return Array.prototype.slice.call(new t(Hc(e)))},arrayToBase64:function(e,t){return jc(new t(e).buffer)},compareOptionsWithDefaults:function(e,t){var n=[];if(t&&e){for(var r=Object.keys(e),i=0;i<r.length;++i){var o=r[i],a=e[o];a instanceof Object||void 0===t[o]||t[o]===a||n.push("".concat(o,":").concat(a))}if(n.length>0)return"!".concat(n.join())}return""},objectsDiff:function e(t,n){var r={};return s.forIn(t,(function(t,i){var o=n[i];if(Wc(t)&&Wc(o)){var a=e(t,o);s.isEmpty(a)||(r[i]=a)}else s.isEqual(t,o)||(r[i]=t)})),r},forInRecursive:function(e,t){!function e(n,r){s.forIn(n,(function(n,i){var o=r+(r.length>0?".":"");n instanceof Object?e(n,o+i):void 0!==n&&t(n,o+i)}))}(e,"")},enquoteString:function(e){return s.isString(e)?'"'.concat(e.replace(/"/g,'\\"'),'"'):e},unquoteString:function(e){if(!s.isString(e))return e;if('"'===e[0]&&'"'===e[e.length-1])return(e=e.slice(1,e.length-1)).replace(/\\"/g,'"');if("'"===e[0]&&"'"===e[e.length-1])return(e=e.slice(1,e.length-1)).replace(/\\'/g,"'");throw new SyntaxError("Incorrect string format, can't unqute it")},getBrowser:function(){return navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&-1===navigator.userAgent.indexOf("CriOS")&&-1===navigator.userAgent.indexOf("FxiOS")?Fc.SAFARI:Fc.DEFAULT},shotOpen:function(e){"undefined"!=typeof window&&window.open().document.write('<body style="margin:0"><img src="'.concat(e,'" /></body>'))},shotDownload:function(e,t){if(e&&"data:"===e.substr(0,5))if(t||(t=["screenshot-",+new Date,".png"].join("")),"undefined"!=typeof window&&window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(Yc(e),t);else if("undefined"!=typeof document){var n=document.createElement("a");n.download=t,n.innerHTML="download",n.href=window.URL.createObjectURL(Yc(e)),document.body.appendChild(n),n.click(),document.body.removeChild(n)}},copySubArrays:function(e,t,n,r){for(var i=0,o=n.length;i<o;++i)for(var a=0;a<r;++a)t[i*r+a]=e[n[i]*r+a]},shallowCloneNode:function(e){var t=e.cloneNode(!0);return t.worldPos=e.worldPos,t},correctSelectorIdentifier:function(e){return Xc.test(e)?e:(Zc[1]=e,Zc.join(""))},getFileExtension:qc,splitFileName:function(e){var t=qc(e);return[e.slice(0,e.length-t.length),t]},download:function(e,t,n){var r=new Blob([e]);if(t||(t=["data",+new Date].join("")),t+=n?".".concat(n):r.type||".bin","undefined"!=typeof window&&window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(r,t);else if("undefined"!=typeof document){var i=document.createElement("a");i.download=t,i.innerHTML="download",i.href=window.URL.createObjectURL(r),document.body.appendChild(i),i.click(),document.body.removeChild(i)}},concatTypedArraysUnsafe:function(e,t){var n=new e.constructor(e.length+t.length);return n.set(e),n.set(t,e.length),n},mergeTypedArraysUnsafe:function(e){if(e.length<=0)return null;for(var t=e.reduce((function(e,t){return e+t.length}),0),n=new e[0].constructor(t),r=0,i=0;r<e.length;r++){var o=e[r].length;n.set(e[r],i),i+=o}return n}},Kc=function(e){function t(){var e;return h(this,t),(e=d(this,f(t).call(this)))._shouldCancel=!1,e}return m(t,e),Tc(t,[{key:"cancel",value:function(){this._shouldCancel=!0,this.dispatchEvent({type:"cancel"})}},{key:"shouldCancel",value:function(){return this._shouldCancel}},{key:"notify",value:function(e){this.dispatchEvent({type:"notification",slaveEvent:e})}}]),t}(Nc),Jc={modes:{BS:{atom:.23,bond:.15,space:.5,multibond:!0,aromrad:.1,showarom:!0,polyComplexity:{poor:3,low:4,medium:6,high:12,ultra:32}},VW:{polyComplexity:{poor:4,low:6,medium:8,high:16,ultra:32}},LN:{multibond:!0,showarom:!0,offsarom:.2,chunkarom:10,atom:.23,lineWidth:2},LC:{bond:.2,space:0,multibond:!0,aromrad:.1,showarom:!0,polyComplexity:{poor:3,low:4,medium:6,high:12,ultra:32}},SA:{zClip:!1,probeRadius:1.5,subset:"",wireframe:!1,polyComplexity:{poor:6,low:8,medium:16,high:30,ultra:60}},SE:{zClip:!1,probeRadius:1.5,subset:"",wireframe:!1,polyComplexity:{poor:6,low:8,medium:16,high:30,ultra:60}},QS:{isoValue:.5,gaussLim:{poor:1.5,low:2,medium:2.5,high:3,ultra:4},scale:1,wireframe:!1,gridSpacing:{poor:2,low:1.5,medium:1,high:.5,ultra:.25},subset:"",zClip:!1},CS:{probeRadius:1.4,isoValue:1.5,wireframe:!1,probePositions:30,polyComplexity:{poor:.5,low:1,medium:1.5,high:1.75,ultra:2},subset:"",zClip:!1},TR:{radius:.3,polyComplexity:{poor:12,low:16,medium:32,high:64,ultra:64}},TU:{radius:.3,heightSegmentsRatio:1.5,tension:-.7,polyComplexity:{poor:4,low:6,medium:10,high:18,ultra:34}},CA:{radius:.3,depth:.25,ss:{helix:{width:1,arrow:2},strand:{width:1,arrow:2}},heightSegmentsRatio:1.5,tension:-.7,polyComplexity:{poor:4,low:6,medium:10,high:18,ultra:34}},TX:{template:"{{Chain}}.{{Residue}}{{Sequence}}.{{Name}}",horizontalAlign:"center",verticalAlign:"middle",dx:0,dy:0,dz:1,fg:"none",bg:"0x202020",showBg:!0},VD:{kSigma:1,kSigmaMed:2,kSigmaMax:4,frame:!0,isoMode:!1,polyComplexity:{poor:2,low:3,medium:4,high:8,ultra:10}}},colorers:{EL:{carbon:-1},UN:{color:16777215},CO:{subset:"charged",color:16711680,baseColor:16777215},CB:{color:9474192,factor:.6},SQ:{gradient:"rainbow"},TM:{gradient:"temp",min:5,max:40},OC:{gradient:"reds"},HY:{gradient:"blue-red"},MO:{gradient:"rainbow"}},antialias:!0,camFov:45,camNear:.5,camFar:100,camDistance:2.5,radiusToFit:1,fogNearFactor:.5,fogFarFactor:1,fogAlpha:1,fogColor:0,fogColorEnable:!1,palette:"JM",resolution:"medium",autoResolution:!1,autoPreset:!0,preset:"default",presets:{default:[{mode:"BS",colorer:"EL",selector:"all",material:"SF"}],empty:[],wire:[{mode:"LN",colorer:"EL",selector:"all",material:"SF"}],small:[{mode:"BS",colorer:"EL",selector:"all",material:"SF"}],macro:[{mode:"CA",colorer:"SS",selector:"not hetatm",material:"SF"},{mode:"BS",colorer:"EL",selector:"hetatm and not water",material:"SF"}]},objects:{line:{color:4294967295,dashSize:.3,gapSize:.05}},bg:{color:2105376,transparent:!1},draft:{clipPlane:!1,clipPlaneFactor:.5,clipPlaneSpeed:3e-5},plugins:{},axes:!0,fog:!0,fps:!0,zSprites:!0,isoSurfaceFakeOpacity:!0,suspendRender:!0,nowater:!1,autobuild:!0,fxaa:!0,outline:{on:!1,color:0,threshold:.1,thickness:1},ao:!1,shadow:{on:!1,type:"random",radius:1},autoRotation:0,maxfps:30,fbxprec:4,autoRotationAxisFixed:!0,zooming:!0,picking:!0,pick:"atom",editing:!1,aromatic:!1,singleUnit:!0,stereo:"NONE",interpolateViews:!0,transparency:"prepass",translationSpeed:2,debug:{example:3.5,text:"hello!",good:!0,ssaoKernelRadius:.7,ssaoFactor:.7,stereoBarrel:.25},use:{multiFile:!1}};function Qc(){Nc.call(this),this.old=null,this.now={},this._changed={},this.reset()}$c.deriveClass(Qc,Nc,{defaults:Jc,set:function(e,t){if(s.isString(e))s.get(this.now,e)!==t&&(s.set(this.now,e,t),this._notifyChange(e,t));else{var n=$c.objectsDiff(e,this.now);s.isEmpty(n)||(s.merge(this.now,n),this._notifyChanges(n))}},get:function(e,t){return s.get(this.now,e,t)},reset:function(){var e=$c.objectsDiff(Jc,this.now);this.now=s.cloneDeep(Jc),this.old=null,this._notifyChanges(e),this._changed={}},checkpoint:function(){this.old=s.cloneDeep(this.now),this._changed={}},_notifyChange:function(e,t){this._changed[e]=!0,this.dispatchEvent({type:"change:".concat(e),value:t})},_notifyChanges:function(e){var t=this;$c.forInRecursive(e,(function(e,n){t._notifyChange(n,e)}))},changed:function(){if(!this.old)return[];var e=this.old,t=this.now;return s.filter(Object.keys(this._changed),(function(n){return s.get(e,n)!==s.get(t,n)}))},applyDiffs:function(e){if(e.hasOwnProperty("VERSION")&&0!==e.VERSION)throw new Error("Settings version does not match!");delete e.VERSION,this.reset(),this.set(e)},getDiffs:function(e){var t=$c.objectsDiff(this.now,Jc);return e&&(t.VERSION=0),t},setPluginOpts:function(e,t){Jc.plugins[e]=s.cloneDeep(t),this.now.plugins[e]=s.cloneDeep(t)}});var eh=new Qc,th=0;function nh(e){return!(!e||"0"===e||s.isString(e)&&"false"===e.toLowerCase())}var rh={string:String,number:Number,boolean:nh},ih=$c.generateRegExp("$;@/?:,");function oh(e){return $c.encodeQueryComponent(e,ih)}var ah=$c.generateRegExp("$;@/? ");function sh(e){return $c.encodeQueryComponent(e,ah)}function lh(e){var t=e.reps;if(!t){var n=eh.now.presets,i=e.preset||eh.now.preset;if(!(t=n[i])){zc.warn('Unknown preset "'.concat(i,'"'));var o=Object.keys(n);t=n[i=r(o,1)[0]]}e.preset=i,e.reps=$c.deriveDeep(t,!0)}}function uh(e,t,n){lh(e);var r=e.reps[th];r.hasOwnProperty(t)&&(th=e.reps.length,e.reps[th]=$c.deriveDeep(r,!0)),void 0!==n&&(e.reps[th][t]=n)}function ch(e,t,n){if(e){var r=e.indexOf("!"),i=function(e,t){var n=e.indexOf(",");return n>=0?(t.push(e.substr(n+1).split(",")),e.substr(0,n)):e}(e.substr(0,r>=0?r:void 0),n);if(r>=0){var o=e.substr(r+1).split(",");if(e=i,t){var a=t[e],u=$c.deriveDeep(a,!0);o.forEach((function(t){var n=t.split(":",2),r=decodeURIComponent(n[0]),i=decodeURIComponent(n[1]),o=rh[l(s.get(a,r))];o?s.set(u,r,o(i)):zc.warn('Unknown argument "'.concat(r,'" for option "').concat(e,'"'))})),Object.keys(u).length>0&&(e=[e,u])}}else e=i}return e}var hh={l:"load",load:String,t:"type",type:String,v:"view",view:String,u:"unit",unit:Number,menu:nh,o:"object",object:function(e,t){var n=[],i=ch(e,eh.defaults.objects,n);Array.isArray(i)||(i=[i]),function(e,t,n){void 0===e._objects&&(e._objects=[]);var i=r(n,2),o=i[0],a=i[1],s={type:o,params:t};void 0!==a&&(s.opts=a),e._objects[e._objects.length]=s}(t,n[0],i)},p:"preset",preset:function(e,t){t.preset=e,t.reps=null,lh(t)},r:"rep",rep:function(e,t){lh(t),(th=(th=Number(e))<=t.reps.length?th<0?0:th:t.reps.length)===t.reps.length&&(t.reps[th]=th>0?$c.deriveDeep(t.reps[th-1],!0):$c.deriveDeep(eh.defaults.presets.default[0],!0))},s:"select",select:function(e,t){uh(t,"selector",e)},m:"mode",mode:function(e,t){uh(t,"mode",ch(e,eh.defaults.modes))},c:"color",color:function(e,t){uh(t,"colorer",ch(e,eh.defaults.colorers))},mt:"material",material:function(e,t){uh(t,"material",ch(e,eh.defaults.materials))},dup:function(e,t){lh(t);var n=t.reps,r=n[th];n[th=n.length]=$c.deriveDeep(r,!0)},ar:"autoResolution"};function dh(e){th=0;for(var t={},n=0,r=e.length;n<r;++n){for(var i=e[n],o=i[0],a=i[1],u=hh[o];s.isString(u);)u=hh[o=u];if(u){if(s.isFunction(u)){var c=u(a,t);void 0!==c&&(t[o]=c)}}else{var h=rh[l(s.get(eh.defaults,o))];h?s.set(t,"settings.".concat(o),h(a)):zc.warn('Unknown option "'.concat(o,'"'))}}return t}function fh(e){var t=[],n=0;return $c.forInRecursive(e,(function(e,r){t[n++]=sh(r)+":"+sh(e)})),t.join(",")}function ph(e){return s.isArray(e)?e.length<2?e[0]:"".concat(e[0]).concat("!").concat(fh(e[1])):e}function mh(e){if(e&&e.type){var t=e.type;return s.isArray(e.params)&&e.params.length>0&&(t+=",".concat(e.params.join(","))),e.opts&&(t+="!"+fh(e.opts)),t}}function vh(e){var t=[],n=0;return $c.forInRecursive(e,(function(e,r){t[n++]="".concat(r,"=").concat($c.enquoteString(e))})),t.join(" ")}function gh(e){return s.isArray(e)?e.length<2?e[0]:"".concat(e[0]," ").concat(vh(e[1])):e}function yh(e){if(e&&e.type){var t=e.type;return s.isArray(e.params)&&e.params.length>0&&(t+=" ".concat(e.params.map($c.enquoteString).join(" "))),e.opts&&(t+=" ".concat(vh(e.opts))),t}}function _h(e,t){var n=[],r=0;function i(e,t){null!=t&&(n[r++]=e+t)}return s.isEmpty(e)?null:(i("",t),i("s=",$c.enquoteString(e.selector)),i("m=",gh(e.mode)),i("c=",gh(e.colorer)),i("mt=",gh(e.material)),n.join(" "))}var xh={fromURL:function(e){return dh($c.getUrlParameters(e))},fromAttr:function(e){return dh($c.getUrlParameters("?".concat(e||"")))},adapters:rh,toURL:function(e){var t=[],n=0;function r(e,r){null!=r&&(t[n++]=oh(e)+"="+oh(r))}r("l",e.load),r("u",e.unit),r("p",e.preset),function(e){if(e)for(var t=0,n=e.length;t<n;++t)s.isEmpty(e[t])||(r("r",t),r("s",e[t].selector),r("m",ph(e[t].mode)),r("c",ph(e[t].colorer)),r("mt",ph(e[t].material)))}(e.reps),function(e){if(e)for(var t=0,n=e.length;t<n;++t)r("o",mh(e[t]))}(e._objects),r("v",e.view),$c.forInRecursive(e.settings,(function(e,t){"preset"!==t&&r(t,e)}));var i="";if("undefined"!=typeof window){var o=window.location;i="".concat(o.protocol,"//").concat(o.host).concat(o.pathname)}return t.length>0&&(i+="?".concat(t.join("&"))),i},toScript:function(e){var t=[],n=0;function r(e,r,i){if(null!=r){var o="string"==typeof r&&i?'"':"";t[n++]="".concat(e," ").concat(o).concat(r).concat(o).trim()}}return r("set","autobuild false"),r("load",e.load,!0),r("unit",e.unit),r("preset",e.preset),function(e){if(e)for(var t=0,n=e.length;t<n;++t)r("rep",_h(e[t],t))}(e.reps),function(e){if(e)for(var t=0,n=e.length;t<n;++t)r("",yh(e[t]))}(e._objects),$c.forInRecursive(e.settings,(function(e,t){"preset"!==t&&r("set ".concat(t),e,!0)})),r("view",e.view),r("set","autobuild true"),t.join("\n")}},bh=function(){function e(t,n){h(this,e),this._node=n||null,this._name=t||null,null===this._node&&null===this._name&&(this._name="Unknown")}return Tc(e,[{key:"getString",value:function(){return this._name||"unknown"}},{key:"getNode",value:function(){return this._node||null}}]),e}(),wh=function(){function e(t,n,r,i,o,a,s,l,u,c,d){h(this,e),this._index=-1,this._residue=t,this._name=n instanceof bh?n:new bh(n),this.element=r,this._position=i,this._role=o,this._mask=1,this._index=-1,this._het=a,this._serial=s,this._location=(l||" ").charCodeAt(0),this._occupancy=u||1,this._temperature=c,this._charge=d,this._hydrogenCount=-1,this._radicalCount=0,this._valence=-1,this._bonds=[],this.flags=0,"H"===r.name?this.flags|=e.Flags.HYDROGEN:"C"===r.name&&(this.flags|=e.Flags.CARBON)}return Tc(e,[{key:"getName",value:function(){return this._name}},{key:"getPosition",value:function(){return this._position}},{key:"getResidue",value:function(){return this._residue}},{key:"getSerial",value:function(){return this._serial}},{key:"getBonds",value:function(){return this._bonds}},{key:"isHet",value:function(){return this._het}},{key:"isHydrogen",value:function(){return 1===this.element.number}},{key:"getValence",value:function(){return-1===this._valence?0:this._valence}},{key:"getVisualName",value:function(){var e=this.getName();return e.getString().length>0?e.getString():this.element.name.trim()}},{key:"forEachBond",value:function(e){for(var t=this._bonds,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"getHydrogenCountBoron",value:function(){var e=3-this.getCharge()-this.getAtomBondsCount()-this._radicalCount;return Math.max(0,e)}},{key:"getHydrogenCountTin",value:function(){var e=this._valence;-1===e&&(e=this.getAtomBondsCount()-Math.abs(this.getCharge())+this._radicalCount);var t=this.findSuitableValence(e);return 0!==this.getCharge()&&(t=4),Math.max(0,t-e)}},{key:"getHydrogenCountMetal",value:function(){return 0}},{key:"getHydrogenCountGroup14",value:function(){var e=this._valence;-1===e&&(e=this.getAtomBondsCount()-Math.abs(this.getCharge())+this._radicalCount);var t=this.findSuitableValence(e);return Math.max(0,t-e)}},{key:"getHydrogenCountNonMetal",value:function(){var e=this._valence;-1===e&&(e=this.getAtomBondsCount()-this.getCharge()+this._radicalCount);var t=this.findSuitableValence(e);return Math.max(0,t-e)}},{key:"getHydrogenCountHydrogen",value:function(){return 0===this.getAtomBondsCount()&&0===this.getCharge()&&0===this.getValence()&&0===this._radicalCount?1:0}},{key:"getHydrogenCount",value:function(){if(this._hydrogenCount>=0)return this._hydrogenCount;var e=this.element,t=e.hydrogenValency;if(1===t.length&&0===t[0])return 0;switch(e.number){case 1:return this.getHydrogenCountHydrogen();case 3:case 11:case 19:case 37:case 55:case 87:case 4:case 12:case 20:case 38:case 56:case 88:case 13:case 31:case 49:case 41:case 82:case 83:return this.getHydrogenCountMetal();case 6:case 14:case 32:case 51:return this.getHydrogenCountGroup14();case 50:return this.getHydrogenCountTin();case 7:case 8:case 9:case 15:case 16:case 17:case 33:case 34:case 35:case 53:case 85:return this.getHydrogenCountNonMetal();case 5:return this.getHydrogenCountBoron();default:return 0}}},{key:"getAtomBondsCount",value:function(){for(var e,t=this.getBonds(),n=0,r=0;r<t.length;r++)n+=(e=t[r].getOrder())<2?1:e;return n}},{key:"findSuitableValence",value:function(e){for(var t=this.element.hydrogenValency,n=t[t.length-1],r=0;r<t.length;r++)if(t[r]>=e){n=t[r];break}return n}},{key:"getCharge",value:function(){return this._charge}},{key:"getLocation",value:function(){return this._location}},{key:"getFullName",value:function(){var e="";return null!==this._residue&&(null!==this._residue._chain&&(e+="".concat(this._residue._chain.getName(),".")),e+="".concat(this._residue._sequence,".")),e+this._name.getString()}}]),e}();u(wh,"Flags",{CARBON:1,HYDROGEN:8,NONPOLARH:4104});var Sh=function e(t,n,r,i,o,a,s){h(this,e),this.number=t,this.name=n,this.fullName=r,this.weight=i,this.radius=o,this.radiusBonding=a,this.hydrogenValency=s};u(Sh,"Constants",{U1:1,Lead:2,U2:3,Wing:4,U18:18}),u(Sh,"Role",{N:Sh.Constants.U1,CA:Sh.Constants.Lead,C:Sh.Constants.U2,O:Sh.Constants.Wing,SG:Sh.Constants.U18}),u(Sh,"ByAtomicNumber",[null,new Sh(1,"H","Hydrogen",1.008,1.2,.23,[1]),new Sh(2,"HE","Helium",4.003,1.4,.93,[0]),new Sh(3,"LI","Lithium",6.941,1.82,.68,[1]),new Sh(4,"BE","Beryllium",9.012,1.7,.35,[2]),new Sh(5,"B","Boron",10.81,2.08,.83,[3]),new Sh(6,"C","Carbon",12.011,1.95,.68,[4]),new Sh(7,"N","Nitrogen",14.007,1.85,.68,[3,5]),new Sh(8,"O","Oxygen",15.999,1.7,.68,[2,4]),new Sh(9,"F","Fluorine",18.998,1.73,.64,[1]),new Sh(10,"NE","Neon",20.18,1.54,1.12,[0]),new Sh(11,"NA","Sodium",22.99,2.27,.97,[1]),new Sh(12,"MG","Magnesium",24.305,1.73,1.1,[2]),new Sh(13,"AL","Aluminum",26.981,2.05,1.35,[3]),new Sh(14,"SI","Silicon",28.086,2.1,1.2,[4]),new Sh(15,"P","Phosphorus",30.974,2.08,.75,[3,5]),new Sh(16,"S","Sulfur",32.07,2,1.02,[2,4,6]),new Sh(17,"CL","Chlorine",35.453,1.97,.99,[1,3,5,7]),new Sh(18,"AR","Argon",39.948,1.88,1.57,[0]),new Sh(19,"K","Potassium",39.1,2.75,1.33,[1]),new Sh(20,"CA","Calcium",40.08,1.973,.99,[2]),new Sh(21,"SC","Scandium",44.956,1.7,1.44,[0]),new Sh(22,"TI","Titanium",47.88,1.7,1.47,[0]),new Sh(23,"V","Vanadium",50.941,1.7,1.33,[0]),new Sh(24,"CR","Chromium",52,1.7,1.35,[0]),new Sh(25,"MN","Manganese",54.938,1.7,1.35,[0]),new Sh(26,"FE","Iron",55.847,1.7,1.34,[0]),new Sh(27,"CO","Cobalt",58.93,1.7,1.33,[0]),new Sh(28,"NI","Nickel",58.69,1.63,1.5,[0]),new Sh(29,"CU","Copper",63.55,1.4,1.52,[0]),new Sh(30,"ZN","Zinc",65.39,1.39,1.45,[0]),new Sh(31,"GA","Gallium",69.72,1.87,1.22,[3]),new Sh(32,"GE","Germanium",72.61,1.7,1.17,[4]),new Sh(33,"AS","Arsenic",74.92,1.85,1.21,[3,5]),new Sh(34,"SE","Selenium",78.96,1.9,1.22,[2,4,6]),new Sh(35,"BR","Bromine",79.9,2.1,1.21,[1,3,5,7]),new Sh(36,"KR","Krypton",83.8,2.02,1.91,[0]),new Sh(37,"RB","Rubidium",85.47,1.7,1.47,[1]),new Sh(38,"SR","Strontium",87.62,1.7,1.12,[2]),new Sh(39,"Y","Yttrium",88.91,1.7,1.78,[0]),new Sh(40,"ZR","Zirconium",91.22,1.7,1.56,[0]),new Sh(41,"NB","Niobium",92.91,1.7,1.48,[0]),new Sh(42,"MO","Molybdenum",95.94,1.7,1.47,[0]),new Sh(43,"TC","Technetium",98.91,1.7,1.35,[0]),new Sh(44,"RU","Ruthenium",101.07,1.7,1.4,[0]),new Sh(45,"RH","Rhodium",102.91,1.7,1.45,[0]),new Sh(46,"PD","Palladium",106.42,1.63,1.5,[0]),new Sh(47,"AG","Silver",107.87,1.72,1.59,[0]),new Sh(48,"CD","Cadmium",112.41,1.58,1.69,[0]),new Sh(49,"IN","Indium",114.82,1.93,1.63,[3]),new Sh(50,"SN","Tin",118.71,2.17,1.46,[2,4]),new Sh(51,"SB","Antimony",121.75,2.2,1.46,[3,5]),new Sh(52,"TE","Tellurium",127.6,2.06,1.47,[2,4,6]),new Sh(53,"I","Iodine",126.91,2.15,1.4,[1,3,5,7]),new Sh(54,"XE","Xenon",131.29,2.16,1.98,[0]),new Sh(55,"CS","Cesium",132.91,1.7,1.67,[1]),new Sh(56,"BA","Barium",137.33,1.7,1.34,[2]),new Sh(57,"LA","Lanthanum",138.91,1.7,1.87,[0]),new Sh(58,"CE","Cerium",140.12,1.7,1.83,[0]),new Sh(59,"PR","Praseodymium",140.91,1.7,1.82,[0]),new Sh(60,"ND","Neodymium",144.24,1.7,1.81,[0]),new Sh(61,"PM","Promethium",144.9,1.7,1.8,[0]),new Sh(62,"SM","Samarium",150.36,1.7,1.8,[0]),new Sh(63,"EU","Europium",151.96,1.7,1.99,[0]),new Sh(64,"GD","Gadolinium",157.25,1.7,1.79,[0]),new Sh(65,"TB","Terbium",158.93,1.7,1.76,[0]),new Sh(66,"DY","Dysprosium",162.5,1.7,1.75,[0]),new Sh(67,"HO","Holmium",164.93,1.7,1.74,[0]),new Sh(68,"ER","Erbium",167.26,1.7,1.73,[0]),new Sh(69,"TM","Thulium",168.93,1.7,1.72,[0]),new Sh(70,"YB","Ytterbium",173.04,1.7,1.94,[0]),new Sh(71,"LU","Lutetium",174.97,1.7,1.72,[0]),new Sh(72,"HF","Hafnium",178.49,1.7,1.57,[0]),new Sh(73,"TA","Tantalum",180.95,1.7,1.43,[0]),new Sh(74,"W","Tungsten",183.85,1.7,1.37,[0]),new Sh(75,"RE","Rhenium",186.21,1.7,1.35,[0]),new Sh(76,"OS","Osmium",190.2,1.7,1.37,[0]),new Sh(77,"IR","Iridium",192.22,1.7,1.32,[0]),new Sh(78,"PT","Platinum",195.08,1.72,1.5,[0]),new Sh(79,"AU","Gold",196.97,1.66,1.5,[0]),new Sh(80,"HG","Mercury",200.59,1.55,1.7,[0]),new Sh(81,"TL","Thallium",204.38,1.96,1.55,[1,3]),new Sh(82,"PB","Lead",207.2,2.02,1.54,[2,4]),new Sh(83,"BI","Bismuth",208.98,1.7,1.54,[3,5]),new Sh(84,"PO","Polonium",210,1.7,1.68,[2,4,6]),new Sh(85,"AT","Astatine",210,1.7,1.7,[1,3,5,7]),new Sh(86,"RN","Radon",222,1.7,2.4,[0]),new Sh(87,"FR","Francium",223,1.7,2,[1]),new Sh(88,"RA","Radium",226.03,1.7,1.9,[2]),new Sh(89,"AC","Actinium",227.03,1.7,1.88,[0]),new Sh(90,"TH","Thorium",232.04,1.7,1.79,[0]),new Sh(91,"PA","Protactinium",231.04,1.7,1.61,[0]),new Sh(92,"U","Uranium",238.03,1.86,1.58,[0]),new Sh(93,"NP","Neptunium",237.05,1.7,1.55,[0]),new Sh(94,"PU","Plutonium",239.1,1.7,1.53,[0]),new Sh(95,"AM","Americium",243.1,1.7,1.51,[0]),new Sh(96,"CM","Curium",247.1,1.7,1.5,[0]),new Sh(97,"BK","Berkelium",247.1,1.7,1.5,[0]),new Sh(98,"CF","Californium",252.1,1.7,1.5,[0]),new Sh(99,"ES","Einsteinium",252.1,1.7,1.5,[0]),new Sh(100,"FM","Fermium",257.1,1.7,1.5,[0]),new Sh(101,"MD","Mendelevium",256.1,1.7,1.5,[0]),new Sh(102,"NO","Nobelium",259.1,1.7,1.5,[0]),new Sh(103,"LR","Lawrencium",260.1,1.7,1.5,[0]),new Sh(104,"RF","Rutherfordium",261,1.7,1.6,[0]),new Sh(105,"DB","Dubnium",262,1.7,1.6,[0]),new Sh(106,"SG","Seaborgium",263,1.7,1.6,[0]),new Sh(107,"BH","Bohrium",262,1.7,1.6,[0]),new Sh(108,"HS","Hassium",265,1.7,1.6,[0]),new Sh(109,"MT","Meitnerium",268,1.7,1.6,[0])]),u(Sh,"ByName",{D:new Sh(1,"D","Deuterium",2.014,1.2,.23,[1]),T:new Sh(1,"T","Tritium",3.016,1.2,.23,[1])}),function(){for(var e=Sh.ByAtomicNumber,t=Sh.ByName,n=0,r=e.length;n<r;++n){var i=e[n];i&&(t[i.name]=i)}}(),Sh.getByName=function(e){var t=Sh.ByName[e];return t||(t=Sh.ByName[e]=new Sh(0,e,"Unknown",0,1,.01,[0])),t};var Eh={UNKNOWN:0,COVALENT:1,AROMATIC:2};function Th(e){return e._position}var Mh=function(){function e(t,n,r,i,o){if(h(this,e),this._left=t,this._right=n,this._fixed=o,this._index=-1,t>n)throw new Error("In a bond atom indices must be in increasing order");this._order=r,this._type=i}return Tc(e,[{key:"getLeft",value:function(){return this._left}},{key:"getRight",value:function(){return this._right}},{key:"getOrder",value:function(){return this._order}},{key:"calcLength",value:function(){return this._left._position.distanceTo(this._right._position)}},{key:"_forEachNeighbour",value:function(e,t){for(var n=e._bonds,r=0,i=n.length;r<i;++r)t(n[r]._left!==e?n[r]._left:n[r]._right)}},{key:"forEachLevelOne",value:function(e){var t=this._left,n=this._right;this._forEachNeighbour(t,(function(t){t!==n&&e(t)})),this._forEachNeighbour(n,(function(n){n!==t&&e(n)}))}},{key:"forEachLevelTwo",value:function(e){var t=this._left,n=this._right,r=this;r._forEachNeighbour(t,(function(i){i!==n&&r._forEachNeighbour(i,(function(n){n!==t&&e(n)}))})),r._forEachNeighbour(n,(function(i){i!==t&&r._forEachNeighbour(i,(function(t){t!==n&&e(t)}))}))}},{key:"_fixDir",value:function(e,t,n){var r=0,i=0,o=e.clone();function a(a){o.copy(n(a)),o.sub(e),t.dot(o)>0?++r:++i}function s(e){"C"===e.element.name&&a(e)}for(var l=[[this.forEachLevelOne,s],[this.forEachLevelOne,a],[this.forEachLevelTwo,s],[this.forEachLevelTwo,a]],u=0;u<l.length;++u){if(l[u][0].call(this,l[u][1]),i>r)return t.multiplyScalar(-1);if(i<r)return t}return t}},{key:"calcNormalDir",value:function(e){var t=this._left,n=this._right,r=t,i=n;e=void 0===e?Th:e,t._bonds.length>n._bonds.length&&(r=n,i=t);for(var o=r,a=0,s=i._bonds,l=0,u=s.length;l<u;++l){var c=s[l]._left;s[l]._left===i&&(c=s[l]._right),c._bonds.length>a&&c!==r&&(o=c,a=c._bonds.length)}var h=e(i),d=e(r).clone().sub(h),f=e(o).clone().sub(h);return f.crossVectors(d,f),f.lengthSq()<1e-4&&f.set(0,1,0),d.normalize(),f.normalize(),d.crossVectors(f,d),d.lengthSq()<1e-4&&d.set(0,1,0),d.normalize(),this._fixDir(h,d,e)}}]),e}();u(Mh,"BondType",Eh),Mh.prototype.BondType=Eh;var Ch=["C3'","C3*","P","H5T","H3T"],Ah=["OP1","O1P"],Rh=["OP2","O2P"],Ph=["C3'","C3*","C1","C1'","C1*","P"],kh=[{types:["A","DA","G","DG"],atoms:["N1"]},{types:["C","DC"],atoms:["N3"]},{types:["T","DT","U","DU"],atoms:["O4"]}],Lh=function(){function e(t,n,r,i){h(this,e),this._chain=t,this._component=null,this._type=n,this._sequence=r,this._icode=i,this._mask=1,this._index=-1,this._atoms=[],this._secondary=null,this._firstAtom=null,this._leadAtom=null,this._wingAtom=null,this._lastAtom=null,this._controlPoint=null,this._midPoint=null,this._wingVector=null,this._cylinders=null,this._isValid=!0,this._het=!1,this._molecule=null,this.temperature=null,this.occupancy=null}return Tc(e,[{key:"getChain",value:function(){return this._chain}},{key:"getMolecule",value:function(){return this._molecule}},{key:"getType",value:function(){return this._type}},{key:"getSequence",value:function(){return this._sequence}},{key:"getSecondary",value:function(){return this._secondary}},{key:"getICode",value:function(){return this._icode}},{key:"addAtom",value:function(e,t,n,r,i,o,a,s,l,u){var c=new wh(this,e,t,n,r,i,o,a,s,l,u);return this._chain.getComplex().addAtom(c),this._atoms.push(c),this._het=this._het||i,c}},{key:"getAtomCount",value:function(){return this._atoms.length}},{key:"forEachAtom",value:function(e){for(var t=this._atoms,n=0,r=t.length;n<r&&!e(t[n]);++n);}},{key:"_findAtomByName",value:function(e){var t=null;return this.forEachAtom((function(n){return n._name._name===e&&(t=n,!0)})),t}},{key:"_findFirstAtomInList",value:function(e){for(var t=null,n=0;n<e.length;++n)if(null!==(t=this._findAtomByName(e[n])))return t;return t}},{key:"collectMask",value:function(){for(var e=4294967295,t=this._atoms,n=0,r=t.length;n<r;++n)e&=t[n]._mask;this._mask=e}},{key:"getCylinderTargetList",value:function(){for(var e=this._type._name,t=0,n=kh.length;t<n;++t)for(var r=0,i=kh[t].types.length;r<i;++r)if(e===kh[t].types[r])return kh[t].atoms;return null}},{key:"_detectLeadWing",value:function(e,t,n){var r=this._findFirstAtomInList(Ch),i=this._findFirstAtomInList(Ah),o=this._findFirstAtomInList(Rh);if(null===i&&null!==t&&(i=t._findFirstAtomInList(Ah)),null===o&&null!==t&&(o=t._findFirstAtomInList(Rh)),null!==r&&null!==i&&null!==o){e._leadAtom=r,e._controlPoint=n(r),e._wingVector=n(o).clone().sub(n(i)),e._isValid=!0;var a=this._findFirstAtomInList(Ph),s=this.getCylinderTargetList(),l=null!==s?this._findFirstAtomInList(s):null;null!==a&&null!==l&&(e._cylinders=[n(a),n(l)])}}},{key:"calcWing",value:function(e,t,n,r){var i=t.clone().sub(e),o=e.clone().sub(n);return o.crossVectors(i,o),o.crossVectors(i,o).normalize(),null!==r&&r.length()>1e-4&&o.length()>1e-4&&Math.abs(r.angleTo(o))>Math.PI/2&&o.negate(),o}},{key:"_innerFinalize",value:function(e,t,n,r,i,o){var a=null===t,s=o(this._leadAtom),l=new E(s.x,s.y,s.z);if(i)this._detectLeadWing(r,n,o);else{if(a)r._midPoint=o(this._firstAtom).clone();else{var u=t._controlPoint;r._midPoint=u.clone().lerp(l,.5),r._wingVector=this.calcWing(u,l,o(e._wingAtom),t._wingVector)}r._controlPoint=l}}},{key:"_finalize2",value:function(e,t,n){this._innerFinalize(e,e,t,this,n,(function(e){return e._position}))}},{key:"isConnected",value:function(e){if(this._chain!==e._chain)return!1;if(this===e)return!0;var t=!1;return this.forEachAtom((function(n){for(var r=n._bonds,i=0,o=r.length;i<o;++i){var a=r[i];if(a._left._residue===e||a._right._residue===e)return t=!0,!0}return!1})),t}},{key:"_finalize",value:function(){var e=this,t=r(this._atoms,1);this._firstAtom=t[0],this._lastAtom=this._atoms[this._atoms.length-1],this._leadAtom=null,this._wingAtom=null;var n=0,i=0,o=0,a=0;this.forEachAtom((function(t){return null===e._leadAtom&&t._role===Sh.Constants.Lead&&(e._leadAtom=t),null===e._wingAtom&&t._role===Sh.Constants.Wing&&(e._wingAtom=t),t._temperature&&(i+=t._temperature,n++),t._occupancy&&(a+=t._occupancy,o++),null!==e._leadAtom&&null!==e._wingAtom})),n>0&&(this.temperature=i/n),o>0&&(this.occupancy=a/o),null!==this._leadAtom&&null!==this._wingAtom||(this._isValid=!1),null===this._leadAtom&&(this._leadAtom=this._firstAtom),null===this._wingAtom&&(this._wingAtom=this._lastAtom)}}]),e}(),Nh=function(){function e(t,n,r){h(this,e),this._name=t,this._fullName=n,this.letterCode=r,this.flags=0}return Tc(e,[{key:"getName",value:function(){return this._name}}]),e}();function Ih(e,t){for(var n=0,r=t.length;n<r;++n){var i=Nh.StandardTypes[t[n]];i&&(i.flags|=e)}}u(Nh,"StandardTypes",{ALA:new Nh("ALA","Alanine","A"),ARG:new Nh("ARG","Arginine","R"),ASN:new Nh("ASN","Asparagine","N"),ASP:new Nh("ASP","Aspartic Acid","D"),CYS:new Nh("CYS","Cysteine","C"),GLN:new Nh("GLN","Glutamine","Q"),GLU:new Nh("GLU","Glutamic Acid","E"),GLY:new Nh("GLY","Glycine","G"),HIS:new Nh("HIS","Histidine","H"),ILE:new Nh("ILE","Isoleucine","I"),LEU:new Nh("LEU","Leucine","L"),LYS:new Nh("LYS","Lysine","K"),MET:new Nh("MET","Methionine","M"),PHE:new Nh("PHE","Phenylalanine","F"),PRO:new Nh("PRO","Proline","P"),PYL:new Nh("PYL","Pyrrolysine","O"),SEC:new Nh("SEC","Selenocysteine","U"),SER:new Nh("SER","Serine","S"),THR:new Nh("THR","Threonine","T"),TRP:new Nh("TRP","Tryptophan","W"),TYR:new Nh("TYR","Tyrosine","Y"),VAL:new Nh("VAL","Valine","V"),A:new Nh("A","Adenine","A"),C:new Nh("C","Cytosine","C"),G:new Nh("G","Guanine","G"),I:new Nh("I","Inosine","I"),T:new Nh("T","Thymine","T"),U:new Nh("U","Uracil","U"),DA:new Nh("DA","Adenine","A"),DC:new Nh("DC","Cytosine","C"),DG:new Nh("DG","Guanine","G"),DI:new Nh("DI","Inosine","I"),DT:new Nh("DT","Thymine","T"),DU:new Nh("DU","Uracil","U"),"+A":new Nh("+A","Adenine","A"),"+C":new Nh("+C","Cytosine","C"),"+G":new Nh("+G","Guanine","G"),"+I":new Nh("+I","Inosine","I"),"+T":new Nh("+T","Thymine","T"),"+U":new Nh("+U","Uracil","U"),WAT:new Nh("WAT","Water",""),H2O:new Nh("H2O","Water",""),HOH:new Nh("HOH","Water",""),DOD:new Nh("DOD","Water",""),UNK:new Nh("UNK","Unknown",""),UNL:new Nh("UNL","Unknown Ligand","")}),u(Nh,"Flags",{PROTEIN:1,BASIC:2,ACIDIC:4,POLAR:8,NONPOLAR:16,AROMATIC:32,NUCLEIC:256,PURINE:512,PYRIMIDINE:1024,DNA:2048,RNA:4096,WATER:65536});var Oh=Nh.Flags;Ih(Oh.WATER,["WAT","H2O","HOH","DOD"]),Ih(Oh.PROTEIN,["ALA","ARG","ASN","ASP","CYS","GLY","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","PRO","PYL","SEC","SER","THR","TRP","TYR","VAL"]),Ih(Oh.BASIC,["ARG","HIS","LYS"]),Ih(Oh.ACIDIC,["ASP","GLU"]),Ih(Oh.POLAR,["ASN","CYS","GLN","SER","THR","TYR"]),Ih(Oh.NONPOLAR,["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL","GLY"]),Ih(Oh.AROMATIC,["PHE","TRP","TYR"]),Ih(Oh.NUCLEIC,["A","G","I","DA","DG","DI","+A","+G","+I","C","T","U","DC","DT","DU","+C","+T","+U"]),Ih(Oh.PURINE,["A","G","I","DA","DG","DI","+A","+G","+I"]),Ih(Oh.PYRIMIDINE,["C","T","U","DC","DT","DU","+C","+T","+U"]),Ih(Oh.DNA,["DA","DG","DI","DC","DT","DU"]),Ih(Oh.RNA,["A","G","I","C","T","U"]),function(e,t){for(var n=Object.keys(t),r=0,i=n.length;r<i;++r){var o=n[r],a=t[o];Nh.StandardTypes[o].hydrophobicity=a}}(0,{ILE:4.5,VAL:4.2,LEU:3.8,PHE:2.8,CYS:2.5,MET:1.9,ALA:1.8,GLY:-.4,THR:-.7,SER:-.8,TRP:-.9,TYR:-1.3,PRO:-1.6,HIS:-3.2,GLU:-3.5,GLN:-3.5,ASP:-3.5,ASN:-3.5,LYS:-3.9,ARG:-4.5});var Dh,zh=function(){function e(t,n){h(this,e),this._complex=t,this._name=n,this._mask=1,this._index=-1,this._residues=[],this.minSequence=Number.POSITIVE_INFINITY,this.maxSequence=Number.NEGATIVE_INFINITY}return Tc(e,[{key:"getComplex",value:function(){return this._complex}},{key:"getName",value:function(){return this._name}},{key:"getResidues",value:function(){return this._residues}},{key:"_determineType",value:function(){var e=this._residues,t=Nh.Flags,n=t.PROTEIN,r=t.NUCLEIC;this.type=0;for(var i=0,o=e.length;i<o;++i){var a=e[i]._type.flags;if(0!=(a&r)){this.type=2;break}if(0!=(a&n)){this.type=1;break}}}},{key:"findResidue",value:function(e,t){for(var n=this._residues,r=0,i=n.length;r<i;++r){var o=n[r];if(o._sequence===e&&o._icode===t)return[o,r]}return null}},{key:"_finalize",value:function(){this._determineType();for(var e=this._residues,t=null,n=0,r=e.length;n<r;++n){var i=n+1<r?e[n+1]:null,o=e[n];o._finalize2(t,i,2===this.type),t=o}if(e.length>1&&e[1]._wingVector){var a=e[1]._wingVector;e[0]._wingVector=new E(a.x,a.y,a.z)}else e.length>0&&(e[0]._wingVector=new E(1,0,0))}},{key:"updateToFrame",value:function(e){var t=this._residues,n=null,r=null,i=e._residues,o=t.length;function a(t){return e.getAtomPos(t._index)}for(var s=0;s<o;++s){var l=t[s],u=i[l._index],c=s+1<o?t[s+1]:null;l._innerFinalize(n,r,c,u,2===this.type,a),n=l,r=u}i[t[0]._index]._wingVector=o>1?i[t[1]._index]._wingVector:new E(1,0,0)}},{key:"addResidue",value:function(e,t,n){var r=this._complex.getResidueType(e);null===r&&(r=this._complex.addResidueType(e));var i=new Lh(this,r,t,n);return this._complex.addResidue(i),this._residues.push(i),r.flags&(Nh.Flags.NUCLEIC|Nh.Flags.PROTEIN)&&(this.maxSequence<t&&(this.maxSequence=t),this.minSequence>t&&(this.minSequence=t)),i}},{key:"getResidueCount",value:function(){return this._residues.length}},{key:"forEachResidue",value:function(e){for(var t=this._residues,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"collectMask",value:function(){for(var e=4294967295,t=this._residues,n=0,r=t.length;n<r;++n)e&=t[n]._mask;this._mask=e}}]),e}(),Fh=function(){function e(t,n,r){h(this,e),this.type=t,this.generic=e.genericByType[this.type]||"loop",this.init=n,this.term=r}return Tc(e,[{key:"_finalize",value:function(e,t,n){if(!(this.init instanceof Lh&&this.term instanceof Lh)){for(var r=n.splitUnifiedSerial(this.init),i=n.splitUnifiedSerial(this.term),o=r.chain;o<=i.chain;o++)for(var a=r.serial;a<=i.serial;a++)for(var s=r.iCode;s<=i.iCode;s++){var l=n.getUnifiedSerial(o,a,s);t[l]&&(t[l]._secondary=this)}this.init=t[this.init],this.term=t[this.term]}}}]),e}();Fh.Type={STRAND:"E",BRIDGE:"B",HELIX_310:"G",HELIX_ALPHA:"H",HELIX_PI:"I",HELIX:"X",TURN_310:"3",TURN_ALPHA:"4",TURN_PI:"5",TURN:"T",BEND:"S",COIL:"C"},Fh.Generic={STRAND:"strand",HELIX:"helix",LOOP:"loop"};var Bh=Fh.Type,Uh=Fh.Generic;Fh.genericByType=(u(Dh={},Bh.STRAND,Uh.STRAND),u(Dh,Bh.HELIX_310,Uh.HELIX),u(Dh,Bh.HELIX_ALPHA,Uh.HELIX),u(Dh,Bh.HELIX_PI,Uh.HELIX),u(Dh,Bh.HELIX,Uh.HELIX),Dh);var Vh=Fh.Type,Gh={1:Vh.HELIX_ALPHA,3:Vh.HELIX_PI,5:Vh.HELIX_310},jh=function(e){function t(e,n,r,i,o,a,s){var l;return h(this,t),(l=d(this,f(t).call(this,Gh[e]||Fh.Type.HELIX,n,r))).serial=i,l.name=o,l.comment=a,l.length=s,l}return m(t,e),t}(Fh),Hh=o((function(e){function t(n,r,i){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=t=Reflect.get:e.exports=t=function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}},t(n,r,i||n)}e.exports=t})),Wh=function(e){function t(e,n,r,i,o,a){var s;return h(this,t),(s=d(this,f(t).call(this,Fh.Type.STRAND,n,r))).sheet=e,s.sense=i,s.atomCur=o,s.atomPrev=a,s}return m(t,e),Tc(t,[{key:"_finalize",value:function(e,n,r){Hh(f(t.prototype),"_finalize",this).call(this,e,n,r);var i=this.atomCur;null===i||Number.isNaN(i)||(this.atomCur=e[i]),null===(i=this.atomPrev)||Number.isNaN(i)||(this.atomPrev=e[i])}}]),t}(Fh),qh=function(){function e(t,n){h(this,e),this._name=t,this._width=n,this._strands=[]}return Tc(e,[{key:"getName",value:function(){return this._name}},{key:"getWidth",value:function(){return this._width}},{key:"addStrand",value:function(e){this._strands.push(e),this._width=this._strands.length}},{key:"addEmptyStrand",value:function(){this._strands.push(new Wh(null,null,null,null,null,null))}},{key:"_finalize",value:function(e,t,n){for(var r=this._strands,i=0,o=r.length;i<o;++i)r[i]._finalize(e,t,n);if(this._width||(this._width=r.length),r.length!==this._width)throw new Error("Sheet ".concat(this._name," is inconsistent."))}}]),e}(),Yh=function(){function e(t,n,r,i,o){h(this,e),this._id=t,this._name=n,this._position=r||new E,this._atoms=i||[],this._charge=0,this._repeat=1,this._center=null,this.xmlNodeRef=o||null}return Tc(e,[{key:"getName",value:function(){return this._name}},{key:"getPosition",value:function(){return this._position}},{key:"getCentralPoint",value:function(){return this._center}},{key:"_rebuildSGroupOnAtomChange",value:function(){if(null!==this._center){for(var e=new E(1e8,1e8,1e8),t=new E(-1e8,-1e8,-1e8),n=0,r=this._atoms.length;n<r;n++){var i=this._atoms[n].getPosition();e.set(Math.min(e.x,i.x),Math.min(e.y,i.y),Math.min(e.z,i.z)),t.set(Math.max(t.x,i.x),Math.max(t.y,i.y),Math.max(t.z,i.z))}this._center.addVectors(e,t),this._center.multiplyScalar(.5)}}},{key:"buildChemicalFormula",value:function(e,t){var n=0,r=0,i=e._buildFormulaSimple(t,(function(e,t){r=e,n=t})),o=this._charge+n;return 0!==o?(this._repeat>1?i=r>1?"".concat(this._repeat.toString(),"(").concat(i,")"):this._repeat.toString()+i:r>1&&(i="(".concat(i,")")),o>1&&(i+="^".concat(o.toString(),"+")),1===o&&(i+="^+"),o<-1&&(i+="^".concat(Math.abs(o).toString(),"-")),-1===o&&(i+="^-")):this._repeat>1&&(i=this._repeat.toString()+i),i}}]),e}(),Xh=function(){var e=function(e,t,n,r){for(n=n||{},r=e.length;r--;n[e[r]]=t);return n},t=[1,4],n=[1,5],r=[1,6],i=[1,7],o=[1,8],a=[1,9],s=[1,11],l=[1,12],u=[5,7,8,11],c=[1,17],h=[1,22],d=[1,20],f=[1,21],p=[5,7,8,11,19],m={trace:function(){},yy:{},symbols_:{error:2,Program:3,Expression:4,EOF:5,Selector:6,OR:7,AND:8,NOT:9,"(":10,")":11,SELECTOR:12,NAMED_SELECTOR:13,SELECTOR_RANGED:14,RangeList:15,SELECTOR_NAMED:16,NameList:17,Range:18,",":19,NUMBER:20,":":21,Name:22,IDENTIFIER:23,STRING:24,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"OR",8:"AND",9:"NOT",10:"(",11:")",12:"SELECTOR",13:"NAMED_SELECTOR",14:"SELECTOR_RANGED",16:"SELECTOR_NAMED",19:",",20:"NUMBER",21:":",23:"IDENTIFIER",24:"STRING"},productions_:[0,[3,2],[4,1],[4,3],[4,3],[4,2],[4,3],[6,1],[6,1],[6,2],[6,2],[15,1],[15,3],[18,1],[18,3],[17,1],[17,3],[22,1],[22,1],[22,1]],performAction:function(e,t,n,r,i,o,a){var s=o.length-1;switch(i){case 1:return o[s-1];case 3:this.$=r.keyword("or")(o[s-2],o[s]);break;case 4:this.$=r.keyword("and")(o[s-2],o[s]);break;case 5:this.$=r.keyword("not")(o[s]);break;case 6:this.$=o[s-1];break;case 7:this.$=r.keyword(o[s])();break;case 8:this.$=r.GetSelector(o[s].toLowerCase().slice(1,o[s].length));break;case 9:case 10:this.$=r.keyword(o[s-1])(o[s]);break;case 11:this.$=new r.RangeList(o[s]);break;case 12:case 16:this.$=o[s-2].append(o[s]);break;case 13:this.$=new r.Range(Number(o[s]));break;case 14:this.$=new r.Range(Number(o[s-2]),Number(o[s]));break;case 15:this.$=new r.ValueList(o[s])}},table:[{3:1,4:2,6:3,9:t,10:n,12:r,13:i,14:o,16:a},{1:[3]},{5:[1,10],7:s,8:l},e(u,[2,2]),{4:13,6:3,9:t,10:n,12:r,13:i,14:o,16:a},{4:14,6:3,9:t,10:n,12:r,13:i,14:o,16:a},e(u,[2,7]),e(u,[2,8]),{15:15,18:16,20:c},{17:18,20:h,22:19,23:d,24:f},{1:[2,1]},{4:23,6:3,9:t,10:n,12:r,13:i,14:o,16:a},{4:24,6:3,9:t,10:n,12:r,13:i,14:o,16:a},e(u,[2,5]),{7:s,8:l,11:[1,25]},e(u,[2,9],{19:[1,26]}),e(p,[2,11]),e(p,[2,13],{21:[1,27]}),e(u,[2,10],{19:[1,28]}),e(p,[2,15]),e(p,[2,17]),e(p,[2,18]),e(p,[2,19]),e([5,7,11],[2,3],{8:l}),e(u,[2,4]),e(u,[2,6]),{18:29,20:c},{20:[1,30]},{20:h,22:31,23:d,24:f},e(p,[2,12]),e(p,[2,14]),e(p,[2,16])],defaultActions:{10:[2,1]},parseError:function(e,t){if(!t.recoverable){var n=new Error(e);throw n.hash=t,n}this.trace(e)},parse:function(e){var t=this,n=[0],r=[],i=[null],o=[],a=this.table,s="",l=0,u=0,c=2,h=1,d=o.slice.call(arguments,1),f=Object.create(this.lexer),p={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(p.yy[m]=this.yy[m]);f.setInput(e,p.yy),p.yy.lexer=f,p.yy.parser=this,void 0===f.yylloc&&(f.yylloc={});var v=f.yylloc;o.push(v);var g=f.options&&f.options.ranges;function y(){var e;return"number"!=typeof(e=r.pop()||f.lex()||h)&&(e instanceof Array&&(e=(r=e).pop()),e=t.symbols_[e]||e),e}"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var _,x,b,w,S,E,T,M,C={};;){if(x=n[n.length-1],this.defaultActions[x]?b=this.defaultActions[x]:(null==_&&(_=y()),b=a[x]&&a[x][_]),void 0===b||!b.length||!b[0]){var A="";for(S in M=[],a[x])this.terminals_[S]&&S>c&&M.push("'"+this.terminals_[S]+"'");A=f.showPosition?"Parse error on line "+(l+1)+":\n"+f.showPosition()+"\nExpecting "+M.join(", ")+", got '"+(this.terminals_[_]||_)+"'":"Parse error on line "+(l+1)+": Unexpected "+(_==h?"end of input":"'"+(this.terminals_[_]||_)+"'"),this.parseError(A,{text:f.match,token:this.terminals_[_]||_,line:f.yylineno,loc:v,expected:M})}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+_);switch(b[0]){case 1:n.push(_),i.push(f.yytext),o.push(f.yylloc),n.push(b[1]),_=null,u=f.yyleng,s=f.yytext,l=f.yylineno,v=f.yylloc;break;case 2:if(E=this.productions_[b[1]][1],C.$=i[i.length-E],C._$={first_line:o[o.length-(E||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(E||1)].first_column,last_column:o[o.length-1].last_column},g&&(C._$.range=[o[o.length-(E||1)].range[0],o[o.length-1].range[1]]),void 0!==(w=this.performAction.apply(C,[s,u,l,p.yy,b[1],i,o].concat(d))))return w;E&&(n=n.slice(0,-1*E*2),i=i.slice(0,-1*E),o=o.slice(0,-1*E)),n.push(this.productions_[b[1]][0]),i.push(C.$),o.push(C._$),T=a[n[n.length-2]][n[n.length-1]],n.push(T);break;case 3:return!0}}return!0}},v={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,r,i;if(this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(i.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var o in i)this[o]=i[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,n,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),o=0;o<i.length;o++)if((n=this._input.match(this.rules[i[o]]))&&(!t||n[0].length>t[0].length)){if(t=n,r=o,this.options.backtrack_lexer){if(!1!==(e=this.test_match(n,i[o])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,i[r]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{"case-insensitive":!0},performAction:function(e,t,n,r){switch(n){case 0:break;case 1:return 20;case 2:return 7;case 3:return 8;case 4:return 9;case 5:return 12;case 6:return 16;case 7:return 14;case 8:return 10;case 9:return 11;case 10:return 19;case 11:return 21;case 12:return"<=";case 13:return">=";case 14:return"<";case 15:return">";case 16:return t.yytext=t.yytext.substr(1,t.yyleng-2),24;case 17:return 13;case 18:return 23;case 19:return 5;case 20:return"INVALID"}},rules:[/^(?:\s+)/i,/^(?:(-?(?:[1-9][0-9]+|[0-9]))\b)/i,/^(?:OR\b)/i,/^(?:AND\b)/i,/^(?:NOT\b)/i,/^(?:((ALL|NONE|HETATM|PROTEIN|BASIC|ACIDIC|CHARGED|POLAR|NONPOLAR|AROMATIC|NUCLEIC|PURINE|PYRIMIDINE|WATER|POLARH|NONPOLARH))\b)/i,/^(?:((NAME|ELEM|TYPE|RESIDUE|ICODE|CHAIN|ALTLOC))\b)/i,/^(?:((SERIAL|SEQUENCE|RESIDX))\b)/i,/^(?:\()/i,/^(?:\))/i,/^(?:,)/i,/^(?::)/i,/^(?:<=)/i,/^(?:>=)/i,/^(?:<)/i,/^(?:>)/i,/^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i,/^(?:(@[_A-Z0-9]+))/i,/^(?:([_A-Z0-9]+))/i,/^(?:$)/i,/^(?:.)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],inclusive:!0}}};function g(){this.yy={}}return m.lexer=v,g.prototype=m,m.Parser=g,new g}(),Zh=function(){function e(t,n){h(this,e),this.min=t,this.max=void 0===n?t:n}return Tc(e,[{key:"includes",value:function(e){return this.min<=e&&e<=this.max}},{key:"toString",value:function(){var e=this.min,t=this.max;return e===t?String(e):[e,t].join(":")}},{key:"toJSON",value:function(){return[this.min,this.max]}}]),e}(),$h=function(){function e(t){if(h(this,e),t instanceof this.constructor)return t;this._values=t instanceof Array?t.slice(0):t?[t]:[]}return Tc(e,[{key:"append",value:function(e){var t=this._values;return t[t.length]=e,this}},{key:"remove",value:function(e){var t=this._values,n=t.indexOf(e);return n>=0&&t.splice(n,1),this}},{key:"toString",value:function(){return this._values.join(",")}},{key:"toJSON",value:function(){for(var e=this._values,t=[],n=0,r=e.length;n<r;++n){var i=e[n];t[n]=i.toJSON?i.toJSON():i}return t}}]),e}(),Kh=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includes",value:function(e){for(var t=this._values,n=0,r=t.length;n<r;++n)if(t[n].includes(e))return!0;return!1}}]),t}($h),Jh=[],Qh=function(e){function t(e,n){var r;h(this,t);var i=r=d(this,f(t).call(this,e));if(n){r.upperOnly=!0;for(var o=i._values,a=0,s=o.length;a<s;++a){var l=o[a];"string"==typeof l&&(o[a]=l.toUpperCase())}}else r.upperOnly=!1;return d(r,i)}return m(t,e),Tc(t,[{key:"includes",value:function(e){return-1!==this._values.indexOf(e)}},{key:"toString",value:function(){var e=this._values;Jh.length=0;for(var t=0,n=e.length;t<n;++t)Jh[t]=$c.correctSelectorIdentifier(String(e[t]));return Jh.join(",")}},{key:"_validate",value:function(e){return this.upperOnly&&"string"==typeof e?e.toUpperCase():e}},{key:"append",value:function(e){return Hh(f(t.prototype),"append",this).call(this,this._validate(e)),this}},{key:"remove",value:function(e){return Hh(f(t.prototype),"remove",this).call(this,this._validate(e)),this}}]),t}($h),ed=function(){function e(){h(this,e)}return Tc(e,[{key:"toString",value:function(){return this.keyword}},{key:"toJSON",value:function(){return[this.name]}}]),e}();ed.prototype.name="Error",ed.prototype.keyword="error";var td=function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this))).list=e,n}return m(t,e),Tc(t,[{key:"toString",value:function(){return"".concat(this.keyword," ").concat(this.list)}},{key:"toJSON",value:function(){return[this.name,this.list.toJSON()]}}]),t}(ed),nd=function(e){function t(e){return h(this,t),d(this,f(t).call(this,new Kh(e)))}return m(t,e),t}(td),rd=function(e){function t(e,n){return h(this,t),d(this,f(t).call(this,new Qh(e,!n)))}return m(t,e),t}(td),id=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return!1}}]),t}(ed);id.prototype.name="None",id.prototype.keyword="none";var od=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return!0}}]),t}(ed);od.prototype.name="All",od.prototype.keyword="all";var ad=new id,sd=function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this))).rhs=e||ad,n}return m(t,e),Tc(t,[{key:"toString",value:function(){var e=this.rhs.priority&&this.rhs.priority>this.priority?"(".concat(this.rhs,")"):this.rhs;return"".concat(this.keyword," ").concat(e)}},{key:"toJSON",value:function(){return[this.name,this.rhs.toJSON()]}}]),t}(ed);sd.prototype.priority=1;var ld=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this))).lhs=e||ad,r.rhs=n||ad,r}return m(t,e),Tc(t,[{key:"toString",value:function(){var e=this.lhs.priority&&this.lhs.priority>this.priority?"(".concat(this.lhs,")"):this.lhs,t=this.rhs.priority&&this.rhs.priority>this.priority?"(".concat(this.rhs,")"):this.rhs;return"".concat(e," ").concat(this.keyword," ").concat(t)}},{key:"toJSON",value:function(){return[this.name,this.lhs.toJSON(),this.rhs.toJSON()]}}]),t}(ed);ld.prototype.priority=1e3;var ud={};function cd(e,t){var n=e.toLowerCase();t.prototype.keyword=n,t.prototype.name=e;var r=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Pc(t,n)};return r.SelectorClass=t,ud[n]=r,t}cd("Serial",function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return this.list.includes(e._serial)}}]),t}(nd)),cd("Name",function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return this.list.includes(e._name.getString())}}]),t}(rd)),cd("AltLoc",function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return this.list.includes(String.fromCharCode(e._location))}}]),t}(rd)),cd("Elem",function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return this.list.includes(e.element.name)}}]),t}(rd)),cd("Residue",function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return this.list.includes(e._residue._type._name)}}]),t}(rd)),cd("Sequence",function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return this.list.includes(e._residue._sequence)}}]),t}(nd)),cd("ICode",function(e){function t(e){return h(this,t),d(this,f(t).call(this,e,!0))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return this.list.includes(e._residue._icode)}}]),t}(rd)),cd("ResIdx",function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return this.list.includes(e._residue._index)}}]),t}(nd)),cd("Chain",function(e){function t(e){return h(this,t),d(this,f(t).call(this,e,!0))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return this.list.includes(e._residue._chain._name)}}]),t}(rd)),cd("Hetatm",function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return e._het}}]),t}(ed)),cd("PolarH",function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return(e.flags&wh.Flags.NONPOLARH)===wh.Flags.HYDROGEN}}]),t}(ed)),cd("NonPolarH",function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return(e.flags&wh.Flags.NONPOLARH)===wh.Flags.NONPOLARH}}]),t}(ed)),cd("All",od),cd("None",id);var hd=ud.none();function dd(e,t,n){return n.prototype.priority=t,cd(e,n)}function fd(e,t){return cd(t,function(t){function n(){return h(this,n),d(this,f(n).apply(this,arguments))}return m(n,t),Tc(n,[{key:"includesAtom",value:function(t){return 0!=(t._residue._type.flags&e)}}]),n}(ed))}dd("Not",1,function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return!this.rhs.includesAtom(e)}}]),t}(sd)),dd("And",2,function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return this.lhs.includesAtom(e)&&this.rhs.includesAtom(e)}}]),t}(ld)),dd("Or",3,function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"includesAtom",value:function(e){return this.lhs.includesAtom(e)||this.rhs.includesAtom(e)}}]),t}(ld)),fd(Nh.Flags.PROTEIN,"Protein"),fd(Nh.Flags.BASIC,"Basic"),fd(Nh.Flags.ACIDIC,"Acidic"),fd(Nh.Flags.BASIC|Nh.Flags.ACIDIC,"Charged"),fd(Nh.Flags.POLAR,"Polar"),fd(Nh.Flags.NONPOLAR,"NonPolar"),fd(Nh.Flags.AROMATIC,"Aromatic"),fd(Nh.Flags.NUCLEIC,"Nucleic"),fd(Nh.Flags.PURINE,"Purine"),fd(Nh.Flags.PYRIMIDINE,"Pyrimidine"),fd(Nh.Flags.WATER,"Water");var pd=Object.create(ud);pd.Selector=ed,pd.RangeListSelector=nd,pd.ValueListSelector=rd,pd.Range=Zh,pd.RangeList=Kh,pd.ValueList=Qh,pd.PrefixOperator=sd,pd.InfixOperator=ld,pd.Context=Object.create({}),pd.GetSelector=function(e){if(!pd.Context.hasOwnProperty(e))throw{message:"selector ".concat(e," is not registered")};return pd.Context[e]||hd},pd.ClearContext=function(){Object.keys(pd.Context).forEach((function(e){delete pd.Context[e]}))},pd.keyword=function(e){return ud[e.toLowerCase()]||ud.none},pd.parse=function(e){var t={};try{t.selector=Xh.parse(e)}catch(e){t.selector=hd,t.error=e.message}return t},Xh.yy=pd,Xh.yy.parseError=Xh.parseError;var md=function(){function e(t){h(this,e),this._complex=t,this._selector=pd.keyword("All")(),this._boundaries={boundingBox:new xe,boundingSphere:new Se}}return Tc(e,[{key:"computeBoundaries",value:function(){var e=this._complex._atoms,t=e.length,n=this._selector,r=this._boundaries.boundingBox;if(r.makeEmpty(),1===t){r.expandByPoint(e[0]._position);var i=new E;r.getCenter(i);var o=2*e[0].element.radius;r.setFromCenterAndSize(i,new E(o,o,o))}else for(var a=0;a<t;++a)n.includesAtom(e[a])&&r.expandByPoint(e[a]._position);var s=0,l=new E;if(r.getCenter(l),1===t)this._boundaries.boundingSphere.set(l,e[0].element.radius);else{for(var u=0;u<t;++u)if(n.includesAtom(e[u])){var c=e[u]._position,h=l.distanceToSquared(c);s<h&&(s=h)}this._boundaries.boundingSphere.set(l,Math.sqrt(s))}}},{key:"getTransforms",value:function(){return[]}},{key:"getSelector",value:function(){return this._selector}},{key:"getBoundaries",value:function(){return this._boundaries}},{key:"finalize",value:function(){}}]),e}(),vd=function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this,e))).chains=[],n.matrices=[],n}return m(t,e),Tc(t,[{key:"computeBoundaries",value:function(){Hh(f(t.prototype),"computeBoundaries",this).call(this);var e=this.matrices,n=this._boundaries.boundingSphere.center,r=this._boundaries.boundingSphere.radius,i=this._boundaries.boundingBox=new xe;i.makeEmpty();for(var o=0,a=e.length;o<a;++o)i.expandByPoint(n.clone().applyMatrix4(e[o]));var s=i.max.distanceTo(i.min)/2+r,l=new E;i.getCenter(l),this._boundaries.boundingSphere=(new Se).set(l,s),i.max.addScalar(r),i.min.subScalar(r)}},{key:"addChain",value:function(e){this.chains[this.chains.length]=e}},{key:"addMatrix",value:function(e){this.matrices[this.matrices.length]=e}},{key:"getTransforms",value:function(){return this.matrices}},{key:"finalize",value:function(){this.chains.length>0?this._selector=pd.keyword("Chain")(this.chains):this._selector=pd.keyword("None")()}}]),t}(md),gd=function(){function e(t){h(this,e),this._complex=t,this._index=-1,this._residueIndices=[],this._cycles=[],this._subDivs=[],this._residueCount=0}return Tc(e,[{key:"getResidues",value:function(){return this._complex._residues}},{key:"getResidueCount",value:function(){return this._residueCount}},{key:"forEachResidue",value:function(e){for(var t=this._complex._residues,n=this._residueIndices,r=0,i=n.length;r<i;++r)for(var o=n[r].start,a=n[r].end;o<=a;++o)e(t[o])}},{key:"setSubDivs",value:function(e){this._subDivs=e;for(var t=0,n=[],r=0,i=0,o=e.length;i<o;++i)if(i===o-1||e[i].end+1!==e[i+1].start){var a=e[t].start,s=e[i].end;n[n.length]={start:a,end:s},r+=s-a+1,t=i+1}this._residueIndices=n,this._residueCount=r}},{key:"getComplex",value:function(){return this._complex}},{key:"forEachBond",value:function(e){for(var t=this._complex._bonds,n=0,r=t.length;n<r;++n){var i=t[n];i._left._residue._component===this&&e(i)}}},{key:"update",value:function(){this.forEachCycle((function(e){e.update()}))}},{key:"forEachAtom",value:function(e){this.forEachResidue((function(t){t.forEachAtom(e)}))}},{key:"addCycle",value:function(e){this._cycles.push(e)}},{key:"forEachCycle",value:function(e){for(var t=this._cycles,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"markResidues",value:function(){var e=this;e.forEachResidue((function(t){t._component=e}))}},{key:"_forEachSubChain",value:function(e,t){for(var n=this._complex._residues,r=this._subDivs,i=0,o=r.length;i<o;++i)for(var a=r[i].start,s=r[i].end;a<=s;++a){var l=n[a];if(e&l._mask&&l._isValid){for(var u=a+1;u<=s;++u){var c=n[u];if(!(e&c._mask&&c._isValid))break}t(i,a,u-1),a=u}}}},{key:"getMaskedSequences",value:function(e){var t=[],n=0;return this._forEachSubChain(e,(function(e,r,i){t[n++]={start:r,end:i}})),t}},{key:"getMaskedSubdivSequences",value:function(e){var t=[],n=-1,r=-1,i=this._subDivs;return this._forEachSubChain(e,(function(e,o,a){r!==e&&(++n,t[n]={arr:[],boundaries:i[e]},r=e),t[n].arr[t[n].arr.length]={start:o,end:a}})),t}}]),e}(),yd=function(){function e(t){h(this,e),this.numPairs=0,this.numMaxPairs=t,this.intBuffer=$c.allocateTyped(Int32Array,4*t);for(var n=0;n<4*t;n++)this.intBuffer[n]=-1;this.hashBuffer=$c.allocateTyped(Int32Array,33554432);for(var r=0;r<33554432;r++)this.hashBuffer[r]=-1}return Tc(e,[{key:"destroy",value:function(){this.intBuffer=null,this.hashBuffer=null}},{key:"addPair",value:function(e,t){for(var n=e<t?e:t,r=e>t?e:t,i=n+(r<<14),o=32*(n+89237*r&1048575),a=0;a<32;a++){var s=this.hashBuffer[o+a];if(-1===s)break;if(s===i)return!1}if(a>=32)throw new Error("addPair: increase cMaxPairsForHashCode");if(this.hashBuffer[o+a]=i,this.numPairs>=this.numMaxPairs)throw new Error("addPair: increase num pairs");return o=4*this.numPairs,this.intBuffer[o]=n,this.intBuffer[o+1]=r,this.intBuffer[o+2]=i,this.numPairs++,!0}}]),e}();function _d(e){var t=e.element;if(t)return t.radiusBonding;throw new Error("_getBondingRadius: Logic error.")}var xd,bd,wd,Sd=function(){function e(t){h(this,e),this._complex=t,this._maxRad=1.8;var n=this._complex.getDefaultBoundaries().boundingBox;this._vBoxMin=n.min.clone(),this._vBoxMax=n.max.clone(),this._pairCollection=null}return Tc(e,[{key:"_addExistingPairs",value:function(){for(var e=this._complex.getAtoms(),t=e.length,n=0,r=this._pairCollection;n<t;n++)for(var i=e[n]._bonds,o=i.length,a=0;a<o;a++){var s=i[a];s._left._index===n&&r.addPair(n,s._right._index)}return 0}},{key:"_findPairs",value:function(){var e=this._complex.getVoxelWorld();if(null!==e)for(var t,n,r,i,o,a,s=this._complex._atoms,l=s.length,u=this,c=function(e){if(!n||!e.isHydrogen()){var a=e.getLocation();if(32===i||32===a||i===a){var s=r.distanceToSquared(e._position),l=e.element.radiusBonding,c=t+l+.45;s>c*c||s<.001||u._pairCollection.addPair(o._index,e._index)}}},h=0;h<l;++h)(!(a=o=s[h]).isHet()||a._bonds&&0===a._bonds.length)&&(t=o.element.radiusBonding,n=o.isHydrogen(),r=o._position,i=o.getLocation(),e.forEachAtomWithinRadius(r,2*this._maxRad+.45,c))}},{key:"_addPairs",value:function(){for(var e=this._complex._atoms,t=0,n=0;t<this._pairCollection.numPairs;t++,n+=4){var r=this._pairCollection.intBuffer[n],i=this._pairCollection.intBuffer[n+1];this._addPair(e[r],e[i])}}},{key:"_addPair",value:function(e,t){for(var n=e._bonds,r=e._index,i=t._index,o=0,a=n.length;o<a;++o){var s=n[o];if(s._left._index===i||s._right._index===i)return}var l=r<i?e:t,u=r<i?t:e,c=this._complex.addBond(l,u,0,Mh.BondType.UNKNOWN,!1);n.push(c),t.getBonds().push(c)}},{key:"build",value:function(){this._buildInner()}},{key:"_buildInner",value:function(){var e=this._complex._atoms;if(!(e.length<2)){if(e[0]._index<0)throw new Error("AutoBond: Atoms in complex were not indexed.");this._calcBoundingBox(),this._pairCollection=new yd(4*e.length),this._addExistingPairs(),this._findPairs(),this._addPairs()}}},{key:"_calcBoundingBox",value:function(){for(var e=this._complex._atoms,t=e.length,n=_d(e[0]),r=1;r<t;++r)n=Math.max(n,_d(e[r]));this._vBoxMax.addScalar(n),this._vBoxMin.addScalar(-n),this._maxRad=1.2*n}},{key:"destroy",value:function(){this._pairCollection&&this._pairCollection.destroy()}}]),e}(),Ed=Mh.BondType.AROMATIC,Td=[Sh.ByName.C.number,Sh.ByName.N.number],Md=(xd=new E,bd=new E,wd=new E,function(e,t){return xd.copy(e).normalize(),bd.copy(t).normalize(),wd.crossVectors(xd,bd),!(wd.length()>.1)&&xd.dot(bd)>=0});function Cd(e,t){for(var n=0;n<e.length&&e[n]<t;)++n;e.splice(n,0,t)}function Ad(e,t){return e._left===t?e._right:e._left}function Rd(e){e._type=Ed}var Pd=function(){function e(t){h(this,e),this.atoms=t,this.update()}return Tc(e,[{key:"update",value:function(){for(var e=this.atoms,t=new E,n=e.length,r=0;r<n;++r)t.add(e[r]._position);t.multiplyScalar(1/n),this.center=t,this.radius=t.distanceTo(e[0]._position.clone().lerp(e[1]._position,.5))}},{key:"forEachBond",value:function(e){var t,n=this.atoms,r=n.length,i=n[0];function o(n){n._left!==t&&n._right!==t||e(n)}for(var a=0;a<r;++a)t=n[(a+1)%r],i.forEachBond(o),i=t}}]),e}();function kd(e){return e._type===Ed}function Ld(e){if(e.type===Ed)return!0;var t=Td.indexOf(e._right.element.number),n=Td.indexOf(e._left.element.number);return-1!==t&&-1!==n}function Nd(e){return e.length>3}function Id(e){return console.assert(e.length>2),!0}var Od=function(){function e(t){h(this,e),this._complex=t;for(var n=new Array(t._bonds.length),r=new Array(t._bonds.length),i=0,o=n.length;i<o;++i)n[i]=[],r[i]=!1;this._bondsData=n,this._bondMarks=r,this._resetCycles()}return Tc(e,[{key:"_resetCycles",value:function(){this._cycles=[],this._currIdx=-1}},{key:"_haveSameCycle",value:function(e,t,n){for(var r=e[t._index],i=e[n._index],o=r.length,a=i.length,s=0,l=0;s<o&&l<a;){if(r[s]===i[l])return!0;r[s]>i[l]?++l:++s}return!1}},{key:"_tryBond",value:function(e,t,n){var r=[],i=this._bondsData,o=Ad(e,t),a=t._position.clone().sub(o._position),s=this._currStart,l=this,u=this._bondMarks,c=this._checkBond;u[e._index]=!0,c=void 0===c?kd:c,t.forEachBond((function(o){if(c(o)&&o!==e&&!u[o._index]&&!l._haveSameCycle(i,e,o)){var h,d,f,p=Ad(o,t),m=p._position.clone().sub(t._position),v=p===s?-2:1-(d=m,f=(h=a).dot(d)/Math.sqrt(h.lengthSq()*d.lengthSq()),_.clamp(f,-1,1)),g=m.cross(a);if(Md(g,n)){for(var y=0;y<r.length&&r[y].val<v;)++y;r.splice(y,0,{bond:o,val:v,dir:g})}}}));for(var h=0,d=r.length;h<d;++h){var f=r[h].bond,p=f._left===t?f._right:f._left;if(p===s)return++this._currIdx,this._cycles.push([t]),u[e._index]=!1,!0;if(this._tryBond(f,p,r[h].dir))return Cd(i[f._index],this._currIdx),this._cycles[this._currIdx].push(t),u[e._index]=!1,!0}return u[e._index]=!1,!1}},{key:"_startCycle",value:function(e){this._currStart=e._left,this._tryBond(e,e._right,new E)&&(Cd(this._bondsData[e._index],this._currIdx),this._cycles[this._currIdx].push(e._left))}},{key:"_findLoops",value:function(e,t){this._checkBond=e;var n=this._complex,r=this;n.forEachComponent((function(n){r._resetCycles(),n.forEachBond((function(t){e(t)&&r._startCycle(t)}));for(var i=r._cycles,o=0,a=i.length;o<a;++o){var s=i[o];if(t(s)){var l=new Pd(s);l.forEachBond(Rd),n.addCycle(l)}}}))}},{key:"markCycles",value:function(){this._findLoops(kd,Nd)}},{key:"detectCycles",value:function(){this._findLoops(Ld,Id)}}]),e}();function Dd(e,t,n,r){var i=n-e.z,o=r-e.z,a=Math.sqrt(Math.max(t*t-i*i,0)),s=Math.sqrt(Math.max(t*t-o*o,0));return[Math.min(a,s),n<=e.z&&r>=e.z?t:Math.max(a,s)]}function zd(e,t,n,r){var i=n-e.y,o=r-e.y,a=Math.sqrt(Math.max(t*t-i*i,0)),s=Math.sqrt(Math.max(t*t-o*o,0));return[Math.min(a,s),n<=e.y&&r>=e.y?t:Math.max(a,s)]}var Fd=function(){function e(t,n){h(this,e),this._box=t.clone();var r=new E;t.getSize(r),this._count=r.clone().divide(n).floor().max(new E(1,1,1)),this._last=this._count.clone().subScalar(1),this._cellSize=r.clone().divide(this._count),this._cellInnerR=.5*Math.min(Math.min(this._cellSize.x,this._cellSize.y),this._cellSize.z),this._cellOuterR=.5*Math.sqrt(this._cellSize.dot(this._cellSize));var i=this._count.x*this._count.y*this._count.z;this._voxels=$c.allocateTyped(Int32Array,i);for(var o=0;o<i;++o)this._voxels[o]=-1;this._atoms=[]}return Tc(e,[{key:"addAtoms",value:function(e){var t=this,n=this._atoms.length;this._atoms.length+=2*e.getAtomCount(),e.forEachAtom((function(e){var r=t._findVoxel(e._position);t._atoms[n]=e,t._atoms[n+1]=t._voxels[r],t._voxels[r]=n,n+=2}))}},{key:"_findVoxel",value:function(t){var n=e._zero,r=e._voxel;return r.copy(t).sub(this._box.min).divide(this._cellSize).floor().clamp(n,this._last),r.x+this._count.x*(r.y+this._count.y*r.z)}},{key:"_forEachAtomInVoxel",value:function(e,t){for(var n=this._voxels[e];n>=0;n=this._atoms[n+1])t(this._atoms[n])}},{key:"_forEachVoxelWithinRadius",value:function(t,n,r){var i=e._xRange,o=e._yRange,a=e._zRange;if(n/this._cellInnerR<10)this._forEachVoxelWithinRadiusSimple(t,n,r);else{var s,l,u,c,h,d,f,p;a.set(t.z-n,t.z+n),a.subScalar(this._box.min.z).divideScalar(this._cellSize.z).floor().clampScalar(0,this._count.z-1);for(var m=a.x;m<=a.y;++m){h=[this._box.min.z+m*this._cellSize.z,this._box.min.z+(m+1)*this._cellSize.z],p=t.z-n<=h[0]&&h[1]<=t.z+n,s=Dd(t,n,h[0],h[1]),o.set(t.y-s[1],t.y+s[1]),o.subScalar(this._box.min.y).divideScalar(this._cellSize.y).floor().clampScalar(0,this._count.y-1);for(var v=o.x;v<=o.y;++v){c=[this._box.min.y+v*this._cellSize.y,this._box.min.y+(v+1)*this._cellSize.y],f=t.y-s[0]<=c[0]&&c[1]<=t.y+s[0],l=zd(t,s[1],c[0],c[1]),i.set(t.x-l[1],t.x+l[1]),i.subScalar(this._box.min.x).divideScalar(this._cellSize.x).floor().clampScalar(0,this._count.x-1);for(var g=i.x;g<=i.y;++g)u=[this._box.min.x+g*this._cellSize.x,this._box.min.x+(g+1)*this._cellSize.x],d=t.x-l[0]<=u[0]&&u[1]<=t.x+l[0],r(g+this._count.x*(v+this._count.y*m),d&&f&&p)}}}}},{key:"_forEachVoxelWithinRadiusSimple",value:function(t,n,r){var i=e._xRange,o=e._yRange,a=e._zRange,s=e._vCenter,l=(n+this._cellOuterR)*(n+this._cellOuterR),u=-1;n>this._cellOuterR&&(u=(n-this._cellOuterR)*(n-this._cellOuterR)),i.set(t.x-n,t.x+n),i.subScalar(this._box.min.x).divideScalar(this._cellSize.x).floor(),i.x=Math.min(Math.max(i.x,0),this._count.x-1),i.y=Math.min(Math.max(i.y,0),this._count.x-1),o.set(t.y-n,t.y+n),o.subScalar(this._box.min.y).divideScalar(this._cellSize.y).floor(),o.x=Math.min(Math.max(o.x,0),this._count.y-1),o.y=Math.min(Math.max(o.y,0),this._count.y-1),a.set(t.z-n,t.z+n),a.subScalar(this._box.min.z).divideScalar(this._cellSize.z).floor(),a.x=Math.min(Math.max(a.x,0),this._count.z-1),a.y=Math.min(Math.max(a.y,0),this._count.z-1);for(var c=a.x;c<=a.y;++c){var h=[this._box.min.z+c*this._cellSize.z,this._box.min.z+(c+1)*this._cellSize.z];s.z=.5*(h[0]+h[1]);for(var d=o.x;d<=o.y;++d){var f=[this._box.min.y+d*this._cellSize.y,this._box.min.y+(d+1)*this._cellSize.y];s.y=.5*(f[0]+f[1]);for(var p=i.x;p<=i.y;++p){var m=[this._box.min.x+p*this._cellSize.x,this._box.min.x+(p+1)*this._cellSize.x];s.x=.5*(m[0]+m[1]);var v=t.distanceToSquared(s);v<=l&&r(p+this._count.x*(d+this._count.y*c),v<=u)}}}}},{key:"forEachAtomWithinRadius",value:function(e,t,n){var r=this,i=t*t;r._forEachVoxelWithinRadius(e,t,(function(t,o){o?r._forEachAtomInVoxel(t,n):r._forEachAtomInVoxel(t,(function(t){e.distanceToSquared(t._position)<=i&&n(t)}))}))}},{key:"forEachAtomWithinDistFromMasked",value:function(e,t,n,r){this._forEachAtomWithinDistFromGroup((function(n){e.forEachAtom((function(e){0!=(e._mask&t)&&n(e)}))}),n,r)}},{key:"forEachAtomWithinDistFromSelected",value:function(e,t,n,r){this._forEachAtomWithinDistFromGroup((function(n){e.forEachAtom((function(e){t.includesAtom(e)&&n(e)}))}),n,r)}},{key:"_forEachAtomWithinDistFromGroup",value:function(e,t,n){var r,i=this,o=t*t,a=[],s=[],l=0;e((function(e){i._forEachVoxelWithinRadius(e._position,t,(function(t,n){n?a[t]=-1:void 0===a[t]?(s.push(e),s.push(-1),a[t]=l,l+=2):-1!==a[t]&&(s.push(e),s.push(a[t]),a[t]=l,l+=2)}))}));var u=function(e){if(void 0!==a[r])if(-1!==(l=a[r])){for(;l>=0;l=s[l+1])if(e._position.distanceToSquared(s[l]._position)<o){n(e);break}}else n(e)};for(r in a)a.hasOwnProperty(r)&&i._forEachAtomInVoxel(r,u)}}]),e}();u(Fd,"_zero",new E(0,0,0)),u(Fd,"_voxel",new E),u(Fd,"_xRange",new x),u(Fd,"_yRange",new x),u(Fd,"_zRange",new x),u(Fd,"_vCenter",new E);var Bd,Ud,Vd=function(){function e(t){h(this,e),this._complex=t,this._hbonds=[],this._complex._residues.length>1e3?this._buildVW():this._build()}return Tc(e,[{key:"isBond",value:function(e,t){if(this._hbonds[e]){var n=r(this._hbonds[e].acceptor,2),i=n[0],o=n[1];if(i&&i.residue===t&&i.energy<-.5)return!0;if(o&&o.residue===t&&o.energy<-.5)return!0}return!1}},{key:"_build",value:function(){for(var e=0;e<this._complex._residues.length-1;++e){var t=this._complex._residues[e];if(0!=(t.getType().flags&Nh.Flags.PROTEIN)){var n=null;e>0&&this._complex._residues[e-1].getType().flags&Nh.Flags.PROTEIN&&t._sequence===this._complex._residues[e-1]._sequence+1&&(n=this._complex._residues[e-1]);for(var r=e+1;r<this._complex._residues.length;++r){var i=this._complex._residues[r];if(0!=(i.getType().flags&Nh.Flags.PROTEIN)){var o=null;this._complex._residues[r-1].getType().flags&Nh.Flags.PROTEIN&&i._sequence===this._complex._residues[r-1]._sequence+1&&(o=this._complex._residues[r-1]),this._calcHBondEnergy(n,t,i),r!==e+1&&this._calcHBondEnergy(o,i,t)}}}}}},{key:"_buildVW",value:function(){var e,t,n=this,r=this._complex._residues,i=this._complex.getVoxelWorld();if(null!==i)for(var o=new yd(this._complex._residues.length*this._complex._residues.length/2),a=0;a<r.length-1;++a)0!=((e=r[a]).getType().flags&Nh.Flags.PROTEIN)&&(!(t=a>0?r[a-1]:null)||0!=(t.getType().flags&Nh.Flags.PROTEIN)&&e._sequence===t._sequence+1||(t=null),i.forEachAtomWithinRadius(this._residueGetCAlpha(e),5,s));function s(i){var a=i._residue;if(a._index!==e._index&&0!=(a.getType().flags&Nh.Flags.PROTEIN)&&o.addPair(e._index,a._index)){var s=a._index>0?r[a._index-1]:null;!s||0!=(s.getType().flags&Nh.Flags.PROTEIN)&&a._sequence===s._sequence+1||(s=null),n._calcHBondEnergy(t,e,a),a._index!==e._index+1&&n._calcHBondEnergy(s,a,e)}}}},{key:"_residueGetCAlpha",value:function(e){for(var t=0;t<e._atoms.length;++t){var n=e._atoms[t].getName().getString();if("CA"===n||"C1"===n)return e._atoms[t].getPosition()}return null}},{key:"_residueGetCO",value:function(e){var t=null,n=null;return e.forEachAtom((function(e){"C"===e.getName().getString()?t=e.getPosition():"O"===e.getName().getString()&&(n=e.getPosition())})),[t,n]}},{key:"_residueGetNH",value:function(e,t){var n,i=this._residueGetCO(e),o=r(i,2),a=o[0],s=o[1];if(t.forEachAtom((function(e){"N"===e.getName().getString()&&(n=e.getPosition())})),a&&s&&n){var l=a.clone();return l.sub(s),l.multiplyScalar(1/l.length()),l.add(n),[n,l]}return[null,null]}},{key:"_calcHBondEnergy",value:function(e,t,n){var i=0;if(null===e)return i;if("PRO"!==t.getType().getName()){var o=this._residueGetNH(e,t),a=r(o,2),s=a[0],l=a[1],u=this._residueGetCO(n),c=r(u,2),h=c[0],d=c[1];if(null===s||null===l||null===h||null===d)return i;var f=l.distanceTo(d),p=l.distanceTo(h),m=s.distanceTo(h),v=s.distanceTo(d);i=f<.5||p<.5||m<.5||v<.5?-9.9:-27.888/f- -27.888/p+-27.888/m- -27.888/v,(i=Math.round(1e3*i)/1e3)<-9.9&&(i=-9.9)}void 0===this._hbonds[t._index]&&(this._hbonds[t._index]={donor:[],acceptor:[]});var g=this._hbonds[t._index];g.acceptor.length<2&&g.acceptor.push({residue:n._index,energy:i}),g.acceptor.length>1&&(i<g.acceptor[0].energy?(g.acceptor[1].residue=g.acceptor[0].residue,g.acceptor[1].energy=g.acceptor[0].energy,g.acceptor[0].residue=n._index,g.acceptor[0].energy=i):i<g.acceptor[1].energy&&(g.acceptor[1].residue=n._index,g.acceptor[1].energy=i)),void 0===this._hbonds[n._index]&&(this._hbonds[n._index]={donor:[],acceptor:[]});var y=this._hbonds[n._index];return y.donor.length<2&&y.donor.push({residue:t._index,energy:i}),y.donor.length>1&&(i<y.donor[0].energy?(y.donor[1].residue=y.donor[0].residue,y.donor[1].energy=y.donor[0].energy,y.donor[0].residue=t._index,y.donor[0].energy=i):i<y.donor[1].energy&&(y.donor[1].residue=t._index,y.donor[1].energy=i)),i}}]),e}(),Gd=Object.freeze({NO_BRIDGE:0,PARALLEL:1,ANTI_PARALLEL:2}),jd=Object.freeze({START:1,MIDDLE:2,END:3,START_AND_END:4}),Hd=Object.freeze({STRAND:"E",BRIDGE:"B",HELIX_310:"G",HELIX_ALPHA:"H",HELIX_PI:"I",TURN:"T",BEND:"S",LOOP:" "}),Wd=function(){function e(t){h(this,e),this._complex=t,this._build()}return Tc(e,[{key:"_build",value:function(){this._hbonds=new Vd(this._complex),this._ss=[],this._sheet=[],this._betaPartners=[],this._bend=[];for(var e=0;e<this._complex.getResidues().length;++e)this._betaPartners[e]=[];this._helixFlags=[],this._helixFlags[3]=[],this._helixFlags[4]=[],this._helixFlags[5]=[],this._chainLengths=[];for(var t=0;t<this._complex._chains.length;++t){for(var n=this._complex._chains[t].getResidues(),r=0;r<n.length&&0!=(n[r].getType().flags&Nh.Flags.PROTEIN);++r);this._chainLengths[t]=r}this._buildBetaSheets();for(var i=0;i<this._complex._chains.length;++i)this._buildAlphaHelices(this._complex._chains[i].getResidues(),this._chainLengths[i],!1)}},{key:"_buildAlphaHelices",value:function(e,t,n){for(var r=3;r<=5&&!(e.length<r);++r)for(var i=0;i+r<t;++i)if(this._hbonds.isBond(e[i+r]._index,e[i]._index)){this._helixFlags[r][e[i+r]._index]=jd.END;for(var o=i+1;o<i+r;++o)void 0===this._helixFlags[r][e[o]._index]&&(this._helixFlags[r][e[o]._index]=jd.MIDDLE);this._helixFlags[r][e[i]._index]===jd.END?this._helixFlags[r][e[i]._index]=jd.START_AND_END:this._helixFlags[r][e[i]._index]=jd.START}for(var a=2;a<t-2;++a){var s=this._kappa(e[a-2],e[a],e[a+2]);this._bend[e[a]._index]=360!==s&&s>70}for(var l=1;l+4<t;++l)if(this._isHelixStart(e[l]._index,4)&&this._isHelixStart(e[l-1]._index,4))for(var u=l;u<=l+3;++u)this._ss[e[u]._index]=Hd.HELIX_ALPHA;for(var c=1;c+3<t;++c)if(this._isHelixStart(e[c]._index,3)&&this._isHelixStart(e[c-1]._index,3)){for(var h=!0,d=c;h&&d<=c+2;++d)h=void 0===this._ss[e[d]._index]||this._ss[e[d]._index]===Hd.HELIX_310;if(h)for(var f=c;f<=c+2;++f)this._ss[e[f]._index]=Hd.HELIX_310}for(var p=1;p+5<t;++p)if(this._isHelixStart(e[p]._index,5)&&this._isHelixStart(e[p-1]._index,5)){for(var m=!0,v=p;m&&v<=p+4;++v)m=void 0===this._ss[e[v]._index]||this._ss[e[v]._index]===Hd.HELIX_PI||n&&this._ss[e[v]._index]===Hd.HELIX_ALPHA;if(m)for(var g=p;g<=p+4;++g)this._ss[e[g]._index]=Hd.HELIX_PI}for(var y=1;y+1<t;++y)if(void 0===this._ss[e[y]._index]){for(var _=!1,x=3;x<=5&&!_;++x)for(var b=1;b<x&&!_;++b)_=y>=b&&this._isHelixStart(e[y-b]._index,x);_?this._ss[e[y]._index]=Hd.TURN:this._bend[e[y]._index]&&(this._ss[e[y]._index]=Hd.BEND)}}},{key:"_residueGetCAlpha",value:function(e){for(var t=0;t<e._atoms.length;++t){var n=e._atoms[t].getName().getString();if("CA"===n||"C1"===n)return e._atoms[t].getPosition()}return null}},{key:"_cosinusAngle",value:function(e,t,n,r){var i=e.clone().sub(t),o=n.clone().sub(r),a=0,s=i.dot(i)*o.dot(o);return s>0&&(a=i.dot(o)/Math.sqrt(s)),a}},{key:"_kappa",value:function(e,t,n){var r=this._residueGetCAlpha(t),i=this._residueGetCAlpha(e),o=this._residueGetCAlpha(n);if(null===r||null===i||null===o)return 180;var a=this._cosinusAngle(r,i,o,r),s=Math.sqrt(1-a*a);return 180*Math.atan2(s,a)/Math.PI}},{key:"_isHelixStart",value:function(e,t){return this._helixFlags[t][e]===jd.START||this._helixFlags[t][e]===jd.START_AND_END}},{key:"_buildBetaSheets",value:function(){for(var e=[],t=0;t<this._complex._chains.length;++t){var n=this._chainLengths[t];if(!(n<=4))for(var r=this._complex._chains[t].getResidues(),i=t;i<this._complex._chains.length;++i){var o=this._chainLengths[i];if(!(o<=4))for(var a=this._complex._chains[i].getResidues(),s=1;s+1<n;++s){var l=r[s],u=1;for(i===t&&(u=s+3);u+1<o;++u){var c=a[u],h=this._testBridge(r,s,a,u);if(h!==Gd.NO_BRIDGE){var d=!1,f=!0,p=!1,m=void 0;try{for(var v,g=e[Symbol.iterator]();!(f=(v=g.next()).done);f=!0){var y=v.value;if(h===y.type&&l._index===y.i[y.i.length-1]+1){if(h===Gd.PARALLEL&&y.j[y.j.length-1]+1===c._index){y.i.push(l._index),y.j.push(c._index),d=!0;break}if(h===Gd.ANTI_PARALLEL&&y.j[0]-1===c._index){y.i.push(l._index),y.j.unshift(c._index),d=!0;break}}}}catch(e){p=!0,m=e}finally{try{f||null==g.return||g.return()}finally{if(p)throw m}}d||e.push({type:h,i:[l._index],chainI:l.getChain()._index,j:[c._index],chainJ:c.getChain()._index})}}}}}e.sort((function(e,t){return e.chainI<t.chainI||e.chainI===t.chainI&&e.i[0]<t.i[0]?-1:1}));for(var _=0;_<e.length;++_)for(var x=_+1;x<e.length;++x){var b=e[_].i[0],w=e[_].i[e[_].i.length-1],S=e[_].j[0],E=e[_].j[e[_].j.length-1],T=e[x].i[0],M=e[x].i[e[x].i.length-1],C=e[x].j[0],A=e[x].j[e[x].j.length-1];e[_].type!==e[x].type||this._hasChainBreak(Math.min(b,T),Math.max(w,M))||this._hasChainBreak(Math.min(S,C),Math.max(E,A))||T-w>=6||w>=T&&b<=M||(e[_].type===Gd.PARALLEL?C-E<6&&T-w<3||C-E<3:S-A<6&&T-w<3||S-A<3)&&(e[_].i=e[_].i.concat(e[x].i),e[_].type===Gd.PARALLEL?e[_].j=e[_].j.concat(e[x].j):e[_].j=e[x].j.concat(e[_].j),e.splice(x--,1))}for(var R=new Set,P=0;P<e.length;++P)R.add(e[P]);for(var k=1,L=0;R.size>0;){var N=R.values().next().value;R.delete(N);var I=new Set;I.add(N);var O=void 0;do{O=new Set;var D=!0,z=!1,F=void 0;try{for(var B,U=I.values()[Symbol.iterator]();!(D=(B=U.next()).done);D=!0){var V=B.value,G=!0,j=!1,H=void 0;try{for(var W,q=R.values()[Symbol.iterator]();!(G=(W=q.next()).done);G=!0){var Y=W.value;this._areBridgesLinked(V,Y)&&O.add(Y)}}catch(e){j=!0,H=e}finally{try{G||null==q.return||q.return()}finally{if(j)throw H}}}}catch(e){z=!0,F=e}finally{try{D||null==U.return||U.return()}finally{if(z)throw F}}var X=!0,Z=!1,$=void 0;try{for(var K,J=O.values()[Symbol.iterator]();!(X=(K=J.next()).done);X=!0)N=K.value,I.add(N),R.delete(N)}catch(e){Z=!0,$=e}finally{try{X||null==J.return||J.return()}finally{if(Z)throw $}}}while(O.size>0);var Q=!0,ee=!1,te=void 0;try{for(var ne,re=I.values()[Symbol.iterator]();!(Q=(ne=re.next()).done);Q=!0)(N=ne.value).ladder=L,N.sheet=k,N.link=I,++L}catch(e){ee=!0,te=e}finally{try{Q||null==re.return||re.return()}finally{if(ee)throw te}}++k}for(var ie=0;ie<e.length;++ie){for(var oe=e[ie],ae=0,se=0,le=0;le<oe.i.length;++le)if(this._betaPartners[oe.i[le]][0]){ae=1;break}for(var ue=0;ue<oe.j.length;++ue)if(this._betaPartners[oe.j[ue]][0]){se=1;break}var ce=Hd.BRIDGE;if(oe.i.length>1&&(ce=Hd.STRAND),oe.type===Gd.PARALLEL){for(var he=0,de=0;de<oe.i.length;++de)this._betaPartners[oe.i[de]][ae]={residue:oe.j[he++],ladder:oe.ladder,parallel:!0};he=0;for(var fe=0;fe<oe.j.length;++fe)this._betaPartners[oe.j[fe]][se]={residue:oe.i[he++],ladder:oe.ladder,parallel:!0}}else{for(var pe=oe.j.length-1,me=0;me<oe.i.length;++me)this._betaPartners[oe.i[me]][ae]={residue:oe.j[pe--],ladder:oe.ladder,parallel:!1};pe=oe.i.length-1;for(var ve=0;ve<oe.j.length;++ve)this._betaPartners[oe.j[ve]][se]={residue:oe.i[pe--],ladder:oe.ladder,parallel:!1}}for(var ge=oe.i[0];ge<=oe.i[oe.i.length-1];++ge)this._ss[ge]!==Hd.STRAND&&(this._ss[ge]=ce,this._sheet[ge]=oe.sheet);for(var ye=oe.j[0];ye<=oe.j[oe.j.length-1];++ye)this._ss[ye]!==Hd.STRAND&&(this._ss[ye]=ce,this._sheet[ye]=oe.sheet)}}},{key:"_testBridge",value:function(e,t,n,r){var i=Gd.NO_BRIDGE,o=e[t-1]._index,a=e[t]._index,s=e[t+1]._index,l=n[r-1]._index,u=n[r]._index,c=n[r+1]._index,h=this._hbonds.isBond.bind(this._hbonds);return h(s,u)&&h(u,o)||h(c,a)&&h(a,l)?i=Gd.PARALLEL:(h(s,l)&&h(c,o)||h(u,a)&&h(a,u))&&(i=Gd.ANTI_PARALLEL),i}},{key:"_areBridgesLinked",value:function(e,t){var n=new Set(e.i),r=new Set(e.j),i=!0,o=!1,a=void 0;try{for(var s,l=t.i[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value;if(n.has(u)||r.has(u))return!0}}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}var c=!0,h=!1,d=void 0;try{for(var f,p=t.j[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var m=f.value;if(n.has(m)||r.has(m))return!0}}catch(e){h=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(h)throw d}}return!1}},{key:"_hasChainBreak",value:function(e,t){for(var n=e+1;n<=t;++n)if(this._complex._residues[n]._sequence!==this._complex._residues[n-1]._sequence+1)return!0;return!1}}]),e}();Wd.StructureType=Hd;var qd=Wd.StructureType,Yd=Fh.Type,Xd=(u(Bd={},qd.HELIX_ALPHA,1),u(Bd,qd.HELIX_PI,3),u(Bd,qd.HELIX_310,5),Bd),Zd=(u(Ud={},qd.BRIDGE,Yd.BRIDGE),u(Ud,qd.TURN,Yd.TURN),u(Ud,qd.BEND,Yd.BEND),u(Ud,qd.LOOP,Yd.COIL),Ud),$d=function(){function e(){h(this,e),this._chains=[],this._components=[],this._helices=[],this._sheets=[],this.structures=[],this._residueTypes=Object.create(Nh.StandardTypes),this._atoms=[],this._residues=[],this._bonds=[],this._sgroups=[],this._molecules=[],this._maskNeedsUpdate=!1,this.metadata={},this.symmetry=[],this.units=[new md(this)],this._currentUnit=0}return Tc(e,[{key:"addAtom",value:function(e){var t=this._atoms.length;return this._atoms.push(e),t}},{key:"addSheet",value:function(e){var t=this._sheets.length;return this._sheets.push(e),t}},{key:"addHelix",value:function(e){var t=this._helices.length;return this._helices.push(e),t}},{key:"getAtoms",value:function(){return this._atoms}},{key:"getBonds",value:function(){return this._bonds}},{key:"getAtomCount",value:function(){return this._atoms.length}},{key:"addResidue",value:function(e){var t=this._residues.length;return this._residues.push(e),t}},{key:"updateToFrame",value:function(e){this.forEachChain((function(t){t.updateToFrame(e)}))}},{key:"addResidueType",value:function(e){return this._residueTypes[e]=new Nh(e,"Unknown","")}},{key:"getResidueCount",value:function(){return this._residues.length}},{key:"getResidues",value:function(){return this._residues}},{key:"getSGroupCount",value:function(){return this._sgroups.length}},{key:"getSGroups",value:function(){return this._sgroups}},{key:"getAtomByFullname",value:function(e){var t=e.split(".");if(3!==t.length)return null;var n=t[0],r=parseInt(t[1],10);if(Number.isNaN(r))return null;var i=t[2].toUpperCase(),o=null;return this.forEachChain((function(e){o||0===e._name.localeCompare(n)&&e.forEachResidue((function(e){o||e._sequence===r&&e.forEachAtom((function(e){o||0===i.localeCompare(e._name.getString())&&(o=e)}))}))})),o}},{key:"addChain",value:function(e){var t=new zh(this,e);return this._chains.push(t),t}},{key:"getChain",value:function(e){for(var t=0,n=this._chains.length;t<n;++t){var r=this._chains[t];if(r.getName()===e)return r}return null}},{key:"getChainCount",value:function(){return this._chains.length}},{key:"getMolecules",value:function(){return this._molecules}},{key:"getMoleculeCount",value:function(){return this._molecules.length}},{key:"forEachAtom",value:function(e){for(var t=this._atoms,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"forEachBond",value:function(e){for(var t=this._bonds,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"forEachResidue",value:function(e){for(var t=this._residues,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"forEachChain",value:function(e){for(var t=this._chains,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"forEachMolecule",value:function(e){for(var t=this._molecules,n=t.length,r=0;r<n;++r)e(t[r])}},{key:"forEachSGroup",value:function(e){for(var t=this._sgroups,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"forEachComponent",value:function(e){for(var t=this._components,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"forEachVisibleComponent",value:function(e){for(var t=this._components,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"addBond",value:function(e,t,n,r,i){var o=new Mh(e,t,n,r,i);return this._bonds.push(o),o}},{key:"getBondCount",value:function(){return this._bonds.length}},{key:"getResidueType",value:function(e){return this._residueTypes[e]||null}},{key:"_atomNameCompare",value:function(e,t,n){var r=Sh.ByName.H.name,i=Sh.ByName.C.name;function o(e){return e===i?String.fromCharCode(1):e===r?String.fromCharCode(n):e}var a=o(e),s=o(t);return a<s?-1:a>s?1:0}},{key:"_atomNameCompareCWithH",value:function(e,t){return this._atomNameCompare(e,t,2)}},{key:"_atomNameCompareCWithoutH",value:function(e,t){return this._atomNameCompare(e,t,254)}},{key:"_buildFormulaSimple",value:function(e,t){var n=e.atoms,r=null,i={},o="",a=this,s=Sh.ByName.H.name,l=0;n.forEach((function(e){var t=e.getHydrogenCount();r=e.element,i[r.name]?i[r.name]+=1:i[r.name]=1,t>0&&(i[s]?i[s]+=t:i[s]=t),l+=e.getCharge()}));var u=Object.keys(i);return i.C?u.sort(this._atomNameCompareCWithH.bind(this)):u.sort((function(e,t){return a._atomNameCompare(e,t,"H".charCodeAt(0))})),u.forEach((function(e){var t=e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase();i[e]>1?o+=t+i[e].toString():o+=t})),null===t?(0!==l&&(u.length>1&&(o="(".concat(o,")")),l>1&&(o+="^{".concat(l.toString(),"+}")),1===l&&(o+="^+"),l<-1&&(o+="^{".concat(Math.abs(l).toString(),"-}")),-1===l&&(o+="^-")),e.repeatCount>1&&(o=e.repeatCount.toString(10)+o)):t(u.length,l),o}},{key:"_buildPartFormula",value:function(t){return t.owner instanceof e||t.owner instanceof gd?this._buildFormulaSimple(t,null):t.owner instanceof Yh?t.owner.buildChemicalFormula(this,t):""}},{key:"_partCompareFunc",value:function(e,t){return this._partCompareFuncInt(e,t,!0)}},{key:"_getCumulativeCharge",value:function(e){for(var t=e.length,n=0,r=0;r<t;r++)n+=e[r].getCharge();return n}},{key:"_partCompareFuncInt",value:function(e,t,n){var r=this,i=Sh.ByName.H.name;function o(e,t){var n={};e.forEach((function(e){if(n[e.element.name]?n[e.element.name]+=1:n[e.element.name]=1,!t){var r=e.getHydrogenCount();r>0&&(n[i]?n[i]+=r:n[i]=r)}}));var o=Object.keys(n);return o.sort(r._atomNameCompareCWithoutH.bind(r)),{seq:o,data:n}}for(var a,s=[n,!1],l=0;l<s.length;l++){for(var u=s[l],c=o(e.atoms,u),h=o(t.atoms,u),d=0,f=0;d<c.seq.length&&f<h.seq.length;){if(c.seq[d]!==h.seq[f])return r._atomNameCompareCWithoutH(c.seq[d],h.seq[f]);if(c.data[c.seq[d]]!==h.data[h.seq[f]])return h.data[h.seq[f]]-c.data[c.seq[d]];d+=1,f+=1}if(0!=(a=c.seq.length-h.seq.length)||!u)return 0===a?this._getCumulativeCharge(e.atoms)-this._getCumulativeCharge(t.atoms):a}return this._getCumulativeCharge(e.atoms)-this._getCumulativeCharge(t.atoms)}},{key:"_checkFormulaBuildable",value:function(){for(var e=this.getAtoms(),t=e.length,n=0;n<t;n++)if(e[n].element.number>Sh.ByName.MT.number)return"}\\text{Could not create chemical formula for this structure.}{";return""}},{key:"buildChemicalFormula",value:function(){var t=[],n=null,r=null,i={},o=null,a=this,s=this._checkFormulaBuildable();if(""!==s)return s;this.forEachAtom((function(e){i[e.getSerial()]&&zc.warn("Broken complex. Formula can be invalid..."),i[e.getSerial()]={atom:e,taken:null}})),this.forEachSGroup((function(e){0===e._charge&&1===e._repeat||(r=(n={owner:e,atoms:[],repeatCount:1}).atoms,e._atoms.forEach((function(t){null===(o=i[t.getSerial()]).taken&&(r.push(t),o.taken=e)})),n.atoms.length>0&&t.push(n),n=null)})),this.forEachComponent((function(e){r=(n={owner:e,atoms:[],repeatCount:1}).atoms,e.forEachResidue((function(t){t._atoms.forEach((function(t){null===(o=i[t.getSerial()]).taken&&(r.push(t),o.taken=e)}))})),n.atoms.length>0&&t.push(n),n=null})),Object.keys(i).forEach((function(e){null===e.taken&&(null===n&&(n={owner:a,atoms:[],repeatCount:1}),n.atoms.push(e.atom),e.taken=a)})),null!==n&&n.atoms.length>0&&t.push(n),t.sort((function(e,t){return a._partCompareFunc(e,t)}));for(var l=t.length-1,u=t.length-2;l>=0&&u>=0;){var c=t[l],h=t[u];c.owner instanceof e||c.owner instanceof gd?h.owner instanceof e||h.owner instanceof gd?(0===this._partCompareFuncInt(h,c,!1)&&(h.repeatCount+=c.repeatCount,t.splice(l,1)),u--,l--):u--:--l===u&&u--}return t.forEach((function(e){var t=a._buildPartFormula(e);t.length>0&&(s.length>0&&(s+="*"),s+=t)})),s}},{key:"getUnifiedSerial",value:function(e,t,n){return t+65536*n+16777216*e}},{key:"splitUnifiedSerial",value:function(e){var t=Math.floor(e/16777216),n=e-16777216*t,r=Math.floor(n/65536);return{chain:t,serial:n-65536*r,iCode:r}}},{key:"_fillCmpEdit",value:function(){var e=this,t=this._components;function n(){var n=new gd(e);return n._index=t.length,t[n._index]=n,n}this.forEachChain((function(e){var t=e._residues,r=t.length;if(!(r<1))for(var i=n(),o=t[0]._index,a=0;a<r;++a){var s=t[a];s._component=i;var l=a===r-1?null:t[a+1];l&&s.isConnected(l)&&s._index===l._index-1||(i.setSubDivs([{start:o,end:s._index}]),l&&(o=l._index,i=n()))}}))}},{key:"_fillCmpNoedit",value:function(){var e=new gd(this);e._index=0;var t=this._residues,n=t.length;if(0!==n){for(var r=[],i=0,o=0;o<n;++o){var a=t[o];a._component=e;var s=o===n-1?null:t[o+1];s&&a.isConnected(s)||(r[r.length]={start:i,end:o},s&&(i=o+1))}e.setSubDivs(r),this._components[e._index]=e}}},{key:"_fillComponents",value:function(e){e?this._fillCmpEdit():this._fillCmpNoedit()}},{key:"getCurrentUnit",value:function(){return this._currentUnit}},{key:"getDefaultBoundaries",value:function(){return this.units[0].getBoundaries()}},{key:"getBoundaries",value:function(){return this.units[this._currentUnit].getBoundaries()}},{key:"getTransforms",value:function(){return this.units[this._currentUnit].getTransforms()}},{key:"getSelector",value:function(){return this.units[this._currentUnit].getSelector()}},{key:"resetCurrentUnit",value:function(){this._currentUnit=0,this.setCurrentUnit(1)}},{key:"setCurrentUnit",value:function(e){return null!=e&&e!==this._currentUnit&&e>=0&&e<this.units.length&&(this._currentUnit=e,!0)}},{key:"_computeBounds",value:function(){for(var e=this.units,t=0,n=e.length;t<n;++t)e[t].computeBoundaries()}},{key:"onAtomPositionChanged",value:function(){this.forEachChain((function(e){e._finalize()})),this.forEachComponent((function(e){e.update()})),this._computeBounds(),this._finalizeBonds(),this.forEachSGroup((function(e){e._rebuildSGroupOnAtomChange()}))}},{key:"update",value:function(){this._maskNeedsUpdate&&(this.updateStructuresMask(),this._maskNeedsUpdate=!1)}},{key:"_finalizeBonds",value:function(){for(var e=this.getBonds(),t=e.length,n=0;n<t;++n)e[n]._index=n}},{key:"finalize",value:function(e){e=e||{};var t,n,r=this._bonds;for(t=r.length-1;t>=0;t--){var i=r[t];null===i._left||null===i._right?r.splice(t,1):(i._left._bonds.push(i),i._right._bonds.push(i))}var o=this._residues;for(t=0,n=o.length;t<n;++t)o[t]._finalize();this.forEachChain((function(e){e._finalize()}));var a=this.units;for(t=0,n=a.length;t<n;++t)a[t].finalize();this.setCurrentUnit(1);var s={};for(t=0,n=o.length;t<n;++t){var l=o[t];s[this.getUnifiedSerial(l.getChain().getName().charCodeAt(0),l.getSequence(),l.getICode().charCodeAt(0))]=l}var u=this.structures;for(t=0,n=u.length;t<n;++t)u[t]._finalize(e.serialAtomMap,s,this);var c=this._helices;for(t=0,n=c.length;t<n;++t)c[t]._finalize(e.serialAtomMap,s,this);var h=this._sheets;for(t=0,n=h.length;t<n;++t)h[t]._finalize(e.serialAtomMap,s,this);this._computeBounds();var d=this._atoms;for(t=0,n=d.length;t<n;++t)d[t]._index=t;if(e.needAutoBonding){var f=new Sd(this);f.build(),f.destroy()}var p=this._chains;for(t=0,n=p.length;t<n;++t)p[t]._index=t;for(t=0,n=o.length;t<n;++t)o[t]._index=t;for(t=0,n=d.length;t<n;++t){var m=d[t];if(m.flags&wh.Flags.HYDROGEN&&1===m._bonds.length){var v=m._bonds[0];(v._left!==m&&v._left||v._right).flags&wh.Flags.CARBON&&(m.flags|=wh.Flags.NONPOLARH)}}this._finalizeBonds(),this._fillComponents(e.enableEditing);var g=new Od(this);g.markCycles(),e.detectAromaticLoops&&g.detectCycles(),this._finalizeMolecules()}},{key:"_finalizeMolecules",value:function(){for(var e=0;e<this._molecules.length;e++)for(var t=this._molecules[e],n=t._residues.length,r=0;r<n;r++)t._residues[r]._molecule=t}},{key:"updateStructuresMask",value:function(){var e=function(e){return e.collectMask()};this.forEachResidue(e),this.forEachChain(e),this.forEachMolecule(e)}},{key:"countAtomsByMask",value:function(e){var t=0;return this.forEachAtom((function(n){0!=(n._mask&e)&&t++})),t}},{key:"getNumAtomsBySelector",value:function(e){var t=0;return this.forEachAtom((function(n){e.includesAtom(n)&&t++})),t}},{key:"resetAtomMask",value:function(e){this.forEachAtom((function(t){t._mask=e}))}},{key:"markAtoms",value:function(e,t){var n=t,r=~n,i=0,o=pd.keyword("And")(e,this.getSelector());return this.forEachAtom((function(e){o.includesAtom(e)?(e._mask|=n,i++):e._mask&=r})),this._maskNeedsUpdate=!0,i}},{key:"markAtomsAdditionally",value:function(e,t){var n=t,r=0;return this.forEachAtom((function(i){e.includesAtom(i)&&(i._mask&t)!==t&&(i._mask|=n,r++)})),r}},{key:"clearAtomBits",value:function(e){var t=~e,n=function(e){e._mask&=t};this.forEachAtom(n),this.forEachResidue(n),this.forEachChain(n),this.forEachMolecule(n)}},{key:"getAtomNames",value:function(){if(this.hasOwnProperty("_atomNames"))return this._atomNames;var e={};return this.forEachAtom((function(t){e[t._name._name]=1})),this._atomNames=Object.keys(e),this._atomNames}},{key:"getElements",value:function(){if(this.hasOwnProperty("_elements"))return this._elements;var e={};return this.forEachAtom((function(t){e[t.element.name]=1})),this._elements=Object.keys(e),this._elements}},{key:"getResidueNames",value:function(){if(this.hasOwnProperty("_residueNames"))return this._residueNames;var e={};return this.forEachResidue((function(t){e[t._type._name]=1})),this._residueNames=Object.keys(e),this._residueNames}},{key:"getChainNames",value:function(){if(this.hasOwnProperty("_chainNames"))return this._chainNames;var e={};return this.forEachChain((function(t){e[t._name]=1})),this._chainNames=Object.keys(e),this._chainNames}},{key:"getAltLocNames",value:function(){if(this.hasOwnProperty("_altlocNames"))return this._altlocNames;var e={};return this.forEachAtom((function(t){e[String.fromCharCode(t._location)]=1})),this._altlocNames=Object.keys(e),this._altlocNames}},{key:"getVoxelWorld",value:function(){if(!this.hasOwnProperty("_voxelWorld"))try{this._voxelWorld=new Fd(this.getDefaultBoundaries().boundingBox,new E(5,5,5)),this._voxelWorld.addAtoms(this)}catch(e){zc.warn("Unable to create voxel world"),this._voxelWorld=null}return this._voxelWorld}},{key:"addElement",value:function(e,t,n,r){for(var i=e.length,o=0;o<i;++o){var a=e[o];r(a,n),t.push(a)}}},{key:"joinComplexes",value:function(e){this._chains=[],this._components=[],this._helices=[],this._sheets=[],this.structures=[],this._atoms=[],this._residues=[],this._bonds=[],this._sgroups=[];var t=this,n=0,r=0,i=0,o=0,a=0;function s(e,t){e._serial+=t,e._index+=t}function l(e,t){e._index+=t}function u(e,t){e._index+=t}function c(e,n){e._complex=t,e._index+=n}function h(e,n){e._complex=t,e._index+=n}function d(){}for(var f=0;f<e.length;++f){var p=e[f];for(var m in this.addElement(p._atoms,this._atoms,n,s),this.addElement(p._bonds,this._bonds,r,l),this.addElement(p._residues,this._residues,i,u),this.addElement(p._chains,this._chains,o,c),this.addElement(p._sheets,this._sheets,0,d),this.addElement(p._helices,this._helices,0,d),this.addElement(p._sgroups,this._sgroups,0,d),this.addElement(p._components,this._components,a,h),this.addElement(p.structures,this.structures,0,d),p._residueTypes)p._residueTypes.hasOwnProperty(m)&&(this._residueTypes[m]=p._residueTypes[m]);n+=p._atoms.length,r+=p._bonds.length,i+=p._residues.length,o+=p._chains.length,a+=p._components.length}this._computeBounds()}},{key:"dssp",value:function(){for(var e,t,n,r,i=new Wd(this),o=this.structures=[],a=this._helices=[],s=this._sheets=[],l=0,u=null,c=0,h=this._residues.length;c<h;++c){var d=i._ss[c],f=this._residues[c],p=i._sheet[c];if(d!==e||p!==t){var m=Xd[d],v=Zd[d];if(d===qd.STRAND){var g=(r=void 0,(r=s[n=p])||(r=s[n]=new qh(String(n),0)),r);u=new Wh(g,f,f,0,null,null),g.addStrand(u)}else void 0!==m?(l++,u=new jh(m,f,f,l,String(l),"",1),a.push(u)):u=void 0!==v?new Fh(v,f,f):null;u&&o.push(u),f._secondary=u,e=d,t=p}else f._secondary=u,u&&(u.term=f),u instanceof jh&&u.length++}this._sheets=s.filter((function(e){return!0}))}}]),e}();function Kd(e){var t=2;for(e=e-1>>1;e;)t<<=1,e>>=1;return t}$d.prototype.id="Complex",$d.prototype.name="";var Jd=function(){function e(t,n,i,o,a,s){if(h(this,e),this._box=i.clone(),this._dimVec=Math.max(Math.floor(o||1),1),this._volumeInfo=s,n instanceof Array){var l=r(n,3);this._dimX=l[0],this._dimY=l[1],this._dimZ=l[2]}else this._dimX=n.x,this._dimY=n.y,this._dimZ=n.z;switch(this._dimX=Math.max(Math.floor(this._dimX),1),this._dimY=Math.max(Math.floor(this._dimY),1),this._dimZ=Math.max(Math.floor(this._dimZ),1),this._rowElements=this._dimVec*this._dimX,this._planeElements=this._rowElements*this._dimY,this._totalElements=this._planeElements*this._dimZ,this._data=a||$c.allocateTyped(t,this._totalElements),this._dimVec){case 1:break;case 2:this.getValue=function(e,t,n){var r=e*this._dimVec+t*this._rowElements+n*this._planeElements;return[this._data[r],this._data[r+1]]},this.setValue=function(e,t,n,r,i){var o=e*this._dimVec+t*this._rowElements+n*this._planeElements;this._data[o]=r,this._data[o+1]=i},this.addValue=function(e,t,n,r,i){var o=e*this._dimVec+t*this._rowElements+n*this._planeElements;this._data[o]+=r,this._data[o+1]+=i};break;case 3:this.getValue=function(e,t,n){var r=e*this._dimVec+t*this._rowElements+n*this._planeElements;return[this._data[r],this._data[r+1],this._data[r+2]]},this.setValue=function(e,t,n,r,i,o){var a=e*this._dimVec+t*this._rowElements+n*this._planeElements;this._data[a]=r,this._data[a+1]=i,this._data[a+2]=o},this.addValue=function(e,t,n,r,i,o){var a=e*this._dimVec+t*this._rowElements+n*this._planeElements;this._data[a]+=r,this._data[a+1]+=i,this._data[a+2]+=o};break;default:throw new Error("Volume: invalid vector dimension")}}return Tc(e,[{key:"getValue",value:function(e,t,n){return this._data[e+t*this._rowElements+n*this._planeElements]}},{key:"setValue",value:function(e,t,n,r){this._data[e+t*this._rowElements+n*this._planeElements]=r}},{key:"addValue",value:function(e,t,n,r){this._data[e+t*this._rowElements+n*this._planeElements]+=r}},{key:"getDimensions",value:function(){return[this._dimX,this._dimY,this._dimZ]}},{key:"getBox",value:function(){return this._box}},{key:"getVolumeInfo",value:function(){return this._volumeInfo}},{key:"getCellSize",value:function(){var e=new E;this._box.getSize(e);var t=new E;return t.x=this._dimX>1?e.x/(this._dimX-1):0,t.y=this._dimY>1?e.y/(this._dimY-1):0,t.z=this._dimZ>1?e.z/(this._dimZ-1):0,t}},{key:"computeGradient",value:function(){if(1!==this._dimVec)return null;var t=new e(Float32Array,[this._dimX,this._dimY,this._dimZ],this._box,3),n=this.getCellSize(),r=new E(-.5/n.x,-.5/n.y,-.5/n.z);function i(e,t,n){return Math.min(n,Math.max(t,e))}var o=this._dimX,a=this._dimY,s=this._dimZ,l=this._data;function u(e,t,n){return l[n*o*a+t*o+e]}for(var c=0;c<s;++c)for(var h=i(c-1,0,s-1),d=i(c+1,0,s-1),f=0;f<a;++f)for(var p=i(f-1,0,a-1),m=i(f+1,0,a-1),v=0;v<o;++v){var g=i(v-1,0,o-1),y=i(v+1,0,o-1);t.setValue(v,f,c,(u(y,f,c)-u(g,f,c))*r.x,(u(v,m,c)-u(v,p,c))*r.y,(u(v,f,d)-u(v,f,h))*r.z)}return t}},{key:"normalize",value:function(){for(var e=this._data,t=e[0],n=e[0],r=1;r<e.length;++r)t=Math.min(t,e[r]),n=Math.max(n,e[r]);var i=1/(n-t);if(0!==i)for(var o=0;o<e.length;++o)e[o]=i*(e[o]-t)}},{key:"getTiledTextureStride",value:function(){return[this._dimX+2,this._dimY+2]}},{key:"buildTiledTexture",value:function(){var e=Math.ceil(Math.sqrt(this._dimZ*this._dimY/this._dimX)),t=e*(this._dimX+2)-1;t=Kd(t),e=Math.floor(t/(this._dimX+2));var n=Math.ceil(this._dimZ/e),r=n*(this._dimY+2)-1;r=Kd(r);for(var i,o,a=new Uint8Array(t*r),s=0;s<n;++s)for(var l=0;l<this._dimY;++l){i=s*e*this._planeElements+l*this._rowElements,o=t*(s*(this._dimY+2)+l);for(var u=0;u<e;++u){for(var c=0;c<this._dimX;++c)a[o++]=255*this._data[i++];a[o++]=255*this._data[i-1],u<e-1&&(i+=this._planeElements-this._rowElements,a[o++]=255*this._data[i])}}for(var h=0;h<n;++h){o=(i=t*(h*(this._dimY+2)+this._dimY-1))+t;for(var d=0;d<t;++d)a[o++]=a[i++];if(h<n-1){o=(i=t*(h+1)*(this._dimY+2))-t;for(var f=0;f<t;++f)a[o++]=a[i++]}}var p=new sn(a,t,r,1024,1009,300,1001,1001,1006,1006);return p.needsUpdate=!0,p}},{key:"getData",value:function(){return this._data}},{key:"getDirectIdx",value:function(e,t,n){return e*this._dimVec+t*this._rowElements+n*this._planeElements}},{key:"getStrideX",value:function(){return this._dimVec}},{key:"getStrideY",value:function(){return this._rowElements}},{key:"getStrideZ",value:function(){return this._planeElements}}]),e}();Jd.prototype.id="Volume";var Qd={Atom:wh,Element:Sh,AtomName:bh,Bond:Mh,Residue:Lh,ResidueType:Nh,Chain:zh,Helix:jh,Strand:Wh,Sheet:qh,SGroup:Yh,Assembly:vd,Complex:$d,Volume:Jd,VoxelWorld:Fd,selectors:pd,Molecule:function(){function e(t,n,r){h(this,e),this._complex=t,this._name=n||"",this._residues=[],this._mask=1,this._index=r||-1}return Tc(e,[{key:"getComplex",value:function(){return this._complex}},{key:"getName",value:function(){return this._name}},{key:"getResidues",value:function(){return this._residues}},{key:"getIndex",value:function(){return this._index}},{key:"forEachResidue",value:function(e){for(var t=this._residues,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"collectMask",value:function(){for(var e=4294967295,t=this._residues,n=0,r=t.length;n<r;++n)e&=t[n]._mask;this._mask=e}}]),e}()},ef=function(e){function t(e){var n;h(this,t),n=d(this,f(t).call(this));var r=c(n);return n._element=e,n._element.style.position="absolute",n.addEventListener("removed",(function(){null!==r._element.parentNode&&r._element.parentNode.removeChild(r._element)})),n}return m(t,e),Tc(t,[{key:"getElement",value:function(){return this._element}},{key:"setTransparency",value:function(e){var t=this.getElement();if(null!==t)if(1!==e){t.style.display="inline";var n=1-e,r=n.toString(),i=100*n;t.style.opacity=r,t.style.filter="alpha(opacity=".concat(i,")")}else t.style.display="none"}},{key:"clone",value:function(){var e=new t(this._element);return e.copy(this),e}}]),t}(oe),tf=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"raycast",value:function(e,t){if(this.visible)for(var n=this.children,r=0,i=n.length;r<i;++r)n[r].raycast(e,t)}},{key:"enableSubset",value:function(e,t){for(var n=this.children,r=0,i=n.length;r<i;++r)n[r].enableSubset&&n[r].enableSubset(e,t)}},{key:"disableSubset",value:function(e,t){for(var n=this.children,r=0,i=n.length;r<i;++r)n[r].disableSubset&&n[r].disableSubset(e,t)}},{key:"isEmpty",value:function(){return 0===this.children.length}},{key:"updateToFrame",value:function(e){for(var t=this.children,n=0,r=t.length;n<r;++n)t[n].updateToFrame&&t[n].updateToFrame(e)}},{key:"getSubset",value:function(e,t){for(var n=[],r=this.children,i=0,o=r.length;i<o;++i)r[i].getSubset&&Array.prototype.push.apply(n,r[i].getSubset(e,t));return n}}]),t}(ci),nf="uniform mat4 projectionMatrix;\r\nuniform mat4 modelViewMatrix;\r\n\r\nattribute vec2 uv;\r\nattribute vec3 position;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n  vUv = uv;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n}\r\n",rf={precision:"mediump",init:function(e){this.precision=e.capabilities.getMaxPrecision("highp")}},of=new sn(new Uint8Array([24,52,0,254,145,0,122,0,0,7,170,0,34,214,0,173,8,0,86,249,0,160,4,0,226,46,0,224,211,0,3,157,0,174,247,0,12,182,0,220,216,0,1,109,0,253,154,0]),4,4,1022,1009,300,1e3,1e3,1003,1003,1);of.needsUpdate=!0;var af={noiseWidth:4,noiseHeight:4,noiseTexture:of};function sf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var lf=[new x(-.541978,.840393),new x(.125533,-.992089),new x(.374329,.927296),new x(-.105475,.994422)],uf=en.merge([dn.fog,dn.lights,{diffuse:{value:new $e(15658734)},opacity:{value:1},specular:{type:"c",value:new $e(1118481)},shininess:{type:"f",value:30},fixedColor:{type:"c",value:new $e(16777215)},zOffset:{type:"f",value:0},zClipValue:{type:"f",value:0},clipPlaneValue:{type:"f",value:0},invModelViewMatrix:{type:"4fv",value:new V},world2colorMatrix:{type:"4fv",value:new V},dashedLineSize:{type:"f",value:.1},dashedLinePeriod:{type:"f",value:.2},projMatrixInv:{type:"4fv",value:new V},viewport:{type:"v2",value:new x},lineWidth:{type:"f",value:2},fogAlpha:{type:"f",value:1},samplesKernel:{type:"v2v",value:null},noiseTex:{type:"t",value:null},noiseTexelSize:{type:"v2",value:null},srcTexelSize:{type:"v2",value:null}}]),cf=["shininess","opacity","zOffset","diffuse","specular","fixedColor","zClipCoef","zClipValue","clipPlaneValue","world2colorMatrix","dashedLineSize","dashedLinePeriod","projMatrixInv","viewport","lineWidth","fogAlpha","samplesKernel","noiseTex","noiseTexelSize","srcTexelSize"];function hf(e){Ra.call(this),this.fog=!0,this.instancedPos=!1,this.instancedMatrix=!1,this.attrColor=!1,this.attrColor2=!1,this.attrAlphaColor=!1,this.overrideColor=!1,this.sphereSprite=!1,this.cylinderSprite=!1,this.zClip=!1,this.clipPlane=!1,this.fakeOpacity=!1,this.prepassTransparancy=!1,this.colorFromPos=!1,this.shadowmap=!1,this.shadowmapType="random",this.colorFromDepth=!1,this.dashedLine=!1,this.transparent=!0,this.thickLine=!1,this.fogTransparent=!1,this.normalsToGBuffer=!1,this.toonShading=!1,this.uberOptions=Object.create(hf.prototype.uberOptions),Ra.prototype.setValues.call(this,{uniforms:en.clone(uf),vertexShader:this.precisionString()+"float INSTANCED_SPRITE_OVERSCALE = 1.3;\r\n\r\nattribute vec3 normal;\r\n\r\n#ifdef NORMALS_TO_G_BUFFER\r\n  varying vec3 viewNormal;\r\n#endif\r\n#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r\n  varying vec3 vNormal;\r\n#endif\r\n\r\n#ifdef THICK_LINE\r\n  attribute vec4 position; // W contains vert pos or neg offset\r\n#else\r\n  attribute vec3 position;\r\n#endif\r\n\r\nvarying vec3 vWorldPosition;\r\nvarying vec3 vViewPosition;\r\n\r\n#ifdef ATTR_ALPHA_COLOR\r\n  attribute float alphaColor;\r\n  varying float alphaCol;\r\n#endif\r\n\r\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\r\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r\n\t\tvarying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\r\n\t#endif\r\n#endif\r\n\r\n#ifdef ATTR_COLOR\r\n  attribute vec3 color;\r\n  varying vec3 vColor;\r\n#endif\r\n\r\n#ifdef ATTR_COLOR2\r\n  attribute vec3 color2;\r\n  varying vec3 vColor2;\r\n  attribute vec2 uv;\r\n  #ifndef CYLINDER_SPRITE\r\n    varying vec2 vUv;\r\n  #endif\r\n#endif\r\n\r\n#ifdef INSTANCED_POS\r\n  attribute vec4 offset;\r\n  #ifdef SPHERE_SPRITE\r\n    varying vec4 instOffset;\r\n  varying vec4 spritePosEye;\r\n  #endif\r\n#endif\r\n\r\n#ifdef INSTANCED_MATRIX\r\n  attribute vec4 matVector1;\r\n  attribute vec4 matVector2;\r\n  attribute vec4 matVector3;\r\n  attribute vec4 invmatVector1;\r\n  attribute vec4 invmatVector2;\r\n  attribute vec4 invmatVector3;\r\n\r\n  #ifdef CYLINDER_SPRITE\r\n    varying vec4 matVec1;\r\n    varying vec4 matVec2;\r\n    varying vec4 matVec3;\r\n    varying vec4 invmatVec1;\r\n    varying vec4 invmatVec2;\r\n    varying vec4 invmatVec3;\r\n  #endif\r\n#endif\r\n\r\nuniform mat4 modelViewMatrix; // optional\r\nuniform mat4 projectionMatrix; // optional\r\nuniform mat3 normalMatrix; // optional\r\nuniform mat4 modelMatrix; // optional\r\n\r\n#ifdef DASHED_LINE\r\n  attribute float lineDistance;\r\n  varying float vLineDistance;\r\n#endif\r\n\r\n#ifdef THICK_LINE\r\n  attribute vec3 direction;\r\n  uniform mat4 projMatrixInv;\r\n  uniform vec2 viewport;\r\n  uniform float lineWidth;\r\n\r\n  vec4 transform(vec4 coord){\r\n    return projectionMatrix * modelViewMatrix * coord;\r\n  }\r\n\r\n  vec2 project(vec4 device){\r\n    vec3 device_normal = device.xyz/device.w;\r\n    vec2 clip_pos = (device_normal*0.5+0.5).xy;\r\n    return clip_pos * viewport;\r\n  }\r\n\r\n  vec4 unproject(vec2 screen, float z, float w){\r\n    vec2 clip_pos = screen/viewport;\r\n    vec2 device_normal = clip_pos*2.0-1.0;\r\n    return vec4(device_normal*w, z, w);\r\n  }\r\n#endif\r\n\r\n\r\n/////////////////////////////////////////// Main ///////////////////////////////////////////////\r\nvoid main() {\r\n\r\n#ifdef ATTR_ALPHA_COLOR\r\n  alphaCol = alphaColor;\r\n#endif\r\n\r\n#ifdef INSTANCED_MATRIX\r\n  vec3 objectNormal = vec3(\r\n    dot(normal, matVector1.xyz),\r\n    dot(normal, matVector2.xyz),\r\n    dot(normal, matVector3.xyz));\r\n#else\r\n  vec3 objectNormal = vec3( normal );\r\n#endif\r\n\r\nvec3 transformedNormal = normalMatrix * objectNormal;\r\n\r\n#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r\n  vNormal = normalize(transformedNormal);\r\n#endif\r\n\r\n#ifdef NORMALS_TO_G_BUFFER\r\n  viewNormal = normalize(mat3(modelViewMatrix)*objectNormal);\r\n#endif\r\n\r\n  vec4 localPos = vec4(position.xyz, 1.0);\r\n  vec4 worldPos = modelMatrix * localPos;\r\n  vec4 mvPosition = modelViewMatrix * localPos;\r\n\r\n// make thick line offset\r\n#ifdef THICK_LINE\r\n   // get screen pos\r\n   vec4 dPos = transform(vec4(position.xyz, 1.0));\r\n   vec2 sPos = project(dPos);\r\n   // move pos forward\r\n   vec3 position2 = position.xyz + direction.xyz * 0.5;\r\n   // get screen offset pos\r\n   vec4 dPos2 = transform(vec4(position2.xyz, 1.0));\r\n   vec2 sPos2 = project(dPos2);\r\n   // screen line direction\r\n   vec2 sDir = normalize(sPos2 - sPos);\r\n   // vertex offset (orthogonal to line direction)\r\n   vec2 offset1 = vec2(-sDir.y, sDir.x);\r\n   // move screen vertex\r\n   vec2 newPos = sPos + offset1 * position.w * lineWidth;\r\n   // get moved pos in view space\r\n   vec4 dNewPos =  unproject(newPos, dPos.z, dPos.w);\r\n   mvPosition.xyz = (projMatrixInv * dNewPos).xyz;\r\n#endif // THICK_LINE\r\n\r\n#ifdef INSTANCED_POS\r\n  #ifdef SPHERE_SPRITE\r\n    instOffset = offset;\r\n\r\n    vec4 posEye = modelViewMatrix * vec4( offset.xyz, 1.0 );\r\n    float scale = length(modelViewMatrix[0]);\r\n    mvPosition = posEye + vec4( position.xyz * offset.w * scale * INSTANCED_SPRITE_OVERSCALE, 0.0 );\r\n    posEye.w = offset.w * scale;\r\n\r\n    spritePosEye = posEye;\r\n #else\r\n    localPos = vec4( offset.xyz + position.xyz * offset.w, 1.0 );\r\n    worldPos = modelMatrix * localPos;\r\n    mvPosition = modelViewMatrix * localPos;\r\n  #endif\r\n#endif\r\n\r\n#ifdef INSTANCED_MATRIX\r\n  #ifdef CYLINDER_SPRITE\r\n    matVec1 = matVector1;\r\n    matVec2 = matVector2;\r\n    matVec3 = matVector3;\r\n    invmatVec1 = invmatVector1;\r\n    invmatVec2 = invmatVector2;\r\n    invmatVec3 = invmatVector3;\r\n\r\n    // calculate eye coords of cylinder endpoints\r\n    vec4 v = vec4(0, -0.5, 0, 1);\r\n    vec4 p1 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\r\n    v.y = 0.5;\r\n    vec4 p2 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\r\n\r\n    // sprite is placed at the center of cylinder\r\n    vec4 posEye;\r\n    posEye.xyz = mix(p1.xyz, p2.xyz, 0.5);\r\n    posEye.w = 1.0;\r\n\r\n    // basic sprite size at screen plane (covers only cylinder axis)\r\n    vec2 spriteSizeScreen = abs(p2.xy / p2.z - p1.xy / p1.z);\r\n\r\n    // cylinder radius in eye space\r\n    float rad = length(modelViewMatrix[0]) * length(vec3(matVector1.x, matVector2.x, matVector3.x));\r\n\r\n    // full sprite size in eye coords\r\n    float minZ = min(abs(p1.z), abs(p2.z));\r\n    vec2 spriteSize = INSTANCED_SPRITE_OVERSCALE  * abs(posEye.z) *\r\n      (spriteSizeScreen + 2.0 * rad / minZ);\r\n\r\n    mvPosition = posEye + vec4( position.xy * 0.5 * spriteSize, 0, 0 );\r\n  #else\r\n    localPos = vec4(dot(localPos, matVector1), dot(localPos, matVector2), dot(localPos, matVector3), 1.0);\r\n    worldPos = modelMatrix * localPos;\r\n    mvPosition = modelViewMatrix * localPos;\r\n  #endif\r\n#endif\r\n\r\n  gl_Position = projectionMatrix * mvPosition;\r\n\r\n  vWorldPosition = worldPos.xyz;\r\n  vViewPosition = - mvPosition.xyz;\r\n\r\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\t  vec4 worldPosition;\r\n\t  // see THREE.WebGLProgram.unrollLoops\r\n\t  #pragma unroll_loop\r\n\t  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n      vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * vec4(vWorldPosition, 1.0);\r\n      vDirectionalShadowNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(objectNormal, 0.0))).xyz;\r\n\t  }\r\n\t#endif\r\n#endif\r\n\r\n#ifdef ATTR_COLOR\r\n  vColor = color.xyz;\r\n#endif\r\n\r\n#ifdef ATTR_COLOR2\r\n  vColor2 = color2;\r\n  #ifndef CYLINDER_SPRITE\r\n    vUv = uv;\r\n  #endif\r\n#endif\r\n\r\n#ifdef DASHED_LINE\r\n  vLineDistance = lineDistance;\r\n#endif\r\n}\r\n",fragmentShader:this.precisionString()+"#if defined (NORMALS_TO_G_BUFFER)\r\n  #define fragColor gl_FragData[0]\r\n#else\r\n  #define fragColor gl_FragColor\r\n#endif\r\n\r\n#ifdef ATTR_ALPHA_COLOR\r\n  varying float alphaCol;\r\n#endif\r\n\r\n#ifdef COLOR_FROM_POS\r\n  uniform mat4 world2colorMatrix;\r\n#endif\r\n\r\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\r\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r\n\t\tvarying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\r\n\r\n    #ifdef SHADOWMAP_PCF_RAND\r\n      // We use 4 instead uniform variable or define because this value is used in for(... i < value; ...) with\r\n      // unroll_loop and unroll_loop has pattern:\r\n      // /#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g\r\n      uniform vec2 samplesKernel[4]; // 4 is length of _samplesKernel which is defined in UberMaterial.js\r\n      uniform sampler2D noiseTex;\r\n      uniform vec2 noiseTexelSize;\r\n      uniform vec2 srcTexelSize;\r\n      uniform mat4 projectionMatrix;\r\n    #endif\r\n\t#endif\r\n#endif\r\n\r\n#ifdef ATTR_COLOR\r\n  varying vec3 vColor;\r\n#endif\r\n\r\n#ifdef ATTR_COLOR2\r\n  varying vec3 vColor2;\r\n  #ifndef CYLINDER_SPRITE\r\n    varying vec2 vUv;\r\n  #endif\r\n#endif\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\nuniform vec3 fixedColor;\r\nuniform float opacity;\r\nuniform float zClipValue;\r\nuniform float clipPlaneValue;\r\n\r\n#ifdef NORMALS_TO_G_BUFFER\r\n  varying vec3 viewNormal;\r\n#endif\r\n\r\n#define PI 3.14159265359\r\n#define RECIPROCAL_PI 0.31830988618\r\n#define saturate(a) clamp( a, 0.0, 1.0 )\r\n\r\n#ifdef USE_FOG\r\n  uniform vec3 fogColor;\r\n  uniform float fogAlpha;\r\n  uniform float fogNear;\r\n  uniform float fogFar;\r\n#endif\r\n\r\nvarying vec3 vWorldPosition; // world position of the pixel (invalid when INSTANCED_SPRITE is defined)\r\nvarying vec3 vViewPosition;\r\n\r\n#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r\n  varying vec3 vNormal;\r\n#endif\r\n\r\n/////////////////////////////////////////// ZSprites ////////////////////////////////////////////////\r\n#ifdef SPHERE_SPRITE\r\n  varying vec4 spritePosEye;\r\n#endif\r\n\r\n#if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n  uniform float zOffset;\r\n  uniform mat4 projectionMatrix;\r\n\r\n  float calcDepthForSprites(vec4 pixelPosEye, float zOffset, mat4 projMatrix) {\r\n    vec4 pixelPosScreen = projMatrix * pixelPosEye;\r\n    return 0.5 * (pixelPosScreen.z / pixelPosScreen.w + 1.0) + zOffset;\r\n  }\r\n#endif\r\n\r\n#ifdef SPHERE_SPRITE\r\n  varying vec4 instOffset;\r\n  uniform mat4 modelMatrix;\r\n  uniform mat4 modelViewMatrix;\r\n  uniform mat4 invModelViewMatrix;\r\n  uniform mat3 normalMatrix;\r\n\r\n  float intersect_ray_sphere(in vec3 origin, in vec3 ray, out vec3 point) {\r\n\r\n    // intersect XZ-projected ray with circle\r\n    float a = dot(ray, ray);\r\n    float b = dot(ray, origin);\r\n    float c = dot(origin, origin) - 1.0;\r\n    float det = b * b - a * c;\r\n    if (det < 0.0) return -1.0;\r\n    float t1 = (-b - sqrt(det)) / a;\r\n    float t2 = (-b + sqrt(det)) / a;\r\n\r\n    // calculate both intersection points\r\n    vec3 p1 = origin + ray * t1;\r\n    vec3 p2 = origin + ray * t2;\r\n\r\n    // choose nearest point\r\n    if (t1 >= 0.0) {\r\n      point = p1;\r\n      return t1;\r\n    }\r\n    if (t2 >= 0.0) {\r\n      point = p2;\r\n      return t2;\r\n    }\r\n\r\n    return -1.0;\r\n  }\r\n\r\n  float get_sphere_point(in vec3 pixelPosEye, out vec3 point) {\r\n    // transform camera pos into sphere local coords\r\n    vec4 v = invModelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\r\n    vec3 origin = (v.xyz - instOffset.xyz) / instOffset.w;\r\n\r\n    // transform (camera -> pixel) ray into cylinder local coords\r\n    v = invModelViewMatrix * vec4(pixelPosEye, 0.0);\r\n    vec3 ray = normalize(v.xyz);\r\n\r\n    return intersect_ray_sphere(origin, ray, point);\r\n  }\r\n#endif\r\n\r\n#ifdef CYLINDER_SPRITE\r\n  varying vec4 matVec1;\r\n  varying vec4 matVec2;\r\n  varying vec4 matVec3;\r\n  varying vec4 invmatVec1;\r\n  varying vec4 invmatVec2;\r\n  varying vec4 invmatVec3;\r\n\r\n  uniform mat4 modelMatrix;\r\n  uniform mat4 modelViewMatrix;\r\n  uniform mat4 invModelViewMatrix;\r\n  uniform mat3 normalMatrix;\r\n\r\n  float intersect_ray_cylinder(in vec3 origin, in vec3 ray, out vec3 point) {\r\n\r\n    // intersect XZ-projected ray with circle\r\n    float a = dot(ray.xz, ray.xz);\r\n    float b = dot(ray.xz, origin.xz);\r\n    float c = dot(origin.xz, origin.xz) - 1.0;\r\n    float det = b * b - a * c;\r\n    if (det < 0.0) return -1.0;\r\n    float t1 = (-b - sqrt(det)) / a;\r\n    float t2 = (-b + sqrt(det)) / a;\r\n\r\n    // calculate both intersection points\r\n    vec3 p1 = origin + ray * t1;\r\n    vec3 p2 = origin + ray * t2;\r\n\r\n    // choose nearest point\r\n    float halfHeight = 0.5;\r\n    if (t1 >= 0.0 && p1.y >= -halfHeight && p1.y <= halfHeight) {\r\n      point = p1;\r\n      return t1;\r\n    }\r\n    if (t2 >= 0.0 && p2.y >= -halfHeight && p2.y <= halfHeight) {\r\n      point = p2;\r\n      return t2;\r\n    }\r\n\r\n    return -1.0;\r\n  }\r\n\r\n  float get_cylinder_point(in vec3 pixelPosEye, out vec3 point) {\r\n    // transform camera pos into cylinder local coords\r\n    vec4 v = invModelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\r\n    vec3 origin = vec3(\r\n      dot(v, invmatVec1),\r\n      dot(v, invmatVec2),\r\n      dot(v, invmatVec3));\r\n\r\n    // transform (camera -> pixel) ray into cylinder local coords\r\n    v = invModelViewMatrix * vec4(pixelPosEye, 0.0);\r\n    vec3 ray = vec3(\r\n      dot(v, invmatVec1),\r\n      dot(v, invmatVec2),\r\n      dot(v, invmatVec3));\r\n    ray = normalize(ray);\r\n\r\n    return intersect_ray_cylinder(origin, ray, point);\r\n  }\r\n#endif\r\n\r\n///////////////////////////////////// Pack and unpack ///////////////////////////////////////////////\r\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\r\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\r\n\r\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\r\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\r\n\r\n\r\nconst float ShiftRight8 = 1. / 256.;\r\n\r\nvec4 packDepthToRGBA( const in float v ) {\r\n  vec4 r = vec4( fract( v * PackFactors ), v );\r\n  r.yzw -= r.xyz * ShiftRight8; // tidy overflow\r\n  return r * PackUpscale;\r\n}\r\n\r\nfloat unpackRGBAToDepth( const in vec4 v ) {\r\n  return dot( v, UnpackFactors );\r\n}\r\n\r\n////////////////////////////////////////// All Lighting /////////////////////////////////////////////////\r\n#ifdef TOON_SHADING\r\n  #define LOW_TOON_BORDER 0.0\r\n  #define MEDIUM_TOON_BORDER 0.7\r\n  #define HIGH_TOON_BORDER 1.0\r\n\r\n  #define MEDIUM_TOON_RANGE 0.5\r\n  #define HIGH_TOON_RANGE 0.95\r\n#endif\r\n#if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\r\n  struct ReflectedLight {\r\n    vec3 directDiffuse;\r\n    vec3 directSpecular;\r\n    vec3 indirectDiffuse;\r\n  };\r\n\r\n  struct BlinnPhongMaterial {\r\n    vec3  diffuseColor;\r\n    vec3  specularColor;\r\n    float specularShininess;\r\n  };\r\n\r\n  struct GeometricContext {\r\n    vec3 normal;\r\n    vec3 viewDir;\r\n  };\r\n\r\n  struct DirectionalLight {\r\n    vec3 direction;\r\n    vec3 color;\r\n\r\n    int shadow;\r\n    vec2 shadowMapSize;\r\n    float shadowBias;\r\n    float shadowRadius;\r\n  };\r\n\r\n  uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\r\n  uniform vec3 ambientLightColor;\r\n\r\n  /////////////////////////////////////////// Shadowmap ////////////////////////////////////////////////\r\n\r\n  #if defined(SHADOWMAP)\r\n  \tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\r\n  \t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\r\n  \t}\r\n\r\n    float getShadow( sampler2D shadowMap, DirectionalLight dirLight, vec4 shadowCoord, vec3 vViewPosition, vec3 vNormal ) {\r\n   \t  float shadow = 0.0;\r\n\r\n      // When shadows for sprites will appear use here for them normals as it done for G-buffer\r\n      shadowCoord.xyz += dirLight.shadowBias * vNormal;\r\n      shadowCoord.xyz /= shadowCoord.w;\r\n\r\n      bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r\n      bool inFrustum = all( inFrustumVec );\r\n      bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r\n      bool frustumTest = all( frustumTestVec );\r\n\r\n      if ( frustumTest ) {\r\n        #ifdef SHADOWMAP_BASIC\r\n      \t  shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\r\n      \t#endif\r\n\r\n      \t#ifdef SHADOWMAP_PCF_SHARP\r\n      \t  vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\r\n\r\n            float dx0 = - texelSize.x * dirLight.shadowRadius;\r\n            float dy0 = - texelSize.y * dirLight.shadowRadius;\r\n            float dx1 = + texelSize.x * dirLight.shadowRadius;\r\n            float dy1 = + texelSize.y * dirLight.shadowRadius;\r\n\r\n            shadow = (\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\r\n            ) * ( 1.0 / 9.0 );\r\n        #endif\r\n\r\n        #ifdef SHADOWMAP_PCF_RAND\r\n          vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\r\n\r\n          vec4 vUv = ((projectionMatrix * vec4(vViewPosition, 1.0)) + 1.0) / 2.0;\r\n          vec2 vUvNoise = vUv.xy / srcTexelSize * noiseTexelSize;\r\n\r\n          vec2 noiseVec = normalize(texture2D(noiseTex, vUvNoise).rg);\r\n          mat2 mNoise = mat2(noiseVec.x, noiseVec.y, -noiseVec.y, noiseVec.x);\r\n\r\n          vec2 offset;\r\n          #pragma unroll_loop\r\n          for ( int i = 0; i < 4; i ++ ) { // 4 is length of _samplesKernel which is defined in UberMaterial.js\r\n            offset = mNoise * ( normalize( samplesKernel[ i ]) * texelSize * dirLight.shadowRadius );\r\n            shadow +=  texture2DCompare( shadowMap, shadowCoord.xy + offset, shadowCoord.z );\r\n          }\r\n          shadow /= float( 4 ); // 4 is length of _samplesKernel which is defined in UberMaterial.js\r\n        #endif\r\n      }\r\n      return shadow;//(shadow != 1.0) ? 0.5 : 1.0;//vec4(shadow, shadow, shadow, 1.0);\r\n   }\r\n  #endif\r\n\r\n  /////////////////////////////////////////// Lighting /////////////////////////////////////////////////\r\n\r\n  vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\r\n    return RECIPROCAL_PI * diffuseColor;\r\n  } // validated\r\n\r\n  vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\r\n    // Original approximation by Christophe Schlick '94\r\n    //;float fresnel = pow( 1.0 - dotLH, 5.0 );\r\n    // Optimized variant (presented by Epic at SIGGRAPH '13)\r\n    float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\r\n    return ( 1.0 - specularColor ) * fresnel + specularColor;\r\n  } // validated\r\n\r\n  float G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\r\n    // geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\r\n    return 0.25;\r\n  }\r\n\r\n  float D_BlinnPhong( const in float shininess, const in float dotNH ) {\r\n    return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\r\n  }\r\n\r\n  vec3 BRDF_Specular_BlinnPhong( const in DirectionalLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\r\n    vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\r\n    float dotNH = saturate(dot( geometry.normal, halfDir ));\r\n    float dotLH = saturate(dot( incidentLight.direction, halfDir ));\r\n\r\n    vec3 F = F_Schlick( specularColor, dotLH );\r\n    float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\r\n    float D = D_BlinnPhong( shininess, dotNH );\r\n\r\n    return F * ( G * D );\r\n  } // validated\r\n\r\n  void RE_Direct_BlinnPhong( const in DirectionalLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight, float penumbra ) {\r\n\r\n    float dotNL = saturate( dot( geometry.normal, directLight.direction ));\r\n    #ifdef TOON_SHADING\r\n      if(dotNL < MEDIUM_TOON_RANGE){\r\n        dotNL = LOW_TOON_BORDER;\r\n      }\r\n      else if(dotNL < HIGH_TOON_RANGE){\r\n        dotNL = MEDIUM_TOON_BORDER;\r\n      }\r\n      else{\r\n        dotNL = HIGH_TOON_BORDER;\r\n      }\r\n    #endif\r\n\r\n    vec3 irradiance = dotNL * directLight.color * PI;\r\n    reflectedLight.directDiffuse += penumbra * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n    reflectedLight.directSpecular += penumbra * irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess );\r\n  }\r\n\r\n  void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\r\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n  }\r\n\r\n  vec3 calcLighting(const in GeometricContext geometry, const in BlinnPhongMaterial material, vec3 vViewPosition) {\r\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ));\r\n    vec3 irradiance = ambientLightColor * PI;\r\n\r\n    float shadowMask = 1.0;\r\n    // see THREE.WebGLProgram.unrollLoops\r\n  \t#pragma unroll_loop\r\n  \t  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n  \t    #ifdef SHADOWMAP\r\n  \t    if ( directionalLights[ i ].shadow > 0 ) shadowMask = getShadow( directionalShadowMap[ i ], directionalLights[ i ], vDirectionalShadowCoord[ i ], vViewPosition, vDirectionalShadowNormal[ i ] );\r\n  \t    #endif\r\n\r\n  \t\t  if ( shadowMask > 0.0 ) RE_Direct_BlinnPhong( directionalLights[ i ], geometry, material, reflectedLight, shadowMask );\r\n  \t\t}\r\n\r\n    RE_IndirectDiffuse_BlinnPhong(irradiance, material, reflectedLight);\r\n\r\n    return saturate(reflectedLight.indirectDiffuse + reflectedLight.directDiffuse + reflectedLight.directSpecular);\r\n  }\r\n#endif\r\n\r\n/////////////////////////////////////////// Dashed Line ///////////////////////////////////////////////\r\n#ifdef DASHED_LINE\r\n  uniform float dashedLineSize;\r\n  uniform float dashedLinePeriod;\r\n  varying float vLineDistance;\r\n#endif\r\n\r\n/////////////////////////////////////////// Main ///////////////////////////////////////////////\r\nvoid main() {\r\n\r\n#ifdef CLIP_PLANE\r\n  if (vViewPosition.z < clipPlaneValue) discard;\r\n#endif\r\n\r\n#ifdef ZCLIP\r\n  if (vViewPosition.z < zClipValue) discard;\r\n#endif\r\n\r\n  vec4 pixelPosWorld = vec4(vWorldPosition, 1.0);\r\n  vec4 pixelPosEye;\r\n\r\n#ifdef SPHERE_SPRITE\r\n\r\n  vec3 viewNormalSprites;\r\n  vec3 normal;\r\n\r\n/* quick-and-dirty method\r\n  normal.xy = ' + INSTANCED_SPRITE_OVERSCALE + ' * (2.0 * vUv - 1.0);\r\n  float r2 = dot(normal.xy, normal.xy);\r\n  if (r2 > 1.0) discard;\r\n  float normalZ = sqrt(1.0 - r2);\r\n  normal.z = normalZ;\r\n  normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\r\n  pixelPosEye = vec4(spritePosEye.xyz, 1.0);\r\n  pixelPosEye.z += spritePosEye.w * normalZ;\r\n*/\r\n\r\n  // ray-trace sphere surface\r\n  {\r\n    vec3 p;\r\n    if (get_sphere_point(-vViewPosition, p) < 0.0) discard;\r\n    pixelPosWorld = modelMatrix * vec4(instOffset.xyz + p * instOffset.w, 1.0);\r\n    // pixelPosEye = modelViewMatrix * vec4(instOffset.xyz + p * instOffset.w, 1.0);\r\n    pixelPosEye = vec4(spritePosEye.xyz, 1.0);\r\n    pixelPosEye.z += instOffset.w *\r\n      (modelViewMatrix[0][2] * p.x +\r\n       modelViewMatrix[1][2] * p.y +\r\n       modelViewMatrix[2][2] * p.z);\r\n    normal = normalize(normalMatrix * p);\r\n    #ifdef NORMALS_TO_G_BUFFER\r\n      viewNormalSprites = normalize(mat3(modelViewMatrix)*p);\r\n    #endif\r\n  }\r\n\r\n#endif\r\n\r\n#ifdef CYLINDER_SPRITE\r\n  vec3 normal;\r\n  vec3 viewNormalSprites;\r\n  float cylinderY = 0.0;\r\n\r\n    // ray-trace cylinder surface\r\n    {\r\n      vec3 p;\r\n      if (get_cylinder_point(-vViewPosition, p) < 0.0) discard;\r\n\r\n      cylinderY = 0.5 * (p.y + 1.0);\r\n\r\n      vec4 v = vec4(p, 1.0);\r\n      v = vec4(dot(v, matVec1), dot(v, matVec2), dot(v, matVec3), 1.0);\r\n      pixelPosWorld = modelMatrix * v;\r\n      pixelPosEye = modelViewMatrix * v;\r\n\r\n      vec3 localNormal = normalize(vec3(p.x, 0.0, p.z));\r\n      normal = vec3(\r\n        dot(localNormal, matVec1.xyz),\r\n        dot(localNormal, matVec2.xyz),\r\n        dot(localNormal, matVec3.xyz));\r\n      #ifdef NORMALS_TO_G_BUFFER\r\n        viewNormalSprites = normalize(mat3(modelViewMatrix)*normal);\r\n      #endif\r\n      normal = normalize(normalMatrix * normal);\r\n    }\r\n#endif\r\n\r\n  #ifdef ATTR_COLOR\r\n    vec3 vertexColor = vColor;\r\n  #else\r\n    vec3 vertexColor = vec3(1.0, 1.0, 1.0);\r\n  #endif\r\n\r\n  #ifdef ATTR_COLOR2\r\n    #ifdef CYLINDER_SPRITE\r\n      float colorCoef = cylinderY; // cylinder parameter is calculated from ray-tracing\r\n    #else\r\n      float colorCoef = vUv.y; // cylinder parameter is interpolated as tex coord\r\n    #endif\r\n      // choose either color or color2\r\n    vertexColor = mix(vColor2, vColor, step(0.5, colorCoef));\r\n  #endif\r\n\r\n  // negative red component is a special condition\r\n  if (vertexColor.x < 0.0) discard;\r\n\r\n  #ifdef DASHED_LINE\r\n    if ( mod( vLineDistance, dashedLinePeriod ) > dashedLineSize ) discard;\r\n  #endif\r\n\r\n  // transparency prepass writes only z, so we don't need to calc the color\r\n  #ifdef PREPASS_TRANSP\r\n    fragColor = vec4(1.0, 1.0, 1.0, 1.0);\r\n    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r\n    #endif\r\n    return;\r\n  #endif\r\n\r\n    float totalOpacity = opacity;\r\n\r\n  #ifdef ATTR_ALPHA_COLOR\r\n    totalOpacity *= alphaCol;\r\n  #endif\r\n\r\n  // discard fully transparent pixels\r\n  if (totalOpacity == 0.0) discard;\r\n\r\n  #ifdef FAKE_OPACITY\r\n    // discard pixels in checker pattern\r\n    vec2 dm_coord = floor(gl_FragCoord.xy);\r\n    dm_coord = fract(dm_coord * 0.5);\r\n    if (totalOpacity < 1.0 && (dm_coord.x < 0.5 ^^ dm_coord.y < 0.5)) discard;\r\n    vec4 diffuseColor = vec4(diffuse, 1.0);\r\n  #else\r\n    vec4 diffuseColor = vec4(diffuse, totalOpacity);\r\n  #endif\r\n\r\n  float flipNormal;\r\n  #if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r\n    flipNormal = 1.0;\r\n    #ifdef DOUBLE_SIDED\r\n      flipNormal = float( gl_FrontFacing );\r\n    #endif\r\n    vec3 normal = normalize( vNormal ) * flipNormal;\r\n  #endif\r\n\r\n    diffuseColor.rgb *= vertexColor;\r\n\r\n  #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n    gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r\n  #endif\r\n\r\n  #ifdef NORMALS_TO_G_BUFFER\r\n    #if defined (SPHERE_SPRITE) || defined (CYLINDER_SPRITE)\r\n      vec3 viewNormaInColor = viewNormalSprites;\r\n      float frontFaced = 1.0;\r\n    #else\r\n      vec3 viewNormaInColor = viewNormal;\r\n      float frontFaced = float( gl_FrontFacing );\r\n    #endif\r\n    // [-1, 1] -> [0, 1]\r\n    viewNormaInColor = 0.5 * viewNormaInColor + 0.5;\r\n    gl_FragData[1] = vec4(viewNormaInColor, frontFaced);\r\n  #endif\r\n\r\n  #if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\r\n    GeometricContext geometry = GeometricContext(normal, normalize( vViewPosition ));\r\n    BlinnPhongMaterial material = BlinnPhongMaterial(diffuseColor.rgb, specular, shininess);\r\n    vec3 outgoingLight = calcLighting(geometry, material, vViewPosition);\r\n  #else\r\n    vec3 outgoingLight = diffuseColor.rgb;\r\n  #endif\r\n\r\n  #ifdef COLOR_FROM_DEPTH\r\n    float depth = 0.0;\r\n    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r\n      depth = gl_FragDepthEXT;\r\n    #else\r\n      depth = gl_FragCoord.z;\r\n    #endif\r\n    fragColor = packDepthToRGBA(depth);\r\n    return;\r\n  #endif\r\n\r\n  #ifdef COLOR_FROM_POS\r\n    fragColor = world2colorMatrix * pixelPosWorld;\r\n  #else\r\n    #ifdef OVERRIDE_COLOR\r\n      fragColor = vec4(fixedColor, diffuseColor.a);\r\n    #else\r\n      fragColor = vec4(outgoingLight, diffuseColor.a);//vec4(vNormal, 1.0);\r\n    #endif\r\n\r\n    #ifdef USE_FOG\r\n      float viewDistance;\r\n      #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n        viewDistance = abs(pixelPosEye.z);\r\n      #else\r\n        viewDistance = vViewPosition.z;\r\n      #endif\r\n      float fogFactor = smoothstep( fogNear, fogFar, viewDistance) * fogAlpha;\r\n      #ifdef FOG_TRANSPARENT\r\n        fragColor.a = fragColor.a * (1.0 - fogFactor);\r\n      #else\r\n        fragColor.rgb = mix( fragColor.rgb, fogColor, fogFactor );\r\n      #endif\r\n    #endif\r\n\r\n  #endif\r\n}\r\n",lights:!0,fog:!0,side:2}),this.setValues(e)}hf.prototype=Object.create(Ra.prototype),hf.prototype.constructor=hf,hf.prototype.precisionString=function(){var e=rf.precision;return"precision ".concat(e," float;\n")+"precision ".concat(e," int;\n\n")},hf.prototype.uberOptions={diffuse:new $e(16777215),specular:new $e(1118481),shininess:30,opacity:1,fixedColor:new $e(16777215),zOffset:0,zClipCoef:2,zClipValue:0,clipPlaneValue:0,world2colorMatrix:new V,dashedLineSize:.1,dashedLinePeriod:.3,projMatrixInv:new V,viewport:new x(800,600),lineWidth:2,fogAlpha:1,samplesKernel:lf,noiseTex:af.noiseTexture,noiseTexelSize:new x(1/af.noiseWidth,1/af.noiseHeight),srcTexelSize:new x(1/800,1/600),copy:function(e){this.diffuse.copy(e.diffuse),this.specular.copy(e.specular),this.shininess=e.shininess,this.opacity=e.opacity,this.fixedColor.copy(e.fixedColor),this.zOffset=e.zOffset,this.zClipCoef=e.zClipCoef,this.zClipValue=e.zClipValue,this.clipPlaneValue=e.clipPlaneValue,this.world2colorMatrix.copy(e.world2colorMatrix),this.dashedLineSize=e.dashedLineSize,this.dashedLinePeriod=e.dashedLinePeriod,this.projMatrixInv=e.projMatrixInv,this.viewport=e.viewport,this.lineWidth=e.lineWidth,this.toonShading=e.toonShading,this.fogAlpha=e.fogAlpha,this.samplesKernel=e.samplesKernel,this.noiseTex=e.noiseTex,this.noiseTexelSize=e.noiseTexelSize,this.srcTexelSize=e.srcTexelSize}},hf.prototype.copy=function(e){return Ra.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=en.clone(e.uniforms),this.defines=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sf(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.defines),this.extensions=e.extensions,this.fog=e.fog,this.instancedPos=e.instancedPos,this.instancedMatrix=e.instancedMatrix,this.attrColor=e.attrColor,this.attrColor2=e.attrColor2,this.attrAlphaColor=e.attrAlphaColor,this.overrideColor=e.overrideColor,this.sphereSprite=e.sphereSprite,this.cylinderSprite=e.cylinderSprite,this.zClip=e.zClip,this.clipPlane=e.clipPlane,this.fakeOpacity=e.fakeOpacity,this.colorFromPos=e.colorFromPos,this.shadowmap=e.shadowmap,this.shadowmapType=e.shadowmapType,this.colorFromDepth=e.colorFromDepth,this.prepassTransparancy=e.prepassTransparancy,this.dashedLine=e.dashedLine,this.thickLine=e.thickLine,this.fogTransparent=e.fogTransparent,this.normalsToGBuffer=e.normalsToGBuffer,this.toonShading=e.toonShading,this.uberOptions.copy(e.uberOptions),this},hf.prototype.createInstance=function(){var e=new hf;return e.copy(this),e.uberOptions=Object.create(this.uberOptions),e},hf.prototype.setValues=function(e){if(void 0!==e){Ra.prototype.setValues.call(this,e);var t={},n={};this.fog&&(t.USE_FOG=1),this.instancedPos&&(t.INSTANCED_POS=1),this.instancedMatrix&&(t.INSTANCED_MATRIX=1),this.attrColor&&(t.ATTR_COLOR=1),this.attrColor2&&(t.ATTR_COLOR2=1),this.attrAlphaColor&&(t.ATTR_ALPHA_COLOR=1),this.overrideColor&&(t.OVERRIDE_COLOR=1),this.sphereSprite&&(t.SPHERE_SPRITE=1,n.fragDepth=1),this.cylinderSprite&&(t.CYLINDER_SPRITE=1,n.fragDepth=1),this.zClip&&(t.ZCLIP=1),this.clipPlane&&(t.CLIP_PLANE=1),this.fakeOpacity&&(t.FAKE_OPACITY=1),this.lights&&(t.USE_LIGHTS=1),this.colorFromPos&&(t.COLOR_FROM_POS=1),this.shadowmap&&(t.SHADOWMAP=1,"pcf"===this.shadowmapType?t.SHADOWMAP_PCF_SHARP=1:"random"===this.shadowmapType?t.SHADOWMAP_PCF_RAND=1:t.SHADOWMAP_BASIC=1),this.colorFromDepth&&(t.COLOR_FROM_DEPTH=1),this.prepassTransparancy&&(t.PREPASS_TRANSP=1),this.dashedLine&&(t.DASHED_LINE=1),this.thickLine&&(t.THICK_LINE=1),this.fogTransparent&&(t.FOG_TRANSPARENT=1),this.normalsToGBuffer&&(n.drawBuffers=1,t.NORMALS_TO_G_BUFFER=1),this.toonShading&&(t.TOON_SHADING=1),this.defines=t,this.extensions=n}},hf.prototype.setUberOptions=function(e){if(void 0!==e)for(var t in e)e.hasOwnProperty(t)&&(this.uberOptions[t]instanceof $e?this.uberOptions[t]=e[t].clone():this.uberOptions[t]=e[t])},hf.prototype.clone=function(e){return e?this.createInstance():nt.prototype.clone.call(this)},hf.prototype.updateUniforms=function(){var e=this;cf.forEach((function(t){e.uniforms.hasOwnProperty(t)&&(e.uberOptions[t]instanceof $e||e.uberOptions[t]instanceof V?e.uniforms[t].value=e.uberOptions[t].clone():e.uniforms[t].value=e.uberOptions[t])}))};var df,ff,pf={DEFAULT:0,VOLUME:1,TRANSPARENT:2,PREPASS_TRANSPARENT:3,VOLUME_BFPLANE:4,COLOR_FROM_POSITION:5},mf=[pf.DEFAULT,pf.TRANSPARENT];oe.prototype.resetTransform=function(){this.position.set(0,0,0),this.quaternion.set(0,0,0,1),this.scale.set(1,1,1)},oe.prototype.updateMatrixWorldRecursive=function(){null!=this.parent&&this.parent.updateMatrixWorldRecursive(),this.updateMatrixWorld()},oe.prototype.addSavingWorldTransform=(df=new V,function(e){e instanceof oe&&(df.getInverse(this.matrixWorld),df.multiply(e.matrixWorld),e.matrix.copy(df),e.matrix.decompose(e.position,e.quaternion,e.scale),this.add(e))}),di.prototype.renderDummyQuad=function(){var e=new rt({transparent:!0,opacity:0,depthWrite:!1}),t=new ae,n=new Gt(new gn(.01,.01),e);t.add(n);var r=new Gs(-.5,.5,.5,-.5,-1e4,1e4);return r.position.z=100,function(){this.render(t,r)}}(),di.prototype.renderScreenQuad=function(){var e=new ae,t=new Gt(new gn(1,1));e.add(t);var n=new Gs(-.5,.5,.5,-.5,-1e4,1e4);return n.position.z=100,function(r){t.material=r,this.render(e,n)}}(),V.prototype.isIdentity=(ff=new V,function(){return ff.equals(this)}),V.prototype.applyToPointsArray=function(e,t,n){if(!e||!t||t<3)return e;n=n||0;for(var r=this.elements,i=0;i<e.length;i+=t){var o=e[i],a=e[i+1],s=e[i+2],l=1/(r[3]*o+r[7]*a+r[11]*s+r[15]);e[i]=(r[0]*o+r[4]*a+r[8]*s+r[12]*n)*l,e[i+1]=(r[1]*o+r[5]*a+r[9]*s+r[13]*n)*l,e[i+2]=(r[2]*o+r[6]*a+r[10]*s+r[14]*n)*l}return e};var vf,gf,yf=function(e){function t(e){return h(this,t),void 0===e.uniforms&&(e.uniforms={}),e.uniforms.srcTex={type:"t",value:null},e.vertexShader=nf,e.transparent=!1,e.depthTest=!1,e.depthWrite=!1,d(this,f(t).call(this,e))}return m(t,e),t}(Ra);function _f(e,t){!function e(n){n instanceof Gt&&t(n);for(var r=0,i=n.children.length;r<i;r++)e(n.children[r])}(e)}function xf(e){e.traverse((function(e){(e instanceof Gt||e instanceof no||e instanceof Qi)&&e.geometry.dispose()})),function(e){for(var t=e.children,n=0,r=t.length;n<r;++n){var i=t[n];i.parent=null,i.dispatchEvent({type:"removed"})}e.children=[]}(e)}function bf(e,t){var n=[];return e.traverse((function(e){for(var r=0;r<t.length;r++)if(e instanceof t[r]){n[n.length]=e;break}})),n}function wf(e){if(e.castShadow){var t=e.material.createInstance();t.setValues({colorFromDepth:!0,lights:!1,shadowmap:!1,fog:!1}),e.customDepthMaterial=t}!e.receiveShadow&&e.material.shadowmap&&e.material.setValues({shadowmap:!1})}di.prototype.renderScreenQuadFromTex=(vf=new yf({uniforms:{opacity:{type:"f",value:1}},fragmentShader:"precision highp float;\r\n\r\nvarying vec2 vUv;\r\nuniform sampler2D srcTex;\r\nuniform float opacity;\r\n\r\nvoid main() {\r\n  vec4 color = texture2D(srcTex, vUv);\r\n  gl_FragColor = vec4(color.xyz, color.a * opacity);\r\n}\r\n",transparent:!0}),function(e,t){vf.uniforms.srcTex.value=e,vf.transparent=t<1,vf.uniforms.opacity.value=t,this.renderScreenQuad(vf)}),di.prototype.renderScreenQuadFromTexWithDistortion=function(){var e=new yf({uniforms:{coef:{type:"f",value:1}},fragmentShader:"precision highp float;\r\n\r\nvarying vec2 vUv;\r\nuniform sampler2D srcTex;\r\nuniform float coef;\r\n\r\nvoid main() {\r\n  vec2 uv = vUv * 2.0 - 1.0;\r\n  float r2 = dot(uv, uv);\r\n  vec2 tc = uv * (1.0 + coef * r2);\r\n  if (!all(lessThan(abs(tc), vec2(1.0))))\r\n    discard;\r\n  tc = 0.5 * (tc + 1.0);\r\n  gl_FragColor = texture2D(srcTex, tc);\r\n}\r\n"});return function(t,n){e.uniforms.srcTex.value=t,e.uniforms.coef.value=n,this.renderScreenQuad(e)}}(),rn.prototype.setMinimalFov=function(e){this.aspect>=1?this.fov=e:this.fov=_.radToDeg(2*Math.atan(Math.tan(.5*_.degToRad(e))/this.aspect))},gl.prototype.updateHalfSized=function(e,t){var n=e.aspect,r=e.fov;e.aspect=n/2,e.setMinimalFov(t),e.updateProjectionMatrix(),this.update(e),e.aspect=n,e.fov=r,e.updateProjectionMatrix()},rn.prototype.setDistanceToFit=function(e,t){this.position.z=e/Math.sin(.5*_.degToRad(t))},Yl.prototype.intersectVisibleObject=function(e,t,n,r){var i=this.intersectObject(e,!1);if(0===i.length)return null;var o,a=Math.min(t.near,n),s=i[0],l=new E;for(o=0;o<i.length&&(s=i[o],l.copy(s.point),l.applyMatrix4(t.matrixWorldInverse),!(l.z<=-a));++o);if(o===i.length)return null;var u=Math.min(t.far,r);return l.copy(s.point),l.applyMatrix4(t.matrixWorldInverse),l.z<=-u?null:s},V.prototype.extractScale=(gf=new E,function(e){void 0===e&&(zc.debug("extractScale(): new is too expensive operation to do it on-the-fly"),e=gf.clone());var t=this.elements;return e.x=gf.set(t[0],t[1],t[2]).length(),e.y=gf.set(t[4],t[5],t[6]).length(),e.z=gf.set(t[8],t[9],t[10]).length(),this.determinant()<0&&(e.x=-e.x),e}),ot.prototype.copyAtList=function(e,t){console.assert(this.itemSize===e.itemSize,"false: BufferAttribute.copyAtList buffers have different item size.");for(var n=this.itemSize,r=0,i=t.length;r<i;++r)for(var o=0;o<n;++o)this.array[r*n+o]=e.array[t[r]*n+o];return this};var Sf={calcCylinderMatrix:function(e,t,n){var r=e.clone().lerp(t,.5),i=new V;i.makeScale(n,e.distanceTo(t),n);var o=new V;o.makeRotationX(Math.PI/2);var a=new V,s=new E(0,1,0);return a.lookAt(r,t,s),a.multiply(o),a.multiply(i),a.setPosition(r),a},calcChunkMatrix:function(e,t,n,r){var i=new V;i.makeScale(r.x,r.y,0);var o=new V;return o.lookAt(e,t,n),o.multiply(i),o.setPosition(e),o},forEachMeshInGroup:_f,countTriangles:function(e){var t=0;return _f(e,(function(e){t+=function(e){var t=e.geometry;if(t instanceof Zs){var n=t.attributes;for(var r in n)if(n.hasOwnProperty(r)&&n[r]instanceof $s){var i=n[r];return(t.index?t.index.array.length/3:0)*i.array.length/i.itemSize}return 0}return t instanceof Et?t.index?t.index.array.length/3:0:t.faces?t.faces.length:0}(e)})),t},groupHasGeometryToRender:function(e){var t=!1;return e.traverse((function(e){(e.hasOwnProperty("geometry")||e instanceof ef)&&(t=!0)})),t},buildDistorionMesh:function(e,t,n){function r(e){for(var t=0,r=e,i=1;Math.abs(r-t)>1e-5;)t=r,r=e/((i=1+n*r)*i);return 1/i}for(var i=new gn(2,2,e,t),o=i.getAttribute("position"),a=0;a<o.count;++a){var s=o.array[3*a],l=o.array[3*a+1],u=r(s*s+l*l);o.setXY(a,u*s,u*l)}return i},RCGroup:tf,fillArray:function(e,t,n,r){n=void 0!==n?n:0,r=void 0!==r?r:e.length;for(var i=n;i<r;++i)e[i]=t},clearTree:xf,destroyObject:function(e){xf(e),e.parent?e.parent.remove(e):e.dispatchEvent({type:"removed"})},belongToSelectLayers:function(e){for(var t=0;t<mf.length;t++)if(1==(e.layers.mask>>mf[t]&1))return!0;return!1},applyTransformsToMeshes:function(e,t){var n=t.length;if(!(n<1))for(var r=bf(e,[Gt,no,Qi]),i=0,o=r.length;i<o;++i){var a=r[i],s=a.parent;if(s){a.applyMatrix(t[0]);for(var l=1;l<n;++l){var u=new a.constructor(a.geometry,a.material);s.add(u),u.applyMatrix(t[l])}}}},processTransparentMaterial:function(e,t){if(t instanceof hf)for(var n=bf(e,[Gt,no]),r=function(e,t){var r=n[e],i=r.parent;if(!i)return"continue";r.material.setValues({prepassTransparancy:!1,fakeOpacity:!1}),r.material.needsUpdate=!0,r.layers.set(pf.TRANSPARENT);var o=r.material.createInstance();o.setValues({prepassTransparancy:!0,fakeOpacity:!1});var a=new r.constructor(r.geometry,o);s.forEach(["transparent","colorFromDepth","lights","shadowmap","fog"],(function(e){a.material[e]=!1})),a.material.needsUpdate=!0,a.applyMatrix(r.matrix),a.layers.set(pf.PREPASS_TRANSPARENT),i.add(a)},i=0,o=n.length;i<o;++i)r(i)},processColFromPosMaterial:function(e,t){if(t instanceof hf)for(var n=bf(e,[Gt,no]),r=function(e,t){var r=n[e],i=r.parent;if(!i)return"continue";var o=r.material.createInstance();o.setValues({colorFromPos:!0});var a=new r.constructor(r.geometry,o);s.forEach(["transparent","colorFromDepth","lights","shadowmap","fog","overrideColor","fogTransparent","attrColor","attrColor2","attrAlphaColor","fakeOpacity"],(function(e){a.material[e]=!1})),a.material.needsUpdate=!0,a.applyMatrix(r.matrix),a.layers.set(pf.COLOR_FROM_POSITION),i.add(a)},i=0,o=n.length;i<o;++i)r(i)},prepareObjMaterialForShadow:wf,processMaterialForShadow:function(e,t){t instanceof hf&&e.traverse((function(e){e instanceof Gt&&wf(e)}))},processObjRenderOrder:function(e,t){var n=+("BA"!==t);e.traverse((function(e){e.isGroup&&(e.renderOrder=n)}))},makeVisibleMeshes:function(e,t){e&&e.traverse&&e.traverse((function(e){e instanceof Gt&&(e.visible=t(e))}))},applySelectionMaterial:function(e){e.traverse((function(e){"material"in e&&(e.material=e.material.clone(!0),e.material.setValues({depthFunc:3,overrideColor:!0,fog:!1}),e.material.setUberOptions({fixedColor:new $e(16776960),zOffset:-1e-6}))}))},getMiddlePoint:function(e,t,n){var r=n||new E;return r.set(0,0,0),r.addScaledVector(e,.5),r.addScaledVector(t,.5),r},LAYERS:pf},Ef={boundingBox:new xe(new E(-1,-1,-1),new E(1,1,1)),boundingSphere:new Se(new E(0,0,0),1)};function Tf(e,t){Sf.RCGroup.call(this),this.name=e,this._dataSource=t}$c.deriveClass(Tf,Sf.RCGroup),Tf.prototype.release=function(){this.parent&&this.parent.remove(this)},Tf.prototype.getDataSource=function(){return this._dataSource},Tf.prototype.getBoundaries=function(){return Ef};var Mf=function(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()};function Cf(e){return null==e||Array.isArray(e)?e:[e]}var Af=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["id"];h(this,e),this._list=[],this._dict={},this._indices=Mf(r),this._indices.forEach((function(e){t._dict[e]={}})),n.forEach((function(e){return t.register(e)}))}return Tc(e,[{key:"register",value:function(t){var n=this;e.registerInList(this._list,t),this._indices.forEach((function(r){e.registerInDict(n._dict[r],Cf(t[r]),t)}))}},{key:"unregister",value:function(t){var n=this;e.unregisterFromList(this._list,t),this._indices.forEach((function(r){e.unregisterFromDict(n._dict[r],Cf(t[r]),t)}))}},{key:"keys",value:function(e){return Object.keys(this._dict[e||this._indices[0]])}},{key:"get",value:function(e,t){var n=this._dict[t||this._indices[0]];if(n){var r=n[e&&e.toLowerCase()];return r&&r.length>0?r[0]:void 0}}},{key:"all",get:function(){return Mf(this._list)}},{key:"first",get:function(){return this._list[0]}}],[{key:"registerInList",value:function(e,t){e.includes(t)||e.push(t)}},{key:"unregisterFromList",value:function(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},{key:"registerInDict",value:function(e,t,n){t.forEach((function(t){t=t.toLowerCase();var r=e[t]=e[t]||[];r.includes(n)||r.push(n)}))}},{key:"unregisterFromDict",value:function(e,t,n){t.forEach((function(t){t=t.toLowerCase();var r=e[t];if(r){var i=r.indexOf(n);-1!==i&&r.splice(i,1),0===r.length&&delete e[t]}}))}}]),e}();function Rf(e){Object.defineProperties(e,{logger:{get:function(){return this.context&&this.context.logger?this.context.logger:zc}},settings:{get:function(){return this.context&&this.context.settings?this.context.settings:eh}}})}var Pf=function(){function e(t,n){h(this,e),this._position=t,this._radius=n}return Tc(e,[{key:"raycast",value:function(t){var n=e._sphere;n.set(this._position,this._radius);var r=new E;return t.ray.intersectSphere(n,r)?{distance:t.ray.origin.distanceTo(r),point:r}:null}}]),e}();u(Pf,"_sphere",new Se);var kf=function(e){return function(e){function t(e){var n,r;h(this,t);for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return(r=d(this,(n=f(t)).call.apply(n,[this].concat(o))))._objects=new Array(e),r.boundingSphere=null,r.boundingBox=null,r}return m(t,e),Tc(t,[{key:"setSphere",value:function(e,t,n){this._objects[e]=new Pf(t,n)}},{key:"raycast",value:function(e,t){for(var n=0,r=this._objects.length;n<r;++n){var i=this._objects[n].raycast(e);i&&(i.chunkIdx=n,t.push(i))}}},{key:"computeBoundingBox",value:function(){var e=this._objects,t=this.boundingBox;null===t&&(this.boundingBox=t=new xe),t.makeEmpty();for(var n=0,r=e.length;n<r;++n)t.expandByPoint(e[n]._position)}},{key:"computeBoundingSphere",value:function(){this.computeBoundingBox();var e=this._objects,t=this.boundingBox,n=0,r=new E;t.getCenter(r);for(var i=0,o=e.length;i<o;++i){var a=e[i]._position,s=r.distanceToSquared(a);n<s&&(n=s)}null===this.boundingSphere&&(this.boundingSphere=new Se),this.boundingSphere.set(r,Math.sqrt(n))}}]),t}(e)},Lf=new $e,Nf=$c.copySubArrays,If=function(e){function t(e,n,r){var i;return h(this,t),(i=d(this,f(t).call(this,e)))._sphGeometry=r?new gn(2,2,1,1):new da(1,2*n,n,0,2*Math.PI,0,Math.PI),i._init(e,i._sphGeometry),i}return m(t,e),Tc(t,[{key:"setItem",value:function(e,t,n){var r,i,o,a,s,l;r=this._offsets,i=4*e,o=t.x,a=t.y,s=t.z,l=n,r[i]=o,r[i+1]=a,r[i+2]=s,r[i+3]=l,this.setSphere(e,t,n)}},{key:"setColor",value:function(e,t){var n,r,i,o,a;Lf.set(t),n=this._colors,r=3*e,i=Lf.r,o=Lf.g,a=Lf.b,n[r]=i,n[r+1]=o,n[r+2]=a}},{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("offset").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(e,t){for(var n=this._alpha,r=0,i=e.length;r<i;++r)n[e[r]]=t;this.getAttribute("alphaColor").needsUpdate=!0}},{key:"getSubset",value:function(e){var t=e.length,n=new Zs;return this._init.call(n,t,this._sphGeometry),Nf(this._offsets,n._offsets,e,4),Nf(this._colors,n._colors,e,3),n.boundingSphere=this.boundingSphere,n.boundingBox=this.boundingBox,[n]}},{key:"_init",value:function(e,t){this.copy(t),this._offsets=$c.allocateTyped(Float32Array,4*e),this._colors=$c.allocateTyped(Float32Array,3*e);var n=this._alpha=$c.allocateTyped(Float32Array,e);s.fill(n,1),this.setAttribute("offset",new $s(this._offsets,4,!1,1)),this.setAttribute("color",new $s(this._colors,3,!1,1)),this.setAttribute("alphaColor",new $s(n,1,!1,1))}}]),t}(kf(Zs)),Of=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"uvIntersection",value:function(e,n,r,i,o,a,s){var l=t._barycoord;return qe.barycoordFromPoint(e,n,r,i,l),o.multiplyScalar(l.x),a.multiplyScalar(l.y),s.multiplyScalar(l.z),o.add(a).add(s),o.clone()}},{key:"checkIntersection",value:function(e,t,n,r,i,o,a){return null===n.intersectTriangle(r,i,o,!1,a)?null:{point:a.clone()}}},{key:"checkBufferGeometryIntersection",value:function(e,n,r,i,o,a,s,l){var u=t._vA,c=t._vB,h=t._vC,d=t._intersectionPoint;u.fromBufferAttribute(i,a),c.fromBufferAttribute(i,s),h.fromBufferAttribute(i,l);var f=this.checkIntersection(e,n,r,u,c,h,d);if(f){if(o){var p=t._uvA,m=t._uvB,v=t._uvC;p.fromBufferAttribute(o,a),m.fromBufferAttribute(o,s),v.fromBufferAttribute(o,l),f.uv=this.uvIntersection(d,u,c,h,p,m,v)}var g=new E;qe.getNormal(u,c,h,g),f.face=new et(a,s,l,g),f.faceIndex=a}return f}},{key:"raycast",value:function(e,t){var n=e.ray;if(null===this.boundingSphere&&this.computeBoundingSphere(),!1!==e.ray.intersectsSphere(this.boundingSphere)&&(null===this.boundingBox||!1!==n.intersectsBox(this.boundingBox))){var r,i,o,a=this.index,s=this.attributes,l=s.position,u=s.uv;if(null!==a)for(var c=0,h=a.count;c<h;c+=3){r=a.getX(c),i=a.getX(c+1),o=a.getX(c+2);var d=this.checkBufferGeometryIntersection(this,e,n,l,u,r,i,o);d&&(d.faceIndex=Math.floor(c/3),t.push(d))}}}}]),t}(Et);u(Of,"_vA",new E),u(Of,"_vB",new E),u(Of,"_vC",new E),u(Of,"_uvA",new x),u(Of,"_uvB",new x),u(Of,"_uvC",new x),u(Of,"_barycoord",new E),u(Of,"_intersectionPoint",new E);var Df=new $e,zf=function(e){function t(e,n){var r;if(h(this,t),(r=d(this,f(t).call(this))).constructor===t)throw new Error("Can not instantiate abstract class!");return r._chunkGeo=e,r._init(e,n),r}return m(t,e),Tc(t,[{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("position").needsUpdate=!0,this.getAttribute("normal").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0}},{key:"setColor",value:function(e,t){Df.set(t);for(var n=this._colors,r=this._chunkSize,i=e*r,o=i+r;i<o;++i){var a=3*i;n[a]=Df.r,n[a+1]=Df.g,n[a+2]=Df.b}}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(e,t){for(var n=this._alpha,r=this._chunkSize,i=0,o=e.length;i<o;++i){var a=e[i]*r;s.fill(n,t,a,a+r)}this.getAttribute("alphaColor").needsUpdate=!0}},{key:"raycast",value:function(e,n){var r=[];Hh(f(t.prototype),"raycast",this).call(this,e,r);for(var i=this._chunkGeo.index.count/3,o=0,a=r.length;o<a;++o)r[o].hasOwnProperty("faceIndex")&&(r[o].chunkIdx=Math.floor(r[o].faceIndex/i),n.push(r[o]))}},{key:"getSubset",value:function(e){var t=e.length,n=new Et;this._init.call(n,this._chunkGeo,t);for(var r=this._positions,i=this._normals,o=this._colors,a=n._positions,s=n._normals,l=n._colors,u=3*this._chunkSize,c=0,h=e.length;c<h;++c){var d=c*u,f=e[c]*u,p=f+u;a.set(r.subarray(f,p),d),s.set(i.subarray(f,p),d),l.set(o.subarray(f,p),d)}return n.boundingSphere=this.boundingSphere,n.boundingBox=this.boundingBox,[n]}},{key:"_init",value:function(e,t){var n=this._chunkSize=e.attributes.position.count,r=e.index.array,i=r.length,o=this._chunkSize*t,a=o>65535,l=i*t,u=this._index=$c.allocateTyped(a?Uint32Array:Uint16Array,l);this._positions=$c.allocateTyped(Float32Array,3*o),this._normals=$c.allocateTyped(Float32Array,3*o),this._colors=$c.allocateTyped(Float32Array,3*o);var c=this._alpha=$c.allocateTyped(Float32Array,o);s.fill(c,1);for(var h=0;h<t;++h){var d=h*i,f=h*n;u.set(r,d);for(var p=0;p<i;++p)u[d+p]+=f}this.setIndex(new ot(this._index,1)),this.setAttribute("position",new ot(this._positions,3)),this.setAttribute("normal",new ot(this._normals,3)),this.setAttribute("color",new ot(this._colors,3)),this.setAttribute("alphaColor",new ot(c,1))}}]),t}(Of),Ff=function(e){function t(e,n){var r;h(this,t);var i=new da(1,2*n,n,0,2*Math.PI,0,Math.PI),o=(r=d(this,f(t).call(this,e,i,e)))._normals,a=i.attributes.normal.array,s=r._chunkSize;r._chunkPos=r._chunkGeo.attributes.position.array,r._tmpPositions=$c.allocateTyped(Float32Array,3*s);for(var l=0;l<e;++l)o.set(a,3*s*l);return r}return m(t,e),Tc(t,[{key:"setItem",value:function(e,t,n){for(var r=this._tmpPositions,i=this._chunkSize,o=this._chunkPos,a=0;a<i;++a){var s=3*a;r[s]=t.x+o[s]*n,r[s+1]=t.y+o[s+1]*n,r[s+2]=t.z+o[s+2]*n}this._positions.set(r,i*e*3),this.setSphere(e,t,n)}}]),t}(kf(zf)),Bf=new E,Uf=new E,Vf=new C,Gf=function(e){function t(e,n){var r;h(this,t);var i=new wa(1,1,1,Math.max(3,n),2,!0),o=(r=d(this,f(t).call(this,i,2*e)))._chunkSize;return r._chunkPos=r._chunkGeo.attributes.position.array,r._chunkNorms=r._chunkGeo.attributes.normal.array,r._tmpVector=$c.allocateTyped(Float32Array,3*o),r}return m(t,e),Tc(t,[{key:"setItem",value:function(e,t,n,r){var i=this._chunkSize,o=2*i*e*3,a=o+3*i,s=this._tmpVector,l=this._chunkPos,u=this._chunkNorms;Bf.lerpVectors(t,n,.5);var c,h=Sf.calcCylinderMatrix(t,Bf,r);Vf.getNormalMatrix(h);for(var d=0;d<i;++d)c=3*d,Uf.fromArray(l,c),Uf.applyMatrix4(h),Uf.toArray(s,c);this._positions.set(s,o),Bf.sub(t);for(var f=0;f<i;++f)s[c=3*f]+=Bf.x,s[c+1]+=Bf.y,s[c+2]+=Bf.z;this._positions.set(s,a);for(var p=0;p<i;++p)c=3*p,Uf.fromArray(u,c),Uf.applyMatrix3(Vf),Uf.toArray(s,c);this._normals.set(s,o),this._normals.set(s,a)}},{key:"setColor",value:function(e,n,r){var i=2*e;Hh(f(t.prototype),"setColor",this).call(this,i,n);var o=i+1;Hh(f(t.prototype),"setColor",this).call(this,o,r)}}]),t}(zf),jf=function(e){function t(e,n,r,i,o,a){var s;h(this,t),s=d(this,f(t).call(this));var l=2*Math.PI;s.type="CylinderBufferGeometry",s.parameters={radiusTop:e,radiusBottom:n,height:r,radialSegments:i,heightSegments:o,openEnded:a};var u=!1===a&&e>0,c=!1===a&&n>0,p=(o+1)*i+u*(i+1)+c*(i+1),m=(2*o+u+c)*i,v=r/2,g=new ot($c.allocateTyped(Float32Array,3*p),3),y=new ot($c.allocateTyped(Float32Array,3*p),3),_=new ct($c.allocateTyped(Uint16Array,3*m),1),x=new ot($c.allocateTyped(Float32Array,2*p),2);console.assert(p<65536,"false: Cylinder Geometry has too many vertices (65536 max).");for(var b=0,w=0,S=-(n-e)/r,T=0;T<=o;T++){if(T!==o)for(var M=0;M<i;M++){var C=b+M,A=b+i+M,R=b+i+(M+1)%i,P=b+(M+1)%i;_.setXYZ(3*w,C,P,A),w++,_.setXYZ(3*w,A,P,R),w++}for(var k=T/o,L=k*(n-e)+e,N=0;N<i;N++){var I=N/i,O=L*Math.sin(I*l+0),D=k*r-v,z=L*Math.cos(I*l+0),F=new E(O,Math.sqrt(O*O+z*z)*S,z).normalize();g.setXYZ(b,O,D,z),y.setXYZ(b,F.x,F.y,F.z),x.setXY(b,I,k),++b}}if(u){for(var B=b,U=b+i,V=0;V<i;++V){var G=b-i;g.setXYZ(b,g.getX(G),g.getY(G),g.getZ(G)),y.setXYZ(b,0,1,0),x.setXY(b,1,1);var j=B+(V+1)%i;_.setXYZ(3*w,b,j,U),w++,b++}g.setXYZ(b,0,v,0),y.setXYZ(b,0,1,0),x.setXY(b,1,1),++b}if(c){for(var H=b,W=b+i,q=0;q<i;++q){var Y=q;g.setXYZ(b,g.getX(Y),g.getY(Y),g.getZ(Y)),y.setXYZ(b,0,-1,0),x.setXY(b,0,0);var X=H+(q+1)%i;_.setXYZ(3*w,X,b,W),w++,b++}g.setXYZ(b,0,-v,0),y.setXYZ(b,0,-1,0),x.setXY(b,0,0)}return s.setIndex(_),s.setAttribute("position",g),s.setAttribute("normal",y),s.setAttribute("uv",x),s}return m(t,e),Tc(t,[{key:"clone",value:function(){var e=this.parameters;return new t(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded)}}]),t}(Et),Hf=new $e,Wf=new V,qf=$c.copySubArrays;function Yf(e,t,n,r,i){e[t]=n,e[t+1]=r,e[t+2]=i}function Xf(e,t,n,r,i,o){e[t]=n,e[t+1]=r,e[t+2]=i,e[t+3]=o}function Zf(e,t){return e-t}var $f=function(e){function t(e,n,r,i){var o;return h(this,t),(o=d(this,f(t).call(this)))._useZSprites=r,o._cylGeometry=r?new gn(2,2,1,1):new jf(1,1,1,Math.max(3,n),2,i),o._init(e,o._cylGeometry,o._useZSprites),o._collisionGeo=new Gf(e,3),o}return m(t,e),Tc(t,[{key:"setItem",value:function(e,t,n,r){var i=Sf.calcCylinderMatrix(t,n,r),o=i.elements,a=4*e;this._collisionGeo.setItem(e,t,n,r),Xf(this._matVector1,a,o[0],o[4],o[8],o[12]),Xf(this._matVector2,a,o[1],o[5],o[9],o[13]),Xf(this._matVector3,a,o[2],o[6],o[10],o[14]),this._useZSprites&&(Wf.getInverse(i),o=Wf.elements,Xf(this._invmatVector1,a,o[0],o[4],o[8],o[12]),Xf(this._invmatVector2,a,o[1],o[5],o[9],o[13]),Xf(this._invmatVector3,a,o[2],o[6],o[10],o[14]))}},{key:"setColor",value:function(e,t,n){var r=3*e;Hf.set(t),Yf(this._color1,r,Hf.r,Hf.g,Hf.b),Hf.set(n),Yf(this._color2,r,Hf.r,Hf.g,Hf.b)}},{key:"computeBoundingSphere",value:function(){this._collisionGeo.computeBoundingSphere(),this.boundingSphere=this._collisionGeo.boundingSphere}},{key:"computeBoundingBox",value:function(){this._collisionGeo.computeBoundingBox(),this.boundingBox=this._collisionGeo.boundingBox}},{key:"raycast",value:function(e,t){this._collisionGeo.raycast(e,t)}},{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("matVector1").needsUpdate=!0,this.getAttribute("matVector2").needsUpdate=!0,this.getAttribute("matVector3").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0,this.getAttribute("color2").needsUpdate=!0,this.getAttribute("alphaColor").needsUpdate=!0,this._useZSprites&&(this.getAttribute("invmatVector1").needsUpdate=!0,this.getAttribute("invmatVector2").needsUpdate=!0,this.getAttribute("invmatVector3").needsUpdate=!0),this._collisionGeo.finishUpdate()}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(e,t){for(var n=this._alpha,r=0,i=e.length;r<i;++r)n[Math.floor(e[r]/2)]=t;this.getAttribute("alphaColor").needsUpdate=!0}},{key:"getSubset",value:function(e){var t=function(e){e.sort(Zf);for(var t=[],n=[],r=0,i=e.length;r<i;++r){var o=e[r],a={first:!1,second:!1};(0|o)%2==0?(a.first=!0,a.second=r+1<i&&e[r+1]===e[r]+1,a.second&&++r):a.second=!0,t.push(Math.floor(o/2)),n.push(a)}return{indices:t,cylinderInfo:n}}(e),n=t.indices,r=n.length,i=new Zs;return this._init.call(i,r,this._cylGeometry,this._useZSprites),qf(this._matVector1,i._matVector1,n,4),qf(this._matVector2,i._matVector2,n,4),qf(this._matVector3,i._matVector3,n,4),this._useZSprites&&(qf(this._invmatVector1,i._invmatVector1,n,4),qf(this._invmatVector2,i._invmatVector2,n,4),qf(this._invmatVector3,i._invmatVector3,n,4)),qf(this._color1,i._color1,n,3),qf(this._color2,i._color2,n,3),function(e,t,n){for(var r=0,i=e.length;r<i;++r){var o=e[r];o.first||(t[3*r]=-.5),o.second||(n[3*r]=-.5)}}(t.cylinderInfo,i._color1,i._color2),i.boundingSphere=this.boundingSphere,i.boundingBox=this.boundingBox,[i]}},{key:"getGeoParams",value:function(){return this._cylGeometry.parameters}},{key:"_init",value:function(e,t,n){this.copy(t),this._matVector1=$c.allocateTyped(Float32Array,4*e),this._matVector2=$c.allocateTyped(Float32Array,4*e),this._matVector3=$c.allocateTyped(Float32Array,4*e),this._color1=$c.allocateTyped(Float32Array,3*e),this._color2=$c.allocateTyped(Float32Array,3*e);var r=this._alpha=$c.allocateTyped(Float32Array,e);s.fill(r,1),this.setAttribute("matVector1",new $s(this._matVector1,4,!1,1)),this.setAttribute("matVector2",new $s(this._matVector2,4,!1,1)),this.setAttribute("matVector3",new $s(this._matVector3,4,!1,1)),this.setAttribute("color",new $s(this._color1,3,!1,1)),this.setAttribute("color2",new $s(this._color2,3,!1,1)),this.setAttribute("alphaColor",new $s(this._alpha,1,!1,1)),n&&(this._invmatVector1=$c.allocateTyped(Float32Array,4*e),this._invmatVector2=$c.allocateTyped(Float32Array,4*e),this._invmatVector3=$c.allocateTyped(Float32Array,4*e),this.setAttribute("invmatVector1",new $s(this._invmatVector1,4,!1,1)),this.setAttribute("invmatVector2",new $s(this._invmatVector2,4,!1,1)),this.setAttribute("invmatVector3",new $s(this._invmatVector3,4,!1,1)))}}]),t}(Zs),Kf=new E,Jf=new E,Qf=new E,ep=new E(1,0,0),tp=new E,np=new E,rp=function(e){function t(e,n,r){var i;h(this,t);var o=function(e,t){for(var n=new Et,r=e.length,i=r*t,o=i<=65536?Uint16Array:Uint32Array,a=(t-1)*r*2,s=new ot($c.allocateTyped(o,3*a),1),l=0,u=0,c=0;c<t;c++){if(c!==t-1)for(var h=0;h<r;h++){var d=l+h,f=l+r+h,p=l+r+(h+1)%r,m=l+(h+1)%r;s.setXYZ(3*u,d,m,f),u++,s.setXYZ(3*u,f,m,p),u++}l+=r}n.setIndex(s);var v=$c.allocateTyped(Float32Array,3*i);return n.setAttribute("position",new ot(v,3)),n._positions=e,n}(e,n);(i=d(this,f(t).call(this,o,r)))._ringsCount=n;for(var a=i._tmpShape=[],s=0;s<e.length;++s)a[s]=new E;return i}return m(t,e),Tc(t,[{key:"setItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this._chunkGeo._positions.length,o=this._ringsCount,a=i*this._ringsCount*e*3;this._setPoints(t,i,o,a),n?this._setSlopeNormals(i,o,a):this._setBaseNormals(i,o,a),r&&this._addCut(i,o,a)}},{key:"_setPoints",value:function(e,t,n,r){for(var i=this._tmpShape,o=this._positions,a=this._chunkGeo._positions,s=0,l=r;s<n;++s)for(var u=e[s],c=0;c<t;++c,l+=3)i[c].copy(a[c]).applyMatrix4(u).toArray(o,l)}},{key:"_setBaseNormals",value:function(e,t,n){for(var r=3*e,i=0,o=n;i<t;++i,o+=r)this._countNormalsInRing(e,o,!1)}},{key:"_setSlopeNormals",value:function(e,t,n){for(var r=this._normals,i=3*e,o=n,a=0;a<e;++a,o+=3)ep.toArray(r,o);if(o-2*i>0)for(var s=0;s<e;++s,o+=3)Qf.fromArray(r,o-2*i).toArray(r,o);else this._countNormalsInRing(e,o,!0,+i),o+=i;for(var l=2;l<t;++l,o+=i)this._countNormalsInRing(e,o,!0,-i)}},{key:"_countNormalsInRing",value:function(e,t,n,r){var i=this._tmpShape,o=this._normals;i[0].fromArray(this._positions,t),i[e-1].fromArray(this._positions,t+3*(e-1));for(var a=0;a<e;++a,t+=3)a<e-1&&i[a+1].fromArray(this._positions,t+3),n?(np.fromArray(this._positions,t+r),Kf.subVectors(i[(a+e-1)%e],i[(a+1)%e]).normalize(),Jf.subVectors(i[a],np).normalize(),Qf.crossVectors(Jf,Kf).normalize().toArray(o,t)):(Kf.subVectors(i[a],i[(a+e-1)%e]).normalize(),Jf.subVectors(i[a],i[(a+1)%e]).normalize(),Qf.addVectors(Kf,Jf).normalize().toArray(o,t))}},{key:"_addCut",value:function(e,t,n){if(!(e<3||t<2)){var r=this._positions,i=this._normals,o=this._tmpShape,a=3*e;o[0].fromArray(r,n),o[1].fromArray(r,n+3),o[2].fromArray(r,n+6),Kf.subVectors(o[1],o[0]).normalize(),Jf.subVectors(o[1],o[2]).normalize(),tp.crossVectors(Kf,Jf).normalize();for(var s=n,l=0;l<2*e;++l,s+=3)tp.toArray(i,s);if(t>2)for(var u=0;u<e;++u,s+=3)Qf.fromArray(r,s-a).toArray(r,s)}}}]),t}(zf),ip=new $e,op=new E;function ap(e,t,n,r,i){e[t]=n,e[t+1]=r,e[t+2]=i}function sp(e,t,n,r,i,o){e[t]=n,e[t+1]=r,e[t+2]=i,e[t+3]=o}function lp(e,t,n,r){var i=4*t,o=i+4*n;return e.subarray(i*r,o*r)}var up=function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this)))._initVertices(e),n}return m(t,e),Tc(t,[{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("position").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0,this.getAttribute("alphaColor").needsUpdate=!0,this.getAttribute("direction").needsUpdate=!0}},{key:"setColor",value:function(e,t){ip.set(t);var n=4*e*3;ap(this._colors,n,ip.r,ip.g,ip.b),n+=3,ap(this._colors,n,ip.r,ip.g,ip.b),n+=3,ap(this._colors,n,ip.r,ip.g,ip.b),n+=3,ap(this._colors,n,ip.r,ip.g,ip.b)}},{key:"setSegment",value:function(e,t,n){op.subVectors(t,n),op.normalize();var r=this._positions,i=this._directions,o=4*e*4,a=4*e*3;sp(r,o,t.x,t.y,t.z,.5),ap(i,a,op.x,op.y,op.z),a+=3,sp(r,o+=4,t.x,t.y,t.z,-.5),ap(i,a,op.x,op.y,op.z),a+=3,sp(r,o+=4,n.x,n.y,n.z,.5),ap(i,a,op.x,op.y,op.z),a+=3,sp(r,o+=4,n.x,n.y,n.z,-.5),ap(i,a,op.x,op.y,op.z)}},{key:"setOpacity",value:function(e,t,n){var r=4*e,i=4*t;s.fill(this.alpha,n,i,r),this.getAttribute("alphaColor").needsUpdate=!0}},{key:"getSubsetSegments",value:function(e,t){return[lp(this._positions,e,t,4),lp(this._directions,e,t,3)]}},{key:"getSubsetColors",value:function(e,t){return lp(this._colors,e,t,3)}},{key:"getSubsetOpacities",value:function(e,t){return lp(this._alpha,e,t,1)}},{key:"getNumVertexPerSegment",value:function(){return 4}},{key:"getPositionSize",value:function(){return 4}},{key:"setSegments",value:function(e,t){var n=4*e*4;if(t instanceof Array&&2===t.length){this._positions.set(t[0],n);var r=4*e*3;this._directions.set(t[1],r)}else this._positions.set(t,n)}},{key:"setColors",value:function(e,t){var n=4*e*3;this._colors.set(t,n)}},{key:"_initVertices",value:function(e){this._buffersSize=4*e;var t=this._buffersSize,n=t>65535;this._index=$c.allocateTyped(n?Uint32Array:Uint16Array,6*e),this._positions=$c.allocateTyped(Float32Array,4*t),this._colors=$c.allocateTyped(Float32Array,3*t),this._directions=$c.allocateTyped(Float32Array,3*t);var r=this._alpha=$c.allocateTyped(Float32Array,t);s.fill(r,1);for(var i=this._index,o=0,a=0,l=0;l<e;l++,o+=6,a+=4)i[o]=a,i[o+1]=a+1,i[o+2]=a+3,i[o+3]=a,i[o+4]=a+2,i[o+5]=a+3;this.setIndex(new ot(this._index,1)),this.setAttribute("position",new ot(this._positions,4)),this.setAttribute("color",new ot(this._colors,3)),this.setAttribute("alphaColor",new ot(r,1)),this.setAttribute("direction",new ot(this._directions,3))}}]),t}(Et),cp=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"startUpdate",value:function(){return!0}},{key:"computeBoundingSphere",value:function(){var e=this.boundingBox,t=0,n=new E;e&&e.getCenter(n);for(var r=this._positions,i=this.boundingSphere||new Se,o=this._positions.length,a=new E,s=this.getPositionSize(),l=0;l<o;l+=s){a.set(r[l],r[l+1],r[l+2]);var u=n.distanceToSquared(a);t<u&&(t=u)}i.set(n,Math.sqrt(t)),this.boundingSphere=i}},{key:"computeBoundingBox",value:function(){for(var e=this._positions,t=new xe,n=this._positions.length,r=new E,i=this.getPositionSize(),o=0;o<n;o+=i)r.set(e[o],e[o+1],e[o+2]),t.expandByPoint(r);this.boundingBox=t}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}}]),t}(up),hp=new E,dp=new C,fp=function(e){function t(e,n){var r;h(this,t);var i=new wa(1,1,1,Math.max(3,n),2,!0),o=(r=d(this,f(t).call(this,i,e)))._chunkSize;return r._chunkPos=r._chunkGeo.attributes.position.array,r._chunkNorms=r._chunkGeo.attributes.normal.array,r._tmpVector=$c.allocateTyped(Float32Array,3*o),r}return m(t,e),Tc(t,[{key:"setItem",value:function(e,t,n,r){var i,o=this._chunkSize,a=o*e*3,s=this._tmpVector,l=this._chunkPos,u=this._chunkNorms,c=Sf.calcCylinderMatrix(t,n,r);dp.getNormalMatrix(c);for(var h=0;h<o;++h)i=3*h,hp.fromArray(l,i),hp.applyMatrix4(c),hp.toArray(s,i);this._positions.set(s,a);for(var d=0;d<o;++d)i=3*d,hp.fromArray(u,i),hp.applyMatrix3(dp),hp.toArray(s,i);this._normals.set(s,a)}}]),t}(zf),pp=function(e){function t(e,n,r){var i;return h(this,t),(i=d(this,f(t).call(this,e*n)))._init(n),i._collisionGeo=r?new fp(e*n,3):null,i}return m(t,e),Tc(t,[{key:"startUpdate",value:function(){return!0}},{key:"computeBoundingSphere",value:function(){var e=this._collisionGeo;if(e)return e.computeBoundingSphere(),void(this.boundingSphere=e.boundingSphere);Hh(f(t.prototype),"computeBoundingSphere",this).call(this)}},{key:"computeBoundingBox",value:function(){var e=this._collisionGeo;if(e)return e.computeBoundingBox(),void(this.boundingBox=e.boundingBox);Hh(f(t.prototype),"computeBoundingBox",this).call(this)}},{key:"raycast",value:function(e,t){if(this._collisionGeo){var n=this._chunkSize;this._collisionGeo.raycast(e,t);for(var r=0,i=t.length;r<i;++r){var o=t[r].chunkIdx;void 0!==o&&(o=o/n|0,t[r].chunkIdx=o)}}}},{key:"setColor",value:function(e,n){for(var r=this._chunkSize,i=e*r,o=i+r;i<o;++i)Hh(f(t.prototype),"setColor",this).call(this,i,n)}},{key:"setSegment",value:function(e,n,r,i){var o=this._chunkSize,a=e*o+n;Hh(f(t.prototype),"setSegment",this).call(this,a,r,i),this._collisionGeo&&this._collisionGeo.setItem(e*o+n,r,i,.1)}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(e,n){for(var r=this._chunkSize,i=0,o=e.length;i<o;++i){var a=e[i]*r;Hh(f(t.prototype),"setOpacity",this).call(this,a,a+r-1,n)}}},{key:"getSubset",value:function(e){for(var n=e.length,r=this._chunkSize,i=new t(n,r,!1),o=0,a=e.length;o<a;++o){var s=o*r,l=e[o]*r;i.setSegments(s,this.getSubsetSegments(l,r)),i.setColors(s,this.getSubsetColors(l,r))}return i.boundingSphere=this.boundingSphere,i.boundingBox=this.boundingBox,[i]}},{key:"_init",value:function(e){this._chunkSize=e}}]),t}(cp),mp=new E,vp=function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this,2*e)))._init(e),n._collisionGeo=new Gf(e,3),n}return m(t,e),Tc(t,[{key:"setItem",value:function(e,n,r){this._collisionGeo.setItem(e,n,r,.3);var i=2*e;mp.lerpVectors(n,r,.5),Hh(f(t.prototype),"setSegment",this).call(this,i,n,mp),Hh(f(t.prototype),"setSegment",this).call(this,i+1,mp,r)}},{key:"setColor",value:function(e,n,r){var i=2*e;Hh(f(t.prototype),"setColor",this).call(this,i,n),Hh(f(t.prototype),"setColor",this).call(this,i+1,r)}},{key:"raycast",value:function(e,t){this._collisionGeo&&this._collisionGeo.raycast(e,t)}},{key:"getSubset",value:function(e){for(var n=e.length,r=new t(n,!1),i=0,o=n;i<o;++i){var a=e[i];r.setSegments(i,this.getSubsetSegments(a,1)),r.setColors(i,this.getSubsetColors(a,1))}return r.boundingSphere=this.boundingSphere,r.boundingBox=this.boundingBox,[r]}},{key:"_init",value:function(e){this._segCounts=2*e}}]),t}(cp),gp=[new E(1,0,0),new E(-1,0,0),new E(0,1,0),new E(0,-1,0),new E(0,0,1),new E(0,0,-1)],yp=gp.length,_p=new E,xp=new E,bp=function(e){function t(e){return h(this,t),d(this,f(t).call(this,e,e,yp/2|0,!1))}return m(t,e),Tc(t,[{key:"setItem",value:function(e,t,n){this.setSphere(e,t,n);for(var r=0;r<yp/2;++r){var i=2*r;_p.x=t.x+gp[i].x*n,_p.y=t.y+gp[i].y*n,_p.z=t.z+gp[i].z*n;var o=i+1;xp.x=t.x+gp[o].x*n,xp.y=t.y+gp[o].y*n,xp.z=t.z+gp[o].z*n,this.setSegment(e,r,_p,xp)}}}]),t}(kf(pp)),wp=new $e,Sp=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this)))._opts=n,r.zClip=r._opts.zClip,r._posRad=$c.allocateTyped(Float32Array,4*e),r._colors=$c.allocateTyped(Float32Array,3*e),r}return m(t,e),Tc(t,[{key:"setItem",value:function(e,t,n){var r=this._posRad,i=4*e;r[i++]=t.x,r[i++]=t.y,r[i++]=t.z,r[i]=n}},{key:"setColor",value:function(e,t){wp.set(t);var n=this._colors,r=3*e;n[r++]=wp.r,n[r++]=wp.g,n[r]=wp.b}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"finishUpdate",value:function(){this._build()}},{key:"setOpacity",value:function(){}},{key:"raycast",value:function(){}},{key:"getSubset",value:function(){return[]}}]),t}(Of),Ep=function(){function e(){h(this,e),this.pointsValuesLinear=null,this.hasIntersection=null,this.bitsInside=null}return Tc(e,[{key:"create",value:function(e){var t=e*e*e;if(t>117440512)throw new Error("Too large cube dimension: lead to memory huge uasge");return this.pointsValuesLinear=$c.allocateTyped(Float32Array,32*t),this.hasIntersection=$c.allocateTyped(Int32Array,t),this.bitsInside=$c.allocateTyped(Int32Array,t),0}},{key:"destroy",value:function(){this.bitsInside=null,this.hasIntersection=null,this.pointsValuesLinear=null}}]),e}();Ep.prototype.striIndicesMarchCube=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];var Tp=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],Mp=function e(){h(this,e),this._arrSize=8,this.p=new Array(this._arrSize),this.g=new Array(this._arrSize),this.val=new Array(this._arrSize);for(var t=0;t<this._arrSize;++t)this.p[t]=new E,this.g[t]=new E;this.cubeIndex=0},Cp=function e(){h(this,e),this.a={p:new E,n:new E},this.b={p:new E,n:new E},this.c={p:new E,n:new E}};function Ap(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=new E;return t}var Rp=function(){function e(){h(this,e),this._numTriangles=0,this._numVertices=0,this._position=[],this._normals=[],this._colors=null,this._indices=[],this._volumetricData=null,this._xAxis=new E,this._yAxis=new E,this._zAxis=new E,this._xDir=new E,this._yDir=new E,this._zDir=new E}return Tc(e,[{key:"_prepareAxesAndDirs",value:function(){var e=this._volumetricData.getCellSize(),t=this._xAxis,n=this._yAxis,r=this._zAxis,i=this._xDir,o=this._yDir,a=this._zDir;t.set(e.x,0,0),n.set(0,e.y,0),r.set(0,0,e.z),i.set(1,0,0),o.set(0,1,0),a.set(0,0,1);var s=new E;if(s.crossVectors(i,o),s.dot(a)<0&&(i.negate(),o.negate(),a.negate()),i.x<0||i.y<0||i.z<0||o.x<0||o.y<0||o.z<0||a.x<0||a.y<0||a.z<0)return!1;var l=function(e){return Math.abs(e)>Number.EPSILON};return!(l(t.y)||l(t.z)||l(n.x)||l(n.z)||l(r.x)||l(r.y))}},{key:"_vertexInterp",value:function(e,t,n,r,i,o){var a=t.p[n],s=t.p[r],l=t.g[n],u=t.g[r],c=t.val[n],h=e-c,d=t.val[r]-c,f=0;Math.abs(d)>0&&(f=h/d),f=f>1?1:f,i.lerpVectors(a,s,f),o.lerpVectors(l,u,f)}},{key:"_polygonize",value:function(t,n,r){for(var i=t.cubeIndex,o=0,a=e._arrSize,s=e._firstIndices,l=e._secondIndices,u=e._vertexList,c=e._normalList;o<a;++o)Tp[i]&1<<o&&this._vertexInterp(n,t,s[o],l[o],u[o],c[o]);var h=0,d=16*i,f=e._triTable;for(o=0;-1!==f[d+o];o+=3)r[h].a.p.copy(u[f[d+o]]),r[h].a.n.copy(c[f[d+o]]),r[h].b.p.copy(u[f[d+o+1]]),r[h].b.n.copy(c[f[d+o+1]]),r[h].c.p.copy(u[f[d+o+2]]),r[h].c.n.copy(c[f[d+o+2]]),++h;return h}},{key:"_doGridPosNorms",value:function(e,t,n){for(var r,i=this._volumetricData,o=this._volumetricData.getData(),a=i.getDimensions(),s=a[0],l=a[1],u=a[2],c=t*i.getStrideX(),h=t*i.getStrideY(),d=t*i.getStrideZ(),f=new Mp,p=f.val,m=f.val.length,v=[new E(0,0,0),new E(t,0,0),new E(t,t,0),new E(0,t,0),new E(0,0,t),new E(t,0,t),new E(t,t,t),new E(0,t,t)],g=new Array(5),y=0;y<5;++y)g[y]=new Cp;var _,x=this,b=this._position,w=this._normals;n?(_=new E(x._xAxis.x,x._yAxis.y,x._zAxis.z),r=function(e){var t=e.p.clone();t.multiply(_),b.push(t.add(x._origin)),w.push(e.n.clone())}):r=function(){var e=new C;e.set(x._xAxis.x,x._yAxis.x,x._zAxis.x,x._xAxis.y,x._yAxis.y,x._zAxis.y,x._xAxis.z,x._yAxis.z,x._zAxis.z);var t=new C;return t.set(x._xDir.x,x._yDir.x,x._zDir.x,x._xDir.y,x._yDir.y,x._zDir.y,x._xDir.z,x._yDir.z,x._zDir.z),function(n){b.push(n.p.clone().applyMatrix3(e).add(x._origin)),w.push(n.n.clone().applyMatrix3(t))}}();for(var S,T,M,A,R=this._indices,P=0,k=0;k<u-t;k+=t)for(var L=0;L<l-t;L+=t)for(var N=i.getDirectIdx(0,L,k),I=0;I<s-t;I+=t,N+=c){p[0]=o[N],p[1]=o[N+c],p[3]=o[N+h],p[2]=o[N+c+h],p[4]=o[N+d],p[5]=o[N+c+d],p[7]=o[N+h+d],p[6]=o[N+c+h+d];for(var O=0,D=0;D<m;++D)p[D]<e&&(O|=1<<D);if(0!==Tp[O]){for(f.cubeIndex=O,D=0;D<m;++D)f.p[D].set(I+v[D].x,L+v[D].y,k+v[D].z),S=this._gradient,T=f.p[D],M=f.g[D],void 0,A=S.getValue(T.x,T.y,T.z),M.set(A[0],A[1],A[2]);var z=this._polygonize(f,e,g);for(P+=z,D=0;D<z;++D)R.push(3*this._numTriangles),R.push(3*this._numTriangles+1),R.push(3*this._numTriangles+2),++this._numTriangles,r(g[D].a),r(g[D].b),r(g[D].c)}}return P}},{key:"compute",value:function(e,t,n,r){this._volumetricData=e,this._origin=t,this._gradient=e.computeGradient(),this._doGridPosNorms(n,r,this._prepareAxesAndDirs())}},{key:"_remapIndices",value:function(e,t){for(var n=this._indices,r=$c.allocateTyped(Uint32Array,t),i=0;i<t;++i)n[i]=e[n[i]],r[i]=n[i];this._indices=r}},{key:"_remapVertices",value:function(e,t,n){for(var r=$c.allocateTyped(Float32Array,3*n),i=$c.allocateTyped(Float32Array,3*n),o=0;o<n;++o){var a=e[o];r[3*o]=a.x,r[3*o+1]=a.y,r[3*o+2]=a.z;var s=t[o].normalize();i[3*o]=s.x,i[3*o+1]=s.y,i[3*o+2]=s.z}this._position=r,this._normals=i}},{key:"vertexFusion",value:function(e,t){var n=this._indices.length,r=this._position,i=this._normals,o=0|r.length;if(0!==n&&0!==o){var a=$c.allocateTyped(Uint32Array,o);a[0]=0;for(var s=1,l=1;l<o;++l){for(var u=s-e<0?0:s-e,c=u+t>s?s:u+t,h=-1,d=u;d<c;++d)if(Math.abs(r[l]-r[d])<Number.EPSILON){h=d;break}-1!==h?a[l]=h:(r[s].copy(r[l]),i[s].copy(i[l]),a[l]=s,++s)}this._remapIndices(a,n),this._remapVertices(r,i,s)}}},{key:"setColorVolTex",value:function(e,t,n,r){var i,o,a,s,l,u,c=this._position.length/3,h=this._position,d=this._origin,f=this._volumetricData.getDimensions(),p=f[0]-1,m=f[1]-1,v=f[2]-1,g=e.getData(),y=e.getStrideX(),_=e.getStrideY(),x=e.getStrideZ();null!==r&&(a=n.getData(),s=n.getStrideX(),l=n.getStrideY(),u=n.getStrideZ());var b=1/this._xAxis.x,w=1/this._yAxis.y,S=1/this._zAxis.z,E=[],T=[],M=$c.allocateTyped(Float32Array,3*c);function C(e,t,n,r){r[0]=(1-e)*g[t]+e*g[n],r[1]=(1-e)*g[t+1]+e*g[n+1],r[2]=(1-e)*g[t+2]+e*g[n+2]}function A(e,n,r,i){var o=t[e];if(null!=o){E[o._index]=o;var s=n*r*i*a[e];void 0===T[o._index]?T[o._index]=s:T[o._index]+=s}}var R=$c.allocateTyped(Int32Array,c),P=0;for(i=0;i<c;i++){var k=3*i,L=(h[k]-d.x)*b,N=(h[k+1]-d.y)*w,I=(h[k+2]-d.z)*S,O=0|Math.min(Math.max(L,0),p),D=0|Math.min(Math.max(N,0),m),z=0|Math.min(Math.max(I,0),v),F=L-O,B=N-D,U=I-z;if(null!=r){E=[],T=[],A(o=n.getDirectIdx(O,D,z),1-F,1-B,1-U),A(o+s,F,1-B,1-U),A(o+l,1-F,B,1-U),A(o+s+l,F,B,1-U),A(o+u,1-F,1-B,U),A(o+s+u,F,1-B,U),A(o+l+u,1-F,B,U),A(o+s+l+u,F,B,U);var V=0,G=-1;for(var j in T)T[j]>V&&(G=j,V=T[j]);if(G<0||!r.includesAtom(E[G])){R[i]=-1;continue}}R[i]=P++;var H=O<p?y:0,W=D<m?_:0,q=z<v?x:0,Y=[0,0,0],X=[0,0,0],Z=[0,0,0],$=[0,0,0];C(F,o=e.getDirectIdx(O,D,z),o+H,Y),C(F,o+W,o+H+W,X),C(F,o+q,o+H+q,Z),C(F,o+W+q,o+H+W+q,$);var K=[0,0,0];K[0]=(1-B)*Y[0]+B*X[0],K[1]=(1-B)*Y[1]+B*X[1],K[2]=(1-B)*Y[2]+B*X[2];var J=[0,0,0];J[0]=(1-B)*Z[0]+B*$[0],J[1]=(1-B)*Z[1]+B*$[1],J[2]=(1-B)*Z[2]+B*$[2],M[k]=(1-U)*K[0]+U*J[0],M[k+1]=(1-U)*K[1]+U*J[1],M[k+2]=(1-U)*K[2]+U*J[2]}if(this._colors=M,null!=r){for(i=0;i<c;++i){var Q=R[i];Q<0||(this._position[3*Q]=this._position[3*i],this._position[3*Q+1]=this._position[3*i+1],this._position[3*Q+2]=this._position[3*i+2],this._normals[3*Q]=this._normals[3*i],this._normals[3*Q+1]=this._normals[3*i+1],this._normals[3*Q+2]=this._normals[3*i+2],this._colors[3*Q]=this._colors[3*i],this._colors[3*Q+1]=this._colors[3*i+1],this._colors[3*Q+2]=this._colors[3*i+2])}var ee=this._indices.length/3,te=0;for(i=0;i<ee;++i){var ne=R[this._indices[3*i]],re=R[this._indices[3*i+1]],ie=R[this._indices[3*i+2]];ne>=0&&re>=0&&ie>=0&&(this._indices[3*te]=ne,this._indices[3*te+1]=re,this._indices[3*te+2]=ie,++te)}this._position=new Float32Array(this._position.buffer.slice(0,3*P*4)),this._normals=new Float32Array(this._normals.buffer.slice(0,3*P*4)),this._colors=new Float32Array(this._colors.buffer.slice(0,3*P*4)),this._indices=new Uint32Array(this._indices.buffer.slice(0,3*te*4))}}},{key:"toMesh",value:function(){var e=new Et;return e.setIndex(new ot(this._indices,1)),e.setAttribute("position",new ot(this._position,3)),e.setAttribute("normal",new ot(this._normals,3)),e.setAttribute("color",new ot(this._colors,3)),e.computeBoundingSphere(),e}}]),e}();u(Rp,"_triTable",Ep.prototype.striIndicesMarchCube),u(Rp,"_arrSize",12),u(Rp,"_firstIndices",[0,1,2,3,4,5,6,7,0,1,2,3]),u(Rp,"_secondIndices",[1,2,3,0,5,6,7,4,4,5,6,7]),u(Rp,"_vertexList",Ap(Rp._arrSize)),u(Rp,"_normalList",Ap(Rp._arrSize));var Pp=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_build",value:function(){var e=this._opts;this.numVoxels=[128,128,128],this.xAxis=new E(1,0,0),this.yAxis=new E(0,1,0),this.zAxis=new E(0,0,1),this.origin=new E(0,0,0),this._visibilitySelector=e.visibilitySelector,this._calcSurface(e)}},{key:"_findMinMax",value:function(e){for(var t=e.length/4,n=[e[0],e[1],e[2],e[3]],r=[e[0],e[1],e[2],e[3]],i=1;i<t;++i)for(var o=4*i,a=0;a<4;++a){var s=e[o+a];n[a]=Math.max(s,n[a]),r[a]=Math.min(s,r[a])}return{maxPosRad:n,minPosRad:r}}},{key:"_findNumVoxels",value:function(e,t){var n=this.numVoxels,i=this._findMinMax(e),o=i.minPosRad,a=i.maxPosRad;o[3]>4&&(t.gridSpacing*=o[3]);var s=t.radScale*a[3]*1.7,l=s;l=.65*Math.sqrt(4/3*Math.PI*l*l*l),s=Math.max(s,l);for(var u=0;u<3;++u)o[u]-=s,a[u]+=s;for(u=0;u<3;++u)n[u]=Math.ceil((a[u]-o[u])/t.gridSpacing);this.xAxis.x=(n[0]-1)*t.gridSpacing,this.yAxis.y=(n[1]-1)*t.gridSpacing,this.zAxis.z=(n[2]-1)*t.gridSpacing;var c=r(o,3);return this.origin.x=c[0],this.origin.y=c[1],this.origin.z=c[2],{bbox:i,dim:n}}},{key:"_makeSurface",value:function(e,t){var n=new Rp;n.compute(e.volMap,this.origin,t.isoValue,1),n.vertexFusion(9,9),n._numTriangles>0?(n.setColorVolTex(e.volTexMap,e.atomMap,e.atomWeightMap,this._visibilitySelector),this.setIndex(new ot(n._indices,1)),this.setAttribute("position",new ot(n._position,3)),this.setAttribute("normal",new ot(n._normals,3)),this.setAttribute("color",new ot(n._colors,3))):this.setAttribute("position",new ot($c.allocateTyped(Float32Array,0),3))}},{key:"_calcSurface",value:function(e){var t={posRad:this._posRad,colors:this._colors,atoms:this._opts.atoms};if(0!==t.posRad.length){var n=this._findNumVoxels(t.posRad,e),r=new xe(this.origin,new E(this.xAxis.x,this.yAxis.y,this.zAxis.z).add(this.origin)),i=this._computeSurface(t,r,n,e);this._makeSurface(i,e)}}}]),t}(Sp),kp=Qd.Volume,Lp=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_computeSurface",value:function(e,t,n,r){this._shiftByOrigin(e.posRad);var i={volMap:new kp(Float32Array,this.numVoxels,t),volTexMap:new kp(Float32Array,this.numVoxels,t,3)};return null!=this._visibilitySelector&&(i.atomMap=[],i.atomWeightMap=new kp(Float32Array,this.numVoxels,t)),this.gaussdensity(i,e,null,r),i}},{key:"gaussdensity",value:function(e,t,n,r){var i,o=t.posRad.length/4,a=t.posRad,s=t.colors,l=this.numVoxels,u=r.radScale,c=r.gaussLim,h=r.gridSpacing,d=1/r.isoValue,f=1/h,p=l[0]-1,m=l[1]-1,v=l[2]-1,g=e.volMap,y=e.volTexMap,_=g.getData(),x=g.getStrideX(),b=y.getData(),w=y.getStrideX();null!=this._visibilitySelector&&(i=e.atomWeightMap.getData());for(var S=e.atomMap,E=0;E<o;++E){var T=4*E,M=a[T+3]*u,C=null===n?1:n[E],A=1/(2*M*M),R=c*M,P=R*R;R*=f;var k=a[T]*f,L=Math.max(k-R|0,0),N=Math.min(k+R|0,p);k=a[T+1]*f;var I=Math.max(k-R|0,0),O=Math.min(k+R|0,m);k=a[T+2]*f;for(var D=Math.max(k-R|0,0),z=Math.min(k+R|0,v),F=D*h-a[T+2],B=D;B<=z;++B,F+=h)for(var U=I*h-a[T+1],V=I;V<=O;++V,U+=h){var G=U*U+F*F;if(!(G>=P))for(var j=g.getDirectIdx(L,V,B),H=y.getDirectIdx(L,V,B),W=L*h-a[T],q=L;q<=N;++q,W+=h,j+=x,H+=w){var Y=-(W*W+G)*A,X=Math.exp(Y)*C;null!=this._visibilitySelector&&X>i[j]&&(i[j]=X,S[j]=t.atoms[E]),_[j]+=X,X*=d;var Z=3*E;b[H]+=X*s[Z],b[H+1]+=X*s[Z+1],b[H+2]+=X*s[Z+2]}}}}},{key:"_shiftByOrigin",value:function(e){for(var t=this.origin.x,n=this.origin.y,r=this.origin.z,i=e.length/4,o=0;o<i;++o){var a=4*o;e[a]-=t,e[a+1]-=n,e[a+2]-=r}}}]),t}(Pp);function Np(e,t,n,r){var i=e.length/4,o=t[0],a=t[1],s=t[2],l=n[0],u=n[1],c=n[2];function h(e,t){return Math.floor((e-t)/r)}var d,f,p,m,v,g=h(l,o)+1,y=h(u,a)+1,_=h(c,s)+1,x=g*y*_,b=y*_,w=[];for(d=0;d<i;d++){var S=4*d;p=e[S],m=e[S+1],v=e[S+2],void 0===w[f=(h(p,o)*y+h(m,a))*_+h(v,s)]?w[f]=[d]:w[f].push(d)}var E,T=$c.allocateTyped(Uint32Array,x),M=$c.allocateTyped(Uint16Array,x),C=$c.allocateTyped(Uint32Array,i),A=0,R=0;for(d=0;d<x;d++){var P=T[d]=A,k=w[d];if(void 0!==k)for(E=0;E<k.length;E++)C[A]=k[E],A++;var L=A-P;M[d]=L,L>R&&(R=L)}this.neighbourListLength=27*R+1,this.withinRadii=function(t,n,r,i,l){var u=0,c=h(t,o),p=h(n,a),m=h(r,s),v=Math.max(0,c-1),x=Math.max(0,p-1),w=Math.max(0,m-1),S=Math.min(g-1,c+1),A=Math.min(y-1,p+1),R=Math.min(_-1,m+1);for(d=v;d<=S;++d){var P=d*b;for(E=x;E<=A;++E)for(var k=E*_,L=w;L<=R;++L)for(var N=T[f=P+k+L],I=N+M[f],O=N;O<I;O++){var D=4*C[O],z=e[D]-t,F=e[D+1]-n,B=e[D+2]-r,U=e[D+3]+i;z*z+F*F+B*B<=U*U&&(l[u++]=C[O])}}l[u]=-1}}function Ip(e,t,n,r){var i,o,a,s,l,u,c,h,d,f,p,m,v,g,y,_,x,b=e.posRad,w=e.colors,S=e.atoms,T=b.length/4,M=t.bbox,C=M.minPosRad,A=M.maxPosRad,R=-1,P=null,k=null,L=null,N=new E(0,0,0),I=new E(0,0,0),O=new E(0,0,0);function D(e,t,n){for(var r=0;r<e.length;r++)e[r]=t+n*r}function z(){s=n.scaleFactor,u=t.dim,x=Math.min(5,2+Math.floor(a*s));var e=u[0]*u[1]*u[2];c=function(e,t,n){for(var r=$c.allocateTyped(e,t),i=0;i<t;++i)r[i]=-1001;return r}(Float32Array,e),h=$c.allocateTyped(Float32Array,3*e),d=$c.allocateTyped(Float32Array,e),L&&(P=$c.allocateTyped(Float32Array,e),k=[]),f=$c.allocateTyped(Float32Array,u[0]),p=$c.allocateTyped(Float32Array,u[1]),m=$c.allocateTyped(Float32Array,u[2]),D(f,C[0],1/s),D(p,C[1],1/s),D(m,C[2],1/s)}function F(e,t,n,r){var o=4*e,a=i[e],s=b[o]-t,l=b[o+1]-n,u=b[o+2]-r;return s*s+l*l+u*u<a}function B(e,t,n,r,i){var o;if(-1!==R){if((o=R)!==r&&o!==i&&F(o,e,t,n))return o;R=-1}var a=0;for(o=_[a];o>=0;){if(o!==r&&o!==i&&F(o,e,t,n))return R=o,o;o=_[++a]}return R=-1,-1}function U(e,t){var n=4*e,r=4*t,i=b[n],o=b[n+1],a=b[n+2],h=b[n+3],d=N.x=b[r]-i,y=N.y=b[r+1]-o,_=N.z=b[r+2]-a,w=b[r+3],S=d*d+y*y+_*_,E=Math.sqrt(S),T=h*((h*h+E*E-w*w)/(2*h*E));N.normalize(),function(e,t){e.x=e.y=e.z=1,0!==t.x?e.x=(t.y+t.z)/-t.x:0!==t.y?e.y=(t.x+t.z)/-t.y:0!==t.z&&(e.z=(t.x+t.y)/-t.z)}(I,N),I.normalize(),O.crossVectors(N,I),O.normalize();var M=Math.sqrt(h*h-T*T);I.multiplyScalar(M),O.multiplyScalar(M),N.multiplyScalar(T),N.x+=i,N.y+=o,N.z+=a,R=-1;for(var A=x,P=0;P<l;P++){var k=g[P],L=v[P],D=N.x+k*I.x+L*O.x,z=N.y+k*I.y+L*O.y,F=N.z+k*I.z+L*O.z;if(-1===B(D,z,F,e,t))for(var U=Math.floor(s*(D-C[0])),V=Math.floor(s*(z-C[1])),G=Math.floor(s*(F-C[2])),j=Math.max(0,U-A),H=Math.max(0,V-A),W=Math.max(0,G-A),q=Math.min(u[0],U+A+2),Y=Math.min(u[1],V+A+2),X=Math.min(u[2],G+A+2),Z=W;Z<X;Z++){_=F-m[Z];for(var $=u[1]*u[0]*Z,K=H;K<Y;K++)for(var J=_*_+(y=z-p[K])*y,Q=$+u[0]*K,ee=j;ee<q;ee++){S=J+(d=D-f[ee])*d;var te=ee+Q,ne=c[te];ne>0&&S<ne*ne&&(c[te]=Math.sqrt(S))}}}}function V(){console.time("ContactSurface.getVolume"),console.time("ContactSurface.init"),function(){a=n.probeRadius,s=n.scaleFactor,l=n.probePositions,L=n.visibilitySelector,i=$c.allocateTyped(Float32Array,T),o=0;for(var e=0;e<T;++e){var t=b[4*e+3]+=a;t>o&&(o=t),i[e]=t*t}z(),function(){var e=0,t=2*Math.PI/l;g=$c.allocateTyped(Float32Array,l),v=$c.allocateTyped(Float32Array,l);for(var n=0;n<l;n++)g[n]=Math.cos(e),v[n]=Math.sin(e),e+=t}(),y=new Np(b,C,A,2.01*o),_=new Int32Array(y.neighbourListLength),R=-1}(),console.timeEnd("ContactSurface.init"),console.time("ContactSurface.projectPoints"),function(){for(var e=0;e<T;e++){var t=4*e,n=b[t],r=b[t+1],o=b[t+2],a=b[t+3],l=i[e];y.withinRadii(n,r,o,a,_);for(var v=Math.ceil(a*s),g=Math.floor(s*(n-C[0])),x=Math.floor(s*(r-C[1])),E=Math.floor(s*(o-C[2])),M=Math.max(0,g-v),A=Math.max(0,x-v),R=Math.max(0,E-v),N=Math.min(u[0],g+v+2),I=Math.min(u[1],x+v+2),O=Math.min(u[2],E+v+2),D=3*e,z=w[D],F=w[D+1],U=w[D+2],V=R;V<O;V++)for(var G=m[V]-o,j=u[1]*u[0]*V,H=A;H<I;H++)for(var W=p[H]-r,q=G*G+W*W,Y=j+u[0]*H,X=M;X<N;X++){var Z=X+Y,$=f[X]-n,K=q+$*$;if(K<l){var J=Math.exp(.28125*-K),Q=3*Z;h[Q]+=z*J,h[Q+1]+=F*J,h[Q+2]+=U*J,d[Z]+=J,null!==L&&J>P[Z]&&(P[Z]=J,k[Z]=S[e]),c[Z]<0&&(c[Z]=-c[Z]);var ee=Math.sqrt(K),te=a/ee,ne=$*te,re=W*te,ie=G*te;if(-1===B(ne+=n,re+=r,ie+=o,e,-1)){var oe=a-ee;oe<c[Z]&&(c[Z]=oe)}}}}}(),console.timeEnd("ContactSurface.projectPoints"),console.time("ContactSurface.projectTorii"),function(){for(var e=0;e<T;e++){var t=4*e;y.withinRadii(b[t],b[t+1],b[t+2],b[t+3],_);for(var n=0,r=_[n];r>=0;)e<r&&U(e,r),r=_[++n]}}(),console.timeEnd("ContactSurface.projectTorii"),function(){for(var e=0,t=c.length;e<t;e++){c[e]<0&&(c[e]=0);var n=d[e];if(n>0){n=1/n;var r=3*e;h[r]*=n,h[r+1]*=n,h[r+2]*=n}}}(),console.timeEnd("ContactSurface.getVolume")}this.build=function(){V(),this.volTexMap=h,this.weightsMap=P,this.atomMap=k,this.volMap=c}}var Op=Qd.Volume,Dp=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_computeSurface",value:function(e,t,n,r){var i=new Ip(e,n,r);return i.build(),{volMap:new Op(Float32Array,this.numVoxels,t,1,i.volMap),volTexMap:new Op(Float32Array,this.numVoxels,t,3,i.volTexMap),atomMap:i.atomMap,atomWeightMap:new Op(Float32Array,this.numVoxels,t,1,i.weightsMap)}}}]),t}(Pp),zp=function e(t,n){h(this,e),this.coord=new E,this.coord.copy(t),this.radius=n,this.colorX=.99999,this.colorY=0,this.colorZ=0,this.atomType=0,this.srcAtom=null},Fp=function(){function e(t,n,r,i,o){h(this,e),this._numAtoms=t,this._atoms=n,this._vBoxMin=new E,this._vBoxMax=new E,this._vBoxMin.copy(r),this._vBoxMax.copy(i),this._probeRadius=o,this._atomsList=null,this._voxelList=null}return Tc(e,[{key:"createVoxels",value:function(){var e,t,n=0|this._numAtoms,r=this._atoms,i=this._vBoxMax.x-this._vBoxMin.x,o=this._vBoxMax.y-this._vBoxMin.y,a=this._vBoxMax.z-this._vBoxMin.z,s=i<o?i:o;s=a<s?a:s;var l,u=0,c=0;for(l=0;l<n;l++)u=(t=2*(r[l].radius+this._probeRadius))>u?t:u,c+=t;var h=Math.floor(s/u);h<2&&(h=2),c/=n,this._numCells=h,this._aveRad=c,this._maxRad=u;var d=h,f=h*h,p=h*h*h,m=this._xScale=1/(this._vBoxMax.x-this._vBoxMin.x),v=this._yScale=1/(this._vBoxMax.y-this._vBoxMin.y),g=this._zScale=1/(this._vBoxMax.z-this._vBoxMin.z),y=0,_=m*h,x=v*h,b=g*h;for(l=0;l<n;l++){var w=4.5*(r[l].radius+this._probeRadius)*2,S=Math.floor(_*w+.8),E=Math.floor(x*w+.8),T=Math.floor(b*w+.8);y+=++S*++E*++T}this._voxelList=$c.allocateTyped(Int32Array,p);var M=[];if(M.length=y,null===this._voxelList||null===M)return-1;for(l=0;l<p;l++)this._voxelList[l]=-1;for(e=0,l=0;l<n;l++){t=4.5*(r[l].radius+this._probeRadius);var C=Math.floor((r[l].coord.x-this._vBoxMin.x-t)*h*m),A=Math.floor((r[l].coord.y-this._vBoxMin.y-t)*h*v),R=Math.floor((r[l].coord.z-this._vBoxMin.z-t)*h*g),P=Math.floor((r[l].coord.x-this._vBoxMin.x+t)*h*m),k=Math.floor((r[l].coord.y-this._vBoxMin.y+t)*h*v),L=Math.floor((r[l].coord.z-this._vBoxMin.z+t)*h*g);C=C>=0?C:0,A=A>=0?A:0,P=P<h?P:h-1,k=k<h?k:h-1,L=L<h?L:h-1;for(var N=R=R>=0?R:0;N<=L;N++)for(var I=A;I<=k;I++)for(var O=C;O<=P;O++){var D=O+I*d+N*f;if(this._voxelList[D]<0)M[2*e+0]=l,M[2*e+1]=-1,this._voxelList[D]=e,e++;else{var z=this._voxelList[D];this._voxelList[D]=e,M[2*e+0]=l,M[2*e+1]=z,e++}}}return this._atomsList=Int32Array.from(M),0}},{key:"destroyVoxels",value:function(){this._atomsList=null,this._voxelList=null,this._atoms=null,this._vertices=null,this._vBoxMin=null,this._vBoxMax=null}},{key:"forEachRelatedAtom",value:function(e,t){for(var n=Math.floor((e.x-this._vBoxMin.x)*this._numCells*this._xScale),r=Math.floor((e.y-this._vBoxMin.y)*this._numCells*this._yScale),i=Math.floor((e.z-this._vBoxMin.z)*this._numCells*this._zScale),o=n+r*this._numCells+i*this._numCells*this._numCells,a=this._atoms,s=this._voxelList[o];s>=0;s=this._atomsList[2*s+1])t(a[this._atomsList[2*s]])}},{key:"getClosestAtom",value:function(e){var t=null,n=Number.MAX_VALUE;return this.forEachRelatedAtom(e,(function(r){var i=e.distanceToSquared(r.coord);i<n&&(n=i,t=r)})),t}},{key:"buildNormals",value:function(e,t,n){for(var r,i=this,o=0,a=0,s=0,l=0,u=0,c=0,h=0,d=0,f=0,p=2.5*this._aveRad,m=p*p,v=.1*-this._aveRad,g=function(e){var t=a-e.coord.x,n=s-e.coord.y,p=l-e.coord.z;if(!((r=t*t+n*n+p*p)>m)){var g=e.radius+i._probeRadius;(d=r-g*g)<0&&(d=-d),f=Math.exp(v*d),u+=t*f,c+=n*f,h+=p*f,o++}},y=0;y<e;y++)a=t[y].x,s=t[y].y,l=t[y].z,o=0,u=c=h=0,this.forEachRelatedAtom(t[y],g),r=u*u+c*c+h*h,o>0&&(d=1/Math.sqrt(r),u*=d,c*=d,h*=d),n[y].x=u,n[y].y=c,n[y].z=h;return 0}},{key:"buildColors",value:function(e,t,n,r){for(var i=this,o=0,a=0,s=0,l=0,u=0,c=r*r,h=[],d=[],f=0,p=function(e){var t=o-e.coord.x,n=a-e.coord.y,r=s-e.coord.z,p=t*t+n*n+r*r;if(!(p>c)){var m=e.radius+i._probeRadius;(l=p-m*m)<0&&(l=-l),u=1/(.8+l),h.push([e.colorX,e.colorY,e.colorZ]),d.push(u),f+=u}},m=0;m<e;m++){o=t[m].x,a=t[m].y,s=t[m].z,h=[],d=[],f=0,this.forEachRelatedAtom(t[m],p);for(var v=0;v<h.length;++v){var g=d[v]/f;n[m].x+=h[v][0]*g,n[m].y+=h[v][1]*g,n[m].z+=h[v][2]*g}}return 0}}]),e}(),Bp=function(){function e(t,n,r){var i;for(h(this,e),this._maxNumVertices=t,this._maxNumTriangles=n,this._vertices=new Array(t),this._normals=new Array(t),this._colors=null,r&&(this._colors=new Array(t)),this._indices=new Array(3*n),this._numVertices=0,this._numTriangles=0,i=0;i<t;i++)this._vertices[i]=new E,this._normals[i]=new E;for(i=0;i<3*n;i++)this._indices[i]=-1;if(r)for(i=0;i<t;i++)this._colors[i]=new E}return Tc(e,[{key:"destroy",value:function(){this._vertices=null,this._normals=null,this._indices=null}}]),e}(),Up=Qd.Element,Vp={InstancedSpheresGeometry:If,SimpleSpheresGeometry:Ff,Simple2CCylindersGeometry:Gf,Instanced2CCylindersGeometry:$f,ExtrudedObjectsGeometry:rp,ChunkedLinesGeometry:pp,TwoColorLinesGeometry:vp,CrossGeometry:bp,QuickSurfGeometry:Lp,ContactSurfaceGeometry:Dp,SSIsosurfaceGeometry:function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_build",value:function(){this._innerBuild();var e=this.getGeo();this.destroy(),this._fromGeo(e)}},{key:"_fromGeo",value:function(e){var t=null,n=$c.allocateTyped(Float32Array,3*e._numVertices),r=$c.allocateTyped(Float32Array,3*e._numVertices);null!==e._colors&&(t=$c.allocateTyped(Float32Array,3*e._numVertices));for(var i=$c.allocateTyped(Uint32Array,3*e._numTriangles),o=0,a=0;o<e._numVertices;o++)n[a+0]=e._vertices[o].x,n[a+1]=e._vertices[o].y,n[a+2]=e._vertices[o].z,r[a+0]=e._normals[o].x,r[a+1]=e._normals[o].y,r[a+2]=e._normals[o].z,a+=3;if(null!==t)for(var s=0,l=0;s<e._numVertices;s++,l+=3)t[l+0]=e._colors[s].x,t[l+1]=e._colors[s].y,t[l+2]=e._colors[s].z;for(var u=3*e._numTriangles,c=0;c<u;c++)i[c]=e._indices[c];this.setIndex(new ot(i,1)),this.setAttribute("position",new ot(n,3)),this.setAttribute("normal",new ot(r,3)),this.setAttribute("color",new ot(t,3)),this.computeBoundingBox(),this.computeBoundingSphere(),e.destroy()}},{key:"convertToAtomsColored",value:function(e,t){for(var n=e.atoms,r=e.colors,i=0,o=n.length;i<o;i++){var a=n[i].getPosition(),s=n[i].element.radius;t[i]=new zp(a,s);var l=n[i].element.number;t[i].atomType=this.getType(l);var u=3*i;t[i].colorX=r[u++],t[i].colorY=r[u++],t[i].colorZ=r[u],t[i].srcAtom=n[i]}}},{key:"getGeo",value:function(){return this.geoOut}},{key:"destroy",value:function(){this.atoms=null,this.hashLines=null,this.hashEntries=null}},{key:"getBoundingBox",value:function(e,t,n){t.x=t.y=t.z=1e7,n.x=n.y=n.z=-1e7;for(var r=this.probeRadius*this.atomRadiusScale,i=0,o=0,a=e.length;o<a;o++){var s=e[o].coord,l=e[o].radius+r;i=l>i?l:i,s.x-l<t.x&&(t.x=s.x-l),s.y-l<t.y&&(t.y=s.y-l),s.z-l<t.z&&(t.z=s.z-l),s.x+l>n.x&&(n.x=s.x+l),s.y+l>n.y&&(n.y=s.y+l),s.z+l>n.z&&(n.z=s.z+l)}t.x-=i,t.y-=i,t.z-=i,n.x+=i,n.y+=i,n.z+=i}},{key:"getCornerCoord",value:function(e,t,n,r,i,o,a){var s=1/(o-1),l=n*s,u=r*s,c=i*s;a.x=e.x*(1-l)+t.x*l,a.y=e.y*(1-u)+t.y*u,a.z=e.z*(1-c)+t.z*c}},{key:"buildEdgePoint",value:function(e,t,n,r,i,o){if(n[e]^n[t]){var a=(0-r.pointsValuesLinear[i+24+e])/(r.pointsValuesLinear[i+24+t]-r.pointsValuesLinear[i+24+e]),s=r.pointsValuesLinear[i+3*e+0],l=r.pointsValuesLinear[i+3*e+1],u=r.pointsValuesLinear[i+3*e+2],c=r.pointsValuesLinear[i+3*t+0],h=r.pointsValuesLinear[i+3*t+1],d=r.pointsValuesLinear[i+3*t+2];o.x=s*(1-a)+c*a,o.y=l*(1-a)+h*a,o.z=u*(1-a)+d*a}}},{key:"isTriangleVisible",value:function(e,t,n){var r=this.voxelWorld.getClosestAtom(e),i=this.voxelWorld.getClosestAtom(t),o=this.voxelWorld.getClosestAtom(n);return null!==r&&null!==i&&null!==o&&null!==r.srcAtom&&null!==i.srcAtom&&null!==o.srcAtom&&this.visibilitySelector.includesAtom(r.srcAtom)&&this.visibilitySelector.includesAtom(i.srcAtom)&&this.visibilitySelector.includesAtom(o.srcAtom)}},{key:"addTriangle",value:function(e,t,n){if(this.visibilitySelector&&!this.isTriangleVisible(e,t,n))return!0;var r=this.geoOut;if(r._numTriangles>=this.maxNumTriangles)return!1;var i=this.addVertexToGeo(r,e),o=this.addVertexToGeo(r,t),a=this.addVertexToGeo(r,n);if((i|o|a)<0)return!1;var s=3*r._numTriangles;return r._indices[s+0]=i,r._indices[s+1]=o,r._indices[s+2]=a,r._numTriangles++,!0}},{key:"buildGeoFromCorners",value:function(e,t,n,r,i,o){for(var a=e-1,s=e,l=e*e,u=new Array(12),c=0;c<12;c++)u[c]=new E;for(var h=[],d=0;d<8;d++)h[d]=1;for(var f=new E,p=0,m=0,v=0;v<a;v++,m+=l)for(var g=0,y=0;y<a;y++,g+=s)for(var _=0;_<a;_++)if(o.hasIntersection[p]){var x=o.bitsInside[p];this.getCornerCoord(t,n,_,v,y,e,f);for(var b=32*p,w=0,S=0;w<8;w++)o.pointsValuesLinear[b+S++]=f.x,o.pointsValuesLinear[b+S++]=f.y,o.pointsValuesLinear[b+S++]=f.z;o.pointsValuesLinear[b+3]+=i.x,o.pointsValuesLinear[b+6]+=i.x,o.pointsValuesLinear[b+15]+=i.x,o.pointsValuesLinear[b+18]+=i.x,o.pointsValuesLinear[b+6+2]+=i.z,o.pointsValuesLinear[b+9+2]+=i.z,o.pointsValuesLinear[b+18+2]+=i.z,o.pointsValuesLinear[b+21+2]+=i.z,o.pointsValuesLinear[b+12+1]+=i.y,o.pointsValuesLinear[b+15+1]+=i.y,o.pointsValuesLinear[b+18+1]+=i.y,o.pointsValuesLinear[b+21+1]+=i.y;for(var T=b+24,M=0;M<8;++M)h[M]=o.pointsValuesLinear[T+M]<0?1:0;this.buildEdgePoint(0,1,h,o,b,u[0]),this.buildEdgePoint(1,2,h,o,b,u[1]),this.buildEdgePoint(2,3,h,o,b,u[2]),this.buildEdgePoint(3,0,h,o,b,u[3]),this.buildEdgePoint(4,5,h,o,b,u[4]),this.buildEdgePoint(5,6,h,o,b,u[5]),this.buildEdgePoint(6,7,h,o,b,u[6]),this.buildEdgePoint(7,4,h,o,b,u[7]),this.buildEdgePoint(0,4,h,o,b,u[8]),this.buildEdgePoint(1,5,h,o,b,u[9]),this.buildEdgePoint(2,6,h,o,b,u[10]),this.buildEdgePoint(3,7,h,o,b,u[11]);for(var C=16*x,A=0,R=0;A<6;A++,R+=3){var P=o.striIndicesMarchCube[C+R];if(P<0)break;var k=o.striIndicesMarchCube[C+R+1],L=o.striIndicesMarchCube[C+R+2];if(!this.addTriangle(u[P],u[k],u[L]))return-2}p++}else p++;return 0}},{key:"getNumIntersectedCells",value:function(e,t,n,r){for(var i=e*e,o=0,a=0,s=0,l=0;l<t;l++,s+=i)for(var u=0,c=0;c<t;c++,u+=e)for(var h=0;h<t;h++){var d=32*a+24,f=h+u+s;r.pointsValuesLinear[d]=n[f],r.pointsValuesLinear[d+1]=n[f+1],r.pointsValuesLinear[d+2]=n[f+e+1],r.pointsValuesLinear[d+3]=n[f+e],r.pointsValuesLinear[d+4]=n[i+f],r.pointsValuesLinear[d+5]=n[i+f+1],r.pointsValuesLinear[d+6]=n[i+f+e+1],r.pointsValuesLinear[d+7]=n[i+f+e];for(var p=0,m=0;m<8;++m)r.pointsValuesLinear[d+m]<0&&(p|=1<<m);0===p||255===p?r.hasIntersection[a]=!1:(r.hasIntersection[a]=!0,o++),r.bitsInside[a]=p,a++}return o}},{key:"getType",value:function(e){var t=[0,0,1,1,2,6,3,6,4,6,5,6,6,0,7,3,8,2,9,6,10,6,11,6,12,6,13,6,14,6,15,4,16,5,17,6,18,6,19,6,20,6,21,6,22,6,23,6,24,6,25,6,26,6,27,6,28,6,29,6,30,6,31,6,32,6,33,6,34,6,35,6,36,6,37,6,38,6,39,6,40,6,41,6,42,6,43,6,44,6,45,6,46,6,47,6,48,6,49,6,50,6,51,6,52,6,53,6,54,6,55,6,56,6,57,6,58,6,59,6,60,6,61,6,62,6,63,6,64,6,65,6,66,6,67,6,68,6,69,6,70,6,71,6,72,6,73,6,74,6,75,6,76,6,77,6,78,6,79,6,80,6,81,6,82,6,83,6,84,6,85,6,86,6,87,6,88,6,89,6,90,6,91,6,92,6,93,6,94,6,95,6,96,6,97,6,98,6,99,6,100,6,101,6,102,6,103,6,104,6,105,6,106,6,107,6,108,6,109,6];if(e<1||e>t.length/2||2*Object.keys(Up.ByAtomicNumber).length!==t.length)throw new Error("atomT.length  should be equal Element.ByAtomicNumber.length * 2");return t[2*e]}},{key:"calculateGridCorners",value:function(e,t,n,r,i,o){for(var a=t*t,s=a*t,l=new E,u=new E,c=0;c<s;c++)e[c]=1e12;for(var h=(t-1)/(r.x-n.x),d=(t-1)/(r.y-n.y),f=(t-1)/(r.z-n.z),p=0,m=i.length;p<m;p++){var v=i[p],g=v.radius+o,y=(v.coord.x-g-n.x)*h,_=(v.coord.y-g-n.y)*d,x=(v.coord.z-g-n.z)*f,b=Math.floor(y),w=Math.floor(_),S=Math.floor(x),T=Math.floor((v.coord.x+g-n.x)*h),M=Math.floor((v.coord.y+g-n.y)*d),C=Math.floor((v.coord.z+g-n.z)*f);T=++T<=t-1?T:t-1,M=++M<=t-1?M:t-1,C=++C<=t-1?C:t-1;for(var A=w;A<=M;A++)for(var R=A*a,P=S;P<=C;P++)for(var k=P*t,L=b;L<=T;L++){var N=R+k+L;this.getCornerCoord(n,r,L,A,P,t,l),u.x=l.x-v.coord.x,u.y=l.y-v.coord.y,u.z=l.z-v.coord.z;var I=Math.sqrt(u.x*u.x+u.y*u.y+u.z*u.z)-g;I<e[N]&&(e[N]=I)}}}},{key:"createVertexHash",value:function(e,t){if(this.hashLines=$c.allocateTyped(Int32Array,65536),null===this.hashLines)return-1;for(var n=0,r=0;n<32768;n++)this.hashLines[r++]=0,this.hashLines[r++]=-1;if(this.maxNumVertices=e,this.maxNumTriangles=t,this.numHashEtriesAllocated=e,this.hashEntries=$c.allocateTyped(Int32Array,2*this.numHashEtriesAllocated),null===this.hashEntries)return-1;for(var i=0,o=0;i<this.numHashEtriesAllocated;i++)this.hashEntries[o++]=-1,this.hashEntries[o++]=-1;return this.numHashEntryIndex=0,0}},{key:"getNewHashEntry",value:function(){if(this.numHashEntryIndex<this.numHashEtriesAllocated){var e=this.numHashEntryIndex;return this.numHashEntryIndex++,e}return-1}},{key:"addVertexToGeo",value:function(e,t){var n,r=this.marCubeResoultion<<2,i=new E,o=Math.floor(r*(t.x-this.vBoxMin.x)/(this.vBoxMax.x+.01-this.vBoxMin.x)),a=Math.floor(r*(t.y-this.vBoxMin.y)/(this.vBoxMax.y+.01-this.vBoxMin.y)),s=815851*o+37633*Math.floor(r*(t.z-this.vBoxMin.z)/(this.vBoxMax.z+.01-this.vBoxMin.z))+2453543*a,l=(s&=32767)+s;if(null!==this.vBoxMin&&null!==this.vBoxMax)for(n=this.hashLines[l+1];n>=0;n=this.hashEntries[2*n+1]){var u=this.hashEntries[2*n+0];if(i.copy(e._vertices[u]),i.x-=t.x,i.y-=t.y,i.z-=t.z,i.x*i.x+i.y*i.y+i.z*i.z<1e-6)return u}if(e._numVertices>=this.maxNumVertices)return-1;var c=e._numVertices;if(e._vertices[c].copy(t),null!==this.vBoxMin&&null!==this.vBoxMax){if((n=this.getNewHashEntry())<0)return-1;var h=this.hashLines[l+1];this.hashLines[l+1]=n,this.hashEntries[2*n+0]=c,this.hashEntries[2*n+1]=h,this.hashLines[l+0]++}return e._numVertices++,c}},{key:"modifyExcludedFromGeo",value:function(e,t,n,r,i,o){for(var a,s,l=e*e,u=(e-1)/(r.x-n.x),c=(e-1)/(r.y-n.y),h=(e-1)/(r.z-n.z),d=2*t*(2*t),f=1/(e-1),p=0;p<i._numVertices;p++){var m=i._vertices[p],v=1.1*t,g=Math.floor((m.x-v-n.x)*u),y=Math.floor((m.y-v-n.y)*c),_=Math.floor((m.z-v-n.z)*h),x=Math.floor((m.x+v-n.x)*u),b=Math.floor((m.y+v-n.y)*c),w=Math.floor((m.z+v-n.z)*h);g=g>=0?g:0,_=_>=0?_:0,x=x<=e-1?x:e-1,b=b<=e-1?b:e-1,w=w<=e-1?w:e-1;for(var S=y=y>=0?y:0;S<=b;S++)for(var E=S*l,T=_;T<=w;T++)for(var M=T*e,C=g;C<=x;C++){a=E+M+C;var A=C*f,R=n.x*(1-A)+r.x*A;A=S*f;var P=n.y*(1-A)+r.y*A;A=T*f;var k=n.z*(1-A)+r.z*A,L=R-m.x,N=P-m.y,I=k-m.z,O=L*L+N*N+I*I;O<d&&((s=-(Math.sqrt(O)-t))>0?(o[a]<0&&(o[a]=s),s>o[a]&&(o[a]=s)):s>o[a]&&(o[a]=s))}}return 0}},{key:"_innerBuild",value:function(){var e,t={posRad:this._posRad,colors:this._colors,atoms:this._opts.atoms};this.complex=this._opts.parent,this.atoms=t.atoms,this.meshResolution=this._opts.gridSpacing,this.atomRadiusScale=this._opts.radScale,this.colorMode=this._opts.colorMode,this.probeRadius=this._opts.probeRadius,this.useVertexColors=!0,this.excludeProbe=this._opts.excludeProbe,this.visibilitySelector=this._opts.visibilitySelector,this.geoOut=null,this.hashLines=null,this.hashEntries=null,this.numHashEtriesAllocated=0,this.numHashEntryIndex=0,this.maxNumVertices=0,this.maxNumTriangles=0;var n=new Array(this.atoms.length);this.convertToAtomsColored(t,n);var r=this.vBoxMin=new E,i=this.vBoxMax=new E;this.getBoundingBox(n,r,i);var o=this.marCubeResoultion=4*this.meshResolution,a=o,s=a*a*a,l=$c.allocateTyped(Float32Array,s),u=this.probeRadius*this.atomRadiusScale;this.calculateGridCorners(l,a,r,i,n,u);var c=o-1,h=new Ep;if((e=h.create(c))<0)return e;var d=new E;d.x=(i.x-r.x)/c,d.y=(i.y-r.y)/c,d.z=(i.z-r.z)/c;var f=this.getNumIntersectedCells(a,c,l,h),p=Math.floor(1.2*f),m=Math.floor(1.2*f*2);if(this.geoOut=new Bp(p,m,this.useVertexColors),(e=this.createVertexHash(p,m))<0)return e;var v=u;if(this.excludeProbe&&(v=.01),this.voxelWorld=new Fp(n.length,n,r,i,v),this.voxelWorld.createVoxels(),e=this.buildGeoFromCorners(o,r,i,l,d,h),this.excludeProbe){if(this.modifyExcludedFromGeo(a,u,r,i,this.geoOut,l),this.geoOut._vertices=null,this.geoOut._colors=null,this.geoOut._indices=null,this.geoOut._normals=null,this.geoOut._numVertices=0,this.geoOut._numTriangles=0,this.geoOut=null,f=this.getNumIntersectedCells(a,c,l,h),p=Math.floor(1.2*f),m=Math.floor(1.2*f*2),this.geoOut=new Bp(p,m,this.useVertexColors),(e=this.createVertexHash(p,m))<0)return e;e=this.buildGeoFromCorners(a,r,i,l,d,h)}this.voxelWorld.buildNormals(this.geoOut._vertices.length,this.geoOut._vertices,this.geoOut._normals);var g=6.5;return this.excludeProbe&&(g-=1.5),this.useVertexColors&&this.voxelWorld.buildColors(this.geoOut._vertices.length,this.geoOut._vertices,this.geoOut._colors,g),this.voxelWorld.destroyVoxels(),this.voxelWorld=null,h.destroy(),e}}]),t}(Sp),LabelsGeometry:function(e){function t(e,n){var r;h(this,t),(r=d(this,f(t).call(this)))._opts=n,r.items=[],r.needsUpdate=!1;var i=-50,o=-50;switch(n.horizontalAlign){case"left":i=0;break;case"right":i=-100}switch(n.verticalAlign){case"top":o=-100;break;case"bottom":o=0}var a=new E(n.dx||0,n.dy||0,n.dz||0);return r.userData={translation:"translate(".concat(i,"%, ").concat(o,"%)"),offset:a},r}return m(t,e),Tc(t,[{key:"setItem",value:function(e,t,n){var r=this._opts,i=this.items[e]||function(e,t){var n=document.createElement("div");if(n.className="label","string"==typeof e){var r=document.createElement("span");r.style.fontSize="150%";for(var i=e.split("\n"),o=0,a=i.length;o<a;++o){var s=document.createElement("span"),l=document.createTextNode(i[o]);s.appendChild(l),r.appendChild(s),o<a-1&&r.appendChild(document.createElement("br"))}n.appendChild(r)}else n.appendChild(e);return n.worldPos=new E,n}(n);i.worldPos.copy(t),i.style.textAlign=r.horizontalAlign,i.style.verticalAlign=r.verticalAlign,this.items[e]=i}},{key:"setColor",value:function(e,t,n){this.items[e].opts={color:t,background:n}}},{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.needsUpdate=!0,this.dispatchEvent({type:"update"})}},{key:"finalize",value:function(){this.finishUpdate()}},{key:"raycast",value:function(){}},{key:"setOpacity",value:function(){}},{key:"getSubset",value:function(){return[]}}]),t}(Nc)};function Gp(e){return function(e){function t(){var e,n;h(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=d(this,(e=f(t)).call.apply(e,[this].concat(i)))).onBeforeRender=t.prototype.onBeforeRender,n}return m(t,e),Tc(t,[{key:"onBeforeRender",value:function(e,t,n,r,i,o){this._onBeforeRender(e,t,n,r,i,o),this._update()}},{key:"_onBeforeRender",value:function(){}},{key:"_update",value:function(){var e=this.material;e&&e instanceof hf&&e.updateUniforms()}}]),t}(e)}var jp=Gp(Gt),Hp=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_onBeforeRender",value:function(e,t,n,r,i,o){jp.prototype._onBeforeRender.call(this,e,t,n);var a=this.material;a&&a.uniforms.invModelViewMatrix&&(this.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,this.matrixWorld),a.uniforms.invModelViewMatrix.value.getInverse(this.modelViewMatrix),a.uniformsNeedUpdate=!0)}}]),t}(jp),Wp=Gp(Gt),qp=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n))).castShadow=!0,r.receiveShadow=!0,r}return m(t,e),Tc(t,[{key:"_onBeforeRender",value:function(e,n,r){Wp.prototype._onBeforeRender.call(this,e,n,r);var i=this.geometry,o=this.material;if(i.zClip&&o.uberOptions){var a=t._modelView,s=t._mvLength,l=t._center;a.multiplyMatrices(this.matrixWorld,r.matrixWorldInverse);var u=s.setFromMatrixColumn(a,0).length();l.copy(i.boundingSphere.center),this.localToWorld(l),o.uberOptions.zClipValue=r.position.z-l.z-u*(.5*i.boundingSphere.radius)}}}]),t}(Wp);u(qp,"_mvLength",new E),u(qp,"_center",new E),u(qp,"_modelView",new V);var Yp=function(e){function t(e,n){var r;h(this,t),(r=d(this,f(t).call(this))).geometry=e;var i=c(r);return i.initialized=!1,r.geometry.addEventListener("update",(function(){i.update()})),r}return m(t,e),Tc(t,[{key:"init",value:function(){for(var e=this.children,t=e.length-1;t>=0;--t)this.remove(e[t]);for(var n=this.geometry,r=n.items,i=n.userData,o=0,a=r.length;o<a;++o){var l=r[o];if(l){var u=$c.shallowCloneNode(l),c=new ef(u);c.userData=s.clone(i),c.getElement().style.visibility="visible",c.source=l,this.add(c)}}this.initialized=!0}},{key:"update",value:function(){if(this.geometry.needsUpdate){var e=this.children;this.initialized||this.init();for(var t=0,n=e.length;t<n;++t){var r=e[t],i=r.source;r.position.copy(i.worldPos),r.userData.color=i.opts.color,r.userData.background=i.opts.background}}}}]),t}(ci),Xp=Gp(Gt);function Zp(e,t){Xp.call(this,e,t),this.castShadow=!0,this.receiveShadow=!0}Zp.prototype=Object.create(Xp.prototype),Zp.prototype.constructor=Zp;var $p=Gp(Gt),Kp=new x,Jp=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_onBeforeRender",value:function(e,t,n,r,i,o){var a=this.material;a.uberOptions&&(a.uberOptions.projMatrixInv.getInverse(n.projectionMatrix,!0),e.getSize(Kp),a.uberOptions.viewport.set(Kp.width,Kp.height))}}]),t}($p),Qp=function(e){function t(){var e,n;h(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=d(this,(e=f(t)).call.apply(e,[this].concat(i)))).castShadow=!0,n.receiveShadow=!0,n}return m(t,e),t}(Gp(Gt)),em={ZClipped:qp,ZSprite:Hp,Text:Yp,Line:Gp(Qi),LineSegments:Gp(no),Mesh:Zp,ThickLineMesh:Jp,Instanced:Qp};function tm(e,t){return function(n){n.setValues(e),n.setUberOptions(t)}}function nm(e,t){return{Geometry:function(n,r){return new Vp.Instanced2CCylindersGeometry(n,r,e,t)},Object:e?em.ZSprite:em.Instanced,initMaterial:tm({instancedMatrix:!0,attrColor:!0,attrColor2:!0,attrAlphaColor:!0,cylinderSprite:e})}}function rm(e,t){var n=e.prototype instanceof up,r=t.lineWidth||0;return{Geometry:e,Object:n?em.ThickLineMesh:em.LineSegments,initMaterial:tm({lights:!1,attrColor:!0,attrAlphaColor:!0,thickLine:n},{lineWidth:r})}}function im(e,t,n,r){var i={wireframe:!!r.wireframe,fakeOpacity:n.now.isoSurfaceFakeOpacity,zClip:r.zClip};return{Geometry:e,Object:em.ZClipped,initMaterial:tm({attrColor:!0,attrAlphaColor:!1,wireframe:i.wireframe,fakeOpacity:i.fakeOpacity,zClip:i.zClip})}}var om=function(){function e(){h(this,e)}return Tc(e,null,[{key:"createSpheres",value:function(e,t){var n=t.now.zSprites;return{Geometry:function(e,t){return new Vp.InstancedSpheresGeometry(e,t,n)},Object:n?em.ZSprite:em.Instanced,initMaterial:tm({instancedPos:!0,attrColor:!0,attrAlphaColor:!0,sphereSprite:n})}}},{key:"create2CClosedCylinders",value:function(e,t){return nm(!1,!1)}},{key:"create2CCylinders",value:function(e,t){return nm(t.now.zSprites,!0)}},{key:"create2CLines",value:function(e,t,n){return rm(Vp.TwoColorLinesGeometry,n)}},{key:"createCrosses",value:function(e,t,n){return rm(Vp.CrossGeometry,n)}},{key:"createExtrudedChains",value:function(e,t){return{Geometry:Vp.ExtrudedObjectsGeometry,Object:em.Mesh,initMaterial:tm({attrColor:!0,attrAlphaColor:!0})}}},{key:"createChunkedLines",value:function(e,t,n){return rm(Vp.ChunkedLinesGeometry,n)}},{key:"createQuickSurface",value:function(e,t,n){return im(Vp.QuickSurfGeometry,0,t,n)}},{key:"createContactSurface",value:function(e,t,n){return im(Vp.ContactSurfaceGeometry,0,t,n)}},{key:"createSASSES",value:function(e,t,n){return im(Vp.SSIsosurfaceGeometry,0,t,n)}},{key:"createLabels",value:function(e,t){return{Geometry:Vp.LabelsGeometry,Object:em.Text,initMaterial:function(){}}}}]),e}(),am=function(e){function t(e,n,r,i){var o;h(this,t),(o=d(this,f(t).call(this)))._geometry=e,o._geoParams=n;var a=r.createInstance();n.initMaterial(a),o._material=a,o._transforms=i.length>0?i:[new V];for(var s=o._createMeshes(e),l=0,u=s.length;l<u;++l)o.add(s[l]);return o}return m(t,e),Tc(t,[{key:"raycast",value:function(e,n){var r=t._ray,i=t._inverseMatrix,o=this.children;r.copy(e.ray);for(var a=0,s=o.length;a<s;++a){var l=o[a];if(Sf.belongToSelectLayers(l)){l.updateMatrixWorld();var u=l.matrixWorld;i.getInverse(u),e.ray.copy(r).applyMatrix4(i);var c=[];this._geometry.raycast(e,c);for(var h=0,d=c.length;h<d;++h){var f=c[h];f.point&&(f.point.applyMatrix4(u),f.distance=r.origin.distanceTo(f.point)),f.object=l,n[n.length]=f}}}e.ray.copy(r)}},{key:"getSubset",value:function(e){for(var t=this._geometry.getSubset(e),n=[],r=0,i=0,o=t.length;i<o;++i)for(var a=this._createMeshes(t[i]),s=0,l=a.length;s<l;++s)n[r++]=a[s];return n}},{key:"_createMeshes",value:function(e){for(var t=this._transforms,n=this._geoParams.Object,r=this._material,i=[],o=0,a=t.length;o<a;++o){var s=new n(e,r);s.applyMatrix(t[o]),i[o]=s}return i}}]),t}(oe);u(am,"_inverseMatrix",new V),u(am,"_ray",new ke);var sm=function(e){function t(e,n,r,i,o,a,s){var l,u,c,p;if(h(this,t),(l=d(this,f(t).call(this))).constructor===t)throw new Error("Can not instantiate abstract class!");return l._selection=n,l._mode=i,l._colorer=r,l._chunksIdc=n.chunks,l._polyComplexity=a,l._geo=new(u=e.Geometry,c=l._makeGeoArgs(),p=[u].concat(c),u.bind.apply(u,Mf(p))),l._mesh=new am(l._geo,e,s,o),l.add(l._mesh),l._build(),l}return m(t,e),Tc(t,[{key:"_makeGeoArgs",value:function(){throw new Error("ChemGroup subclass must override _makeGeoArgs() method")}},{key:"getSubset",value:function(e,t){t=void 0!==t&&t;var n=this._calcChunksList(e,t);return 0===n.length?[]:this._mesh.getSubset(n)}},{key:"_changeSubsetOpacity",value:function(e,t,n){var r=this._calcChunksList(e,n);0!==r.length&&this._geo.setOpacity(r,t)}},{key:"enableSubset",value:function(e,t){t=void 0===t||t,this._changeSubsetOpacity(e,1,t)}},{key:"disableSubset",value:function(e,t){t=void 0===t||t,this._changeSubsetOpacity(e,0,t)}}]),t}(tf),lm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"raycast",value:function(e,t){var n=this._selection.atoms,r=[];this._mesh.raycast(e,r);for(var i=this._chunksIdc,o=0,a=r.length;o<a;++o)if(r[o].hasOwnProperty("chunkIdx")){var s=i[r[o].chunkIdx];s<n.length&&(r[o].atom=n[s],t.push(r[o]))}}},{key:"_calcChunksList",value:function(e){for(var t=[],n=this._selection.atoms,r=this._chunksIdc,i=0,o=r.length;i<o;++i)0!=(n[r[i]]._mask&e)&&t.push(i);return t}}]),t}(sm),um=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_makeGeoArgs",value:function(){return[this._selection.chunks.length,this._polyComplexity]}},{key:"_build",value:function(){for(var e=this._selection.chunks,t=this._selection,n=t.atoms,r=t.parent,i=this._mode,o=this._colorer,a=this._geo,s=0,l=e.length;s<l;++s){var u=n[e[s]];a.setItem(s,u._position,i.calcAtomRadius(u)),a.setColor(s,o.getAtomColor(u,r))}a.finalize()}},{key:"updateToFrame",value:function(e){for(var t=this._selection.chunks,n=this._selection.atoms,r=this._mode,i=this._colorer,o=e.needsColorUpdate(i),a=this._geo,s=0,l=t.length;s<l;++s){var u=n[t[s]];a.setItem(s,e.getAtomPos(t[s]),r.calcAtomRadius(u)),o&&a.setColor(s,e.getAtomColor(i,u))}a.finalize()}}]),t}(lm),cm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_makeGeoArgs",value:function(){for(var e=[],t=this._selection,n=t.atoms,r=t.chunks,i=r.length,o=0;o<i;++o)e[o]=n[r[o]];var a=this._mode.getSurfaceOpts();return a.atoms=e,[i,a]}}]),t}(um),hm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_makeGeoArgs",value:function(){for(var e=[],t=this._selection,n=t.atoms,r=t.chunks,i=r.length,o=0;o<i;++o)e[o]=n[r[o]];var a=this._mode.getSurfaceOpts();return a.atoms=e,a.selection=this._selection,a.colorMode=this._colorer,[i,a]}}]),t}(um);function dm(e){return null!==e.getName().getNode()?e.getName().getNode():e.getVisualName()}var fm={none:function(e){return e},adjust:function(e){var t=e>>16&255,n=e>>8&255,r=255&e;return.2126*t+.7152*n+.0722*r>127?(t=3*t/10,n=3*n/10,r=3*r/10):(t=255-3*(255-t)/10,n=255-3*(255-n)/10,r=255-3*(255-r)/10),t<<16|n<<8|r},inverse:function(e){return 255-(e>>16&255)<<16|255-(e>>8&255)<<8|255-(255&e)}};function pm(e,t){var n;if(fm.hasOwnProperty(t))n=$c.hexColor(fm[t](e));else{var r=parseInt(t,16);n=!Number.isNaN(r)&&t.toLowerCase().startsWith("0x")?$c.hexColor(r):"#000000"}return n}var mm={serial:function(e){return e.getSerial()},name:function(e){return e.getVisualName()},elem:function(e){return e.element.name},residue:function(e){return e._residue.getType().getName()},sequence:function(e){return e._residue.getSequence()},chain:function(e){return e._residue.getChain().getName()},hetatm:function(e){return e.isHet()},water:function(e){return"HOH"===e._residue.getType().getName()||"WAT"===e._residue.getType().getName()}},vm=function(e,t){return t.replace(/\{\{(\s*\w+\s*)\}\}/g,(function(t){var n=t.replace(/\s+/g,"");return n=n.substring(2,n.length-2).toLowerCase(),mm.hasOwnProperty(n)?mm[n](e):"null"}))},gm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_makeGeoArgs",value:function(){var e=this._mode.getLabelOpts();return[this._selection.chunks.length,e]}},{key:"_build",value:function(){for(var e=this._mode.getLabelOpts(),t=this._selection.chunks,n=this._selection,r=n.atoms,i=n.parent,o=this._colorer,a=this._geo,s=0,l=t.length;s<l;++s){var u=r[t[s]],c=e.template?vm(u,e.template):dm(u);if(c){var h=o.getAtomColor(u,i),d=parseInt(pm(h,e.fg).substring(1),16),f=e.showBg?parseInt(pm(h,e.bg).substring(1),16):"transparent";a.setItem(s,u.getPosition(),c),a.setColor(s,d,f)}}a.finalize()}},{key:"updateToFrame",value:function(e){for(var t=this._mode.getLabelOpts(),n=this._selection.chunks,r=this._selection.atoms,i=this._colorer,o=this._geo,a=e.needsColorUpdate(i),s=0,l=n.length;s<l;++s){var u=r[n[s]],c=t.template?vm(u,t.template):dm(u);if(c){var h=e.getAtomColor(i,u),d=parseInt(pm(h,t.fg).substring(1),16),f=t.showBg?parseInt(pm(h,t.bg).substring(1),16):"transparent";o.setItem(s,e.getAtomPos(n[s]),c),a&&o.setColor(s,d,f)}}o.finalize()}}]),t}(lm);function ym(e,t,n,r){var i=Math.sin(e);return t.clone().multiplyScalar(Math.sin((1-r)*e)/i).addScaledVector(n,Math.sin(r*e)/i)}var _m=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_buildInner",value:function(e,t){for(var n=this._selection.chunks,r=new E,i=new E,o=this._segmentsHeight,a=1/o,s=this._colorer,l=this._selection,u=l.cycles,c=l.parent,h=0,d=n[h],f=0,p=u.length;f<p;++f){var m=u[f],v=m.atoms,g=[],y=[],_=m.center,x=m.radius-e,b=v.length,w=0,S=v[b-1]._position,T=v[w]._position;r.subVectors(S,_),i.subVectors(T,_);for(var M=i.clone().cross(r).normalize();w<b;++w){var C=r.angleTo(i);y[w]=ym(C,r,i,.5).normalize(),T=v[(w+1)%b]._position,r.copy(i),i.subVectors(T,_)}for(w=0;w<b;++w)if(v[w]._index===d){for(var A=y[w],R=y[(w+1)%b],P=s.getAtomColor(v[w],c),k=A.angleTo(R),L=0;L<=o;++L)g[L]=ym(k,A,R,L*a).multiplyScalar(x).add(_);t(h++,P,g,_,M),d=n[h]}}}}]),t}(lm);function xm(e,t){for(var n=[],r=0;r<t;++r){var i=-2*r/t*Math.PI;n.push(new E(Math.cos(i)*e,Math.sin(i)*e,0))}return n}var bm=Sf.calcChunkMatrix,wm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_build",value:function(){var e=this._segmentsHeight,t=this._mode.getAromRadius(),n=new x(t,t),r=this._mode.calcStickRadius()+2*t,i=new E,o=[],a=this._geo;this._buildInner(r,(function(t,r,s,l,u){for(var c=0;c<=e;++c){var h=s[c],d=h.clone().sub(l).cross(u);i.addVectors(h,d),o[c]=bm(h,i,u,n)}a.setItem(t,o),a.setColor(t,r)})),a.finalize()}},{key:"_makeGeoArgs",value:function(){return this._segmentsHeight=this._polyComplexity,[xm(1,this._polyComplexity),this._segmentsHeight+1,this._selection.chunks.length]}}]),t}(_m),Sm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_build",value:function(){var e=this,t=this._geo,n=this._mode.getAromaticOffset();this._buildInner(n,(function(n,r,i){for(var o=i[0],a=1;a<=e._segmentsHeight;++a){var s=i[a];t.setSegment(n,a-1,o,s),o=s}t.setColor(n,r)})),t.finalize()}},{key:"_makeGeoArgs",value:function(){return this._segmentsHeight=this._mode.getAromaticArcChunks(),[this._selection.chunks.length,this._segmentsHeight,!0]}}]),t}(_m),Em=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"raycast",value:function(e,t){var n=this._selection.residues,r=[];this._mesh.raycast(e,r);for(var i=this._chunksIdc,o=0,a=r.length;o<a;++o)if(r[o].hasOwnProperty("chunkIdx")){var s=i[r[o].chunkIdx];s<n.length&&(r[o].residue=n[s],t.push(r[o]))}}},{key:"_calcChunksList",value:function(e){for(var t=[],n=this._selection.residues,r=this._chunksIdc,i=0,o=r.length;i<o;++i)0!=(n[r[i]]._mask&e)&&t.push(i);return t}}]),t}(sm),Tm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"raycast",value:function(e,t){var n=this._selection.residues,r=[];this._mesh.raycast(e,r);for(var i=this._chunksIdc,o=0,a=r.length;o<a;++o)if(r[o].hasOwnProperty("chunkIdx")){var s=i[Math.floor(r[o].chunkIdx/2)];s<n.length&&(r[o].residue=n[s],t.push(r[o]))}}},{key:"_build",value:function(){for(var e=this._selection,t=e.residues,n=e.parent,r=this._colorer,i=this._geo,o=this._mode.calcStickRadius(),a=0,s=this._selection.chunks,l=0,u=s.length;l<u;++l){var c=t[s[l]],h=r.getResidueColor(c,n);this._processItem(a++,c._cylinders[0],c._cylinders[1],o,h)}i.finalize()}},{key:"_calcChunksList",value:function(e){for(var t=[],n=0,r=this._selection.residues,i=this._chunksIdc,o=0,a=i.length;o<a;++o)0!=(r[i[o]]._mask&e)&&(t[n++]=2*o,t[n++]=2*o+1);return t}},{key:"updateToFrame",value:function(e){for(var t=e.getResidues(),n=this._selection.parent,r=this._colorer,i=this._geo,o=this._mode.calcStickRadius(),a=0,s=this._selection.chunks,l=0,u=s.length;l<u;++l){var c=t[s[l]],h=r.getResidueColor(c,n);this._processItem(a++,c._cylinders[0],c._cylinders[1],o,h)}i.finishUpdate()}}]),t}(Em),Mm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_makeGeoArgs",value:function(){return[this._selection.chunks.length,this._polyComplexity]}},{key:"_processItem",value:function(e,t,n,r,i){var o=this._geo;o.setItem(e,t,n,r),o.setColor(e,i,i)}}]),t}(Tm),Cm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_makeGeoArgs",value:function(){return[2*this._selection.chunks.length,this._polyComplexity]}},{key:"_processItem",value:function(e,t,n,r,i){var o=this._geo,a=2*e;o.setItem(a,t,r),o.setColor(a,i),a++,o.setItem(a,n,r),o.setColor(a,i)}}]),t}(Tm),Am=o((function(e,t){(function(){var e,n,r,i,o,a,s,l,u,c,h,d,f,p,m,v,g,y,_,x,b,w,S,E,T,M,C=Object.prototype.hasOwnProperty,A=function(e,t){for(var n in t)C.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};for(v in d={method:(r={METHOD_NEAREST:"nearest",METHOD_LINEAR:"linear",METHOD_CUBIC:"cubic",METHOD_LANCZOS:"lanczos",METHOD_SINC:"sinc",CLIP_CLAMP:"clamp",CLIP_ZERO:"zero",CLIP_PERIODIC:"periodic",CLIP_MIRROR:"mirror",CUBIC_TENSION_DEFAULT:0,CUBIC_TENSION_CATMULL_ROM:0}).METHOD_CUBIC,cubicTension:r.CUBIC_TENSION_DEFAULT,clip:r.CLIP_CLAMP,scaleTo:0,sincFilterSize:2,sincWindow:void 0},u=function(e,t){return Math.max(0,Math.min(e,t-1))},h=function(e,t){return(e%=t)<0&&(e+=t),e},c=function(e,t){var n;return(e=h(e,n=2*(t-1)))>t-1&&(e=n-e),e},e=function(){function e(e,t){if(this.array=e.slice(0),this.length=this.array.length,!(this.clipHelper={clamp:this.clipHelperClamp,zero:this.clipHelperZero,periodic:this.clipHelperPeriodic,mirror:this.clipHelperMirror}[t.clip]))throw"Invalid clip: "+t.clip}return e.prototype.getClippedInput=function(e){return 0<=e&&e<this.length?this.array[e]:this.clipHelper(e)},e.prototype.clipHelperClamp=function(e){return this.array[u(e,this.length)]},e.prototype.clipHelperZero=function(e){return 0},e.prototype.clipHelperPeriodic=function(e){return this.array[h(e,this.length)]},e.prototype.clipHelperMirror=function(e){return this.array[c(e,this.length)]},e.prototype.interpolate=function(e){throw"Subclasses of AbstractInterpolator must override the interpolate() method."},e}(),o=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return A(t,e),t.prototype.interpolate=function(e){return this.getClippedInput(Math.round(e))},t}(e),i=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return A(t,e),t.prototype.interpolate=function(e){var t;return(1-(e-=t=Math.floor(e)))*this.getClippedInput(t)+e*this.getClippedInput(t+1)},t}(e),n=function(e){function t(e,n){this.tangentFactor=1-Math.max(-1,Math.min(1,n.cubicTension)),t.__super__.constructor.apply(this,arguments)}return A(t,e),t.prototype.getTangent=function(e){return this.tangentFactor*(this.getClippedInput(e+1)-this.getClippedInput(e-1))/2},t.prototype.interpolate=function(e){var t,n,r,i,o;return t=Math.floor(e),n=[this.getTangent(t),this.getTangent(t+1)],(2*(o=(e-=t)*(i=e*e))-3*i+1)*(r=[this.getClippedInput(t),this.getClippedInput(t+1)])[0]+(o-2*i+e)*n[0]+(-2*o+3*i)*r[1]+(o-i)*n[1]},t}(e),w=Math.sin,a=Math.PI,S=function(e){return 0===e?1:w(a*e)/(a*e)},g=function(e){return function(t){return S(t/e)}},_=function(e){return function(t){return S(t)*e(t)}},s=function(e){function t(e,n){if(t.__super__.constructor.apply(this,arguments),this.a=n.sincFilterSize,!n.sincWindow)throw"No sincWindow provided";this.kernel=_(n.sincWindow)}return A(t,e),t.prototype.interpolate=function(e){var t,n,r,i,o;for(r=0,n=i=(t=Math.floor(e))-this.a+1,o=t+this.a;i<=o?n<=o:n>=o;i<=o?n++:n--)r+=this.kernel(e-n)*this.getClippedInput(n);return r},t}(e),f=function(e,t){var n,r,i,o;for(o=[],r=0,i=e.length;r<i;r++)n=e[r],o.push(n[t]);return o},y=function(e,t,n){var r,i;return"0,1"===n.join?e:(r=t/(n[1]-n[0]),i=n[0],function(t){return e(r*(t-i))})},p=function(e){return Object.prototype.toString.call(e).slice("[object ".length,-1)},T=function(e){if(isNaN(e))throw"NaN in Smooth() input";if("Number"!==p(e))throw"Non-number in Smooth() input";if(!isFinite(e))throw"Infinity in Smooth() input"},M=function(e,t){var n,r,i;if("Array"!==p(e))throw"Non-vector in Smooth() input";if(e.length!==t)throw"Inconsistent dimension in Smooth() input";for(r=0,i=e.length;r<i;r++)n=e[r],T(n)},m=function(e){return"Number"===p(e)&&isFinite(e)&&!isNaN(e)},x=function(e){var t;switch(t="scaleTo param must be number or array of two numbers",p(e)){case"Number":if(!m(e))throw t;e=[0,e];break;case"Array":if(2!==e.length)throw t;if(!m(e[0])||!m(e[1]))throw t;break;default:throw t}return e},b=function(e){var t,n,r;for(n in t={},e)C.call(e,n)&&(r=e[n],t[n]=r);return t},l=function(e,t){var r,a,u,c,h,m,v,_,w,S,E;for(v in null==t&&(t={}),w={},t=b(t),w.config=b(t),null==t.scaleTo&&(t.scaleTo=t.period),null==t.sincFilterSize&&(t.sincFilterSize=t.lanczosFilterSize),d)C.call(d,v)&&(E=d[v],null==t[v]&&(t[v]=E));if(!(h={nearest:o,linear:i,cubic:n,lanczos:s,sinc:s}[t.method]))throw"Invalid method: "+t.method;if("lanczos"===t.method&&(t.sincWindow=g(t.sincFilterSize)),e.length<2)throw"Array must have at least two elements";for(v in w.count=e.length,S=function(){var n,r,i,o;switch(p(e[0])){case"Number":if(w.dimension="scalar",l.deepValidation)for(n=0,i=e.length;n<i;n++)_=e[n],T(_);return c=new h(e,t),function(e){return c.interpolate(e)};case"Array":if(w.dimension=a=e[0].length,!a)throw"Vectors must be non-empty";if(l.deepValidation)for(r=0,o=e.length;r<o;r++)E=e[r],M(E,a);return m=function(){var n;for(n=[],u=0;0<=a?u<a:u>a;0<=a?u++:u--)n.push(new h(f(e,u),t));return n}(),function(e){var t,n,r,i;for(i=[],n=0,r=m.length;n<r;n++)t=m[n],i.push(t.interpolate(e));return i};default:throw"Invalid element type: "+p(e[0])}}(),r="periodic"===t.clip?e.length:e.length-1,t.scaleTo||(t.scaleTo=r),w.domain=x(t.scaleTo),S=y(S,r,w.domain),w.domain.sort(),w)C.call(w,v)&&(E=w[v],S[v]=E);return S},r)C.call(r,v)&&(E=r[v],l[v]=E);l.deepValidation=!0,(null!==t?t:window).Smooth=l}).call(i)})).Smooth,Rm=Qd.ResidueType,Pm=Sf.calcChunkMatrix;function km(e,t){var n=Am(e,{method:Am.METHOD_CUBIC,clip:Am.CLIP_CLAMP,cubicTension:t,scaleTo:1});return function(t,r){var i=r;null===i&&(i=function(t){return(t*(e.length-1-2)+1)/(e.length-1)});var o=i(t),a=n(o);return new E(a[0],a[1],a[2])}}function Lm(e,t,n,r){if(!r._isValid)return e[n]=e[n-1],void(t[n]=t[n-1]);var i=r._controlPoint;e[n]=[i.x,i.y,i.z];var o=i.clone().add(r._wingVector);t[n]=[o.x,o.y,o.z]}var Nm=function(){function e(t,n,r,i,o,a){h(this,e);var s=function(e,t,n,r){var i=r.start,o=r.end;function a(t){return t>i&&e[t-1]._isValid?t-1:t}function s(t){return t<o&&e[t+1]._isValid?t+1:t}var l=[],u=[],c=0;function h(t,n){var r=e[t]._controlPoint.clone().lerp(e[n]._controlPoint,-.25),i=r.clone().add(e[t]._wingVector);u[c]=[r.x,r.y,r.z],l[c++]=[i.x,i.y,i.z],u[c]=[r.x,r.y,r.z],l[c++]=[i.x,i.y,i.z]}var d=a(t),f=s(n);if(d===f)return function(e,t,n,r){var i,o,a=0!=(r._type.flags&Rm.Flags.NUCLEIC),s=a?"C5'":"N",l=a?"C3'":"C";if(r.forEachAtom((function(e){var t=e.getVisualName();i||t!==s?o||t!==l||(o=e._position):i=e._position})),i&&o||(i=r._firstAtom._position,o=r._lastAtom._position),i&&o){var u=o.clone().sub(i),c=r._wingVector,h=r._controlPoint,d=h.clone().add(c),f=h.clone().sub(u),p=f.clone().add(c);e[n]=[f.x,f.y,f.z],t[n]=[p.x,p.y,p.z],e[++n]=[f.x,f.y,f.z],t[n]=[p.x,p.y,p.z],e[++n]=[h.x,h.y,h.z],t[n]=[d.x,d.y,d.z],++n;var m=h.clone().add(u),v=m.clone().add(c);e[n]=[m.x,m.y,m.z],t[n]=[v.x,v.y,v.z],e[++n]=[m.x,m.y,m.z],t[n]=[v.x,v.y,v.z]}}(u,l,c,e[t]),{centerPoints:u,topPoints:l};t===d?h(t,s(t)):(Lm(u,l,c++,e[a(d)]),Lm(u,l,c++,e[d]));for(var p=t;p<=n;++p)Lm(u,l,c++,e[p]);return f===s(f)?h(n,a(n)):(Lm(u,l,c++,e[f]),Lm(u,l,c,e[s(f)])),{centerPoints:u,topPoints:l}}(t,n,r,a);this._topInterp=km(s.topPoints,o),this._centerInterp=km(s.centerPoints,o),this._shift=.5/(r-n+2),this._valueStep=(1-2*this._shift)/(2*(r-n+1)*(i-1)),this._segmentsCount=i}return Tc(e,[{key:"prepareMatrices",value:function(e,t,n){for(var r=this._segmentsCount,i=new Array(r),o=new x(0,0),a=this._topInterp,s=this._centerInterp,l=this._shift+this._valueStep*(r-1)*e,u=0;u<r;++u){var c=Math.min(1,u/(r-1));o.lerpVectors(t,n,c);var h=a(l,null),d=s(l,null),f=s(l+=this._valueStep,null);i[u]=Pm(d.clone(),f.clone(),h.clone().sub(d),o)}return i}}]),e}();function Im(e,t){for(var n=[],r=0;r<t;++r){var i=Math.PI/2-2*Math.PI*r/t;n.push(new E(Math.cos(i)*e,Math.sin(i)*e,0))}return n}function Om(e,t,n,r,i,o){for(var a=0,s=e.length;a<s;++a)for(var l=e[a].arr,u=e[a].boundaries,c=0,h=l.length;c<h;++c)for(var d=[l[c].start,l[c].end],f=new Nm(t,d[0],d[1],n,r,u),p=null,m=2*l[c].start,v=2*l[c].end+1,g=i.getResidueRadius(t[0],0),y=m;y<=v;++y){var _=t[y/2|0],x=i.getResidueRadius(_,y%2),b=i.getResidueRadius(_,1+y%2),w=f.prepareMatrices(y-2*d[0],x,b);w.unshift(null===p?w[0]:p),o(_,w,x.x!==b.x||x.y!==b.y,x.x!==g.x||x.y!==g.y),p=w[n],g=b}}var Dm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_makeGeoArgs",value:function(){var e=this._mode.getHeightSegmentsRatio();return this._segmentsHeight=this._polyComplexity*e|0,[Im(1,this._polyComplexity),this._segmentsHeight+1,2*this._selection.chunks.length]}},{key:"_build",value:function(){var e=this._selection,t=e.residues,n=e.parent,r=this._mode,i=this._colorer,o=r.getTension(),a=this._geo,s=0,l=[];Om(this._selection.subdivs,t,this._segmentsHeight,o,r,(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=i.getResidueColor(e,n);l[s]=e._index,a.setItem(s,t,r,o),a.setColor(s++,u)})),this._chunksIdc=l,a.finalize()}},{key:"updateToFrame",value:function(e){var t=this._selection.parent,n=this._mode,r=this._colorer,i=n.getTension(),o=this._geo,a=e.getResidues(),s=0,l=e.needsColorUpdate(r);Om(this._selection.subdivs,a,this._segmentsHeight,i,n,(function(e,n){o.setItem(s,n),l&&o.setColor(s,r.getResidueColor(e,t)),s++})),o.finalize()}}]),t}(Em),zm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_makeGeoArgs",value:function(){for(var e=this._selection.subdivs,t=0,n=0,r=e.length;n<r;++n)for(var i=e[n].arr,o=0,a=i.length;o<a;++o)t+=i[o].end-i[o].start;return[t,this._polyComplexity]}},{key:"_build",value:function(){for(var e=this._selection,t=e.residues,n=e.parent,r=this._mode,i=this._colorer,o=this._geo,a=0,s=[],l=this._selection.subdivs,u=r.calcStickRadius(),c=0,h=l.length;c<h;++c)for(var d=l[c].arr,f=0,p=d.length;f<p;++f)for(var m=d[f].start,v=d[f].end,g=t[m],y=m+1;y<=v;++y){var _=t[y];s[a]={first:g._index,second:_._index},o.setItem(a,g._controlPoint,_._controlPoint,u),o.setColor(a,i.getResidueColor(g,n),i.getResidueColor(_,n)),a++,g=_}this._chunksIdc=s,o.finalize()}},{key:"updateToFrame",value:function(e){for(var t=e.getResidues(),n=this._selection.parent,r=this._mode,i=this._colorer,o=this._geo,a=0,s=this._selection.subdivs,l=r.calcStickRadius(),u=e.needsColorUpdate(i),c=0,h=s.length;c<h;++c)for(var d=s[c].arr,f=0,p=d.length;f<p;++f)for(var m=d[f].start,v=d[f].end,g=t[m],y=m+1;y<=v;++y){var _=t[y];o.setItem(a,g._controlPoint,_._controlPoint,l),u&&o.setColor(a,i.getResidueColor(g,n),i.getResidueColor(_,n)),a++,g=_}o.finalize()}},{key:"raycast",value:function(e,t){var n=[],r=this._selection.residues;this._mesh.raycast(e,n);for(var i=this._chunksIdc,o=0,a=n.length;o<a;++o)if(n[o].hasOwnProperty("chunkIdx")){var s=n[o].chunkIdx,l=i[Math.floor(s/2)],u=s%2==0?l.first:l.second;u<r.length&&(n[o].residue=r[u],t.push(n[o]))}}},{key:"_calcChunksList",value:function(e){for(var t=[],n=this._chunksIdc,r=this._selection.residues,i=0,o=n.length;i<o;++i){var a=n[i];r[a.first]._mask&e&&t.push(2*i),r[a.second]._mask&e&&t.push(2*i+1)}return t}}]),t}(sm),Fm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_makeGeoArgs",value:function(){for(var e=this._mode.drawMultiorderBonds(),t=this._mode.showAromaticLoops(),n=this._selection.chunks,r=this._selection.bonds,i=0,o=0,a=n.length;o<a;++o)i+=this.getBondOrder(r[n[o]],e,t);return[i,this._polyComplexity]}},{key:"getBondOrder",value:function(e,t,n){var r=1;return!t||n&&e._type===Mh.BondType.AROMATIC||(r=function(e){return e<2?1:e}(e._order)),r}},{key:"raycast",value:function(e,t){var n=this._selection.bonds,r=[];this._mesh.raycast(e,r);for(var i=this._chunksIdc,o=0,a=r.length;o<a;++o)if(r[o].hasOwnProperty("chunkIdx")){var s=r[o].chunkIdx,l=i[Math.floor(s/2)];if(l<n.length){var u=n[l];r[o].atom=s%2==0?u._left:u._right,t.push(r[o])}}}},{key:"_calcChunksList",value:function(e,t){for(var n=[],r=this._selection.bonds,i=this._chunksIdc,o=0,a=i.length;o<a;++o){var s=r[i[o]];s._left._mask&e&&(!t||s._right._mask&e)&&n.push(2*o),s._right._mask&e&&(!t||s._left._mask&e)&&n.push(2*o+1)}return n}}]),t}(sm),Bm={AtomsSphereGroup:um,AtomsSurfaceGroup:cm,AtomsSASSESGroupStub:hm,AtomsTextGroup:gm,AromaticTorusGroup:wm,AromaticLinesGroup:Sm,NucleicCylindersGroup:Mm,NucleicSpheresGroup:Cm,ResiduesSubseqGroup:Dm,ResiduesTraceGroup:zm,BondsCylinderGroup:function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_build",value:function(){for(var e,t=this._selection.chunks,n=this._selection,r=n.bonds,i=n.parent,o=this._mode,a=this._colorer,s=this._geo,l=o.drawMultiorderBonds(),u=o.showAromaticLoops(),c=o.calcStickRadius(),h=o.calcSpaceFraction(),d=new E,f=new E,p=0,m=[],v=0,g=t.length;v<g;++v){var y=r[t[v]],_=y._left,x=y._right,b=_._position,w=x._position;e=y.calcNormalDir();for(var S=this.getBondOrder(y,l,u),T=2*Math.min(o.calcAtomRadius(_),o.calcAtomRadius(x))/S,M=l?Math.min(c,.5*T*(1-h)):c,C=0;C<S;++C){var A=T*(S%2==0?(.5+(C/2|0))*(1-C%2*2):((C+1)/2|0)*(C%2*2-1));m[p]=y._index,d.copy(b),d.addScaledVector(e,A),f.copy(w),f.addScaledVector(e,A),s.setItem(p,d,f,M),s.setColor(p++,a.getAtomColor(_,i),a.getAtomColor(x,i))}}s.finalize(),this._chunksIdc=m}},{key:"updateToFrame",value:function(e){for(var t,n=this._selection.chunks,r=this._selection.bonds,i=this._mode,o=this._colorer,a=this._geo,s=i.drawMultiorderBonds(),l=i.showAromaticLoops(),u=i.calcStickRadius(),c=i.calcSpaceFraction(),h=new E,d=new E,f=0,p=e.needsColorUpdate(o),m=0,v=n.length;m<v;++m){var g=r[n[m]],y=g._left,_=g._right,x=e.getAtomPos(y._index).clone(),b=e.getAtomPos(_._index);t=g.calcNormalDir();for(var w=this.getBondOrder(g,s,l),S=2*Math.min(i.calcAtomRadius(y),i.calcAtomRadius(_))/w,T=s?Math.min(u,.5*S*(1-c)):u,M=0;M<w;++M){var C=S*(w%2==0?(.5+(M/2|0))*(1-M%2*2):((M+1)/2|0)*(M%2*2-1));h.copy(x),h.addScaledVector(t,C),d.copy(b),d.addScaledVector(t,C),a.setItem(f,h,d,T),p&&a.setColor(f,e.getAtomColor(o,y),e.getAtomColor(o,_)),f++}}a.finalize()}}]),t}(Fm),BondsLinesGroup:function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_build",value:function(){for(var e=this._selection.chunks,t=this._selection,n=t.bonds,r=t.parent,i=this._mode,o=this._colorer,a=this._geo,s=i.drawMultiorderBonds(),l=i.showAromaticLoops(),u=new E,c=new E,h=new E,d=0,f=[],p=0,m=e.length;p<m;++p){var v=n[e[p]],g=v._left,y=v._right,_=g._position,x=y._position,b=1===g._bonds.length,w=1===y._bonds.length;u.subVectors(x,_);for(var S=u.length(),T=v.calcNormalDir(),M=this.getBondOrder(v,s,l),C=0;C<M;++C){c.copy(_),h.copy(x);var A=M%2==0?(.5+(C/2|0))*(1-C%2*2):((C+1)/2|0)*(C%2*2-1);f[d]=v._index,2!==M||b||w||(A-=.5,A*=-1),!b&&!w&&M>1&&0!==A&&(c.lerpVectors(_,x,.15/S),h.lerpVectors(_,x,1-.15/S)),A*=.15,c.addScaledVector(T,A),h.addScaledVector(T,A),a.setItem(d,c,h),a.setColor(d++,o.getAtomColor(g,r),o.getAtomColor(y,r))}}a.finalize(),this._chunksIdc=f}},{key:"updateToFrame",value:function(e){for(var t=this._selection.chunks,n=this._selection.bonds,r=this._mode,i=this._colorer,o=this._geo,a=r.drawMultiorderBonds(),s=r.showAromaticLoops(),l=new E,u=new E,c=new E,h=0,d=e.needsColorUpdate(i),f=0,p=t.length;f<p;++f){var m=n[t[f]],v=m._left,g=m._right,y=e.getAtomPos(v._index).clone(),_=e.getAtomPos(g._index),x=1===v._bonds.length,b=1===g._bonds.length;l.subVectors(_,y);for(var w=l.length(),S=m.calcNormalDir(),T=this.getBondOrder(m,a,s),M=0;M<T;++M){u.copy(y),c.copy(_);var C=T%2==0?(.5+(M/2|0))*(1-M%2*2):((M+1)/2|0)*(M%2*2-1);2!==T||x||b||(C-=.5,C*=-1),!x&&!b&&T>1&&0!==C&&(u.lerpVectors(y,_,.15/w),c.lerpVectors(y,_,1-.15/w)),C*=.15,u.addScaledVector(S,C),c.addScaledVector(S,C),o.setItem(h,u,c),d&&o.setColor(h,e.getAtomColor(i,v),e.getAtomColor(i,g)),h++}}o.finalize()}}]),t}(Fm)},Um=function(e){function t(e,n,r,i,o,a,s,l){var u;h(this,t),u=d(this,f(t).call(this));var p=c(u);u._complex=r,u._mode=o;var m=r.getAtoms(),v=r.getTransforms();return r.forEachComponent((function(t){var u=[],c=0;if(t.forEachAtom((function(e){p._checkAtom(e,s)&&(u[c++]=e._index)})),0!==c){var h=new e(n,{atoms:m,chunks:u,parent:r},i,o,v,a,l);h._component=t,p.add(h)}})),u}return m(t,e),Tc(t,[{key:"_checkAtom",value:function(e,t){return e._mask&t}},{key:"getSubset",value:function(e,t){for(var n=[],r=this.children,i=0,o=0,a=r.length;o<a;++o)if(r[o].getSubset)for(var s=r[o].getSubset(e,t),l=0,u=s.length;l<u;++l){var c=s[l];c._component=r[o]._component,n[i++]=c}return n}}]),t}(tf),Vm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_checkAtom",value:function(e,t){if(!(e._mask&t))return!1;for(var n=e._bonds,r=0,i=n.length;r<i;++r)if(n[r]._left._mask&t&&n[r]._right._mask&t)return!1;return!0}}]),t}(Um),Gm=function(e){function t(e,n,r,i,o,a,s,l){var u;h(this,t),u=d(this,f(t).call(this));var p=c(u);u._complex=r;var m=r.getResidues(),v=r.getTransforms();return r.forEachComponent((function(t){var u=0,c=[];if(t.forEachResidue((function(e){p._checkResidue(e,s)&&(c[u++]=e._index)})),0!==u){var h=new e(n,{residues:m,chunks:c,parent:r},i,o,v,a,l);h._component=t,p.add(h)}})),u}return m(t,e),Tc(t,[{key:"checkResidue",value:function(e,t){return e._mask&t}},{key:"getSubset",value:function(e,t){for(var n=[],r=this.children,i=0,o=0,a=r.length;o<a;++o)if(r[o].getSubset)for(var s=r[o].getSubset(e,t),l=0,u=s.length;l<u;++l){var c=s[l];c._component=r[o]._component,n[i++]=c}return n}}]),t}(tf),jm={Atoms:Um,OrphanAtoms:Vm,Residues:Gm,Nucleic:function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_checkResidue",value:function(e,t){return t&e._mask&&null!==e._cylinders}}]),t}(Gm),Subseqs:function(e){function t(e,n,r,i,o,a,s,l){var u;h(this,t),u=d(this,f(t).call(this));var p=c(u);u._complex=r;var m=r.getResidues(),v=r.getTransforms();return r.forEachComponent((function(t){for(var u=t.getMaskedSubdivSequences(s),c=0,h=[],d=0,f=u.length;d<f;++d)for(var g=u[d].arr,y=0,_=g.length;y<_;++y)for(var x=g[y].start,b=g[y].end;x<=b;++x)h[c++]=m[x]._index;if(0!==c){var w=new e(n,{residues:m,chunks:h,subdivs:u,parent:r},i,o,v,a,l);w._component=t,p.add(w)}})),u}return m(t,e),Tc(t,[{key:"getSubset",value:function(e,t){for(var n=[],r=this.children,i=0,o=0,a=r.length;o<a;++o)if(r[o].getSubset)for(var s=r[o].getSubset(e,t),l=0,u=s.length;l<u;++l){var c=s[l];c._component=r[o]._component,n[i++]=c}return n}}]),t}(tf),Bonds:function(e){function t(e,n,r,i,o,a,s,l){var u;h(this,t),u=d(this,f(t).call(this));var p=c(u);u._complex=r;var m=r.getBonds(),v=r.getTransforms();return r.forEachComponent((function(t){var u=[],c=0;if(t.forEachBond((function(e){var t=e._left,n=e._right;t._mask&s&&n._mask&s&&(u[c++]=e._index)})),0!==c){var h=new e(n,{bonds:m,chunks:u,parent:r},i,o,v,a,l);h._component=t,p.add(h)}})),u}return m(t,e),Tc(t,[{key:"getSubset",value:function(e,t){for(var n=[],r=this.children,i=0,o=0,a=r.length;o<a;++o)if(r[o].getSubset)for(var s=r[o].getSubset(e,t),l=0,u=s.length;l<u;++l){var c=s[l];c._component=r[o]._component,n[i++]=c}return n}}]),t}(tf),Aromatic:function(e){function t(e,n,r,i,o,a,s,l){var u;h(this,t),u=d(this,f(t).call(this));var p=c(u);u._complex=r;var m=r.getAtoms(),v=r.getTransforms();return o.showAromaticLoops()?(r.forEachComponent((function(t){var u=[],c=0,h=[],d=0;t.forEachCycle((function(e){for(var t=e.atoms,n=0,r=0,i=t.length;r<i;++r)0!=(t[r]._mask&s)&&(++n,u[c++]=t[r]._index);n>0&&(h[d++]=e)}));var f=new e(n,{cycles:h,atoms:m,chunks:u,parent:r},i,o,v,a,l);f._component=t,p.add(f)})),u):d(u)}return m(t,e),Tc(t,[{key:"getSubset",value:function(e,t){for(var n=[],r=this.children,i=0,o=0,a=r.length;o<a;++o)if(r[o].getSubset)for(var s=r[o].getSubset(e,t),l=0,u=s.length;l<u;++l){var c=s[l];c._component=r[o]._component,n[i++]=c}return n}}]),t}(tf)};function Hm(e,t,n){return function(r,i,o,a,s,l){return new t(n,e,r,i,o,a,s,l)}}var Wm=function(){function e(){h(this,e)}return Tc(e,null,[{key:"AtomsSpheres",value:function(e,t){return Hm(om.createSpheres(e,t),jm.Atoms,Bm.AtomsSphereGroup)}},{key:"OrphanedAtomsCrosses",value:function(e,t,n){return Hm(om.createCrosses(e,t,n),jm.OrphanAtoms,Bm.AtomsSphereGroup)}},{key:"BondsCylinders",value:function(e,t){return Hm(om.create2CCylinders(e,t),jm.Bonds,Bm.BondsCylinderGroup)}},{key:"BondsLines",value:function(e,t,n){return Hm(om.create2CLines(e,t,n),jm.Bonds,Bm.BondsLinesGroup)}},{key:"CartoonChains",value:function(e,t){return Hm(om.createExtrudedChains(e,t),jm.Subseqs,Bm.ResiduesSubseqGroup)}},{key:"TraceChains",value:function(e,t){return Hm(om.create2CClosedCylinders(e,t),jm.Subseqs,Bm.ResiduesTraceGroup)}},{key:"NucleicSpheres",value:function(e,t){return Hm(om.createSpheres(e,t),jm.Nucleic,Bm.NucleicSpheresGroup)}},{key:"NucleicCylinders",value:function(e,t){return Hm(om.create2CCylinders(e,t),jm.Nucleic,Bm.NucleicCylindersGroup)}},{key:"ALoopsTorus",value:function(e,t){return Hm(om.createExtrudedChains(e,t),jm.Aromatic,Bm.AromaticTorusGroup)}},{key:"ALoopsLines",value:function(e,t,n){return Hm(om.createChunkedLines(e,t,n),jm.Aromatic,Bm.AromaticLinesGroup)}},{key:"QuickSurfGeo",value:function(e,t,n){return Hm(om.createQuickSurface(e,t,n),jm.Atoms,Bm.AtomsSurfaceGroup)}},{key:"ContactSurfaceGeo",value:function(e,t,n){return Hm(om.createContactSurface(e,t,n),jm.Atoms,Bm.AtomsSurfaceGroup)}},{key:"SASSESSurfaceGeo",value:function(e,t,n){return Hm(om.createSASSES(e,t,n),jm.Atoms,Bm.AtomsSASSESGroupStub)}},{key:"TextLabelsGeo",value:function(e,t){return Hm(om.createLabels(e,t),jm.Atoms,Bm.AtomsTextGroup)}}]),e}(),qm=function(){function e(t){if(h(this,e),this.constructor===e)throw new Error("Can not instantiate abstract class!");this.opts=s.merge($c.deriveDeep(this.settings.now.modes[this.id],!0),t)}return Tc(e,[{key:"identify",value:function(){var e=$c.objectsDiff(this.opts,this.settings.now.modes[this.id]);return s.isEmpty(e)?this.id:[this.id,e]}},{key:"buildGeometry",value:function(e,t,n,i){for(var o=this.opts.polyComplexity?this.opts.polyComplexity[this.settings.now.resolution]:0,a=this.depGroups,l=a.length,u=new Sf.RCGroup,c=0;c<l;++c){var h=a[c],d={};s.isArray(h)&&(d=h[1].call(this),h=r(h,1)[0]);var f=new(Wm[h](null,this.settings,d))(e,t,this,o,n,i);f.children.length>0&&u.add(f)}return u}}]),e}();function Ym(){return{lineWidth:this.opts.lineWidth}}Rf(qm.prototype),qm.prototype.id="__",qm.prototype.depGroups=[];var Xm=function(e){function t(e){var n;h(this,t),(n=d(this,f(t).call(this,e))).depGroups=n.depGroups.slice(0);for(var r=n.depGroups,i=0,o=r.length;i<o;++i)r[i]=[r[i],Ym];return n}return m(t,e),Tc(t,[{key:"drawMultiorderBonds",value:function(){return this.opts.multibond}},{key:"calcAtomRadius",value:function(){return this.opts.atom}},{key:"getAromaticOffset",value:function(){return this.opts.offsarom}},{key:"getAromaticArcChunks",value:function(){return this.opts.chunkarom}},{key:"showAromaticLoops",value:function(){return this.opts.showarom}}]),t}(qm);u(Xm,"id","LN"),Xm.prototype.id="LN",Xm.prototype.name="Lines",Xm.prototype.shortName="Lines",Xm.prototype.depGroups=["ALoopsLines","BondsLines","OrphanedAtomsCrosses"];var Zm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"calcAtomRadius",value:function(e){return this.opts.bond}},{key:"calcStickRadius",value:function(){return this.opts.bond}},{key:"calcSpaceFraction",value:function(){return this.opts.space}},{key:"getAromRadius",value:function(){return this.opts.aromrad}},{key:"showAromaticLoops",value:function(){return this.opts.showarom}},{key:"drawMultiorderBonds",value:function(){return this.opts.multibond}}]),t}(qm);u(Zm,"id","LC"),Zm.prototype.id="LC",Zm.prototype.name="Licorice",Zm.prototype.shortName="Licorice",Zm.prototype.depGroups=["AtomsSpheres","BondsCylinders","ALoopsTorus"];var $m=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"calcAtomRadius",value:function(e){return e.element.radius*this.opts.atom}},{key:"calcStickRadius",value:function(){return this.opts.bond}},{key:"getAromRadius",value:function(){return this.opts.aromrad}},{key:"showAromaticLoops",value:function(){return this.opts.showarom}},{key:"calcSpaceFraction",value:function(){return this.opts.space}},{key:"drawMultiorderBonds",value:function(){return this.opts.multibond}}]),t}(qm);u($m,"id","BS"),$m.prototype.id="BS",$m.prototype.name="Balls and Sticks",$m.prototype.shortName="Balls",$m.prototype.depGroups=["AtomsSpheres","BondsCylinders","ALoopsTorus"];var Km=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"calcAtomRadius",value:function(e){return e.element.radius}}]),t}(qm);u(Km,"id","VW"),Km.prototype.id="VW",Km.prototype.name="Van der Waals",Km.prototype.shortName="VDW",Km.prototype.depGroups=["AtomsSpheres"];var Jm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"calcStickRadius",value:function(){return this.opts.radius}}]),t}(qm);u(Jm,"id","TR"),Jm.prototype.id="TR",Jm.prototype.name="Trace",Jm.prototype.shortName="Trace",Jm.prototype.depGroups=["TraceChains"];var Qm=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getResidueRadius",value:function(e){return this.TUBE_RADIUS}},{key:"getHeightSegmentsRatio",value:function(){return this.opts.heightSegmentsRatio}},{key:"getTension",value:function(){return this.opts.tension}},{key:"buildGeometry",value:function(e,t,n,r){var i=this.opts.radius;return this.TUBE_RADIUS=new x(i,i),qm.prototype.buildGeometry.call(this,e,t,n,r)}}]),t}(qm);u(Qm,"id","TU"),Qm.prototype.id="TU",Qm.prototype.name="Tube",Qm.prototype.shortName="Tube",Qm.prototype.depGroups=["CartoonChains"];var ev=function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this,e))).secCache={},n}return m(t,e),Tc(t,[{key:"getResidueStartRadius",value:function(e){var t=e.getSecondary();if(!t||!t.generic)return this.TUBE_RADIUS;var n=this.secCache[t.generic];return n?t.term===e?n.start:n.center:this.TUBE_RADIUS}},{key:"getResidueEndRadius",value:function(e){var t=e.getSecondary();if(null===t||!t.generic)return this.TUBE_RADIUS;var n=this.secCache[t.generic];return n?t.term===e?this.ARROW_END:n.center:this.TUBE_RADIUS}},{key:"getResidueRadius",value:function(e,t){var n=this.getResidueStartRadius(e);if(0===t)return n;var r=this.getResidueEndRadius(e);return 2===t?r:n.clone().lerp(r,t/2)}},{key:"calcStickRadius",value:function(e){return this.opts.radius}},{key:"getHeightSegmentsRatio",value:function(){return this.opts.heightSegmentsRatio}},{key:"getTension",value:function(){return this.opts.tension}},{key:"buildGeometry",value:function(e,t,n,r){var i=this.opts.radius,o=this.opts.depth;this.TUBE_RADIUS=new x(i,i),this.ARROW_END=new x(o,i);var a={},s=this.opts.ss;for(var l in s)a[l]={center:new x(o,s[l].width),start:new x(o,s[l].arrow)};return this.secCache=a,qm.prototype.buildGeometry.call(this,e,t,n,r)}}]),t}(qm);u(ev,"id","CA"),ev.prototype.id="CA",ev.prototype.name="Cartoon",ev.prototype.shortName="Cartoon",ev.prototype.depGroups=["CartoonChains","NucleicSpheres","NucleicCylinders"];var tv=Qd.selectors;function nv(){return{wireframe:this.opts.wireframe,zClip:this.opts.zClip}}var rv=function(e){function t(e){var n;h(this,t),(n=d(this,f(t).call(this,e))).depGroups=n.depGroups.slice(0);for(var r=n.surfaceNames,i=n.depGroups,o=0,a=r.length;o<a;++o)i[i.length]=[r[o],nv];return n}return m(t,e),Tc(t,[{key:"calcAtomRadius",value:function(e){return e.element.radius}},{key:"getVisibilitySelector",value:function(){var e=null;if(""!==this.opts.subset){var t=tv.parse(this.opts.subset);t.error||(e=t.selector)}return e}}]),t}(qm);rv.prototype.isSurface=!0,rv.prototype.surfaceNames=[];var iv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getSurfaceOpts",value:function(){return{useBeads:!1,isoValue:this.opts.isoValue,gaussLim:this.opts.gaussLim[this.settings.now.resolution],radScale:this.opts.scale,gridSpacing:this.opts.gridSpacing[this.settings.now.resolution],zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector()}}}]),t}(rv);u(iv,"id","QS"),iv.prototype.id="QS",iv.prototype.name="Quick Surface",iv.prototype.shortName="Quick Surf",iv.prototype.surfaceNames=["QuickSurfGeo"];var ov=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,n)))._excludeProbe=e,r}return m(t,e),Tc(t,[{key:"calcAtomRadius",value:function(e){return e.element.radius}},{key:"getSurfaceOpts",value:function(){return{gridSpacing:this.opts.polyComplexity[this.settings.now.resolution],radScale:this._radScale,zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector(),probeRadius:this.opts.probeRadius,excludeProbe:this._excludeProbe}}}]),t}(rv);ov.prototype.id="SU",ov.prototype.name="Surface",ov.prototype.shortName="Surface",ov.prototype.surfaceNames=["SASSESSurfaceGeo"],ov.prototype._radScale=1,ov.prototype._excludeProbe=!1;var av=function(e){function t(e){return h(this,t),d(this,f(t).call(this,!1,e))}return m(t,e),t}(ov);u(av,"id","SA"),av.prototype.id="SA",av.prototype.name="Solvent Accessible Surface",av.prototype.shortName="SAS";var sv=function(e){function t(e){return h(this,t),d(this,f(t).call(this,!0,e))}return m(t,e),t}(ov);u(sv,"id","SE"),sv.prototype.id="SE",sv.prototype.name="Solvent Excluded Surface",sv.prototype.shortName="SES";var lv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getSurfaceOpts",value:function(){return{probeRadius:this.opts.probeRadius,radScale:this.opts.polyComplexity[this.settings.now.resolution],scaleFactor:this.opts.polyComplexity[this.settings.now.resolution],gridSpacing:1/this.opts.polyComplexity[this.settings.now.resolution],isoValue:this.opts.isoValue,probePositions:this.opts.probePositions,zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector()}}}]),t}(rv);u(lv,"id","CS"),lv.prototype.id="CS",lv.prototype.name="Contact Surface",lv.prototype.shortName="Contact Surf",lv.prototype.isSurface=!0,lv.prototype.surfaceNames=["ContactSurfaceGeo"];var uv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getTemplateOptions",value:function(){return this.opts.template}},{key:"getLabelOpts",value:function(){return s.merge(this.opts,{colors:!0,adjustColor:!0,transparent:!0})}}]),t}(qm);u(uv,"id","TX"),uv.prototype.id="TX",uv.prototype.name="Text mode",uv.prototype.shortName="Text",uv.prototype.depGroups=["TextLabelsGeo"];var cv=new Af([Xm,Zm,$m,Km,Jm,Qm,ev,iv,av,sv,lv,uv]);function hv(e,t,n){return e<=n?e<0?0:e:n}var dv=function(){function e(t,n){h(this,e),this.name=t||"Custom",this.id=n||"CP"}return Tc(e,[{key:"getElementColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.elementColors[e];return void 0!==n||t?n:this.defaultElementColor}},{key:"getResidueColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.residueColors[e];return void 0!==n||t?n:this.defaultResidueColor}},{key:"getChainColor",value:function(e){var t=e.charCodeAt(0);return t=(31&(t<0?0:t>=256?t-256:t))%this.chainColors.length,this.chainColors[t]}},{key:"getSecondaryColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.secondaryColors[e];return void 0!==n||t?n:this.defaultSecondaryColor}},{key:"getSequentialColor",value:function(e){var t=this.colors,n=t.length;return e<0?t[e%n+n]:t[e%n]}},{key:"getGradientColor",value:function(e,t){var n=this.gradients[t];if(!n)return this.defaultNamedColor;var r,i,o,a,s=n.length,l=e*(s-1),u=Math.floor(l),c=hv(u+1,0,s-1);return(a=1-(o=l-(u=hv(u,0,s-1))))*((r=n[u])>>16&255)+o*((i=n[c])>>16&255)<<16|a*(r>>8&255)+o*(i>>8&255)<<8|a*(255&r)+o*(255&i)}},{key:"getNamedColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.namedColors[e];return void 0!==n||t?n:this.defaultNamedColor}}]),e}();s.assign(dv.prototype,{colors:[16777215,16711680,65280,255,8421504],minRangeColor:0,midRangeColor:8355711,maxRangeColor:16777215,defaultElementColor:16777215,elementColors:{},defaultResidueColor:16777215,residueColors:{},chainColors:[16777215],defaultSecondaryColor:16777215,secondaryColors:{},defaultGradientColor:0,defaultNamedColor:16777215,namedColorsArray:[["indianred",13458524],["lightcoral",15761536],["salmon",16416882],["darksalmon",15308410],["lightsalmon",16752762],["crimson",14423100],["red",16711680],["firebrick",11674146],["darkred",9109504],["pink",16761035],["lightpink",16758465],["hotpink",16738740],["deeppink",16716947],["mediumvioletred",13047173],["palevioletred",14381203],["coral",16744272],["tomato",16737095],["orangered",16729344],["darkorange",16747520],["orange",16753920],["gold",16766720],["yellow",16776960],["lightyellow",16777184],["lemonchiffon",16775885],["lightgoldenrodyellow",16448210],["papayawhip",16773077],["moccasin",16770229],["peachpuff",16767673],["palegoldenrod",15657130],["khaki",15787660],["darkkhaki",12433259],["lavender",15132410],["thistle",14204888],["plum",14524637],["violet",15631086],["orchid",14315734],["fuchsia",16711935],["magenta",16711935],["mediumorchid",12211667],["mediumpurple",9662683],["rebeccapurple",6697881],["blueviolet",9055202],["darkviolet",9699539],["darkorchid",10040012],["darkmagenta",9109643],["purple",8388736],["indigo",4915330],["slateblue",6970061],["mediumslateblue",8087790],["darkslateblue",4734347],["greenyellow",11403055],["chartreuse",8388352],["lawngreen",8190976],["lime",65280],["limegreen",3329330],["palegreen",10025880],["lightgreen",9498256],["mediumspringgreen",64154],["springgreen",65407],["mediumseagreen",3978097],["seagreen",3050327],["forestgreen",2263842],["green",32768],["darkgreen",25600],["yellowgreen",10145074],["olivedrab",7048739],["olive",8421376],["darkolivegreen",5597999],["mediumaquamarine",6737322],["darkseagreen",9419919],["lightseagreen",2142890],["darkcyan",35723],["teal",32896],["aqua",65535],["cyan",65535],["lightcyan",14745599],["paleturquoise",11529966],["aquamarine",8388564],["turquoise",4251856],["mediumturquoise",4772300],["darkturquoise",52945],["cadetblue",6266528],["steelblue",4620980],["lightsteelblue",11584734],["powderblue",11591910],["lightblue",11393254],["skyblue",8900331],["lightskyblue",8900346],["deepskyblue",49151],["dodgerblue",2003199],["cornflowerblue",6591981],["royalblue",4286945],["blue",255],["mediumblue",205],["darkblue",139],["navy",128],["midnightblue",1644912],["cornsilk",16775388],["blanchedalmond",16772045],["bisque",16770244],["navajowhite",16768685],["wheat",16113331],["burlywood",14596231],["tan",13808780],["rosybrown",12357519],["sandybrown",16032864],["goldenrod",14329120],["darkgoldenrod",12092939],["peru",13468991],["chocolate",13789470],["saddlebrown",9127187],["sienna",10506797],["brown",10824234],["maroon",8388608],["white",16777215],["snow",16775930],["honeydew",15794160],["mintcream",16121850],["azure",15794175],["aliceblue",15792383],["ghostwhite",16316671],["whitesmoke",16119285],["seashell",16774638],["beige",16119260],["oldlace",16643558],["floralwhite",16775920],["ivory",16777200],["antiquewhite",16444375],["linen",16445670],["lavenderblush",16773365],["mistyrose",16770273],["gainsboro",14474460],["lightgray",13882323],["silver",12632256],["darkgray",11119017],["gray",8421504],["dimgray",6908265],["lightslategray",7833753],["slategray",7372944],["darkslategray",3100495],["black",0]],namedColors:{},gradients:{rainbow:[255,65535,65280,16776960,16711680],temp:[255,32767,16777215,16744192,16711680],hot:[16777215,16744192,16711680],cold:[16777215,32767,255],"blue-red":[255,16777215,16711680],reds:[16777215,16711680],blues:[16777215,255]}});for(var fv=dv.prototype,pv=fv.namedColorsArray,mv=fv.namedColors,vv=0,gv=pv.length;vv<gv;++vv){var yv=r(pv[vv],2),_v=yv[0],xv=yv[1];mv[_v]=xv}var bv,wv=new dv("CPK","CP");wv.elementColors={H:16777215,C:2105376,N:2121983,O:15605776,F:65280,P:8397055,S:16776960,CL:47872,FE:13684944,CO:13684944,NI:13684944,CU:13684944,BR:34816,I:21760};var Sv=new dv("Jmol","JM");Sv.colors=[255,22015,44031,65535,65451,65365,65280,5635840,11271936,16776960,16755456,16733440,16711680,16711765,16711851,16711935,11206911,5570815],Sv.elementColors={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:4366e3,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998},Sv.defaultResidueColor=12492910,Sv.residueColors={ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,A:10526975,C:16747595,G:16740464,I:8454143,T:10551200,U:16744576,DA:10526975,DC:16747595,DG:16740464,DI:8454143,DT:10551200,DU:16744576,"+A":10526975,"+C":16747595,"+G":16740464,"+I":8454143,"+T":10551200,"+U":16744576},Sv.chainColors=[4294967295,4290826495,4289789872,4294951112,4294967168,4294951167,4289786096,4294955120,4293951616,4294303411,4278239231,4291648604,4284927402,4288335154,4293821166,4278243025,4278255487,4282168177,4278190219,4290623339,4278215680,4286578688,4286611456,4286578816,4278222976,4290283019,4289864226];var Ev,Tv=Fh.Type;Sv.secondaryColors=(u(bv={},Tv.HELIX_ALPHA,16711808),u(bv,Tv.HELIX_PI,6291584),u(bv,Tv.HELIX_310,10485888),u(bv,Tv.STRAND,16762880),u(bv,Tv.TURN,6324479),u(bv,"dna",11403518),u(bv,"rna",16580962),bv);var Mv=new dv("VMD","VM");Mv.colors=[255,16711680,6316128,16744448,16776960,8421427,10066329,65280,16777215,16751001,4243648,10879142,8447590,15099571,8408320,8421568],Mv.defaultElementColor=8408320,Mv.elementColors={H:16777215,C:4243391,N:255,O:16711680,P:8421427,S:16776960},Mv.defaultResidueColor=4243648,Mv.residueColors={ALA:255,ARG:16777215,ASN:8421427,ASP:16711680,CYS:16776960,GLN:16744448,GLU:16751001,GLY:16777215,HIS:4243648,ILE:65280,LEU:16751001,LYS:4243648,MET:16776960,PHE:10879142,PRO:8408064,SER:16776960,THR:15099571,TRP:10066329,TYR:65280,VAL:8421427,A:255,C:16744448,G:16776960,T:10879142,U:65280,DA:255,DC:16744448,DG:16776960,DT:10879142,DU:65280,"+A":255,"+C":16744448,"+G":16776960,"+T":10879142,"+U":65280,WAT:4243648,H2O:4243648,HOH:4243648},Mv.chainColors=[16777215].concat(Mv.colors);var Cv=Fh.Type;Mv.secondaryColors=(u(Ev={},Cv.HELIX_ALPHA,10879142),u(Ev,Cv.HELIX_310,255),u(Ev,Cv.HELIX_PI,16711680),u(Ev,Cv.STRAND,16776960),u(Ev,Cv.BRIDGE,8421427),u(Ev,Cv.TURN,4243648),Ev);var Av=new Af([wv,Sv,Mv]),Rv=function(){function e(t){if(h(this,e),this.constructor===e)throw new Error("Can not instantiate abstract class!");this.opts=s.merge($c.deriveDeep(eh.now.colorers[this.id],!0),t),this.palette=Av.first}return Tc(e,[{key:"identify",value:function(){var e=$c.objectsDiff(this.opts,eh.now.colorers[this.id]);return s.isEmpty(e)?this.id:[this.id,e]}}]),e}();Rv.prototype.id="__";var Pv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){var n=e.element.name;return"C"===n&&this.opts.carbon>=0?this.opts.carbon:this.palette.getElementColor(n)}},{key:"getResidueColor",value:function(e,t){return this.palette.defaultResidueColor}}]),t}(Rv);u(Pv,"id","EL"),Pv.prototype.id="EL",Pv.prototype.name="Element",Pv.prototype.shortName="Element";var kv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){return this.getResidueColor(e._residue,t)}},{key:"getResidueColor",value:function(e,t){return this.palette.getResidueColor(e._type._name)}}]),t}(Rv);u(kv,"id","RT"),kv.prototype.id="RT",kv.prototype.name="Residue Type",kv.prototype.shortName="Residue";var Lv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){return this.getResidueColor(e._residue,t)}},{key:"getResidueColor",value:function(e,t){var n=e._chain;if(n.minSequence===Number.POSITIVE_INFINITY&&n.maxSequence===Number.NEGATIVE_INFINITY)return this.palette.defaultNamedColor;var r=n.minSequence,i=n.maxSequence>r?n.maxSequence:r+1;return this.palette.getGradientColor((e._sequence-r)/(i-r),this.opts.gradient)}}]),t}(Rv);u(Lv,"id","SQ"),Lv.prototype.id="SQ",Lv.prototype.name="Sequence",Lv.prototype.shortName="Sequence";var Nv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){return this.getResidueColor(e._residue,t)}},{key:"getResidueColor",value:function(e,t){return this.palette.getChainColor(e.getChain()._name)}}]),t}(Rv);u(Nv,"id","CH"),Nv.prototype.id="CH",Nv.prototype.name="Chain",Nv.prototype.shortName="Chain";var Iv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){return this.getResidueColor(e._residue,t)}},{key:"getResidueColor",value:function(e,t){if(e._type.flags&Nh.Flags.DNA)return this.palette.getSecondaryColor("dna");if(e._type.flags&Nh.Flags.RNA)return this.palette.getSecondaryColor("rna");var n=e.getSecondary();if(n){var r=this.palette.getSecondaryColor(n.type,!0);return void 0===r&&(r=this.palette.getSecondaryColor(n.generic)),r}return this.palette.defaultSecondaryColor}}]),t}(Rv);u(Iv,"id","SS"),Iv.prototype.id="SS",Iv.prototype.name="Secondary Structure",Iv.prototype.shortName="Structure";var Ov=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){return this.opts.color}},{key:"getResidueColor",value:function(e,t){return this.opts.color}}]),t}(Rv);u(Ov,"id","UN"),Ov.prototype.id="UN",Ov.prototype.name="Uniform",Ov.prototype.shortName="Uniform";var Dv=function(e){function t(e){var n;h(this,t),n=d(this,f(t).call(this,e));var r=pd.parse(n.opts.subset);return n._subsetCached=r.error?pd.none():r.selector,n}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){return this._subsetCached.includesAtom(e)?this.opts.color:this.opts.baseColor}},{key:"getResidueColor",value:function(e,t){for(var n=this._subsetCached,r=!0,i=e._atoms,o=0,a=i.length;o<a;++o)r=r&&n.includesAtom(i[o]);return r?this.opts.color:this.opts.baseColor}}]),t}(Rv);u(Dv,"id","CO"),Dv.prototype.id="CO",Dv.prototype.name="Conditional",Dv.prototype.shortName="Conditional";var zv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){return this.palette.getChainColor(String.fromCharCode(e._location))}},{key:"getResidueColor",value:function(e,t){return this.palette.defaultResidueColor}}]),t}(Rv);u(zv,"id","CF"),zv.prototype.id="CF",zv.prototype.name="Conformation",zv.prototype.shortName="Conformation";var Fv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){var n=this.opts,r=1;return e._temperature&&n?(r=n.min===n.max?e._temperature>n.max?1:0:(e._temperature-n.min)/(n.max-n.min),this.palette.getGradientColor(r,n.gradient)):this.palette.defaultGradientColor}},{key:"getResidueColor",value:function(e,t){var n=this.opts;if(!n)return this.palette.defaultGradientColor;if(e.temperature){var r;return r=n.min===n.max?e.temperature>n.max?1:0:(e.temperature-n.min)/(n.max-n.min),this.palette.getGradientColor(r,n.gradient)}return this.palette.defaultGradientColor}}]),t}(Rv);u(Fv,"id","TM"),Fv.prototype.id="TM",Fv.prototype.name="Temperature",Fv.prototype.shortName="Temperature";var Bv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){var n=this.opts;if(e._occupancy&&n){var r=1-e._occupancy;return this.palette.getGradientColor(r,n.gradient)}return this.palette.defaultGradientColor}},{key:"getResidueColor",value:function(e,t){var n=this.opts;if(!n)return this.palette.defaultGradientColor;if(e.occupancy>0){var r=1-e.occupancy;return this.palette.getGradientColor(r,n.gradient)}return this.palette.defaultGradientColor}}]),t}(Rv);u(Bv,"id","OC"),Bv.prototype.id="OC",Bv.prototype.name="Occupancy",Bv.prototype.shortName="Occupancy";var Uv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){return this.getResidueColor(e._residue,t)}},{key:"getResidueColor",value:function(e,t){var n=this.palette.defaultResidueColor;return e._type.hydrophobicity&&(n=this.palette.getGradientColor((e._type.hydrophobicity- -4.5)/9,this.opts.gradient)),n}}]),t}(Rv);u(Uv,"id","HY"),Uv.prototype.id="HY",Uv.prototype.name="Hydrophobicity",Uv.prototype.shortName="Hydrophobicity";var Vv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){return this.getResidueColor(e._residue,t)}},{key:"getResidueColor",value:function(e,t){var n=e._molecule,r=t.getMoleculeCount();return r>1?this.palette.getGradientColor((n._index-1)/(r-1),this.opts.gradient):this.palette.getGradientColor(0,this.opts.gradient)}}]),t}(Rv);u(Vv,"id","MO"),Vv.prototype.id="MO",Vv.prototype.name="Molecule",Vv.prototype.shortName="Molecule";var Gv=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"getAtomColor",value:function(e,t){var n,r,i=this.opts.color,o=(n=i,(r=this.opts.factor)*(n>>16&255)<<16|r*(n>>8&255)<<8|r*(255&n));return e.flags&wh.Flags.CARBON?i:o}},{key:"getResidueColor",value:function(e,t){return this.opts.color}}]),t}(Rv);u(Gv,"id","CB"),Gv.prototype.id="CB",Gv.prototype.name="Carbon",Gv.prototype.shortName="Carbon";var jv=new Af([Pv,kv,Lv,Nv,Iv,Ov,Dv,zv,Fv,Bv,Uv,Vv,Gv]);function Hv(e){return new $e(e,e,e)}var Wv=new Af([{id:"DF",name:"Diffuse",shortName:"Diffuse",uberOptions:{diffuse:Hv(1),specular:Hv(0),shininess:1,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"SF",name:"Soft Plastic",shortName:"Soft",uberOptions:{diffuse:Hv(1),specular:Hv(.1),shininess:30,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"PL",name:"Glossy Plastic",shortName:"Glossy",uberOptions:{diffuse:Hv(.56),specular:Hv(.28),shininess:100,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"ME",name:"Metal",shortName:"Metal",uberOptions:{diffuse:Hv(.56),specular:Hv(.55),shininess:30,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"TR",name:"Transparent",shortName:"Transparent",uberOptions:{diffuse:Hv(1),specular:Hv(0),shininess:1,opacity:.5},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!0,toonShading:!1}},{id:"GL",name:"Glass",shortName:"Glass",uberOptions:{diffuse:Hv(.5),specular:Hv(.65),shininess:100,opacity:.5},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!0,toonShading:!1}},{id:"BA",name:"Backdrop",shortName:"Backdrop",uberOptions:{diffuse:Hv(1),specular:Hv(0),shininess:1,opacity:1},values:{lights:!1,fog:!1,depthWrite:!1,transparent:!1,toonShading:!1}},{id:"TN",name:"Toon",shortName:"Toon",uberOptions:{diffuse:Hv(1),specular:Hv(0),shininess:1,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!0}},{id:"FL",name:"Flat",shortName:"Flat",uberOptions:{diffuse:Hv(1),specular:Hv(0),shininess:0,opacity:1},values:{lights:!1,fog:!0,depthWrite:!0,transparent:!1}}]),qv=Qd.selectors,Yv=function(){function e(t,n,r,i){h(this,e);var o={clipPlane:eh.now.draft.clipPlane,fogTransparent:eh.now.bg.transparent,shadowmap:eh.now.shadow.on,shadowmapType:eh.now.shadow.type};this.index=t,this.mode=n,this.colorer=r,this.selector=i,this.selectorString="",this.count=0,this.material=new hf,this.material.setValues(o),this.material.setUberOptions({fogAlpha:eh.now.fogAlpha}),this.materialPreset=Wv.first,this.needsRebuild=!0,this.visible=!0,this.setMode(n)}return Tc(e,[{key:"markAtoms",value:function(e){return this.count=e.markAtoms(this.selector,1<<this.index),this.needsRebuild=!0,this.count}},{key:"unmarkAtoms",value:function(e){e.clearAtomBits(1<<this.index),this.count=0}},{key:"setMode",value:function(e){this.mode=e}},{key:"setMaterialPreset",value:function(e){this.materialPreset=e,this.material.setUberOptions(e.uberOptions),this.material.setValues(e.values)}},{key:"reset",value:function(){this.geo=null,this.selectionGeo=null}},{key:"buildGeometry",value:function(e){return this.reset(),this.needsRebuild=!1,eh.now.ao&&this.material.setValues({normalsToGBuffer:eh.now.ao}),this.geo=this.mode.buildGeometry(e,this.colorer,1<<this.index,this.material),this.material.uberOptions.opacity<.99&&"prepass"===eh.now.transparency&&Sf.processTransparentMaterial(this.geo,this.material),this.geo.visible=this.visible,eh.now.shadow.on&&Sf.processMaterialForShadow(this.geo,this.material),Sf.processObjRenderOrder(this.geo,this.materialPreset.id),Sf.processColFromPosMaterial(this.geo,this.material),this.geo}},{key:"buildSelectionGeometry",value:function(e){var t=null;if(this.geo&&"getSubset"in this.geo){var n=this.geo.getSubset(e);if(n&&n.length>0){(t=new ci).matrixAutoUpdate=!1,t.matrix=this.geo.matrix;for(var r=0;r<n.length;r++){var i=n[r];t.add(i)}}}return t&&(t.visible=this.visible),this.selectionGeo=t,this.selectionGeo}},{key:"compare",value:function(e){var t={},n=String(this.selector);e&&n.valueOf()===String(e.selector).valueOf()||(t.selector=n);var r=this.mode.identify();e&&!Array.isArray(r)&&r===e.mode||(t.mode=r);var i=this.colorer.identify();return e&&!Array.isArray(i)&&i===e.colorer||(t.colorer=i),e&&this.materialPreset.id===e.material||(t.material=this.materialPreset.id),t}},{key:"change",value:function(e,t,n,r){var i={};if(e.selector){var o=qv.parse(e.selector).selector,a=String(o);this.selectorString!==a&&(i.selector=a,this.selectorString=a,this.selector=o,this.markAtoms(t))}if(e.mode){var l=e.mode;s.isEqual(this.mode,l)||(i.mode=l,this.setMode(n))}if(e.colorer){var u=e.colorer;s.isEqual(this.colorer,u)||(i.colorer=u,this.colorer=r)}if(e.material){var c=e.material;s.isEqual(this.material,c)||(i.material=c,this.setMaterialPreset(Wv.get(e.material)))}return i}},{key:"show",value:function(e){this.visible=e,this.geo&&(this.geo.visible=e),this.selectionGeo&&(this.selectionGeo.visible=e)}}]),e}();function Xv(){}var Zv={ComponentEditor:function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this)))._complexVisual=e,n._inProgress=!1,n}return m(t,e),Tc(t,[{key:"begin",value:function(){var e=this._complexVisual.getComplex();this._componentTransforms=[];for(var t=0;t<e._components.length;++t){var n=e._components[t];this._componentTransforms[n._index]=new oe}return this._inProgress=!0,!0}},{key:"apply",value:function(){if(this._inProgress){for(var e=this._complexVisual.getComplex(),t=0;t<e._components.length;++t)this._bakeComponentTransform(e._components[t]);e.onAtomPositionChanged(),this._resetComponentTransform(),this._complexVisual.finalizeEdit()}}},{key:"discard",value:function(){this._inProgress&&(this._resetComponentTransform(),this._complexVisual.finalizeEdit())}},{key:"getAltObj",value:function(){var e={objects:[],pivot:new E(0,0,0)},t=this._complexVisual,n=t.getSelectedComponent();if(null===n)return e;var r,i,o,a,s=this._complexVisual.getSelectionGeo(),l=1<<t.getSelectionBit();for(function e(t,n,r){var i=t.children;if(i)for(var o=0,a=i.length;o<a;++o){var s=i[o];s._component===n&&r(s),s instanceof Sf.RCGroup&&e(s,n,r)}}(t,n,(function(t){e.objects.push(t)})),r=0;r<s.children.length;++r)for(o=s.children[r],i=0;i<o.children.length;++i)(a=o.children[i]).hasOwnProperty("_component")&&a._component===n&&e.objects.push(a);e.objects.push(this._componentTransforms[n._index]);var u=new E(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new E(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return n.forEachResidue((function(e){var t=e._atoms;for(i=0;i<t.length;++i)t[i]._mask&l&&(u.min(t[i]._position),c.max(t[i]._position))})),e.pivot.lerpVectors(u,c,.5),e}},{key:"_bakeComponentTransform",value:function(e){var t=this._componentTransforms[e._index];!t||0===t.position.x&&0===t.position.y&&0===t.position.z&&0===t.quaternion.x&&0===t.quaternion.y&&0===t.quaternion.z&&1===t.quaternion.w||(t.updateMatrix(),e.forEachResidue((function(e){for(var n=e._atoms,r=0;r<n.length;++r)n[r]._position.applyMatrix4(t.matrix)})))}},{key:"_resetComponentTransform",value:function(){var e,t,n,r,i=this._complexVisual,o=this._complexVisual.getSelectionGeo();for(e=0;e<this._componentTransforms.length;++e)(r=this._componentTransforms[e]).position.set(0,0,0),r.quaternion.set(0,0,0,1);for(e=0;e<i.children.length;++e)for(n=i.children[e],t=0;t<n.children.length;++t)(r=n.children[t]).hasOwnProperty("_component")&&(r.position.set(0,0,0),r.quaternion.set(0,0,0,1));for(e=0;e<o.children.length;++e)for(n=o.children[e],t=0;t<n.children.length;++t)(r=n.children[t]).hasOwnProperty("_component")&&(r.position.set(0,0,0),r.quaternion.set(0,0,0,1))}}]),t}(Xv),FragmentEditor:function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this)))._complexVisual=e,n._inProgress=!1,n}return m(t,e),Tc(t,[{key:"begin",value:function(){var e=this._complexVisual,t=this._complexVisual.getSelectionGeo(),n=this._getSelectionBorderAtoms();if(n.length<1||n.length>2)return zc.error("Can only edit fragments with one or two bound atoms."),!1;this._fragmentBoundAtoms=n;var r=1<<e.getSelectionBit();e.disableSubset(r,!0);for(var i=0;i<t.children.length;++i)t.children[i].visible=!1;var o=n[0]._position.clone();2===n.length&&o.lerp(n[1]._position,.5),this._fragmentGeo=new ci,e.add(this._fragmentGeo),this._fragmentGeo.position.copy(o),this._fragmentSelectionGeo=new ci,t.add(this._fragmentSelectionGeo),this._fragmentSelectionGeo.position.copy(o);var a=o.clone();a.negate();for(var s=0;s<e.children.length;++s){var l=e.children[s];if("getSubset"in l){var u=new ci;this._fragmentGeo.add(u);var c=new ci;this._fragmentSelectionGeo.add(c);for(var h=l.getSubset(r,!0),d=0;d<h.length;d++){var f=h[d];u.add(f),f.position.copy(a)}for(var p=l.getSubset(r,!0),m=0;m<p.length;m++){var v=p[m];c.add(v),v.position.copy(a)}}}return Sf.applySelectionMaterial(this._fragmentSelectionGeo),this._inProgress=!0,!0}},{key:"apply",value:function(){if(this._inProgress){var e=this._complexVisual,t=e.getSelectionBit(),n=this._fragmentGeo.position,r=this._fragmentGeo.matrix.clone();r.multiply((new V).makeTranslation(-n.x,-n.y,-n.z)),this._bakeAtomTransform(r,1<<t),e.enableSubset(1<<t,!0),e.getComplex().onAtomPositionChanged(),e.finalizeEdit()}}},{key:"discard",value:function(){if(this._inProgress){var e=this._complexVisual,t=this._complexVisual.getSelectionGeo();this._fragmentGeo.parent.remove(this._fragmentGeo),e.enableSubset(1<<e.getSelectionBit(),!0);for(var n=0;n<t.children.length;++n){var r=t.children[n];r.visible?t.remove(r):r.visible=!0}e.finalizeEdit()}}},{key:"isFreeRotationAllowed",value:function(){return this._fragmentBoundAtoms.length<2}},{key:"getAltObj",value:function(){var e={objects:[],pivot:new E(0,0,0)};e.objects.push(this._fragmentGeo,this._fragmentSelectionGeo);var t=this._fragmentBoundAtoms;if(1===t.length){if(1===t[0]._bonds.length){var n=t[0]._bonds[0];e.axis=(new E).subVectors(n._right._position,n._left._position),e.axis.normalize(),e.axis.transformDirection(this._complexVisual.matrixWorld)}}else 2===t.length&&(e.axis=(new E).subVectors(t[1]._position,t[0]._position),e.axis.normalize(),e.axis.transformDirection(this._complexVisual.matrixWorld));return e}},{key:"_getSelectionBorderAtoms",value:function(){var e=this._complexVisual.getComplex(),t=1<<this._complexVisual.getSelectionBit(),n={};e.forEachBond((function(e){e._left._mask&t?0==(e._right._mask&t)&&(n[e._left._index]=1):e._right._mask&t&&(n[e._right._index]=1)}));for(var r=[],i=Object.keys(n),o=0,a=i.length;o<a;++o){var s=i[o];r.push(e._atoms[s])}return r}},{key:"_bakeAtomTransform",value:function(e,t){this._complexVisual.getComplex().forEachAtom((function(n){n._mask&t&&n._position.applyMatrix4(e)}))}}]),t}(Xv)},$v=Qd.selectors;function Kv(e,t){Array.isArray(t)||(t=[t]);var n=r(t,2),i=n[0],o=n[1];return new(e.get(i)||e.first)(o)}var Jv=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._complex=n,r._reprList=[],r._repr=null,r._reprListChanged=!0,r._selectionBit=0,r._reprUsedBits=0,r._selectionCount=0,r._selectionGeometry=new ci,r}return m(t,e),Tc(t,[{key:"getBoundaries",value:function(){return this._complex.getBoundaries()}},{key:"release",value:function(){this._selectionGeometry.parent&&this._selectionGeometry.remove(this._selectionGeometry),Tf.prototype.release.call(this)}},{key:"getComplex",value:function(){return this._complex}},{key:"getSelectionCount",value:function(){return this._selectionCount}},{key:"getSelectionGeo",value:function(){return this._selectionGeometry}},{key:"getSelectionBit",value:function(){return this._selectionBit}},{key:"getEditor",value:function(){return this._editor}},{key:"resetReps",value:function(e){this._complex&&this._complex.clearAtomBits(-1),this._reprListChanged=!0,this._reprUsedBits=0,this._reprList.length=e.length;for(var t=0,n=e.length;t<n;++t){var r=e[t],i=void 0,o=void 0;"string"==typeof r.selector?(o=r.selector,i=$v.parse(o).selector):void 0===r.selector?(o=eh.now.presets.default[0].selector,i=$v.parse(o).selector):o=(i=r.selector).toString();var a=Kv(cv,r.mode),s=Kv(jv,r.colorer),l=Wv.get(r.material)||Wv.first;this._reprList[t]=new Yv(t,a,s,i),this._reprList[t].setMaterialPreset(l),this._reprList[t].selectorString=o,this._complex&&this._complex.markAtoms(i,1<<t),this._reprUsedBits|=1<<t}this._repr=e.length>0?this._reprList[0]:null,this._selectionBit=e.length,this._reprUsedBits|=1<<this._selectionBit,this._selectionCount=0,this._complex&&this._complex.update()}},{key:"repCount",value:function(){return this._reprList.length}},{key:"repCurrent",value:function(e){return e>=0&&e<this._reprList.length?this._repr=this._reprList[e]:e=this._reprList.indexOf(this._repr),e}},{key:"rep",value:function(e,t){if(!t&&(void 0===e||e instanceof Object)&&(t=e,e=this.repCurrent()),e<0||e>this._reprList.length)return zc.error("Rep ".concat(e," does not exist!")),null;if(e===this._reprList.length){var n=this.repAdd(t);return zc.warn("Rep ".concat(e," does not exist! New representation was created.")),{desc:n.desc,index:e,status:"created"}}var r=this._reprList[e],i={selector:r.selectorString,mode:r.mode.identify(),colorer:r.colorer.identify(),material:r.materialPreset.id};if(t){var o=r.change(t,this._complex,Kv(cv,t.mode),Kv(jv,t.colorer));if(o){for(var a in r.needsRebuild=!0,o)o.hasOwnProperty(a)&&(i.key=o.key,zc.debug("rep[".concat(e,"].").concat(a," changed to").concat(o.key)));return o.mode&&r.mode.isSurface&&("ultra"===eh.now.resolution||"high"===eh.now.resolution)&&(zc.report('Surface resolution was changed to "medium" to avoid hang-ups.'),eh.set("resolution","medium")),{desc:i,index:e,status:"changed"}}}return{desc:i,index:e,status:""}}},{key:"repGet",value:function(e){return(void 0===e||e instanceof Object)&&(e=this.repCurrent()),e<0||e>=this._reprList.length?null:this._reprList[e]}},{key:"_getFreeReprIdx",value:function(){for(var e=this._reprUsedBits,n=0;n<=t.NUM_REPRESENTATION_BITS;++n,e>>=1)if(0==(1&e))return n;return-1}},{key:"repAdd",value:function(e){if(this._reprList.length>=t.NUM_REPRESENTATION_BITS)return null;var n=this._getFreeReprIdx();if(n<0)return null;var r=this.buildSelectorFromMask(1<<this._selectionBit),i=eh.now.presets.default[0],o=s.merge({selector:i.selector,mode:i.mode,colorer:i.colorer,material:i.material},e),a="string"==typeof o.selector?$v.parse(o.selector).selector:o.selector,l=new Yv(this._selectionBit,Kv(cv,o.mode),Kv(jv,o.colorer),a);return l.selectorString=a.toString(),l.setMaterialPreset(Wv.get(o.material)),l.markAtoms(this._complex),this._reprList.push(l),this._selectionBit=n,this._reprUsedBits|=1<<this._selectionBit,this._complex.markAtoms(r,1<<this._selectionBit),{desc:o,index:this._reprList.length-1}}},{key:"repRemove",value:function(e){void 0===e&&(e=this.repCurrent());var t=this._reprList.length;if(!(e<0||e>=t||t<=1)){var n=this._reprList[e];n.unmarkAtoms(this._complex),this._reprUsedBits&=~(1<<n.index),this._reprList.splice(e,1),n===this._repr&&(e=e<--t?e:t-1,this._repr=this._reprList[e]),this._reprListChanged=!0}}},{key:"repHide",value:function(e,t){void 0===t&&(t=!0),e<0||e>=this._reprList.length||this._reprList[e].show(!t)}},{key:"select",value:function(e,t){t?this._selectionCount+=this._complex.markAtomsAdditionally(e,1<<this._selectionBit):this._selectionCount=this._complex.markAtoms(e,1<<this._selectionBit),this._complex.updateStructuresMask(),this.rebuildSelectionGeometry()}},{key:"resetSelectionMask",value:function(){0!==this._selectionCount&&(this._selectionCount=0,this._complex&&this._complex.clearAtomBits(1<<this._selectionBit))}},{key:"updateSelectionMask",value:function(e){var t=this,n=e.atom,r=e.residue,i=e.chain,o=e.molecule,a=1<<this._selectionBit,s=~a;if(n)r=n._residue,i=r._chain,o=r._molecule,n._mask&a?(n._mask&=s,r._mask&=s,i._mask&=s,o&&(o._mask&=s),this._selectionCount--):(n._mask|=a,this._selectionCount++,r.collectMask(),i.collectMask(),o&&o.collectMask());else if(r)i=r._chain,o=r._molecule,r._mask&a?(r._mask&=s,i._mask&=s,r.forEachAtom((function(e){e._mask&a&&(e._mask&=s,t._selectionCount--)}))):(r._mask|=a,r.forEachAtom((function(e){e._mask&a||(e._mask|=a,t._selectionCount++)})),i.collectMask(),o&&o.collectMask());else if(i||o){var l=i||o;l._mask&a?(l._mask&=s,l.forEachResidue((function(e){e._mask&a&&(e._mask&=s,e.forEachAtom((function(e){e._mask&a&&(e._mask&=s,t._selectionCount--)})),e._mask&=s)}))):(l._mask|=a,l.forEachResidue((function(e){if(!(e._mask&a)){e._mask|=a,e.forEachAtom((function(e){e._mask&a||(e._mask|=a,t._selectionCount++)}));var n=i?e.getMolecule():e.getChain();n&&n.collectMask()}})))}else this.resetSelectionMask()}},{key:"expandSelection",value:function(){var e=this,t=1<<this._selectionBit;this._complex.forEachBond((function(e){e._left._mask&t?0==(e._right._mask&t)&&(e._right._mask|=1<<31):e._right._mask&t&&(e._left._mask|=1<<31)})),this._complex.forEachAtom((function(n){n._mask&1<<31&&(n._mask=n._mask&~(1<<31)|t,++e._selectionCount)})),this._complex.updateStructuresMask()}},{key:"shrinkSelection",value:function(){var e=this,t=1<<this._selectionBit;this._complex.forEachBond((function(e){e._left._mask&t?0==(e._right._mask&t)&&(e._left._mask|=1<<31):e._right._mask&t&&(e._right._mask|=1<<31)})),this._complex.forEachAtom((function(e){e._mask&t&&1===e._bonds.length&&(e._mask|=1<<31)}));var n=~(t|1<<31);this._complex.forEachAtom((function(t){t._mask&1<<31&&(t._mask&=n,--e._selectionCount)})),this._complex.updateStructuresMask()}},{key:"getSelectedComponent",value:function(){var e=1<<this._selectionBit,t=null,n=!1;return this._complex.forEachAtom((function(r){r._mask&e&&(null===t?t=r._residue._component:t!==r._residue._component&&(n=!0))})),n?null:t}},{key:"getSelectionCenter",value:function(e,t,n){e.set(0,0,0);var r=0;return this._complex.forEachAtom((function(i){t(i,n)&&(e.add(i._position),r++)})),0!==r&&(e.divideScalar(r),e.applyMatrix4(this.matrix),!0)}},{key:"needsRebuild",value:function(){if(this._reprListChanged)return!0;for(var e=this._reprList,t=0,n=e.length;t<n;++t)if(e[t].needsRebuild)return!0;return!1}},{key:"rebuild",value:function(){var e=this;return Sf.clearTree(this),new Promise((function(t){var n=e._complex;if(n){var r=!1;setTimeout((function(){console.time("build");for(var i=e._reprList,o=Av.get(eh.now.palette)||Av.first,a=!1,s=0,l=i.length;s<l;++s){var u=i[s];if(u.colorer.palette=o,u.needsRebuild){u.reset();try{u.buildGeometry(n)}catch(e){if(!(e instanceof $c.OutOfMemoryError))throw e;u.needsRebuild=!1,u.reset(),zc.error("Not enough memory to build geometry for representation ".concat(u.index+1)),r=!0}}a=r||a||Sf.groupHasGeometryToRender(u.geo),u.geo&&e.add(u.geo)}e._reprListChanged=!1,console.timeEnd("build"),t()}),10)}else t()}))}},{key:"setNeedsRebuild",value:function(){for(var e=this._reprList,t=0,n=e.length;t<n;++t)e[t].needsRebuild=!0}},{key:"rebuildSelectionGeometry",value:function(){var e=1<<this._selectionBit;Sf.clearTree(this._selectionGeometry);for(var t=0,n=this._reprList.length;t<n;++t){var r=this._reprList[t].buildSelectionGeometry(e);if(r){this._selectionGeometry.add(r);for(var i=0;i<r.children.length;i++){var o=r.children[i];if(this._editor&&this._editor._componentTransforms){var a=this._editor._componentTransforms[o._component._index];a&&(o.position.copy(a.position),o.quaternion.copy(a.quaternion))}}Sf.applySelectionMaterial(r)}}}},{key:"_buildSelectorFromSortedLists",value:function(e,t,n){var r=this._complex;function i(e){for(var t=[],n=0,r=NaN,i=NaN,o=0,a=e.length;o<a;++o){var s=e[o];s===i+1?i=s:(Number.isNaN(r)||(t[n++]=new $v.Range(r,i)),r=i=s)}return Number.isNaN(r)||(t[n]=new $v.Range(r,i)),t}var o=null;if(n.length===r._chains.length)o=$v.all();else{var a;if(n.length>0&&(a=$v.chain(n),o=o?$v.or(o,a):a),Object.keys(t).length>0)for(var s in t)t.hasOwnProperty(s)&&(a=$v.and($v.chain(s),$v.residx(i(t[s]))),o=o?$v.or(o,a):a);e.length>0&&(a=$v.serial(i(e)),o=o?$v.or(o,a):a),o||(o=$v.none())}return o}},{key:"buildSelectorFromMask",value:function(e){var t=this._complex,n=[],r={},i=[];return t.forEachChain((function(t){t._mask&e&&n.push(t._name)})),t.forEachResidue((function(t){if(t._mask&e&&!(t._chain._mask&e)){var n=t._chain._name;n in r?r[n].push(t._index):r[n]=[t._index]}})),t.forEachAtom((function(t){t._mask&e&&!(t._residue._mask&e)&&i.push(t._serial)})),this._buildSelectorFromSortedLists(i,r,n)}},{key:"forSelectedResidues",value:function(e){var t=1<<this._selectionBit;this._complex.forEachResidue((function(n){n._mask&t&&e(n)}))}},{key:"beginComponentEdit",value:function(){if(this._editor)return null;var e=new Zv.ComponentEditor(this);return e.begin()?(this._editor=e,e):null}},{key:"beginFragmentEdit",value:function(){if(this._editor)return null;var e=new Zv.FragmentEditor(this);return e.begin()?(this._editor=e,e):null}},{key:"finalizeEdit",value:function(){this._editor=null}},{key:"setMaterialValues",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=0,i=this._reprList.length;r<i;++r){var o=this._reprList[r];o.material.setValues(e),t&&o.geo.traverse((function(t){t instanceof Gt&&(t.material.setValues(e),void 0!==n&&n(t),t.material.needsUpdate=!0)}))}}},{key:"setUberOptions",value:function(e){for(var t=0,n=this._reprList.length;t<n;++t)this._reprList[t].material.setUberOptions(e)}},{key:"within",value:function(e,t){var n=this._complex.getVoxelWorld();if(null===n)return!1;var r=1<<this._selectionBit;return this._complex.markAtoms(e,r),n&&n.forEachAtomWithinDistFromMasked(this._complex,r,Number(t),(function(e){e._mask|=r})),this._selectionCount=this._complex.countAtomsByMask(r),this._complex.updateStructuresMask(),this.buildSelectorFromMask(r)}}]),t}(Tf);Jv.NUM_REPRESENTATION_BITS=30;var Qv=en.merge([{volumeDim:{type:"v3",value:new E(512,512,512)},tileTex:{type:"t",value:null},tileTexSize:{type:"v2",value:new x(512,512)},tileStride:{type:"v2",value:new x(512,512)},boxAngles:{type:"v3",value:new E(1,1,1)},delta:{type:"v3",value:new E(0,0,0)},_isoLevel0:{type:"v2",value:new E(.5,.75,1)},_flipV:{type:"f",value:0},_BFLeft:{type:"t",value:null},_BFRight:{type:"t",value:null},_FFLeft:{type:"t",value:null},_FFRight:{type:"t",value:null},_WFFLeft:{type:"t",value:null},_WFFRight:{type:"t",value:null}}]);function eg(e,t){var n=en.clone(t);for(var r in e)n.hasOwnProperty(r)&&(n[r].value=e[r]);return n}function tg(e,t){return{uniforms:eg(e,{}),vertexShader:"varying vec3 pos;\r\n\r\nvoid main() {\r\n  // we're assuming local position is in [-0.5, 0.5]\r\n  // we need to offset it to be represented in RGB\r\n  pos = position.xyz + 0.5;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}",fragmentShader:"varying vec3 pos;\r\n\r\nvoid main() {\r\n  gl_FragColor = vec4(pos, 0.5);\r\n}",transparent:!1,depthTest:!1,depthWrite:!1,side:t}}var ng=function e(t,n,r,i){h(this,e),this.uniforms=eg(t,n),this.vertexShader=r,this.fragmentShader=i,this.transparent=!1,this.depthTest=!1,this.depthWrite=!1,this.side=0},rg={BackFacePosMaterial:function(e){function t(e){h(this,t);var n=tg(e,1);return d(this,f(t).call(this,n))}return m(t,e),t}(tn),BackFacePosMaterialFarPlane:function(e){function t(e){h(this,t);var n=en.merge([{aspectRatio:{type:"f",value:0},farZ:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},matWorld2Volume:{type:"4fv",value:new V}}]),r=new ng(e,n,"varying vec4 volPos;\r\nuniform float aspectRatio;\r\nuniform float farZ;\r\nuniform float tanHalfFOV;\r\nuniform mat4  matWorld2Volume;\r\n\r\nvoid main() {\r\n  // rescale plane to fill in the whole far plane area seen from camera\r\n  vec3 pos = position.xyz;\r\n  pos.x = pos.x * tanHalfFOV * farZ * aspectRatio;\r\n  pos.y = pos.y * tanHalfFOV * farZ;\r\n  // common transformation\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\r\n  // calc pos in volume CS\r\n  volPos = matWorld2Volume * modelMatrix * vec4(pos, 1.0);\r\n  // we're assuming local position is in [-0.5, 0.5]\r\n  // we need to offset it to be represented in RGB\r\n  volPos = volPos + 0.5;\r\n  volPos.w = 0.5;\r\n}\r\n","varying vec4 volPos;\r\n\r\nvoid main() {\r\n  gl_FragColor = volPos;\r\n}");return d(this,f(t).call(this,r))}return m(t,e),t}(tn),FrontFacePosMaterial:function(e){function t(e){h(this,t);var n=tg(e,0);return d(this,f(t).call(this,n))}return m(t,e),t}(tn),VolumeMaterial:function(e){function t(e){var n;h(this,t);var r=new ng(e,Qv,"varying vec4 screenSpacePos;\r\n\r\nvoid main() {\r\n  screenSpacePos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n  gl_Position = screenSpacePos;\r\n}","uniform mat4 projectionMatrix;\r\n\r\n// 3D volume texture\r\nuniform vec3 volumeDim;    // volume dimensions, pixels\r\nuniform sampler2D tileTex; // tiled texture containing all Z-slices of a 3D data\r\nuniform vec2 tileTexSize;  // size of tiled texture, pixels\r\nuniform vec2 tileStride;   // UV stride between slices in tile tex, pixels\r\n\r\nuniform vec3 boxAngles;//value of angles({x: alpha, y:beta, z:gamma}) types 1 - if angle is obtuse, 0 - if acute\r\nuniform vec3 delta; //Projection box delta's from non-orthogonal origin axes; {x: XY, y : XZ, z: YZ}\r\n\r\nuniform vec3 _isoLevel0;\r\nuniform float _flipV;\r\nuniform sampler2D _BFLeft;\r\nuniform sampler2D _BFRight;\r\nuniform sampler2D _FFLeft;\r\nuniform sampler2D _FFRight;\r\nuniform sampler2D _WFFLeft;\r\nuniform sampler2D _WFFRight;\r\n\r\nvarying vec4 screenSpacePos;\r\n\r\n#define NO_COLOR vec4(0., 0., 0., 0.)\r\n\r\nvec4 sample3DTexture(vec3 texCoord) {\r\n  // a pair of Z slices is determined by nearest slice border\r\n  float zSliceBorder = floor(texCoord.z * volumeDim.z + 0.5);\r\n  float zSliceNumber1 = max(zSliceBorder - 1.0, 0.0);\r\n  float zSliceNumber2 = min(zSliceBorder, volumeDim.z - 1.0);\r\n\r\n  float rowTiles = floor(tileTexSize.x / tileStride.x);\r\n\r\n  // calculate coords in tile texture for both slices\r\n  vec2 tileOffset = vec2(mod(zSliceNumber1, rowTiles), floor(zSliceNumber1 / rowTiles));\r\n  vec2 texCoordSlice1 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\r\n  tileOffset = vec2(mod(zSliceNumber2, rowTiles), floor(zSliceNumber2 / rowTiles));\r\n  vec2 texCoordSlice2 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\r\n\r\n  // bilinear filtering\r\n  vec4 colorSlice1 = texture2D(tileTex, texCoordSlice1);\r\n  vec4 colorSlice2 = texture2D(tileTex, texCoordSlice2);\r\n  float weightSlice2 = texCoord.z * volumeDim.z - (zSliceNumber1 + 0.5);\r\n  return mix(colorSlice1, colorSlice2, weightSlice2);\r\n}\r\n\r\nvec4 sample3DTextureInclined(vec3 boxCoord) { // delta:{ x: XY, y : XZ, z: YZ }\r\n  vec3 textCoord = boxCoord;\r\n  vec2 currDelta = mix(boxCoord.zz, vec2(1., 1.) - boxCoord.zz, boxAngles.yx) * delta.yz;\r\n\r\n  textCoord.y = (boxCoord.y  - currDelta.y) / (1. - delta.z);\r\n  if (textCoord.y < 0.0 || textCoord.y > 1.0)\r\n    return NO_COLOR;\r\n\r\n  currDelta.x += mix(textCoord.y, 1.0 - textCoord.y, boxAngles.z) * delta.x;\r\n\r\n  textCoord.x = (boxCoord.x - currDelta.x) / (1. - delta.x - delta.y);\r\n  if (textCoord.x < 0.0 || textCoord.x > 1.0)\r\n    return NO_COLOR;\r\n\r\n  return sample3DTexture(textCoord);\r\n}\r\n\r\nfloat CalcColor(vec3 iter, vec3 dir) {\r\n  float d = 1. / 128.;\r\n  vec3 dx = vec3(d, 0.0, 0.0);\r\n  vec3 dy = vec3(0.0, d, 0.0);\r\n  vec3 dz = vec3(0.0, 0.0, d);\r\n\r\n  // #Opt: coordInc.x:(iter + dx).x > 1. ? 0.: sample3DTextureInclined(iter + dx).x,\r\n  vec3 coordInc = mix(\r\n    vec3(\r\n      sample3DTextureInclined(iter + dx).x,\r\n      sample3DTextureInclined(iter + dy).x,\r\n      sample3DTextureInclined(iter + dz).x\r\n    ),\r\n    vec3(0. ,0. , 0.),\r\n    vec3(floor((iter + dx).x), floor((iter + dy).y), floor((iter + dz).z))\r\n  );\r\n\r\n  // #Opt: coordDec.x:(iter - dx).x < 0. ? 0.: sample3DTextureInclined(iter - dx).x,\r\n  vec3 coordDec = mix(\r\n    vec3(0. ,0. , 0.),\r\n    vec3(\r\n      sample3DTextureInclined(iter - dx).x,\r\n      sample3DTextureInclined(iter - dy).x,\r\n      sample3DTextureInclined(iter - dz).x\r\n    ),\r\n    vec3(ceil((iter - dx).x), ceil((iter - dy).y), ceil((iter - dz).z))\r\n  );\r\n\r\n  vec3 N = normalize(coordInc - coordDec);\r\n  float dif = max(0.0, dot(N, dir));\r\n  return dif;\r\n}\r\n\r\nvec3 AccuracyIso(vec3 left, vec3 right, float volLeft, float threshold) {\r\n  for (int i = 0; i < 5; i++) {\r\n    vec3 iterator = 0.5 * (left + right);\r\n    float vol = sample3DTextureInclined(iterator).r;\r\n    if ((volLeft - threshold) * (vol - threshold) < 0.)\r\n      right = iterator;\r\n    else\r\n      left = iterator;\r\n  }\r\n  return 0.5 * (left + right);\r\n}\r\n\r\nvec3 CorrectIso(vec3 left, vec3 right, float tr) {\r\n  for (int j = 0; j < 5; j++) {\r\n    vec3 iterator = 0.5 * (left + right);\r\n    float vol = sample3DTextureInclined(iterator).r;\r\n    if (vol < tr)\r\n      right = iterator;\r\n    else\r\n      left = iterator;\r\n  }\r\n  return 0.5 * (left + right);\r\n}\r\n\r\nvec4 GetIso1(vec3 start, vec3 back, float molDist, vec3 dir, float tr, int count) {\r\n  float vol, stepSize = (float(count) + 2.) / float(STEPS_COUNT);\r\n  vec3 step = stepSize * dir, iterator = start, left, right;\r\n  vec4 acc = NO_COLOR;\r\n\r\n  for (int i = 0; i < STEPS_COUNT; i++) {\r\n    iterator = iterator + step;\r\n    vol = sample3DTextureInclined(iterator).r;\r\n    if (length(iterator - back) <= stepSize || (vol > tr))\r\n      break;\r\n  }\r\n\r\n  if (vol > tr)\r\n    acc = vec4(CorrectIso(iterator, iterator - step, tr).xyz, 1.);\r\n\r\n  return acc;\r\n}\r\n\r\nfloat easeOut(float x0, float x1, float x) {\r\n  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\r\n  return 1.0 - (1.0 - t) * (1.0 - t);\r\n}\r\n\r\nfloat easeIn(float x0, float x1, float x) {\r\n  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\r\n  return t * t;\r\n}\r\n\r\nvec3 GetColSimple(float vol) {\r\n  float t = easeOut(_isoLevel0.x, _isoLevel0.y, vol);\r\n  float s = easeIn(_isoLevel0.y, _isoLevel0.z, vol);\r\n  return vec3(0.5, 0.6, 0.7) * (1.0 - t) + 2.0 * vec3(s, 0, 0);\r\n}\r\n\r\nvec4 VolRender(vec3 start, vec3 back, float molDist, vec3 dir) {\r\n  vec4 acc = NO_COLOR, iso;\r\n  vec3 iterator = start, sumColor = vec3(0., 0., 0.);\r\n  float stepSize, alpha, sumAlpha = 0.0, vol, curStepSize, molD;\r\n  vec3 step, col, colOld, right;\r\n  float tr0 = _isoLevel0.x;\r\n  float dif, r, kd, finish;\r\n  int count = 0, stopMol = 0;\r\n\r\n  for (int k = 0; k < 3; k++) {\r\n    stepSize = (float(k) + 2.) / float(STEPS_COUNT);\r\n    kd = 140. * tr0 * stepSize;\r\n    r = 1. - kd;\r\n    step = stepSize * dir;\r\n    iso = GetIso1(iterator, back, molDist, dir, tr0, k);\r\n    if (iso.a < 0.1 || length(iso.xyz - start) > molDist)\r\n      break;\r\n    iterator = iso.xyz;\r\n    dif = 1.;// CalcColor(iterator, dir);\r\n    colOld = GetColSimple(tr0);\r\n    curStepSize = stepSize;\r\n    for (int i = 0; i < STEPS_COUNT; i++) {\r\n      iterator = iterator + step;\r\n      molD = length(iterator - start);\r\n      vol = sample3DTextureInclined(iterator).r;\r\n      finish = distance(iterator, back) - stepSize;\r\n      if (finish < 0.0 || vol < tr0 || (sumAlpha > 0.97) || molD > molDist)\r\n        break;\r\n      alpha = (1. - r);\r\n      col = GetColSimple(vol);\r\n      vol = sample3DTextureInclined(iterator - 0.5 * step).r;\r\n      vec3 colMid = GetColSimple(vol);\r\n      sumColor += (1. - sumAlpha) * (colOld + 4.* colMid + col) * alpha / 6.;\r\n      sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\r\n      colOld = col;\r\n    } // for i\r\n\r\n    if (finish < 0.0 || sumAlpha > 0.97)\r\n      break;\r\n\r\n    if (molD > molDist) {\r\n      curStepSize = stepSize - (molD - molDist);\r\n      right = iterator - (molD - molDist) * dir;\r\n      vol = sample3DTextureInclined(right).r;\r\n    } else {\r\n      vec3 left = iterator - step;\r\n      right = CorrectIso(left, iterator, tr0);\r\n      curStepSize = distance(left, right);\r\n      vol = tr0;\r\n    }\r\n\r\n    alpha = (1. - r) * curStepSize / stepSize;\r\n    dif = 1.;// CalcColor(right, dir);\r\n    col = GetColSimple(vol);\r\n    vol = sample3DTextureInclined(iterator - 0.5 * curStepSize / stepSize * step).r;\r\n    vec3 colMid = GetColSimple(vol);\r\n    sumColor += (1. - sumAlpha) * (colOld + 4. * colMid + col) * alpha / 6.;\r\n    sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\r\n\r\n    if (molD > molDist)\r\n      break;\r\n  } // for k\r\n  acc.rgb = 1. * sumColor / sumAlpha;\r\n  acc.a = sumAlpha;\r\n  return acc;\r\n}\r\n\r\nvec4 VolRender1(vec3 start, vec3 back, float molDist, vec3 dir) {\r\n  float stepSize = 1.0 / float(STEPS_COUNT);\r\n  float len = length(back - start);\r\n  vec3 step = stepSize * dir;\r\n  vec3 iterator = start;\r\n  float acc = 0.0;\r\n\r\n  for (int i = 0; i < STEPS_COUNT; i++) {\r\n    if (float(i) * stepSize > len)\r\n      break;\r\n    iterator = iterator + step;\r\n    if (sample3DTextureInclined(iterator).r > _isoLevel0.x)\r\n      acc += 10. * sample3DTextureInclined(iterator).r / float(STEPS_COUNT);\r\n  }\r\n\r\n  return vec4(1.,1.,1., acc);\r\n}\r\n\r\nvec4 IsoRender(vec3 start, vec3 back, float molDist, vec3 dir) {\r\n  vec4 tst = GetIso1(start, back, 2., dir, _isoLevel0.x, 0);\r\n  vec4 col = NO_COLOR;\r\n\r\n  if (length(tst.xyz - start) < molDist && tst.a > 0.1) {\r\n    float dif =  CalcColor(tst.xyz, dir);\r\n    dif = 0.9 * dif * dif;\r\n    col = vec4(dif, dif, dif, 1);\r\n  }\r\n  return col;\r\n}\r\n\r\nvec4 VolRender2(vec3 start, vec3 back, float molDist, vec3 dir) {\r\n  return sample3DTexture(start);\r\n}\r\n\r\nvoid main() {\r\n  vec3 tc = screenSpacePos.xyz / screenSpacePos.w * 0.5 + 0.5;\r\n\r\n  if (_flipV > 0.0) {\r\n    tc.y = 1.0 - tc.y;\r\n  }\r\n\r\n  vec3 start;\r\n  vec3 back;\r\n  vec3 molBack;\r\n  if (projectionMatrix[0][2] < 0.0) {\r\n    start = texture2D(_FFLeft, tc.xy).xyz;\r\n    back = texture2D(_BFLeft, tc.xy).xyz;\r\n    molBack = texture2D(_WFFLeft, tc.xy).xyz;\r\n  } else {\r\n    start = texture2D(_FFRight, tc.xy).xyz;\r\n    back = texture2D(_BFRight, tc.xy).xyz;\r\n    molBack = texture2D(_WFFRight, tc.xy).xyz;\r\n  }\r\n\r\n  vec3 dir = normalize(back - start);\r\n\r\n  float molDist = 2.0;\r\n  if (length(molBack) > 0.001) {\r\n    molDist = distance(start, molBack);\r\n  }\r\n\r\n  #ifdef ISO_MODE\r\n    gl_FragColor = IsoRender(start, back, molDist, dir);\r\n  #else\r\n    gl_FragColor = VolRender(start, back, molDist, dir);\r\n  #endif\r\n}\r\n");return r.transparent=!0,r.depthTest=!0,(n=d(this,f(t).call(this,r))).updateDefines(),n}return m(t,e),Tc(t,[{key:"updateDefines",value:function(){this.defines={ISO_MODE:eh.now.modes.VD.isoMode,STEPS_COUNT:100*eh.now.modes.VD.polyComplexity[eh.now.resolution]},this.needsUpdate=!0}}]),t}(tn)},ig=function(e){function t(){var e;h(this,t);var n=new Et;e=d(this,f(t).call(this,n)),u(c(e),"volumeInfo",{}),e.clipPlane=new Oe;var r=new E(.5,.5,.5);return e.size=r,e.cullFlag=[!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!1,!1],e.faces=[{indices:[],norm:new E(0,0,-1)},{indices:[],norm:new E(0,0,1)},{indices:[],norm:new E(0,-1,0)},{indices:[],norm:new E(0,1,0)},{indices:[],norm:new E(-1,0,0)},{indices:[],norm:new E(1,0,0)},{indices:[],norm:new E(0,0,0)}],e.vertices=[new E(-r.x,-r.y,-r.z),new E(-r.x,r.y,-r.z),new E(r.x,-r.y,-r.z),new E(r.x,r.y,-r.z),new E(-r.x,-r.y,r.z),new E(-r.x,r.y,r.z),new E(r.x,-r.y,r.z),new E(r.x,r.y,r.z),new E(0,0,0),new E(0,0,0),new E(0,0,0),new E(0,0,0),new E(0,0,0),new E(0,0,0)],n.setAttribute("position",new ot(new Float32Array(3*e.vertices.length),3)),e.name="VolumeMesh",e}return m(t,e),Tc(t,[{key:"_updateVertices",value:function(){var e,n=t._corners,r=t._edges,i=t._edgeIntersections,o=this.clipPlane.normal,a=this.clipPlane.constant,s=this.vertices,l=this.size,u=[0,0,0,0,0,0,0,0],c=[1,1,1,1,1,1,1,1,1,1,1,1],h=new E,d=null;function f(){if(0===o.x)return 0;var e=-(o.dot(h)+a)/o.x;return-l.x<=e&&e<=l.x?(d.set(e,h.y,h.z),e===l.x?2:e===-l.x?-2:1):0}function p(){if(0===o.y)return 0;var e=-(o.dot(h)+a)/o.y;return-l.y<=e&&e<=l.y?(d.set(h.x,e,h.z),e===l.y?2:e===-l.y?-2:1):0}function m(){if(0===o.z)return 0;var e=-(o.dot(h)+a)/o.z;return-l.z<=e&&e<=l.z?(d.set(h.x,h.y,e),e===l.z?2:e===-l.z?-2:1):0}for(var v=0;v<12;++v){var g=r[v];d=i[v],h.set(g[2],g[3],g[4]),h.multiply(l);var y=0;0===g[2]&&(y=f()),0===g[3]&&(y=p()),0===g[4]&&(y=m()),-2===y?u[g[0]]=1:2===y?u[g[1]]=1:0===y&&(c[v]=0)}var _={indices:[],norm:o.clone().negate()},x=8;for(e=0;e<8;++e)1===u[e]&&(s[x].set(n[e][0],n[e][1],n[e][2]).multiply(l),_.indices.push(x++),c[n[e][3]]=0,c[n[e][4]]=0,c[n[e][5]]=0);for(e=0;e<12;++e)1===c[e]&&(s[x].copy(i[e]),_.indices.push(x++));this.faces[6]=_;var b=new E,w=new E;for(this.clipPlane.coplanarPoint(w),e=0;e<s.length;++e)this.cullFlag[e]=!1,e<8?(b.subVectors(s[e],w),this.cullFlag[e]=o.dot(b)>=0):e<8+_.indices.length&&(this.cullFlag[e]=!0);var S=this.geometry.getAttribute("position"),T=0;for(e=0;e<s.length;++e)S.array[T++]=s[e].x,S.array[T++]=s[e].y,S.array[T++]=s[e].z;S.needsUpdate=!0}},{key:"_collectVertices",value:function(e,t){var n,r=this.vertices;for(e.indices=[],n=0;n<r.length;++n)this.cullFlag[n]&&t(r[n])&&e.indices.push(n)}},{key:"_sortIndices",value:function(e,t){var n,r,i=this.vertices,o=[],a=new E;for(n=1;n<e.indices.length;++n)a.subVectors(i[e.indices[n]],i[e.indices[0]]),a.normalize(),a.cross(t),a.negate(),o[n]=e.norm.dot(a);for(n=1;n<e.indices.length-1;++n)for(r=n+1;r<e.indices.length;++r)if(o[r]<o[n]){var s=o[n];o[n]=o[r],o[r]=s,s=e.indices[n],e.indices[n]=e.indices[r],e.indices[r]=s}}},{key:"_updateIndices",value:function(){var e,t,n,i=this.vertices,o=this.size;this._collectVertices(this.faces[0],(function(e){return e.z===-o.z})),this._collectVertices(this.faces[1],(function(e){return e.z===o.z})),this._collectVertices(this.faces[2],(function(e){return e.y===-o.y})),this._collectVertices(this.faces[3],(function(e){return e.y===o.y})),this._collectVertices(this.faces[4],(function(e){return e.x===-o.x})),this._collectVertices(this.faces[5],(function(e){return e.x===o.x}));var a=new E,s=new E,l=new E;for(t=0;t<this.faces.length;++t)if(0!==(n=this.faces[t]).indices.length){for(a.set(0,0,0),e=0;e<n.indices.length;++e)a.add(i[n.indices[e]]);a.multiplyScalar(1/n.indices.length),s.subVectors(i[n.indices[0]],a),s.normalize();var u=[];for(e=0;e<n.indices.length;++e)l.subVectors(i[n.indices[e]],a),u[e]=l.dot(s);for(e=1;e<n.indices.length;++e)if(u[e]<u[0]){var c=u[0];u[0]=u[e],u[e]=c,c=r(n.indices,1)[0],n.indices[0]=n.indices[e],n.indices[e]=c}this._sortIndices(n,s)}var h=0;for(t=0;t<this.faces.length;++t)(n=this.faces[t]).indices.length>=3&&(h+=3*(n.indices.length-2));var d=0,f=new Uint16Array(h);for(t=0;t<this.faces.length;++t)for(n=this.faces[t],e=0;e<n.indices.length-2;++e)f[d]=n.indices[0],f[d+1]=n.indices[e+1],f[d+2]=n.indices[e+2],d+=3;this.geometry.setIndex(new ot(f,1))}},{key:"setDataSource",value:function(e){var t=new rg.VolumeMaterial,n=e.getDimensions(),r=e.getTiledTextureStride(),i=e.buildTiledTexture(),o=e.getBox();t.uniforms.volumeDim.value.set(n[0],n[1],n[2]),t.uniforms.tileTex.value=i,t.uniforms.tileTexSize.value.set(i.image.width,i.image.height),t.uniforms.tileStride.value.set(r[0],r[1]),Object.assign(this.volumeInfo,e.getVolumeInfo());var a=this.volumeInfo;t.uniforms.delta.value.copy(a.delta),t.uniforms.boxAngles.value.set(a.obtuseAngle[0],a.obtuseAngle[1],a.obtuseAngle[2]),this.material=t,o.getSize(this.scale),o.getCenter(this.position)}},{key:"_updateIsoLevel",value:function(){var e=eh.now.modes.VD,t=e.kSigma,n=e.kSigmaMed,r=e.kSigmaMax,i=this.volumeInfo,o=i.dmean-i.dmin,a=i.dmax-i.dmin,s=function(e){return(o+e*i.sd)/a};this.material.uniforms._isoLevel0.value.set(s(t),s(n),s(r))}},{key:"rebuild",value:function(e){var n=t._nearClipPlaneOffset,r=t._pos,i=t._norm,o=t._norm4D,a=t._matrixWorldToLocal,s=t._clipPlane;this._updateIsoLevel(),e.getWorldDirection(i),e.getWorldPosition(r),r.addScaledVector(i,e.near+n),a.getInverse(this.matrixWorld),r.applyMatrix4(a),o.set(i.x,i.y,i.z,0),o.applyMatrix4(a),i.copy(o),i.normalize(),s.setFromNormalAndCoplanarPoint(i,r),this.clipPlane.equals(s)||(this.clipPlane=s.clone(),this._updateVertices(),this._updateIndices())}}]),t}(Gt);u(ig,"_corners",[[-1,-1,-1,0,4,8],[1,-1,-1,0,5,9],[1,1,-1,1,5,10],[-1,1,-1,1,4,11],[-1,-1,1,2,6,8],[1,-1,1,2,7,9],[1,1,1,3,7,10],[-1,1,1,3,6,11]]),u(ig,"_edges",[[0,1,0,-1,-1],[2,3,0,1,-1],[4,5,0,-1,1],[6,7,0,1,1],[0,3,-1,0,-1],[1,2,1,0,-1],[4,7,-1,0,1],[5,6,1,0,1],[0,4,-1,-1,0],[1,5,1,-1,0],[2,6,-1,1,0],[3,7,1,1,0]]),u(ig,"_edgeIntersections",function(){for(var e=[],t=0;t<12;++t)e.push(new E);return e}()),u(ig,"_nearClipPlaneOffset",.2),u(ig,"_pos",new E),u(ig,"_norm",new E),u(ig,"_norm4D",new k),u(ig,"_matrixWorldToLocal",new V),u(ig,"_clipPlane",new Oe);var og=function(){function e(t,n){h(this,e);var r=n.delta,i=n.obtuseAngle,o=new E;t.getSize(o),o.multiplyScalar(.5);for(var a=this._getBaseVertices(r,i),s=new Zt,l=0;l<4;l++)s.vertices.push(a[l].clone().multiply(o)),s.vertices.push(a[(l+1)%4].clone().multiply(o));for(var u=new E(2*o.x*(1-r.x-r.y),0,0),c=0;c<8;c++)s.vertices.push(s.vertices[c].clone().add(u));for(var d=0;d<4;d++)s.vertices.push(s.vertices[2*d].clone()),s.vertices.push(s.vertices[2*d+8].clone());var f=new E;t.getCenter(f),s.vertices.forEach((function(e){return e.add(f)})),this._lines=new no(s,new Yi({color:16777215})),this._lines.layers.set(Sf.LAYERS.VOLUME)}return Tc(e,[{key:"_getBaseVertices",value:function(t,n){var r=e._projectionTable,i=function(e,i){var o=t[r[e][0]];return(-.5*(i-1)+i*n[r[e][1]])*o};return[new E(2*(i("XZ",1)+i("XY",1))-1,2*i("YZ",1)-1,-1),new E(2*(i("XZ",-1)+i("XY",1))-1,2*i("YZ",-1)-1,1),new E(2*(i("XZ",-1)+i("XY",-1))-1,1-2*i("YZ",1),1),new E(2*(i("XZ",1)+i("XY",-1))-1,1-2*i("YZ",-1),-1)]}},{key:"getMesh",value:function(){return this._lines}}]),e}();u(og,"_projectionTable",{XY:["x",2],XZ:["y",1],YZ:["z",0]});var ag=function(){function e(t,n,r){h(this,e);var i=this._initPlaneGeo(n,r),o=new rg.BackFacePosMaterialFarPlane;this._plane=new em.Mesh(i,o),this._plane.frustumCulled=!1,this._plane.doubleSided=!0;var a=new V;this._plane._onBeforeRender=function(e,n,r,i,o,s){var l=this.material;if(t&&l){var u=new k(0,0,-(r.far-.1),1);u.applyMatrix4(r.matrixWorld),this.matrix.identity(),this.matrix.makeTranslation(u.x,u.y,u.z),this.matrixWorld.copy(this.matrix),this.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,this.matrixWorld),this.normalMatrix.getNormalMatrix(this.modelViewMatrix);var c=t.matrixWorld;a.getInverse(c),l.uniforms.aspectRatio.value=r.aspect,l.uniforms.farZ.value=r.far,l.uniforms.tanHalfFOV.value=Math.tan(.5*_.DEG2RAD*r.fov),l.uniforms.matWorld2Volume.value=a}},this._plane.layers.set(Sf.LAYERS.VOLUME_BFPLANE)}return Tc(e,[{key:"_initPlaneGeo",value:function(e,t){var n=new Zt;return e=e||1,t=t||1,n.vertices.push(new E(-.5*e,.5*t,0)),n.vertices.push(new E(.5*e,.5*t,0)),n.vertices.push(new E(-.5*e,-.5*t,0)),n.vertices.push(new E(.5*e,-.5*t,0)),n.faces.push(new et(0,2,1)),n.faces.push(new et(2,3,1)),n}},{key:"getMesh",value:function(){return this._plane}}]),e}();function sg(e,t){Tf.call(this,e,t),this._mesh=new ig,this._mesh.setDataSource(t),this.add(this._mesh),this._frame=new og(this.getBoundaries().boundingBox,this._mesh.volumeInfo),this.add(this._frame.getMesh()),this.showFrame(eh.now.modes.VD.frame),this._farPlane=new ag(this._mesh,2,2),this.add(this._farPlane.getMesh())}function lg(){this.now=Mc.now,this._startTime=0,this._times=[]}function ug(e){this._renderer=e,this._prepareTest()}$c.deriveClass(sg,Tf),sg.prototype.getBoundaries=function(){var e=this._dataSource.getBox(),t=new Se;return e.getBoundingSphere(t),{boundingBox:e,boundingSphere:t}},sg.prototype.getMesh=function(){return this._mesh},sg.prototype.showFrame=function(e){this._frame.getMesh().material.visible=e},lg.prototype.start=function(){this._startTime=this.now()},lg.prototype.end=function(){0!==this._startTime&&this._times.push(this.now()-this._startTime)},lg.prototype.rawMean=function(){for(var e=this._times.length,t=0,n=0;n<e;++n)t+=this._times[n];return t/e},lg.prototype.mean=function(){return this._robustMean(this._times)},lg.prototype.deviation=function(e){return this._robustDeviation(this._times,e)},lg.prototype.min=function(){return this._robustMin(this._times)},lg.prototype._robustMean=function(e){var t=Math.round(.1*e.length),n=e.length-Math.round(.2*e.length);e.sort((function(e,t){return e-t}));for(var r=0,i=t;i<n;++i)r+=e[i];return r/n},lg.prototype._robustDeviation=function(e,t){for(var n=e.length,r=new Array(n),i=0;i<n;++i)r[i]=(e[i]-t)*(e[i]-t);return r.sort((function(e,t){return e-t})),Math.sqrt(this._robustMean(r))},lg.prototype._robustMin=function(e){var t=Math.round(.05*e.length),n=Math.round(.1*e.length);e.sort((function(e,t){return e-t}));for(var r=0,i=0;i<n;++i)r+=e[t+i];return r/n},ug.prototype._prepareTest=function(){this._scene=new ae;for(var e=new vn(10,10,128,128),t=new rt({color:this._renderer.getClearColor()}),n=0;n<300;++n){var r=new Gt(e,t);this._scene.add(r)}this._camera=new rn(45,1,1,2e3),this._camera.position.z=30,this._prof=new lg},ug.prototype.run=function(){for(var e=0;e<100;++e)this._prof.start(),this._renderer.setRenderTarget(this._target),this._renderer.render(this._scene,this._camera),this._prof.end()},ug.prototype.runOnTicks=function(e,t,n){var r=this;void 0===e&&(e=50),void 0===t&&(t=1e3),void 0===n&&(n=1e4);var i=-1,o=this._prof.now();return new Promise((function(a){requestAnimationFrame((function s(){r._renderer.render(r._scene,r._camera);var l=r._prof.now()-o;l>t&&(r._prof.end(),r._prof.start(),++i),l>n||i===e?a(Math.max(i,0)):requestAnimationFrame(s)}))}))},ug.prototype.mean=function(){return this._prof?this._prof.rawMean():0},ug.prototype.min=function(){return this._prof?this._prof.min():0};var cg=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return h(this,t),d(this,f(t).call(this,e,["types"]))}return m(t,e),Tc(t,[{key:"find",value:function(e){var t=[];if(e.type)t=this._dict.types[e.type.toLowerCase()]||[];else if(e.source)return this._list.filter((function(t){return t.canProbablyLoad&&t.canProbablyLoad(e.source)}));return Mf(t)}}]),t}(Af),hg=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this)))._source=e,r._options=n||{},r._abort=!1,r._agent=null,r}return m(t,e),Tc(t,[{key:"load",value:function(){return Promise.reject(new Error("Loading from this source is not implemented"))}},{key:"abort",value:function(){this._abort=!0,this._agent&&this._agent.abort()}}],[{key:"extractName",value:function(e){}}]),t}(Nc);Rf(hg.prototype);var dg=function(e){function t(e,n){var r;return h(this,t),n=(r=d(this,f(t).call(this,e,n)))._options,r._binary=!0===n.binary,r}return m(t,e),Tc(t,[{key:"load",value:function(){var e=this;return new Promise((function(t,n){if(e._abort)throw new Error("Loading aborted");var r=e._source,i=e._agent=new FileReader;i.addEventListener("load",(function(){t(i.result)})),i.addEventListener("error",(function(){n(i.error)})),i.addEventListener("abort",(function(){n(new Error("Loading aborted"))})),i.addEventListener("progress",(function(t){e.dispatchEvent(t)})),e._binary?i.readAsArrayBuffer(r):i.readAsText(r)}))}}],[{key:"canProbablyLoad",value:function(e){return File&&e instanceof File||Blob&&e instanceof Blob}},{key:"extractName",value:function(e){return e&&e.name}}]),t}(hg);dg.types=["file","blob"];var fg=/^(https?|ftp):\/\//i,pg=function(e){function t(e,n){var r;return h(this,t),n=(r=d(this,f(t).call(this,e,n)))._options,r._binary=!0===n.binary,r}return m(t,e),Tc(t,[{key:"load",value:function(){var e=this;return new Promise((function(t,n){if(e._abort)throw new Error("Loading aborted");var r=e._source,i=e._agent=new XMLHttpRequest;i.addEventListener("load",(function(){200===i.status?t(i.response):n(new Error("HTTP ".concat(i.status," while fetching ").concat(r)))})),i.addEventListener("error",(function(){n(new Error("HTTP request failed"))})),i.addEventListener("abort",(function(){n(new Error("Loading aborted"))})),i.addEventListener("progress",(function(t){e.dispatchEvent(t)})),i.open("GET",r),e._binary?i.responseType="arraybuffer":i.responseType="text",i.send()}))}}],[{key:"canProbablyLoad",value:function(e){return s.isString(e)&&fg.test(e)}},{key:"extractName",value:function(e){if(e){var t=(e.indexOf("?")+1||e.lastIndexOf("#")+1||e.length+1)-1;return e.slice(e.lastIndexOf("/",t)+1,t)}}}]),t}(hg);pg.types=["url"];var mg=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"load",value:function(){var e=this;return new Promise((function(t){if(e._abort)throw new Error("Loading aborted");t(e._source)}))}}],[{key:"canProbablyLoad",value:function(e){return!1}}]),t}(hg);mg.types=["immediate"];var vg=new cg([dg,pg,mg]),gg=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return h(this,t),d(this,f(t).call(this,e,["formats","extensions"]))}return m(t,e),Tc(t,[{key:"find",value:function(e){var t=[];return e.format?t=this._dict.formats[e.format.toLowerCase()]||[]:e.ext&&(t=this._dict.extensions[e.ext.toLowerCase()]||[]),0===t.length&&!e.format&&e.data?this._list.filter((function(t){return t.canProbablyParse&&t.canProbablyParse(e.data)})):Mf(t)}}]),t}(Af),yg=function(){function e(t,n){h(this,e),this._data=t,this._options=n||{},this._abort=!1}return Tc(e,[{key:"parseSync",value:function(){throw new Error("Parsing this type of data is not implemented")}},{key:"parse",value:function(){var e=this;return new Promise((function(t,n){setTimeout((function(){try{return e._abort?n(new Error("Parsing aborted")):t(e.parseSync())}catch(e){return n(e)}}))}))}},{key:"getModel",value:function(){return this.model._parseHeader(this._data),this.model}},{key:"abort",value:function(){this._abort=!0}}]),e}();Rf(yg.prototype);var _g=function(){function e(){h(this,e),this.matrices=[],this._matrix=null,this._matrixIndex=-1}return Tc(e,[{key:"parse",value:function(e){var t=this._matrix;if("  SMTRY"===e.readString(12,18)){var n=e.readCharCode(19)-49,r=e.readString(20,80).trim().split(/\s+/),i=parseInt(r[0],10);null!==this._matrix&&i===this._matrixIndex||(this._matrixIndex=i,this._matrix=t=new V,this.matrices[this.matrices.length]=t);var o=t.elements;o[n]=parseFloat(r[1]),o[n+4]=parseFloat(r[2]),o[n+8]=parseFloat(r[3]),o[n+12]=parseFloat(r[4])}}}]),e}();_g.prototype.id=290;var xg=Qd.Assembly,bg=function(){function e(t){h(this,e),this._complex=t,this.assemblies=[],this._assembly=null,this._matrix=null,this._matrixIndex=-1}return Tc(e,[{key:"parse",value:function(e){var t=this._assembly,n=this._matrix;if(t&&"  BIOMT"===e.readString(12,18)){var r=e.readCharCode(19)-49,i=e.readString(20,80).trim().split(/\s+/),o=parseInt(i[0],10);null!==this._matrix&&o===this._matrixIndex||(this._matrixIndex=o,this._matrix=n=new V,t.addMatrix(n));var a=n.elements;a[r]=parseFloat(i[1]),a[r+4]=parseFloat(i[2]),a[r+8]=parseFloat(i[3]),a[r+12]=parseFloat(i[4])}else if(t&&"CHAINS:"===e.readString(35,41))for(var s=e.readString(42,80).split(","),l=0,u=s.length;l<u;++l){var c=s[l].trim();c.length>0&&t.addChain(c)}else"BIOMOLECULE:"===e.readString(12,23)&&(this._matrix=null,this._matrixIndex=-1,this._assembly=t=new xg(this._complex),this.assemblies.push(t))}}]),e}();bg.prototype.id=350;var wg=function(){function e(t){h(this,e),this._data=t,this._start=0,this._nextCR=-1,this._nextLF=-1,this._next=-1,this._end=t.length,this.next()}return Tc(e,[{key:"readLine",value:function(){return this._data.slice(this._start,this._next)}},{key:"readChar",value:function(e){return(e=this._start+e-1)<this._next?this._data[e]:" "}},{key:"readCharCode",value:function(e){return(e=this._start+e-1)<this._next?this._data.charCodeAt(e):32}},{key:"readString",value:function(e,t){var n=this._start+e-1,r=this._start+t;return this._data.slice(n,r<this._next?r:this._next)}},{key:"readInt",value:function(e,t){return parseInt(this.readString(e,t),10)}},{key:"readFloat",value:function(e,t){return parseFloat(this.readString(e,t))}},{key:"end",value:function(){return this._start>=this._end}},{key:"next",value:function(){var e=this._next+1;this._start=e<this._end?e:this._end,this._start>this._nextCR&&(this._nextCR=(this._data.indexOf("\r",this._start)+1||this._end+1)-1),this._start>this._nextLF&&(this._nextLF=(this._data.indexOf("\n",this._start)+1||this._end+1)-1),this._next=this._nextCR+1<this._nextLF?this._nextCR:this._nextLF}}]),e}(),Sg=Qd.Complex,Eg=Qd.Element,Tg=Qd.Helix,Mg=Qd.Sheet,Cg=Qd.Strand,Ag=Qd.Bond,Rg=Qd.Molecule,Pg=/^(HEADER\s|COMPND\s|REMARK\s|ATOM {2}|HETATM|MODEL )/i,kg={290:_g,350:bg},Lg=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._complex=null,r._chain=null,r._residue=null,r._sheet=null,r._serialAtomMap=null,r._modelId=1,r._compaundFound=!1,r._biomoleculeFound=!1,r._allowedChainsIDs=null,r._lastMolId=-1,r._remarks={},r._remark=null,r._molecules=[],r._molecule=null,r._compndCurrToken="",r._options.fileType="pdb",r}return m(t,e),Tc(t,[{key:"_finalize",value:function(){this._fixBondsArray(),this._fixChains();var e=this._remarks[290];this._complex.symmetry=s.isUndefined(e)?[]:e.matrices;var t=this._remarks[350];this._complex.units=this._complex.units.concat(s.isUndefined(t)?[]:t.assemblies),this._finalizeMolecules(),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}},{key:"_finalizeMolecules",value:function(){var e,t={},n=this._complex._chains;for(e=0;e<n.length;++e){var r=n[e];t[r._name]=r}for(e=0;e<this._molecules.length;e++){for(var i=this._molecules[e],o=[],a=0;a<i._chains.length;a++){var s=t[i._chains[a]];o=o.concat(s._residues.slice())}var l=new Rg(this._complex,i._name,e+1);l._residues=o,this._complex._molecules[e]=l}}},{key:"_fixChains",value:function(){for(var e={},t=this._complex,n=0;n<t._chains.length;n++){var r=t._chains[n];e[r._name.charCodeAt(0)]=r}}},{key:"_fixBondsArray",value:function(){for(var e=this._serialAtomMap={},t=this._complex,n=t._atoms,r=0,i=n.length;r<i;++r){var o=n[r];e[o._serial]=o}for(var a=t._bonds,s=this.logger,l=0,u=a.length;l<u;++l){var c=a[l];c._right<c._left&&s.debug("_fixBondsArray: Logic error."),c._left=e[c._left]||null,c._right=e[c._right]||null}}},{key:"_parseATOM",value:function(e){if(1===this._modelId){var t=72===e.readCharCode(1),n=t?e.readInt(7,11):e.readInt(6,11),r=e.readString(13,16),i=e.readChar(17),o=e.readString(18,20).trim(),a=e.readChar(22),s=e.readInt(23,26),l=e.readChar(27),u=e.readFloat(31,38),c=e.readFloat(39,46),h=e.readFloat(47,54),d=e.readFloat(55,60),f=e.readFloat(61,66),p=e.readString(77,78).trim()||function(e){var t=4===e.trim().length;return e.slice(0,t?1:2).trim()}(r),m=e.readInt(79,80)||0;if(!this.settings.now.nowater||"HOH"!==o&&"WAT"!==o){r=r.trim();var v=Eg.getByName(p),g=Eg.Role[r],y=this._chain;y&&y.getName()===a||(this._chain=y=this._complex.getChain(a)||this._complex.addChain(a),this._residue=null);var _=this._residue;_&&_.getSequence()===s&&_.getICode()===l||(this._residue=_=y.addResidue(o,s,l));var x=new E(u,c,h);_.addAtom(r,v,x,g,t,n,i,d,f,m)}}}},{key:"_parseENDMDL",value:function(){this._modelId+=1}},{key:"_parseCONECT",value:function(e){var t=e.readInt(7,11),n=e.readInt(12,16),r=e.readInt(17,21),i=e.readInt(22,26),o=e.readInt(27,31),a=this._complex;n&&n>t&&a.addBond(t,n,0,Ag.BondType.UNKNOWN,!0),r&&r>t&&a.addBond(t,r,0,Ag.BondType.UNKNOWN,!0),i&&i>t&&a.addBond(t,i,0,Ag.BondType.UNKNOWN,!0),o&&o>t&&a.addBond(t,o,0,Ag.BondType.UNKNOWN,!0)}},{key:"_parseCOMPND",value:function(e){var t=e.readString(11,80),n=t.indexOf(":");if(this._compndCurrToken=n>0?t.substring(0,n).trim():this._compndCurrToken,"MOL_ID"===this._compndCurrToken)this._molecule={_index:"",_chains:[]},this._molecule._index=parseInt(t.substring(n+1,t.indexOf(";")),10),this._molecules.push(this._molecule);else if("MOLECULE"===this._compndCurrToken&&null!=this._molecule)this._molecule._name=t.substring(n+1,t.indexOf(";")).trim();else if("CHAIN"===this._compndCurrToken&&null!=this._molecule){var r=t.substring(n+1,80).trim(),i=r[r.length-1];";"!==i&&","!==i||(r=r.slice(0,-1));var o=(r=r.replace(/\s+/g,"")).split(",");this._molecule._chains=this._molecule._chains.concat(o)}}},{key:"_parseREMARK",value:function(e){var t=e.readInt(8,10),n=this._remarks[t];if(s.isUndefined(n)){var r=kg[t];s.isFunction(r)&&(this._remarks[t]=n=new r(this._complex))}s.isUndefined(n)||n.parse(e)}},{key:"_parseHELIX",value:function(e){var t=this;this._parseSTRUCTURE(e,[20,22,32,34],(function(e){t._complex.addHelix(e),t._complex.structures.push(e)}))}},{key:"_parseSHEET",value:function(e){var t=this;this._parseSTRUCTURE(e,[22,23,33,34],(function(e){t._complex.addSheet(e)}))}},{key:"_parseSTRUCTURE",value:function(e,t,n){var r=e.readInt(8,10),i=e.readString(12,14).trim(),o=e.readString(41,70).trim(),a=e.readInt(72,76),s=e.readInt(39,40),l=e.readInt(15,16),u=e.readInt(42,45),c=e.readInt(57,60),h=e.readString(t[0],t[2]+1).charCodeAt(0),d=e.readString(t[2],t[2]+1).charCodeAt(0),f=e.readInt(t[1],t[1]+3),p=e.readString(t[1]+4,t[1]+4),m=0;p.length>0&&(m=p.charCodeAt(0));var v,g=e.readInt(t[3],t[3]+3),y=0;(p=e.readString(t[3]+4,t[3]+4)).length>0&&(y=p.charCodeAt(0));var _=this._sheet;if(83===e.readCharCode(1)){null!==_&&_.getName()!==i&&(_=null,this._sheet=null),null===_?(this._sheet=v=new Mg(i,l),n(v)):v=_;var x=new Cg(v,this._complex.getUnifiedSerial(h,f,m),this._complex.getUnifiedSerial(d,g,y),s,u,c);v.addStrand(x),this._complex.structures.push(x)}else n(v=new Tg(s,this._complex.getUnifiedSerial(h,f,m),this._complex.getUnifiedSerial(d,g,y),r,i,o,a))}},{key:"_parseHEADER",value:function(e){var t=this._complex.metadata;t.classification=e.readString(11,50).trim(),t.date=e.readString(51,59).trim();var n=e.readString(63,66).trim();t.id=n,n&&(this._complex.name=n),t.format="pdb"}},{key:"_parseTITLE",value:function(e){var t=this._complex.metadata;t.title=t.title||[];var n=e.readInt(9,10)||1;t.title[n-1]=e.readString(11,80).trim()}},{key:"parseSync",value:function(){for(var e=new wg(this._data),n=this._complex=new Sg;!e.end();){var r=e.readString(1,6),i=t.tagParsers[r];s.isFunction(i)&&i.call(this,e),e.next()}if(this._finalize(),this._serialAtomMap=null,this._sheet=null,this._residue=null,this._chain=null,this._complex=null,0===n.getAtomCount())throw new Error("The data does not contain valid atoms");return n}}],[{key:"canProbablyParse",value:function(e){return s.isString(e)&&Pg.test(e)}}]),t}(yg);u(Lg,"tagParsers",{HEADER:Lg.prototype._parseHEADER,"TITLE ":Lg.prototype._parseTITLE,"ATOM  ":Lg.prototype._parseATOM,HETATM:Lg.prototype._parseATOM,ENDMDL:Lg.prototype._parseENDMDL,CONECT:Lg.prototype._parseCONECT,COMPND:Lg.prototype._parseCOMPND,REMARK:Lg.prototype._parseREMARK,"HELIX ":Lg.prototype._parseHELIX,"SHEET ":Lg.prototype._parseSHEET,"ATOM 1":Lg.prototype._parseATOM,"ATOM 2":Lg.prototype._parseATOM,"ATOM 3":Lg.prototype._parseATOM,"ATOM 4":Lg.prototype._parseATOM,"ATOM 5":Lg.prototype._parseATOM,"ATOM 6":Lg.prototype._parseATOM,"ATOM 7":Lg.prototype._parseATOM,"ATOM 8":Lg.prototype._parseATOM,"ATOM 9":Lg.prototype._parseATOM}),Lg.formats=["pdb"],Lg.extensions=[".pdb",".ent"];var Ng=Qd.Complex,Ig=Qd.Element,Og=Qd.AtomName,Dg=Qd.SGroup,zg=Qd.Bond,Fg={A:0,S:1,D:2,T:3},Bg=/\s*<\?xml\b[^?>]*\?>\s*<(?:cml|molecule)\b/i,Ug=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._complex=null,r._residue=null,r._serialAtomMap=null,r._modelId=1,r._lastMolId=-1,r._readOnlyOneMolecule=!1,r._options.fileType="cml",r}return m(t,e),Tc(t,[{key:"_rebuidBondIndexes",value:function(e,t){for(var n=e.length,r=0;r<n;r++)for(var i=e[r].id,o=t.length,a=0;a<o;a++){var s=t[a].atomRefs2.split(" ");s[0]===i&&(t[a].start=r),s[1]===i&&(t[a].end=r)}}},{key:"_createSGroup",value:function(e,t){var n=new Dg(e.id,e.fieldData,new E(parseFloat(e.x),parseFloat(e.y),0),e.atomRefs,e);"Relative"===e.placement&&(n._center=new E(0,0,0)),"MDLBG_FRAGMENT_CHARGE"===e.fieldName&&(n._charge=parseInt(e.fieldData,10)||0),"MDLBG_FRAGMENT_COEFFICIENT"===e.fieldName&&(n._repeat=parseInt(e.fieldData,10)||1),t.push(n)}},{key:"_extractSGroup",value:function(e,t){if(Array.isArray(t)||(t=[]),e)if(Array.isArray(e))for(var n=e.length,r=0;r<n;r++)e[r].molecule&&(t=t.concat(this._extractSGroup(e[r].molecule))),this._createSGroup(e[r],t);else e.molecule&&e.molecule&&(t=t.concat(this._extractSGroup(e.molecule))),this._createSGroup(e,t);return t}},{key:"_extractSGroups",value:function(e,t){var n,r,i=this._extractSGroup(e),o=t.length;for(n=0;n<o;n++){var a=t[n].id;for(r=0;r<i.length;r++)i[r]._atoms.split(" ")[0]===a&&(t[n].sgroupRef||(t[n].sgroupRef=[]),t[n].sgroupRef.push(i[r]))}var s,l={},u=null,c=new E(1e8,1e8,1e8),h=new E(-1e8,-1e8,-1e8);function d(e){(u=l[e])&&i[r]._atoms.push(u.a)}function f(e){(u=l[e])&&(c.set(Math.min(c.x,u.x),Math.min(c.y,u.y),Math.min(c.z,u.z)),h.set(Math.max(h.x,u.x),Math.max(h.y,u.y),Math.max(h.z,u.z)),d(e))}for(n=0;n<t.length;n++)l[t[n].id]={},l[t[n].id].x=t[n].x2,t[n].x3&&(l[t[n].id].x=t[n].x3),l[t[n].id].x=parseFloat(l[t[n].id].x),l[t[n].id].y=t[n].y2,t[n].y3&&(l[t[n].id].y=t[n].y3),l[t[n].id].y=parseFloat(l[t[n].id].y),l[t[n].id].z="0.0",t[n].z3&&(l[t[n].id].z=t[n].z3),l[t[n].id].z=parseFloat(l[t[n].id].z),l[t[n].id].a=t[n];for(r=0;r<i.length;r++)null!==i[r]._center?(c.set(1e8,1e8,1e8),h.set(-1e8,-1e8,-1e8),s=i[r]._atoms.split(" "),i[r]._atoms=[],s.forEach(f),i[r]._center.addVectors(c,h),i[r]._center.multiplyScalar(.5)):(s=i[r]._atoms.split(" "),i[r]._atoms=[],s.forEach(d));l=null}},{key:"_traverseData",value:function(e){var t={};return e.childNodes.length&&function e(t,n){if("#text"!==t.nodeName||""!==t.nodeValue.trim()){var r={};r.xmlNode=t;var i,o,a,s=n[t.nodeName];if(s?(i=s,"[object Array]"!==Object.prototype.toString.apply(i)?n[t.nodeName]=[s,r]:n[t.nodeName].push(r)):n[t.nodeName]=r,t.attributes)for(o=t.attributes.length,a=0;a<o;a++){var l=t.attributes[a];r[l.nodeName]=l.nodeValue}for(o=t.childNodes.length,a=0;a<o;a++)e(t.childNodes[a],r)}}(e.childNodes[0],t),t}},{key:"_findSuitableMolecule",value:function(e,t){for(var n in e)if("xmlNode"!==n)if("molecule"===n){if(e.molecule&&(e.molecule.atomArray&&e.molecule.atomArray.atom&&t.push(e),Array.isArray(e.molecule)))for(var r=0;r<e.molecule.length;r++)e.molecule[r].atomArray&&e.molecule[r].atomArray.atom&&t.push({molecule:e.molecule[r]})}else e[n]&&null!==e[n]&&"object"===l(e[n])&&this._findSuitableMolecule(e[n],t)}},{key:"_selectComponents",value:function(e){var t,n=(new DOMParser).parseFromString(e,"application/xml"),r=this._traverseData(n),i=this;t=r.cml?r.cml:r;var o=[],a=[];return this._findSuitableMolecule(t,a),this._readOnlyOneMolecule&&a.length>1&&a.splice(1,a.length-1),a.forEach((function(e){var t=function(e){var t,r=[];if(e.molecule&&e.molecule.atomArray&&e.molecule.atomArray.atom)Array.isArray(e.molecule.atomArray.atom)?r=e.molecule.atomArray.atom:r.push(e.molecule.atomArray.atom);else if(!e.molecule){return{atomLabels:null,labelsCount:1}}e.molecule.molecule&&i._extractSGroups(e.molecule.molecule,r);for(var o=r.length,a=0;a<o;a++)(t=r[a]).edges=[];var s,l=[];e.molecule.bondArray&&e.molecule.bondArray.bond&&(Array.isArray(e.molecule.bondArray.bond)?l=e.molecule.bondArray.bond:l.push(e.molecule.bondArray.bond)),o=l.length,i._rebuidBondIndexes(r,l);for(var u=0;u<o;u++)if((t=r[(s=l[u]).start])&&(t.edges.push(s.end),(t=r[s.end])&&(t.edges.push(s.start),1))){var c=s.xmlNode.getAttribute("order"),h=parseInt(c,10);if(l[u].order=0,l[u].type=zg.BondType.UNKNOWN,h>1)l[u].order=h;else{var d=Fg[c];void 0!==d&&(l[u].order=d,"A"===c&&(l[u].type=zg.BondType.AROMATIC))}}o=r.length;for(var f=0;f<o;f++)(t=r[f]).edges.sort();var p=i._breadWidthSearch(r,0),m={};return m.atoms=r,m.bonds=l,m.labels=p.atomLabels,m.count=Math.min(1,p.labelsCount),m.curr=-1,m.originalCML=n,m}(e);t.atoms.length>0&&o.push(t)})),o}},{key:"_packLabel",value:function(e,t){return(t<<16)+e}},{key:"_unpackLabel",value:function(e){return{molId:e>>>16,compId:65535&e}}},{key:"_breadWidthSearch",value:function(e,t){var n,r=new Array(e.length);for(n=0;n<r.length;n++)r[n]=this._packLabel(0,t);for(var i=[],o=0,a=e.length;a>0;){o++;var s=-1;for(n=0;n<r.length;n++)if(0===this._unpackLabel(r[n]).compId){s=n;break}if(s<0)break;for(i.push(e[s]),r[s]=this._packLabel(o,t),a--;i.length>0;){var l=i.shift();if(l)for(var u=0;u<l.edges.length;u++)r[l.edges[u]]!==o&&(i.push(e[l.edges[u]]),r[l.edges[u]]=o,a--)}}var c={};return c.atomLabels=r,c.labelsCount=o,c}},{key:"_parseBond",value:function(e,t,n,r){if(e>=0){var i=[Math.min(e,t),Math.max(e,t)];this._complex.addBond(i[0],i[1],n,r,!0)}}},{key:"_fixBondsArray",value:function(){for(var e=this._serialAtomMap={},t=this._complex,n=t._atoms,r=0,i=n.length;r<i;++r){var o=n[r];e[o._serial]=o}for(var a=t._bonds,s=this.logger,l=0,u=a.length;l<u;++l){var c=a[l];c._right<c._left&&s.debug("_fixBondsArray: Logic error."),c._left=e[c._left]||null,c._right=e[c._right]||null}}},{key:"_parseSet",value:function(e){var t,n,r,i=this._complex=new Ng,o=e,a=o.curr,s=o.atoms,l=o.labels,u=null,c=s.length,h={},d=[];for(t=0;t<c;t++)d.push(t);for(d.sort((function(e,t){return l[e]-l[t]})),t=0;t<c;t++){var f=l[d[t]];if(this._unpackLabel(f).molId===this._unpackLabel(a).molId){u=s[d[t]];var p=new Og(u.elementType,null);if(u.sgroupRef)for(var m=u.sgroupRef.length,v=0;v<m;++v)i._sgroups.push(u.sgroupRef[v]);if(u.x3||u.x2){var g=this._unpackLabel(f).compId,y=g,_=g.toString();1===_.length&&(_="0".concat(_));var x="N".concat(_),b=h[" "];b&&" "===b.getName()||(h[" "]=b=this._complex.getChain(" ")||this._complex.addChain(" "),this._residue=null);var w=this._residue;w&&w.getSequence()===y&&" "===w.getICode()||(this._residue=w=b.addResidue(x,y," "));var S=null;u.x3?S=new E(parseFloat(u.x3),parseFloat(u.y3),parseFloat(u.z3)):u.x2&&(S=new E(parseFloat(u.x2),parseFloat(u.y2),0));var T=Ig.ByName[u.elementType.toUpperCase()];T||((T=JSON.parse(JSON.stringify(Ig.ByName[Object.keys(Ig.ByName)[Object.keys(Ig.ByName).length-1]]))).number+=1,T.name=u.elementType.toUpperCase(),T.fullName="Unknown",Ig.ByName[u.elementType.toUpperCase()]=T);var M=parseInt(u.id.replace(/[^0-9]/,""),10),C=w.addAtom(p,T,S,Ig.Role.SG,!0,M," ",1,0,0);u.hydrogenCount&&(C._hydrogenCount=parseInt(u.hydrogenCount,10)),u.mrvValence&&(C._valence=parseInt(u.mrvValence,10)),(r=C).xmlNodeRef=u,u.x2&&(u.x3=u.x2,delete u.x2),u.y2&&(u.y3=u.y2,delete u.y2),u.z3||(u.z3="0.0"),u.complexAtom=r}}}for(h=null,t=0;t<o.bonds.length;t++){var A=o.bonds[t];if(this._unpackLabel(l[A.start]).molId===this._unpackLabel(a).molId&&this._unpackLabel(l[A.end]).molId===this._unpackLabel(a).molId){if(!(u=s[A.start])||!s[A.end])continue;this._parseBond(parseInt(u.id.replace(/[^0-9]/,""),10),parseInt(s[A.end].id.replace(/[^0-9]/,""),10),A.order,A.type)}}for(t=0;t<this._complex.getSGroupCount();t++){var R=this._complex.getSGroups()[t];for(n=0;n<R._atoms.length;n++)R._atoms[n]=R._atoms[n].complexAtom}for(t=0;t<c;t++)this._unpackLabel(l[t]).molId===this._unpackLabel(a).molId&&((u=s[t]).complexAtom=null,delete u.complexAtom);return this._complex.originalCML=o.originalCML,this._fixBondsArray(),i.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._serialAtomMap=null,this._complex=null,i}},{key:"parseSync",value:function(){var e=[],t=this;this._selectComponents(this._data).forEach((function(n){n.curr=2,0===n.count&&(n.count=1);for(var r=0;r<n.count;r++)n.curr=r+1,e.push(t._parseSet(n,!1))}));var n=0;if(e.forEach((function(e){n+=e.getAtomCount()})),n<=0)throw new Error("The data does not contain valid atoms");if(e.length>1){var r=new Ng;return r.joinComplexes(e),r.originalCML=e[0].originalCML,r}return 1===e.length?e[0]:new Ng}}],[{key:"canProbablyParse",value:function(e){return s.isString(e)&&Bg.test(e)}}]),t}(yg);Ug.formats=["cml"],Ug.extensions=[".cml"];var Vg=o((function(e,t){!function(e){function t(e,t,n){for(var r=(e.byteLength,0),i=n.length;i>r;r++){var o=n.charCodeAt(r);if(128>o)e.setUint8(t++,o>>>0&127|0);else if(2048>o)e.setUint8(t++,o>>>6&31|192),e.setUint8(t++,o>>>0&63|128);else if(65536>o)e.setUint8(t++,o>>>12&15|224),e.setUint8(t++,o>>>6&63|128),e.setUint8(t++,o>>>0&63|128);else{if(!(1114112>o))throw new Error("bad codepoint "+o);e.setUint8(t++,o>>>18&7|240),e.setUint8(t++,o>>>12&63|128),e.setUint8(t++,o>>>6&63|128),e.setUint8(t++,o>>>0&63|128)}}}function r(e){for(var t=0,n=0,r=e.length;r>n;n++){var i=e.charCodeAt(n);if(128>i)t+=1;else if(2048>i)t+=2;else if(65536>i)t+=3;else{if(!(1114112>i))throw new Error("bad codepoint "+i);t+=4}}return t}function i(e,o,a){var s=n(e);if("string"===s){if(32>(l=r(e)))return o.setUint8(a,160|l),t(o,a+1,e),1+l;if(256>l)return o.setUint8(a,217),o.setUint8(a+1,l),t(o,a+2,e),2+l;if(65536>l)return o.setUint8(a,218),o.setUint16(a+1,l),t(o,a+3,e),3+l;if(4294967296>l)return o.setUint8(a,219),o.setUint32(a+1,l),t(o,a+5,e),5+l}if(e instanceof Uint8Array){var l=e.byteLength,u=new Uint8Array(o.buffer);if(256>l)return o.setUint8(a,196),o.setUint8(a+1,l),u.set(e,a+2),2+l;if(65536>l)return o.setUint8(a,197),o.setUint16(a+1,l),u.set(e,a+3),3+l;if(4294967296>l)return o.setUint8(a,198),o.setUint32(a+1,l),u.set(e,a+5),5+l}if("number"===s){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return o.setUint8(a,203),o.setFloat64(a+1,e),9;if(e>=0){if(128>e)return o.setUint8(a,e),1;if(256>e)return o.setUint8(a,204),o.setUint8(a+1,e),2;if(65536>e)return o.setUint8(a,205),o.setUint16(a+1,e),3;if(4294967296>e)return o.setUint8(a,206),o.setUint32(a+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return o.setInt8(a,e),1;if(e>=-128)return o.setUint8(a,208),o.setInt8(a+1,e),2;if(e>=-32768)return o.setUint8(a,209),o.setInt16(a+1,e),3;if(e>=-2147483648)return o.setUint8(a,210),o.setInt32(a+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(null===e)return o.setUint8(a,192),1;if("boolean"===s)return o.setUint8(a,e?195:194),1;if("object"===s){var c=0,h=Array.isArray(e);if(h)l=e.length;else{var d=Object.keys(e);l=d.length}if(16>l?(o.setUint8(a,l|(h?144:128)),c=1):65536>l?(o.setUint8(a,h?220:222),o.setUint16(a+1,l),c=3):4294967296>l&&(o.setUint8(a,h?221:223),o.setUint32(a+1,l),c=5),h)for(var f=0;l>f;f++)c+=i(e[f],o,a+c);else for(f=0;l>f;f++){var p=d[f];c+=i(p,o,a+c),c+=i(e[p],o,a+c)}return c}throw new Error("Unknown type "+s)}function o(e){var t=new ArrayBuffer(function e(t){var i=n(t);if("string"===i){if(32>(o=r(t)))return 1+o;if(256>o)return 2+o;if(65536>o)return 3+o;if(4294967296>o)return 5+o}if(t instanceof Uint8Array){if(256>(o=t.byteLength))return 2+o;if(65536>o)return 3+o;if(4294967296>o)return 5+o}if("number"===i){if(Math.floor(t)!==t)return 9;if(t>=0){if(128>t)return 1;if(256>t)return 2;if(65536>t)return 3;if(4294967296>t)return 5;throw new Error("Number too big 0x"+t.toString(16))}if(t>=-32)return 1;if(t>=-128)return 2;if(t>=-32768)return 3;if(t>=-2147483648)return 5;throw new Error("Number too small -0x"+t.toString(16).substr(1))}if("boolean"===i||null===t)return 1;if("object"===i){var o,a=0;if(Array.isArray(t)){o=t.length;for(var s=0;o>s;s++)a+=e(t[s])}else{var l=Object.keys(t);for(o=l.length,s=0;o>s;s++){var u=l[s];a+=e(u)+e(t[u])}}if(16>o)return 1+a;if(65536>o)return 3+a;if(4294967296>o)return 5+a;throw new Error("Array or object too long 0x"+o.toString(16))}throw new Error("Unknown type "+i)}(e));return i(e,new DataView(t),0),new Uint8Array(t)}function a(e,t,n){return t?new e(t.buffer,t.byteOffset,t.byteLength/(n||1)):void 0}function s(e){return a(DataView,e)}function l(e){return a(Uint8Array,e)}function u(e){return a(Int8Array,e)}function c(e){return a(Int32Array,e,4)}function h(e,t){var n=e.length/2;t||(t=new Int16Array(n));for(var r=0,i=0;n>r;++r,i+=2)t[r]=e[i]<<8^e[i+1]<<0;return t}function d(e,t){var n=e.length/4;t||(t=new Int32Array(n));for(var r=0,i=0;n>r;++r,i+=4)t[r]=e[i]<<24^e[i+1]<<16^e[i+2]<<8^e[i+3]<<0;return t}function f(e,t){var n=e.length;t||(t=new Uint8Array(4*n));for(var r=s(t),i=0;n>i;++i)r.setInt32(4*i,e[i]);return l(t)}function p(e,t,n){var r=e.length,i=1/t;n||(n=new Float32Array(r));for(var o=0;r>o;++o)n[o]=e[o]*i;return n}function m(e,t,n){var r=e.length;n||(n=new Int32Array(r));for(var i=0;r>i;++i)n[i]=Math.round(e[i]*t);return n}function v(e,t){var n,r;if(!t){var i=0;for(n=0,r=e.length;r>n;n+=2)i+=e[n+1];t=new e.constructor(i)}var o=0;for(n=0,r=e.length;r>n;n+=2)for(var a=e[n],s=e[n+1],l=0;s>l;++l)t[o]=a,++o;return t}function g(e){if(0===e.length)return new Int32Array;var t,n,r=2;for(t=1,n=e.length;n>t;++t)e[t-1]!==e[t]&&(r+=2);var i=new Int32Array(r),o=0,a=1;for(t=1,n=e.length;n>t;++t)e[t-1]!==e[t]?(i[o]=e[t-1],i[o+1]=a,a=1,o+=2):++a;return i[o]=e[e.length-1],i[o+1]=a,i}function y(e,t){var n=e.length;t||(t=new e.constructor(n)),n&&(t[0]=e[0]);for(var r=1;n>r;++r)t[r]=e[r]+t[r-1];return t}function _(e,t){var n=e.length;t||(t=new e.constructor(n)),t[0]=e[0];for(var r=1;n>r;++r)t[r]=e[r]-e[r-1];return t}function x(e,t){var n,r,i=e instanceof Int8Array?127:32767,o=-i-1,a=e.length;if(!t){var s=0;for(n=0;a>n;++n)e[n]<i&&e[n]>o&&++s;t=new Int32Array(s)}for(n=0,r=0;a>n;){for(var l=0;e[n]===i||e[n]===o;)l+=e[n],++n;l+=e[n],++n,t[r]=l,++r}return t}function b(e,t,n){return p(x(e,c(n)),t,n)}function w(e,t,n,r){var i=new ArrayBuffer(12+r.byteLength),o=new Uint8Array(i),a=new DataView(i);return a.setInt32(0,e),a.setInt32(4,t),n&&o.set(n,8),o.set(r,12),o}function S(e){return w(2,e.length,void 0,l(e))}function E(e){return w(4,e.length,void 0,f(e))}function T(e,t){return w(5,e.length/t,f([t]),l(e))}function M(e){return w(6,e.length,void 0,f(g(e)))}function C(e){return w(8,e.length,void 0,f(function(e){return g(_(e))}(e)))}function A(e,t){var n=e.length,r=f([t]),i=function(e,t){var n=e.length;t||(t=new Uint8Array(2*n));for(var r=s(t),i=0;n>i;++i)r.setInt16(2*i,e[i]);return l(t)}(function(e,t,n){return function(e,t){var n,r=t?127:32767,i=-r-1,o=e.length,a=0;for(n=0;o>n;++n)0===(u=e[n])?++a:a+=u===r||u===i?2:u>0?Math.ceil(u/r):Math.ceil(u/i);var s=t?new Int8Array(a):new Int16Array(a),l=0;for(n=0;o>n;++n){var u;if((u=e[n])>=0)for(;u>=r;)s[l]=r,++l,u-=r;else for(;i>=u;)s[l]=i,++l,u-=i;s[l]=u,++l}return s}(function(e,t,n){return _(m(e,t),void 0)}(e,t),n)}(e,t));return w(10,n,r,i)}function R(e){var t={};return D.forEach((function(n){void 0!==e[n]&&(t[n]=e[n])})),e.bondAtomList&&(t.bondAtomList=E(e.bondAtomList)),e.bondOrderList&&(t.bondOrderList=S(e.bondOrderList)),t.xCoordList=A(e.xCoordList,1e3),t.yCoordList=A(e.yCoordList,1e3),t.zCoordList=A(e.zCoordList,1e3),e.bFactorList&&(t.bFactorList=A(e.bFactorList,100)),e.atomIdList&&(t.atomIdList=C(e.atomIdList)),e.altLocList&&(t.altLocList=M(e.altLocList)),e.occupancyList&&(t.occupancyList=function(e,t){return w(9,e.length,f([t]),f(function(e,t){return g(m(e,t))}(e,t)))}(e.occupancyList,100)),t.groupIdList=C(e.groupIdList),t.groupTypeList=E(e.groupTypeList),e.secStructList&&(t.secStructList=S(e.secStructList)),e.insCodeList&&(t.insCodeList=M(e.insCodeList)),e.sequenceIndexList&&(t.sequenceIndexList=C(e.sequenceIndexList)),t.chainIdList=T(e.chainIdList,4),e.chainNameList&&(t.chainNameList=T(e.chainNameList,4)),t}function P(e){function t(e){for(var t={},n=0;e>n;n++)t[o()]=o();return t}function n(t){var n=e.subarray(a,a+t);return a+=t,n}function r(t){var n=e.subarray(a,a+t);a+=t;var r=65535;if(t>r){for(var i=[],o=0;o<n.length;o+=r)i.push(String.fromCharCode.apply(null,n.subarray(o,o+r)));return i.join("")}return String.fromCharCode.apply(null,n)}function i(e){for(var t=new Array(e),n=0;e>n;n++)t[n]=o();return t}function o(){var o,l,u=e[a];if(0==(128&u))return a++,u;if(128==(240&u))return a++,t(l=15&u);if(144==(240&u))return a++,i(l=15&u);if(160==(224&u))return a++,r(l=31&u);if(224==(224&u))return o=s.getInt8(a),a++,o;switch(u){case 192:return a++,null;case 194:return a++,!1;case 195:return a++,!0;case 196:return l=s.getUint8(a+1),a+=2,n(l);case 197:return l=s.getUint16(a+1),a+=3,n(l);case 198:return l=s.getUint32(a+1),a+=5,n(l);case 202:return o=s.getFloat32(a+1),a+=5,o;case 203:return o=s.getFloat64(a+1),a+=9,o;case 204:return o=e[a+1],a+=2,o;case 205:return o=s.getUint16(a+1),a+=3,o;case 206:return o=s.getUint32(a+1),a+=5,o;case 208:return o=s.getInt8(a+1),a+=2,o;case 209:return o=s.getInt16(a+1),a+=3,o;case 210:return o=s.getInt32(a+1),a+=5,o;case 217:return l=s.getUint8(a+1),a+=2,r(l);case 218:return l=s.getUint16(a+1),a+=3,r(l);case 219:return l=s.getUint32(a+1),a+=5,r(l);case 220:return l=s.getUint16(a+1),a+=3,i(l);case 221:return l=s.getUint32(a+1),a+=5,i(l);case 222:return l=s.getUint16(a+1),a+=3,t(l);case 223:return l=s.getUint32(a+1),a+=5,t(l)}throw new Error("Unknown type 0x"+u.toString(16))}var a=0,s=new DataView(e.buffer);return o()}function k(e,t,n,r){switch(e){case 1:return function(e,t){var n=e.length;t||(t=new Float32Array(n/4));for(var r=s(t),i=s(e),o=0,a=0,l=n/4;l>o;++o,a+=4)r.setFloat32(a,i.getFloat32(a),!0);return t}(t);case 2:return u(t);case 3:return h(t);case 4:return d(t);case 5:return l(t);case 6:return v(d(t),new Uint8Array(n));case 7:return v(d(t));case 8:return function(e,t){return y(v(e),void 0)}(d(t));case 9:return function(e,t,n){return p(v(e,c(n)),t,n)}(d(t),d(r)[0]);case 10:return function(e,t,n){var r=x(e,c(n));return function(e,t,n){return p(y(e,c(n)),t,n)}(r,t,function(e){return a(Float32Array,e,4)}(r))}(h(t),d(r)[0]);case 11:return p(h(t),d(r)[0]);case 12:return b(h(t),d(r)[0]);case 13:return b(u(t),d(r)[0]);case 14:return x(h(t));case 15:return x(u(t))}}function L(e,t){var n=(t=t||{}).ignoreFields,r={};return z.forEach((function(t){var i=!!n&&-1!==n.indexOf(t),o=e[t];i||void 0===o||(o instanceof Uint8Array?r[t]=k.apply(null,function(e){var t=s(e),n=t.getInt32(0),r=t.getInt32(4),i=e.subarray(8,12);return[n,e=e.subarray(12),r,i]}(o)):r[t]=o)})),r}function N(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")}function I(e,t){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),L(e instanceof Uint8Array?P(e):e,t)}function O(e,t,n,r){var i=new XMLHttpRequest;i.addEventListener("load",(function(){try{var e=I(i.response);n(e)}catch(e){r(e)}}),!0),i.addEventListener("error",r,!0),i.responseType="arraybuffer",i.open("GET",t+e.toUpperCase()),i.send()}var D=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],z=D.concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]),F="//mmtf.rcsb.org/v1.0/",B=F+"full/",U=F+"reduced/";e.encode=function(e){return o(R(e))},e.decode=I,e.traverse=function(e,t,n){var r,i,o,a,s,l,u=(n=n||{}).firstModelOnly,c=t.onModel,h=t.onChain,d=t.onGroup,f=t.onAtom,p=t.onBond,m=0,v=0,g=0,y=0,_=0,x=-1,b=e.chainNameList,w=e.secStructList,S=e.insCodeList,E=e.sequenceIndexList,T=e.atomIdList,M=e.bFactorList,C=e.altLocList,A=e.occupancyList,R=e.bondAtomList,P=e.bondOrderList;for(r=0,i=e.chainsPerModel.length;i>r&&!(u&&m>0);++r){var k=e.chainsPerModel[m];for(c&&c({chainCount:k,modelIndex:m}),o=0;k>o;++o){var L=e.groupsPerChain[v];if(h){var I=N(e.chainIdList.subarray(4*v,4*v+4)),O=null;b&&(O=N(b.subarray(4*v,4*v+4))),h({groupCount:L,chainIndex:v,modelIndex:m,chainId:I,chainName:O})}for(a=0;L>a;++a){var D=e.groupList[e.groupTypeList[g]],z=D.atomNameList.length;if(d){var F=null;w&&(F=w[g]);var B=null;e.insCodeList&&(B=String.fromCharCode(S[g]));var U=null;E&&(U=E[g]),d({atomCount:z,groupIndex:g,chainIndex:v,modelIndex:m,groupId:e.groupIdList[g],groupType:e.groupTypeList[g],groupName:D.groupName,singleLetterCode:D.singleLetterCode,chemCompType:D.chemCompType,secStruct:F,insCode:B,sequenceIndex:U})}for(s=0;z>s;++s){if(f){var V=null;T&&(V=T[y]);var G=null;M&&(G=M[y]);var j=null;C&&(j=String.fromCharCode(C[y]));var H=null;A&&(H=A[y]),f({atomIndex:y,groupIndex:g,chainIndex:v,modelIndex:m,atomId:V,element:D.elementList[s],atomName:D.atomNameList[s],formalCharge:D.formalChargeList[s],xCoord:e.xCoordList[y],yCoord:e.yCoordList[y],zCoord:e.zCoordList[y],bFactor:G,altLoc:j,occupancy:H})}y+=1}if(p){var W=D.bondAtomList;for(s=0,l=D.bondOrderList.length;l>s;++s)p({atomIndex1:y-z+W[2*s],atomIndex2:y-z+W[2*s+1],bondOrder:D.bondOrderList[s]})}g+=1}v+=1}if(_=x+1,x=y-1,p&&R)for(s=0,l=R.length;l>s;s+=2){var q=R[s],Y=R[s+1];(q>=_&&x>=q||Y>=_&&x>=Y)&&p({atomIndex1:q,atomIndex2:Y,bondOrder:P?P[s/2]:null})}m+=1}},e.fetch=function(e,t,n){O(e,B,t,n)},e.fetchReduced=function(e,t,n){O(e,U,t,n)},e.version="v1.1.0dev",e.fetchUrl=B,e.fetchReducedUrl=U,e.encodeMsgpack=o,e.encodeMmtf=R,e.decodeMsgpack=P,e.decodeMmtf=L}(t)})),Gg=Qd.Complex,jg=Qd.Chain,Hg=Qd.Atom,Wg=Qd.AtomName,qg=Qd.Element,Yg=Qd.Helix,Xg=Qd.Sheet,Zg=Qd.Strand,$g=Qd.Bond,Kg=Qd.Assembly,Jg=Qd.Molecule,Qg=function(){function e(t){h(this,e),this._original=Array.from(t),this._original.sort(),this._sum=0;for(var n=0;n<this._original.length;++n)this._sum+=this._original[n]}return Tc(e,[{key:"compare",value:function(e){var t=e.length;if(t!==this._original.length)return!1;var n,r=0;for(n=0;n<t;++n)r+=e[n];if(r!==this._sum)return!1;var i=Array.from(e);for(i.sort(),n=0;n<t;++n)if(i[n]!==this._original[n])return!1;return!0}}]),e}();Qg.prototype.constructor=Qg;var ey=Fh.Type,ty=[ey.HELIX_PI,ey.BEND,ey.HELIX_ALPHA,ey.STRAND,ey.HELIX_310,ey.BRIDGE,ey.TURN,ey.COIL],ny=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._options.fileType="mmtf",r}return m(t,e),Tc(t,[{key:"_onModel",value:function(e){}},{key:"_onChain",value:function(e){if(0===e.modelIndex){var t=new jg(this._complex,e.chainName);this._complex._chains[e.chainIndex]=t,t._index=e.chainIndex}}},{key:"_onGroup",value:function(e){if(0===e.modelIndex&&(!this.settings.now.nowater||"HOH"!==e.groupName&&"WAT"!==e.groupName)){var t=this._complex._chains[e.chainIndex],n=e.insCode.charCodeAt(0)?e.insCode:"",r=t.addResidue(e.groupName,e.groupId,n);r._index=e.groupIndex,this._updateSecStructure(this._complex,r,e)}}},{key:"_onAtom",value:function(e){if(0===e.modelIndex){var t=e.altLoc.charCodeAt(0)?e.altLoc:"",n=new Hg(e.groupIndex,new Wg(e.atomName),qg.getByName(e.element.toUpperCase()),new E(e.xCoord,e.yCoord,e.zCoord),qg.Role[e.atomName],!1,e.atomId,t,e.occupancy,e.bFactor,e.formalCharge);this._complex._atoms[e.atomIndex]=n,n._index=e.atomIndex,this._serialAtomMap[e.atomId]=n}}},{key:"_onBond",value:function(e){var t=Math.max(e.atomIndex1,e.atomIndex2);if(!(t>=this._complex._atoms.length)){var n=Math.min(e.atomIndex1,e.atomIndex2);this._complex.addBond(this._complex._atoms[n],this._complex._atoms[t],e.bondOrder,$g.BondType.UNKNOWN,!0)}}},{key:"_updateSecStructure",value:function(e,t,n){if(!s.isUndefined(n)&&n.secStruct===this._ssType)return t._secondary=this._ssStruct,void(this._ssStruct&&(this._ssStruct.term=t));if(!s.isUndefined(n)){var r=ty[n.secStruct];this._ssType=n.secStruct,this._ssStart=t;var i=null;switch(this._ssType){case-1:case 7:break;case 0:case 2:case 4:i=new Yg([3,-1,1,-1,5][this._ssType],t,t,0,"","",0),e._helices.push(i);break;case 3:var o=new Xg("",0);e._sheets.push(o),i=new Zg(o,t,t,0,null,null);break;default:void 0!==r&&(i=new Fh(r,t,t))}this._ssStruct=i,t._secondary=i,i&&e.structures.push(i)}}},{key:"_updateMolecules",value:function(e){var t=e.entityList;if(t)for(var n=e.chainsPerModel[0],r=0;r<t.length;r++){for(var i=t[r],o=i.chainIndexList,a=[],s=0;s<o.length;s++){var l=o[s];if(!(l>=n)){var u=this._complex._chains[l];a=a.concat(u._residues.slice())}}var c=new Jg(this._complex,i.description,r+1);c._residues=a,this._complex._molecules[r]=c}}},{key:"_traverse",value:function(e){var t=this,n=this._complex.metadata;n.id=e.structureId,n.title=[],n.title[0]=e.title,n.date=e.releaseDate,n.format="mmtf";var r={onModel:function(e){t._onModel(e)},onChain:function(e){t._onChain(e)},onGroup:function(e){t._onGroup(e)},onAtom:function(e){t._onAtom(e)},onBond:function(e){t._onBond(e)}};this._ssType=-1,this._ssStruct=null,this._ssStart=null,Vg.traverse(e,r),this._updateSecStructure(this._complex),this._updateMolecules(e)}},{key:"_linkAtomsToResidues",value:function(){for(var e=0;e<this._complex._atoms.length;++e){var t=this._complex._atoms[e],n=this._complex._residues[t._residue];t._residue=n,n._atoms.push(t)}}},{key:"_findSynonymousChains",value:function(){for(var e={},t=0;t<this._complex._chains.length;++t){var n=this._complex._chains[t],r=n.getName();e.hasOwnProperty(r)||(e[r]=[]),e[r].push(n._index)}return e}},{key:"_parseAssemblyInfo",value:function(e){var t,n,r,i=[],o=this.logger;for(t=0;t<e.bioAssemblyList.length;++t){var a=e.bioAssemblyList[t];if(0!==a.transformList.length){var s=a.transformList[0].chainIndexList,l=new Qg(s),u={};for(n=0;n<s.length;++n)u[this._complex._chains[s[n]].getName()]=1;var c=[],h=void 0;for(h in u)u.hasOwnProperty(h)&&Array.prototype.push.apply(c,this._chainsByName[h]);l.compare(c)||o.debug("MMTF: Assembly is missing some of the synonymous chains. Skipping...");var d=new Kg(this._complex);for(h in u)u.hasOwnProperty(h)&&d.addChain(h);for(d.addMatrix((new V).fromArray(a.transformList[0].matrix).transpose()),n=1;n<a.transformList.length;++n){var f=a.transformList[n];if(l.compare(f.chainIndexList)){var p=(new V).fromArray(f.matrix).transpose();for(r=0;r<d.matrices.length&&!d.matrices[r].equals(p);++r);r===d.matrices.length&&d.addMatrix(p)}else o.debug("MMTF: Chain lists differ for different transforms in one assembly. Skipping...")}d.finalize(),i.push(d)}}return i}},{key:"_markHeteroAtoms",value:function(e){for(var t=e.chainsPerModel[0],n=0;n<e.entityList.length;++n){var r=e.entityList[n];if("polymer"!==r.type)for(var i=0;i<r.chainIndexList.length;++i){var o=r.chainIndexList[i];if(!(o>=t))for(var a=this._complex._chains[o],s=0;s<a._residues.length;++s)for(var l=a._residues[s],u=0;u<l._atoms.length;++u)l._atoms[u]._het=!0}}}},{key:"_joinSynonymousChains",value:function(){var e,t,n=[],r={};for(e=0;e<this._complex._chains.length;++e){var i=this._complex._chains[e],o=i.getName();if(r.hasOwnProperty(o)){var a=r[o];for(t=0;t<i._residues.length;++t){var s=i._residues[t];a._residues.push(s),s._chain=a}}else r[o]=i,i._index=n.length,n.push(i)}this._complex._chains=n}},{key:"parseSync",value:function(){var e=Vg.decode(this._data);return this._complex=new Gg,this._serialAtomMap={},this._traverse(e),this._linkAtomsToResidues(),this._markHeteroAtoms(e),this._chainsByName=this._findSynonymousChains(),Array.prototype.push.apply(this._complex.units,this._parseAssemblyInfo(e)),this._joinSynonymousChains(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._complex}}],[{key:"canProbablyParse",value:function(e){return s.isArrayBuffer(e)&&223==(1|new Uint8Array(e,0,1)[0])}}]),t}(yg);ny.formats=["mmtf"],ny.extensions=[".mmtf"],ny.binary=!0;var ry=function(e){function t(e,n,r){var i;return h(this,t),i=d(this,f(t).call(this,"data:".concat(n,":").concat(r,": ").concat(e))),Error.captureStackTrace&&Error.captureStackTrace(c(i),t),i.name="ParsingError",i.parseLine=n,i.parseColumn=r,i}return m(t,e),t}(kc(Error));function iy(e){return 32===e||10===e||13===e||9===e}function oy(e,t,n){for(var r=t.length,i=-1;n<r&&(i=t.charCodeAt(n))!==e&&10!==i;)++n;return i===e?n:-1}var ay=Qd.Complex,sy=Qd.Element,ly=Qd.Helix,uy=Qd.Sheet,cy=Qd.Strand,hy=Qd.Assembly,dy=Qd.Molecule,fy=["auth_seq_id","Cartn_x","Cartn_y","Cartn_z","label_atom_id"],py={helx:"helix",turn:"turn",strn:"strand"};function my(e){return null==e||s.isArray(e)?e:[e]}function vy(e){var t=4===e.trim().length;return e.slice(0,t?1:2).trim()}var gy=function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this))).name="AtomDataError",n.message=e,n}return m(t,e),t}(kc(Error));function yy(e,t){for(var n=(e=s.isString(e)?e:"".concat(e)).replace(/\)\s*\(/g,"!").replace(/[()']/g,"").split("!"),r=[],i=0,o=n.length;i<o;++i){for(var a=n[i].split(","),l=[],u=0,c=0,h=a.length;c<h;++c){var d=a[c];if(d.includes("-"))for(var f=d.split("-"),p=parseInt(f[0],10),m=parseInt(f[1],10);p<=m;++p)l[u++]=t[p];else l[u++]=t[d]}r.push(l)}var v=[],g=0;return function e(t,n){for(var i=0,o=r[t].length;i<o;++i){var a=n?n.clone():new V;a.multiplyMatrices(r[t][i],a),0===t?v[g++]=a:e(t-1,a)}}(r.length-1),v}var _y=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n))).asymDict={},r.molecules=[],r._options.fileType="cif",r}return m(t,e),Tc(t,[{key:"parseSync",value:function(){this.logger.info("Parsing CIF file..");var e=function(e){var t,n,r,i,o=0,a=0,l=e.length,u=NaN,c=!0,h=1,d=1,f=0,p={},m={},v=[],g=0,y="",_=[],x=0;function b(){var t;if((46===u||63===u)&&(o+1>=l||iy(e.charCodeAt(o+1))))return++d,void++o;if(c&&59===u){a=o;var n=0;do{if(-1===(a=oy(10,e,a+1)))throw new ry("Unterminated text block found",h,d);++n}while(a+1<l&&e.charCodeAt(a+1)!==u||a+1>=l);return t=e.substring(o+1,a).replace(/\r/g,""),o=a+2,h+=n,d=1,c=!1,t}if(39===u||34===u){a=o;do{if(-1===(a=oy(u,e,a+1)))throw new ry("Unterminated quoted string found",h,d)}while(a+1<l&&!iy(e.charCodeAt(a+1)));return t=e.substring(o+1,a),d+=a-o+1,o=a+1,t}for(a=o;a<l&&!iy(e.charCodeAt(a));)++a;t=e.substring(o,a),d+=a-o,o=a;var r=Number(t);return Number.isNaN(r)?t:r}for(;o<=l;){if(13===(u=e.charCodeAt(o)));else if(10===u)c=!0,++h,d=1;else{if(32!==u&&9!==u){if(35===u){if(-1===(o=oy(10,e,o+1)))break;continue}if(0===f){if(68!==u&&100!==u||"ata_"!==e.substr(o+1,4).toLowerCase()){if(Number.isNaN(u))break;throw new ry("Unexpected character in state ".concat(f),h,d)}for(t=a=o+5;a<l&&!iy(e.charCodeAt(a));)++a;if(d+=a-o,t<(o=a)){p[e.substring(t,o)]=m={},f=1;continue}throw new ry("Data block name missing",h,d)}if(1===f){if(68!==u&&100!==u||"ata_"!==e.substr(o+1,4).toLowerCase()){if(95===u){for(t=a=o+1;a<l&&!iy(e.charCodeAt(a));)++a;if(d+=a-o,t<(o=a)){y=e.substring(t,o),f=2;continue}throw new ry("Tag name missing",h,d)}if(76!==u&&108!==u||"oop_"!==e.substr(o+1,4).toLowerCase()){if(Number.isNaN(u))break;throw new ry("Unexpected character in state ".concat(f),h,d)}if(d+=5,(o+=5)<l&&!iy(e.charCodeAt(o)))throw new ry("Unexpected character in state ".concat(f),h,d);v=[],g=0,_=[],x=0,f=3;continue}f=0;continue}if(2===f){if(Number.isNaN(u))break;n=b(),s.set(m,y,n),f=1;continue}if(3===f){if(95===u){for(t=a=o+1;a<l&&!iy(e.charCodeAt(a));)++a;if(d+=a-o,t<(o=a)){i=e.substring(t,o),v[g++]=i;continue}throw new ry("Tag name missing",h,d)}if(g>0){for(var w=0;w<g;++w)n=[],_[w]=n,s.set(m,v[w],n);f=4;continue}throw new ry("Data tags are missing inside a loop",h,d)}if(4===f){68!==u&&100!==u||"ata_"!==e.substr(o+1,4).toLowerCase()?95===u?f=1:76!==u&&108!==u||"oop_"!==e.substr(o+1,4).toLowerCase()?Number.isNaN(u)?f=0:(r=b(),_[x%g].push(r),++x):f=1:f=0;continue}throw new ry("Unexpected internal state ".concat(f),h,d)}c=!1,++d}++o}if(2===f)throw new ry("Unexpected end of file in state ".concat(f),h,d);return p}(this._data);return this._toComplex(e)}},{key:"_toComplex",value:function(e){var t=new ay,n=e[Object.keys(e)[0]];return this._extractAtoms(t,n),this._extractSecondary(t,n),this._extractAssemblies(t,n),this._extractMolecules(t,n),this._extractMetadata(t,n),t.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing}),t}},{key:"_extractMetadata",value:function(e,t){var n=e.metadata;n.id=t.entry.id,n.classification=t.struct_keywords.pdbx_keywords;var r=t.database_PDB_rev;n.date=r&&r.date_original?r.date_original:"",n.format="cif",n.title=[],n.title[0]=t.struct.title}},{key:"_extractMolecules",value:function(e,t){var n,r=my(t.entity.pdbx_description),i=r.length;for(n=0;n<i;n++)this.molecules[n].name=r[n];var o=e.getMolecules();for(n=0;n<i;n++){var a=this.molecules[n];o[n]=new dy(e,a.name,n+1),o[n]._residues=a.residues}}},{key:"_extractAtoms",value:function(e,t){var n=t.atom_site;if(!n)throw new gy("CIF parsing error: atom_site is not specified!");for(var r=0,i=fy.length;r<i;++r)if(!n[fy[r]])throw new gy("CIF parsing error: requires field ".concat(fy[r]," not found!"));for(var o=this.asymDict,a=my(n.auth_seq_id),s=my(n.Cartn_x),l=my(n.Cartn_y),u=my(n.Cartn_z),c=my(n.label_atom_id),h=c.length,d=my(n.group_PDB)||[],f=my(n.auth_asym_id)||[],p=my(n.label_asym_id)||[],m=my(n.id)||[],v=my(n.pdbx_PDB_ins_code)||[],g=my(n.label_comp_id)||[],y=my(n.type_symbol)||[],_=my(n.B_iso_or_equiv)||[],x=my(n.occupancy)||[],b=my(n.pdbx_formal_charge)||[],w=my(n.label_alt_id)||[],S=my(n.pdbx_PDB_model_num)||[],T=my(n.label_entity_id)||[],M=null,C=null,A=0;A<h;++A)if(1===(S[A]||1)){var R=String(f[A]||" ");M&&M.getName()===R||(M=e.getChain(R)||e.addChain(R)),o[String(p[A]||" ")]=R;var P=a[A],k=String(v[A]||" "),L=String(g[A]||"");if(!C||C.getSequence()!==P||C.getICode()!==k){C=M.addResidue(L,P,k);var N=T[A]-1,I=this.molecules[N];I||(this.molecules[N]={name:"",residues:[]},I=this.molecules[N]),I.residues.push(C)}var O=c[A],D=y[A]||vy(O),z=sy.getByName(D),F=sy.Role[O.trim()],B=new E(s[A],l[A],u[A]),U="HETATM"===d[A]||!1,V=m[A]||A,G=_[A]||0,j=x[A]||0,H=String(w[A]||""),W=b[A]||0;C.addAtom(O,z,B,F,U,V,H,j,G,W)}}},{key:"_extractSecondary",value:function(e,t){t.struct_conf&&this._extractConfs(e,t.struct_conf),t.struct_sheet_range&&this._extractSheets(e,t.struct_sheet_range)}},{key:"_extractSheets",value:function(e,t){var n=this.asymDict;if(t.sheet_id&&t.id&&t.beg_label_seq_id&&t.end_label_seq_id&&t.beg_label_asym_id)for(var r=e._sheets,i=my(t.sheet_id),o=my(t.id),a=my(t.beg_auth_seq_id),s=my(t.end_auth_seq_id),l=my(t.beg_label_asym_id),u=my(t.pdbx_beg_PDB_ins_code)||[],c=my(t.pdbx_end_PDB_ins_code)||[],h=0,d=o.length;h<d;++h){var f=e.getChain(n[l[h]]),p=E(i[h]),m=a[h],v=s[h],g=u[h]||" ",y=c[h]||" ",_=f.findResidue(m,g),x=f.findResidue(v,y);if(_&&x){for(var b=new cy(p,_[0],x[0],0,null,null),w=f.getResidues(),S=_[1];S<=x[1];++S)w[S]._secondary=b;p.addStrand(b),e.structures.push(b)}}function E(e){for(var t=r.length,n=0;n<t;++n)if(r[n]._name===e)return r[n];return r[t]=new uy(e,0),r[t]}}},{key:"_extractConfs",value:function(e,t){var n=this.asymDict;if(t.conf_type_id&&t.beg_label_seq_id&&t.end_label_seq_id&&t.beg_label_asym_id)for(var r,i,o=my(t.conf_type_id),a=my(t.beg_auth_seq_id),s=my(t.pdbx_beg_PDB_ins_code)||[],l=my(t.end_auth_seq_id),u=my(t.pdbx_end_PDB_ins_code)||[],c=my(t.details)||[],h=my(t.pdbx_PDB_helix_length)||[],d=my(t.pdbx_PDB_helix_class)||[],f=my(t.id)||[],p=my(t.beg_label_asym_id),m=0,v=o.length;m<v;++m){var g=(r=o[m],i=void 0,(i=/[A-Za-z]+/.exec(r))?py[i[0].toLowerCase()]:null);if(g){var y=f[m]||o[m],_=e.getChain(n[p[m]]),x=a[m],b=l[m],w=s[m]||" ",S=u[m]||" ",E=_.findResidue(x,w),T=_.findResidue(b,S);if(E&&T){var M=c[m]||"",C=h[m]||0,A=d[m]||" ",R=void 0;if("helix"===g){var P=e._helices.length;R=new ly(A,E[0],T[0],P,y,M,C),e.addHelix(R),e.structures.push(R)}else"turn"===g?(R=new Fh(Fh.Type.TURN,E[0],T[0]),e.structures.push(R)):R=null;if(R)for(var k=_.getResidues(),L=E[1];L<=T[1];++L)k[L]._secondary=R}}}}},{key:"_extractAssemblies",value:function(e,t){var n=this.asymDict,r=t.pdbx_struct_assembly_gen;if(r){var i=my(r.assembly_id),o=my(r.oper_expression),a=my(r.asym_id_list);if(i&&o&&a){var s=function(e){if(!e)return null;var t=my(e.id),n=e.matrix,r=e.vector;if(!t||!n||!r)return null;for(var i=[],o=0,a=t.length;o<a;++o){for(var s=new V,l=s.elements,u=0;u<3;++u){var c=n[u+1];l[u]=my(c[1])[o],l[u+4]=my(c[2])[o],l[u+8]=my(c[3])[o],l[u+12]=my(r[u+1])[o]}i[t[o]]=s}return i}(t.pdbx_struct_oper_list);if(s)for(var l=0,u=i.length;l<u;++l){for(var c=new hy(e),h=yy(o[l],s),d=a[l].split(","),f=0,p=d.length;f<p;++f){var m=d[f].trim();m.length>0&&c.addChain(n[m])}c.matrices=h,e.units.push(c)}}}}}],[{key:"canProbablyParse",value:function(e){return s.isString(e)&&/^\s*data_/i.test(e)}}]),t}(yg);_y.formats=["cif","mmcif"],_y.extensions=[".cif",".mmcif"];var xy=function(){function e(){h(this,e),u(this,"_xyz2crs",[]),u(this,"_origin",new E(0,0,0)),this._header={},this._boxSize=new E,this._boxStart=new E,this._header.delta={},this._header.extent=[],this._header.nstart=[],this._header.grid=[],this._header.crs2xyz=[],this._header.cellDims=new E,this._header.angles=[],this._header.origin=new E(0,0,0),this._header.dmin=0,this._header.dmean=0,this._header.dmax=0}return Tc(e,[{key:"_typedCheck",value:function(){if(s.isTypedArray(this._buff))this._buff=this._buff.buffer;else if(!s.isArrayBuffer(this._buff))throw new TypeError("Expected ArrayBuffer or TypedArray")}},{key:"_fillHeader",value:function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(e[n][0]){case 0:this._header[n]=t[e[n][1]][e[n][2]];break;case 2:this._parseArray(this._header[n],t[e[n][1]],e[n][2]);break;case 1:this._parseVector(this._header[n],t[e[n][1]],e[n][2]);break;case 3:this._header[n]=new Uint8Array(t[e[n][1]],4*[e[n][2]],4*[e[n][3]])}}},{key:"_parseVector",value:function(e,t,n){var r=[t[n],t[n+1],t[n+2]];e.x=r[0],e.y=r[1],e.z=r[2]}},{key:"_parseArray",value:function(e,t,n){e[0]=t[n],e[1]=t[n+1],e[2]=t[n+2]}},{key:"_parseHeader",value:function(e){}},{key:"_setAxisIndices",value:function(){}},{key:"_setOrigins",value:function(){}},{key:"_getAxis",value:function(){var e=this._header,t=e.cellDims.x/e.grid[0],n=e.cellDims.y/e.grid[1],i=e.cellDims.z/e.grid[2],o=r(e.angles,3),a=o[0],s=o[1],l=o[2],u=Math.cos(s),c=(Math.cos(a)-Math.cos(s)*Math.cos(l))/Math.sin(l),h=Math.sqrt(1-u*u-c*c);return[new E(t,0,0),new E(Math.cos(l)*n,Math.sin(l)*n,0),new E(u*i,c*i,h*i)]}},{key:"_getXYZdim",value:function(){return[this._header.extent[this._xyz2crs[0]],this._header.extent[this._xyz2crs[1]],this._header.extent[this._xyz2crs[2]]]}},{key:"_getVolumeInfo",value:function(){var e=s.pick(this._header,["dmean","dmin","dmax","sd","delta"]);return e.obtuseAngle=this._header.angles.map((function(e){return Number(e>=Math.PI/2)})),e}},{key:"_setBoxParams",value:function(e,t,n){var i=this,o=0,a=0,s=r(this._header.angles,3),l=s[0],u=s[1];s[2]>=Math.PI/2&&(o+=Math.abs(t.x)),u>=Math.PI/2&&(o+=Math.abs(n.x)),l>=Math.PI/2&&(a+=Math.abs(n.y)),this._boxStart=new E(this._origin.x-o,this._origin.y-a,this._origin.z),this._boxSize=new E(Math.abs(e.x)+Math.abs(t.x)+Math.abs(n.x),Math.abs(t.y)+Math.abs(n.y),Math.abs(n.z));var c=function(e,t){return Math.abs(e[t])/i._boxSize[t]};this._header.delta.x=c(t,"x"),this._header.delta.y=c(n,"x"),this._header.delta.z=c(n,"y")}},{key:"_getXYZbox",value:function(){return new xe(this._boxStart.clone(),this._boxStart.clone().add(this._boxSize))}},{key:"_toXYZData",value:function(){}},{key:"parse",value:function(e){return this._parseHeader(e),this._setOrigins(),new Jd(Float32Array,this._getXYZdim(),this._getXYZbox(),1,this._toXYZData(),this._getVolumeInfo())}}]),e}(),by={extent:[2,"u32",0],type:[0,"u32",3],nstart:[2,"i32",4],grid:[2,"u32",7],cellDims:[1,"f32",10],angles:[2,"f32",13],crs2xyz:[2,"i32",16],dmin:[0,"f32",19],dmax:[0,"f32",20],dmean:[0,"f32",21],ispg:[0,"u32",22],nsymbt:[0,"u32",23],lksflg:[0,"u32",24],customData:[3,"buffer",25,9],origin:[1,"f32",34],map:[3,"buffer",52,1],machine:[0,"u32",53],sd:[0,"f32",54],nlabel:[0,"f32",55],label:[3,"buffer",56,200]},wy=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_parseHeader",value:function(e){this._buff=e,this._typedCheck();var t={};t.u32=new Uint32Array(this._buff,0,56),t.i32=new Int32Array(this._buff,0,56),t.f32=new Float32Array(this._buff,0,56),t.buffer=this._buff;var n=this._header;this._fillHeader(by,t),n.angles.forEach((function(e,t,n){n[t]*=Math.PI/180}))}},{key:"_setAxisIndices",value:function(){var e=this._header;0===e.cellDims.x&&0===e.cellDims.y&&0===e.cellDims.z&&e.cellDims.set(1,1,1);var t=this._header.crs2xyz;0===t[0]&&0===t[1]&&0===t[2]&&(t[0]=1,t[1]=2,t[2]=3);var n=this._xyz2crs;n[t[0]-1]=0,n[t[1]-1]=1,n[t[2]-1]=2}},{key:"_setOrigins",value:function(){var e=this._getAxis(),t=r(e,3),n=t[0],i=t[1],o=t[2];this._setAxisIndices();var a=this._header,s=this._xyz2crs;if(0===a.origin.x&&0===a.origin.y&&0===a.origin.z?(this._origin.addScaledVector(n,a.nstart[s[0]]),this._origin.addScaledVector(i,a.nstart[s[1]]),this._origin.addScaledVector(o,a.nstart[s[2]])):this._origin=a.origin,n.multiplyScalar(a.extent[s[0]]-1),i.multiplyScalar(a.extent[s[1]]-1),o.multiplyScalar(a.extent[s[2]]-1),2!==a.type)throw new Error("CCP4: Unsupported format ".concat(a.type));this._data=new Float32Array(this._buff,1024+a.nsymbt,a.extent[0]*a.extent[1]*a.extent[2]),this._setBoxParams(n,i,o)}},{key:"_toXYZData",value:function(){var e=this._header,t=this._data,n=this._xyz2crs,r=new Float32Array(t.length),i=this._getXYZdim(),o=i[0],a=i[1],s=0,l=[];for(l[2]=0;l[2]<e.extent[2];l[2]++)for(l[1]=0;l[1]<e.extent[1];l[1]++)for(l[0]=0;l[0]<e.extent[0];l[0]++,s++)r[l[n[0]]+o*(l[n[1]]+a*l[n[2]])]=t[s];return r}}]),t}(xy),Sy=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._options.fileType="ccp4",r.model=new wy,r}return m(t,e),Tc(t,[{key:"parseSync",value:function(){return this.model.parse(this._data)}}],[{key:"canProbablyParse",value:function(e){return!1}}]),t}(yg);Sy.formats=["ccp4"],Sy.extensions=[".ccp4",".map",".mrc"],Sy.binary=!0;var Ey=Qd.Complex,Ty=Qd.Element,My=Qd.Molecule,Cy=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._complex=null,r._atomsInf=null,r._options.fileType="xyz",r._fileName=n.name,r}return m(t,e),Tc(t,[{key:"_parseToAtomsInf",value:function(e){var t=e.indexOf("\n"),n=parseInt(e.substring(0,t),10),r=e.indexOf("\n",t+1),i=e.slice(t+1,r).trim();0===i.length&&(i=this._fileName);var o=r+e.substring(r).search(/\S/);this._atomsInf=e.substring(o).split(/[\s,]*\n[\s,]*/),Number.isNaN(n)||this._atomsInf.length-1===n?(this._complex.metadata.format="xyz",this._complex.name=i):this._complex.error={message:"wrong number of atoms"}}},{key:"_parseAtomsInf",value:function(){for(var e=this._complex.addChain("A").addResidue("UNK",1," "),t=0;t<this._atomsInf.length-1;t++){var n=this._atomsInf[t].split(/[\s,]+/);if(4!==n.length){this._complex.error={message:"missed parameters"};break}var r=t+1,i=n[0],o=new E(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])),a=Ty.getByName(i);e.addAtom(i,a,o,void 0,!0,r," ",1,1,0)}var s=new My(this._complex,this._complex.name,1);s._residues=e,this._complex._molecules[0]=s}},{key:"parseSync",value:function(){var e=this._complex=new Ey;if(this._parseToAtomsInf(this._data),this._parseAtomsInf(),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._complex=null,this._atomsInf=null,e.error)throw new Error(e.error.message);return e}}],[{key:"canProbablyParse",value:function(e){return s.isString(e)&&/^\s*\d+ *\n[^\n]*\n\s*\w{1,3}\s+-?\d/.test(e)}}]),t}(yg);u(Cy,"formats",["xyz"]),u(Cy,"extensions",[".xyz"]);var Ay=Qd.Complex,Ry=Qd.Element,Py=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._options.fileType="pubchem+json",r}return m(t,e),Tc(t,[{key:"parseSync",value:function(){return this.logger.info("Parsing PubChem JSON file..."),this._toComplex(JSON.parse(this._data))}},{key:"_toComplex",value:function(e){var t=new Ay,n=e.PC_Compounds&&e.PC_Compounds[0];return n&&(this._extractAtoms(t,n),t.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing})),t}},{key:"_extractAtoms",value:function(e,t){var n=t.atoms&&t.atoms.aid,r=n&&t.atoms.element;if(!r||n.length!==r.length)throw new Error("Unable to parse atom elements");r=s.fromPairs(s.zip(n,r));var i={},o=t.coords&&t.coords[0],a=o&&o.conformers&&o.conformers[0],l=a&&a.x,u=a&&a.y,c=a&&a.z||[];if(!(n=o&&o.aid)||!l||!u)throw new Error("Coordinates are not found in the file");for(var h=e.addChain(" ").addResidue("UNK",1," "),d=0,f=n.length;d<f;++d){var p=n[d],m=Ry.ByAtomicNumber[r[p]],v=new E(l[d],u[d],c[d]||0);i[p]=h.addAtom(m.name,m,v,void 0,!0,p," ",1,0,0)}var g=t.bonds&&t.bonds.aid1,y=t.bonds&&t.bonds.aid2,_=t.bonds&&t.bonds.order||[];if(g&&y&&g.length===y.length)for(var x=0,b=g.length;x<b;++x)e.addBond(i[g[x]],i[y[x]],_[x]||1,0,!0)}}],[{key:"canProbablyParse",value:function(e){return s.isString(e)&&"{"===e[0]}}]),t}(yg);Py.formats=["pubchem","pubchem+json","pc"],Py.extensions=[".json"];var ky=function(){function e(t){h(this,e),this._strings=t.split(/\r?\n|\r/),this._currentStart=0,this._currentStringIndx=0}return Tc(e,[{key:"setStart",value:function(e){e>=this._strings.length?(this._currentStart=this._strings.length-1,this._currentStringIndx=this._strings.length-1):(this._currentStart=e,this._currentStringIndx=e)}},{key:"getNextString",value:function(){return this._strings[++this._currentStringIndx]}},{key:"getCurrentString",value:function(){return this._strings[this._currentStringIndx]}},{key:"getStringFromStart",value:function(e){return this._currentStringIndx=this._currentStart+e,this._strings[this._currentStart+e]}},{key:"findNextDataItem",value:function(){for(var e=this.getNextString(),t=!1;!s.isUndefined(e)&&"$$$$"!==e.trim();){if(e.match(/>\s+<(.*)>/)){t=!0;break}e=this.getNextString()}return t}},{key:"findNextCompoundStart",value:function(){for(var e=this.getCurrentString();!s.isUndefined(e)&&"$$$$"!==e.trim();)e=this.getNextString();return this.setStart(++this._currentStringIndx),this.probablyHaveDataToParse()}},{key:"probablyHaveDataToParse",value:function(){return this._currentStringIndx<this._strings.length-2}}]),e}(),Ly=Qd.Complex,Ny=Qd.Element,Iy=Qd.Bond,Oy=Qd.Molecule,Dy=[0,3,2,1,0,-1,-2,-3],zy=[0,1,2,3,1,1,1,2],Fy=[Iy.BondType.UNKNOWN,Iy.BondType.COVALENT,Iy.BondType.COVALENT,Iy.BondType.COVALENT,Iy.BondType.AROMATIC,Iy.BondType.UNKNOWN,Iy.BondType.AROMATIC,Iy.BondType.AROMATIC],By=/.*(M\s\sEND).*|.*(^$$$$).*|.*>\s+<(.+)>.*/,Uy=/.*($$$$).*|.*>\s+<(.+)>.*/,Vy=["name","id","title"],Gy={name:["PUBCHEM_IUPAC_TRADITIONAL_NAME",/PUBCHEM_(.+)_NAME/,/(.+)name/,/(.+)NAME/],id:["PUBCHEM_COMPOUND_CID","id","ID",/.*CID/,/.*ID/,/.*id/],title:["msg","MSG","message","title","description","desc"]},jy=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._format="sdf",r._complex=null,r._chain=null,r._residue=null,r._molecules=null,r._metadata={},r._metadata.molecules=[],r._currentMolProps={},r._compoundIndx=-1,r._assemblies=[],r._atomsParsed=0,r._atomsIndexes=[],r}return m(t,e),Tc(t,[{key:"canProbablyParse",value:function(e){return s.isString(e)&&By.test(e)}},{key:"_parseHeader",value:function(e){var t={};t.name=e.getStringFromStart(0);var n=parseInt(e.getStringFromStart(1).substr(10,6).trim(),10);t.date=n.toString()||"",t.title=e.getStringFromStart(2),this._metadata.molecules.push(t)}},{key:"_parseAtoms",value:function(e,t){var n,r=this._atomsParsed,i=function(e){if(!e)return"A";for(var t=[];e;)t.push(65+e%26),e=Math.trunc(e/26);return t.length>1&&(t.reverse(),t[0]-=1),String.fromCharCode.apply(String,t)}(this._compoundIndx);this._chain=this._complex.getChain(i)||this._complex.addChain(i),this._residue=this._chain.addResidue("UNK",1," ");for(var o=0;o<t;o++){n=e.getNextString(),r++;var a=parseFloat(n.substr(0,10)),s=parseFloat(n.substr(10,10)),l=parseFloat(n.substr(20,10)),u=Dy[parseInt(n.substr(36,3),10)],c=new E(a,s,l),h=n.substr(31,3).trim().toUpperCase(),d=Ny.getByName(h);this._atomsIndexes[h]||(this._atomsIndexes[h]=0),this._atomsIndexes[h]+=1,h+=this._atomsIndexes[h],this._residue.addAtom(h,d,c,void 0,!0,r," ",1,0,u)}}},{key:"_parseBonds",value:function(e,t){for(var n,r=0;r<t;r++){n=e.getNextString();var i=parseInt(n.substr(0,3),10)+this._atomsParsed,o=parseInt(n.substr(3,3),10)+this._atomsParsed,a=parseInt(n.substr(6,3),10);if(i>o){var s=[o,i];i=s[0],o=s[1]}this._complex.addBond(i,o,zy[a]||1,Fy[a]||Iy.BondType.UNKNOWN,!0)}}},{key:"_parseMOL",value:function(e){this._compoundIndx++,this._parseHeader(e);var t=e.getStringFromStart(3),n=parseInt(t.substr(0,3),10),r=parseInt(t.substr(3,3),10);this._parseAtoms(e,n),this._parseBonds(e,r),this._atomsParsed+=n,this._metadata.molecules[this._compoundIndx]._residues=[],this._metadata.molecules[this._compoundIndx]._residues.push(this._residue)}},{key:"_parseDataItem",value:function(e){for(var t=e.getCurrentString(),n=[],i=e.getNextString();""!==i.trim();)n.push(i),i=e.getNextString();1===n.length&&(n=r(n,1)[0]),this._currentMolProps[t.replace(/[<>]/g,"").trim()]=n}},{key:"_parseCompound",value:function(e){if(this._parseMOL(e),"sdf"===this._format){for(this._currentMolProps={};e.findNextDataItem();)this._parseDataItem(e);if(0!==Object.keys(this._currentMolProps).length){var t=this._metadata.molecules[this._compoundIndx];t.props=this._currentMolProps,this._tryToUpdateMoleculeData(t)}}}},{key:"_fixBondsArray",value:function(){for(var e=this._serialAtomMap,t=this._complex._bonds,n=0;n<t.length;n++){var r=t[n];r._right<r._left&&console.log("_fixBondsArray: Logic error."),r._left=e[r._left]||null,r._right=e[r._right]||null}}},{key:"_buildAssemblies",value:function(){var e=this._complex._chains;if(1===e.length)return this._assemblies;for(var t=0;t<e.length;t++){var n=new vd(this._complex),r=new V;n.addMatrix(r),n.addChain(e[t]._name),this._assemblies.push(n)}return this._assemblies}},{key:"_buildMolecules",value:function(){this._complex._molecules=[];for(var e=this._metadata.molecules,t=0;t<e.length;t++){var n=new Oy(this._complex,e[t].name,t+1);n._residues=e[t]._residues,this._complex._molecules[t]=n}return this._complex._molecules}},{key:"_searchTag",value:function(e,t){for(var n=0;n<t.length;n++)if(e instanceof RegExp&&e.test(t[n].tag)||e===t[n].tag)return t[n].data}},{key:"_tryToFind",value:function(e,t){for(var n=0;n<e.length;n++){var r=this._searchTag(e[n],t);if(r)return r}}},{key:"_tryToUpdateMoleculeData",value:function(e){for(var t=!1,n=0;n<Vy.length;n++){var r=Gy[Vy[n]],i=this._tryToFind(r,e.props);i&&(e[Vy[n]]=i,t=!0)}return e.name=e.name||e.id,e.name.match(/^\d+$/)&&(e.name="CID: ".concat(e.name)),t}},{key:"_finalizeMetadata",value:function(){var e=this._metadata.molecules,t=this._complex.metadata,n=this._complex;if(1===e.length)n.name=e[0].name,t.title=e[0].title,t.date=e[0].date,t.properties=e[0].props;else if(e.length>1){t.molecules=[];for(var r=0;r<e.length;r++)t.molecules.push({name:e[r].name,date:e[r].date,title:e[r].title,properties:e[r].props})}}},{key:"_finalize",value:function(){for(var e=this._serialAtomMap={},t=this._complex._atoms,n=0;n<t.length;n++){var r=t[n];e[r._serial]=r}this._complex._finalizeBonds(),this._fixBondsArray(),this._finalizeMetadata(),this._buildAssemblies(),this._complex.units=this._complex.units.concat(this._assemblies),this._buildMolecules(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:!1,enableEditing:!1,serialAtomMap:this._serialAtomMap})}},{key:"defineFormat",value:function(e){return Uy.test(e)?"sdf":"mol"}},{key:"parseSync",value:function(){var e=this._complex=new Ly,t=new ky(this._data);this._format=this.defineFormat(this._data),e.metadata.format=this._format;do{this._parseCompound(t)}while(t.findNextCompoundStart());return this._finalize(),e}}]),t}(yg);jy.formats=["mol","sdf"],jy.extensions=[".mol",".sdf"];var Hy={nstart:[2,"i16",0],extent:[2,"i16",3],grid:[2,"i16",6],cellDims:[1,"i16",9],angles:[2,"i16",12],div:[0,"i16",15],adder:[0,"i16",16],scaleFactor:[0,"i16",17]},Wy=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"_parseHeader",value:function(e){this._buff=e,this._typedCheck();var t={};if(t.i16=new Int16Array(this._buff),100!==t.i16[18])for(var n=0,r=t.i16.length;n<r;++n){var i=t.i16[n];t.i16[n]=(255&i)<<8|i>>8&255}if(100!==t.i16[18])throw new Error("DSN6: Incorrect format ");var o=this._header;this._fillHeader(Hy,t),o.cellDims.multiplyScalar(1/o.scaleFactor),o.angles.forEach((function(e,t,n){n[t]*=Math.PI/180/o.scaleFactor})),o.div/=100}},{key:"_setAxisIndices",value:function(){this._xyz2crs[0]=0,this._xyz2crs[1]=1,this._xyz2crs[2]=2}},{key:"_setOrigins",value:function(){var e=this._header,t=this._getAxis(),n=r(t,3),i=n[0],o=n[1],a=n[2];this._setAxisIndices(),this._origin.addScaledVector(i,e.nstart[0]),this._origin.addScaledVector(o,e.nstart[1]),this._origin.addScaledVector(a,e.nstart[2]),i.multiplyScalar(e.extent[0]),o.multiplyScalar(e.extent[1]),a.multiplyScalar(e.extent[2]),this._setBoxParams(i,o,a)}},{key:"_pointCalculate",value:function(e,t,n,r,i,o,a){var s=this._header;return i<s.extent[0]&&r<s.extent[1]&&n<s.extent[2]?(e[i+s.extent[0]*(r+s.extent[1]*n)]=(t[o.counter]-s.adder)/s.div,++o.counter,!0):(o.counter+=8-a,!1)}},{key:"_blockCalculate",value:function(e,t,n,r,i,o){for(var a=0;a<8;++a)for(var s=8*n+a,l=0;l<8;++l)for(var u=8*r+l,c=!0,h=0;c&&h<8;){var d=8*i+h;c=this._pointCalculate(e,t,s,u,d,o,h),h++}}},{key:"_toXYZData",value:function(){for(var e=this._header,t=new Uint8Array(this._buff),n=new Float32Array(e.extent[0]*e.extent[1]*e.extent[2]),r=new E(e.extent[0]/8,e.extent[1]/8,e.extent[2]/8),i={counter:512},o=0;o<r.z;++o)for(var a=0;a<r.y;++a)for(var s=0;s<r.x;++s)this._blockCalculate(n,t,o,a,s,i);return this._calculateInfoParams(n),n}},{key:"_calculateInfoParams",value:function(e){this._header.dmean/=e.length;for(var t=0,n=e[0],r=e[0],i=0;i<e.length;i++)t+=Math.pow(this._header.dmean-e[i],2),e[i]<n&&(n=e[i]),e[i]>r&&(r=e[i]);this._header.sd=Math.sqrt(t/e.length),this._header.dmax=r,this._header.dmin=n}}]),t}(xy),qy=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._options.fileType="dsn6",r.model=new Wy,r}return m(t,e),Tc(t,[{key:"parseSync",value:function(){return this.model.parse(this._data)}}],[{key:"canParse",value:function(e,t){return!!e&&e instanceof ArrayBuffer&&yg.checkDataTypeOptions(t,"dsn6")}},{key:"canProbablyParse",value:function(e){return!1}}]),t}(yg);qy.formats=["dsn6"],qy.extensions=[".dsn6",".omap"],qy.binary=!0;var Yy=function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this,e)))._next=-1,n.next(),n}return m(t,e),Tc(t,[{key:"getNext",value:function(){return this._next}}]),t}(wg),Xy=Qd.Complex,Zy=Qd.Element,$y=Qd.Molecule,Ky=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._time=null,r._numAtoms=null,r._residueNumber=null,r._residueName="",r._atomName="",r._atomNumber=null,r._atomPosition=[],r._atomVelocity=[],r._complex=null,r._molecules=[],r._molecule=null,r._options.filetype="gro",r}return m(t,e),Tc(t,[{key:"canProbablyParse",value:function(e){return s.isString(this._data)&&/^\s*[^\n]*\n\s*\d+ *\n\s*\d+[^\n\d]{3}\s*\w+\s*\d+\s*-?\d/.test(e)}},{key:"_parseTitle",value:function(e){var t=this._complex.metadata;t.id=e.readLine().trim(),t.name=t.id.slice(t.id.lastIndexOf("\\")+1,t.id.lastIndexOf(".")),t.format="gro"}},{key:"_parseNumberOfAtoms",value:function(e){if(this._numAtoms=e.readInt(0,e.getNext()),Number.isNaN(this._numAtoms))throw new Error("Line 2 is not representing atom number. Consider checking input file")}},{key:"_parseAtom",value:function(e){this._residueNumber=e.readInt(1,5),this._residueName=e.readString(6,10).trim(),this._atomName=e.readString(11,15).trim(),this._atomNumber=e.readInt(16,20);var t=10*e.readFloat(21,28),n=10*e.readFloat(29,36),r=10*e.readFloat(37,45);if(Number.isNaN(t)||Number.isNaN(n)||Number.isNaN(r))this._complex.error={message:'Atom position is invalid in "'.concat(e.readLine(),'"')};else{var i=Zy.getByName(this._atomName[0]);if("Unknown"!==i.fullName){var o=Zy.Role[this._atomName],a=this._chain;a||(this._chain=a=this._complex.addChain("A"));var s=this._residue;s&&s.getSequence()===this._residueNumber||(this._residue=s=a.addResidue(this._residueName,this._residueNumber," ")),this._atomPosition=new E(t,n,r),s.addAtom(this._atomName,i,this._atomPosition,o,!0,this._atomNumber," ",1,1,0)}else this._complex.error={message:"".concat(this._atomName[0]," hasn't been recognised as an atom name.")}}}},{key:"_finalize",value:function(){var e=new $y(this._complex,this._complex.metadata.name,1);e._residues=this._chain._residues,e._chains=this._chain,this._complex._molecules[0]=e,this._molecules.push(e),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}},{key:"parseSync",value:function(){var e=this._complex=new Xy,t=new Yy(this._data),n=0;for(this._parseTitle(t),t.next(),this._parseNumberOfAtoms(t),t.next(),n=0;n<this._numAtoms&&!t.end();++n)this._parseAtom(t),t.next();if(n<this._numAtoms&&(this._complex.error={message:"File ended unexpectedly."}),e.error)throw new Error(e.error.message);return this._finalize(),this._atomPosition=null,this._complex=null,this._molecules=null,this._molecule=null,e}}]),t}(yg);Ky.formats=["gro"],Ky.extensions=[".gro"];var Jy=Qd.Complex,Qy=Qd.Element,e_=Qd.Bond,t_=Qd.Molecule,n_={un:0,1:1,2:2,3:3,ar:1,am:1,nc:0,du:1},r_={un:e_.BondType.UNKNOWN,1:e_.BondType.COVALENT,2:e_.BondType.COVALENT,3:e_.BondType.COVALENT,ar:e_.BondType.AROMATIC,am:e_.BondType.COVALENT,nc:e_.BondType.UNKNOWN,du:e_.BondType.COVALENT},i_=/\d+$/,o_=/\s+/;function a_(e){return e.trim().split(o_)}var s_=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._complex=null,r._chain=null,r._residue=null,r._compoundIndx=-1,r._molecules=[],r._molecule=null,r._currPosIdx=0,r._currStartIdx=0,r._serialAtomMap={},r._options.fileType="mol2",r}return m(t,e),Tc(t,[{key:"_parseRawStrings",value:function(e){return e.split(/\r?\n|\r/)}},{key:"_toStringFromStart",value:function(e,t){var n=this._currStartIdx+e;this._currPosIdx=n<t.length?n:this._currStartIdx}},{key:"_toHeaderString",value:function(e,t){for(this._toStringFromStart(0,t);this._currPosIdx<t.length;){if(t[this._currPosIdx].match("@<TRIPOS>".concat(e)))return;this._currPosIdx++}this._toStringFromStart(0,t)}},{key:"_toStringFromHeader",value:function(e,t,n){this._toHeaderString(e,n);var r=this._currPosIdx+t;n[this._currPosIdx].match("@<TRIPOS>".concat(e))&&r<n.length&&(this._currPosIdx=r)}},{key:"_setStart",value:function(e,t){e>=t.length?this._currStartIdx=this._currPosIdx=t.length-1:this._currStartIdx=this._currPosIdx=e}},{key:"_probablyHaveDataToParse",value:function(e){return this._currPosIdx<e.length-2}},{key:"_findNextCompoundStart",value:function(e){for(;this._currPosIdx<e.length&&"@<TRIPOS>MOLECULE>"!==e[this._currPosIdx].trim();)this._currPosIdx++;return this._setStart(++this._currPosIdx,e),this._probablyHaveDataToParse(e)}},{key:"_parseMolecule",value:function(e){this._toHeaderString("MOLECULE",e);var t=this._complex.metadata;t.name=e[++this._currPosIdx],t.format="mol2",this._molecule={_index:"",_chains:[]},this._molecule._index=this._compoundIndx+1,this._molecules.push(this._molecule)}},{key:"_parseAtoms",value:function(e,t){this._toHeaderString("ATOM",t);for(var n=0;n<e;n++){var r=a_(t[++this._currPosIdx]);if(r.length<6)throw new Error("MOL2 parsing error: Not enough information to create atom!");var i=parseInt(r[0],10),o=r[1],a=parseFloat(r[2]),s=parseFloat(r[3]),l=parseFloat(r[4]),u=r[5].split(".")[0].toUpperCase(),c=0;r.length>=9&&(c=parseFloat(r[8])||0);var h=this._chain;if(h||(this._chain=h=this._complex.getChain("A")||this._complex.addChain("A"),this._residue=null),this._setResidue(r)){var d=Qy.getByName(u),f=Qy.Role[o],p=new E(a,s,l);this._residue.addAtom(o,d,p,f,!1,i," ",1,0,c)}}}},{key:"_setResidue",value:function(e){var t=1,n="UNK";if(e.length>=7&&(t=parseInt(e[6],10)),e.length>=8&&"<0>"!==e[7]&&(n=e[7].replace(i_,"")),this.settings.now.nowater&&("HOH"===n||"WAT"===n))return!1;var r=this._residue,i=this._chain;return r&&r.getSequence()===t||(this._residue=i.addResidue(n,t,"A")),!0}},{key:"_parseBonds",value:function(e,t){this._toHeaderString("BOND",t);for(var n=0;n<e;n++){var r=a_(t[++this._currPosIdx]);if(r.length<3)throw new Error("MOL2 parsing error: Missing information about bonds!");var i=parseInt(r[1],10),o=parseInt(r[2],10),a=r[3];if(i>o){var s=[o,i];i=s[0],o=s[1]}this._complex.addBond(i,o,n_[a]||0,r_[a]||e_.BondType.UNKNOWN,!0)}}},{key:"_fixSerialAtoms",value:function(){for(var e=this._complex._atoms,t=0;t<e.length;t++){var n=e[t];this._serialAtomMap[n._serial]=n}}},{key:"_fixBondsArray",value:function(){var e=this._serialAtomMap,t=this._complex;if(0===Object.keys(e).length)throw new Error("MOL2 parsing error: Missing atom information!");for(var n=t._bonds,r=0;r<n.length;r++){var i=n[r];i._left=e[i._left]||null,i._right=e[i._right]||null}}},{key:"_finalizeMolecules",value:function(){var e=this._complex._chains[0];this._complex._molecules=[];for(var t=0;t<this._molecules.length;t++){var n=this._molecules[t],r=e._residues,i=new t_(this._complex,n._name,t+1);i._residues=r,this._complex._molecules[t]=i}}},{key:"_finalize",value:function(){this._complex._finalizeBonds(),this._fixSerialAtoms(),this._fixBondsArray(),this._finalizeMolecules(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}},{key:"_parseCompound",value:function(e){this._compoundIndx++,this._parseMolecule(e),this._toStringFromHeader("MOLECULE",2,e);var t=e[this._currPosIdx].trim().split(o_),n=t[0],r=t[1];this._parseAtoms(n,e),this._parseBonds(r,e)}},{key:"parseSync",value:function(){var e=this._complex=new Jy,t=this._parseRawStrings(this._data);do{this._parseCompound(t)}while(this._findNextCompoundStart(t));return this._finalize(),e}}]),t}(yg);s_.formats=["mol2"],s_.extensions=[".mol2",".ml2",".sy2"];var l_=new gg([Lg,_y,ny,Cy,Ug,Py,jy,Sy,qy,Ky,s_]),u_=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return h(this,t),d(this,f(t).call(this,e,["formats"]))}return m(t,e),Tc(t,[{key:"find",value:function(e){var t=[];return e.format&&(t=this._dict.formats[e.format.toLowerCase()]||[]),Mf(t)}}]),t}(Af),c_=function(){function e(t,n){h(this,e),this._source=t,this._options=n||{},this._abort=!1}return Tc(e,[{key:"exportSync",value:function(){throw new Error("Exporting to this source is not implemented")}},{key:"export",value:function(){var e=this;return new Promise((function(t,n){setTimeout((function(){try{return e._abort?n(new Error("Export aborted")):t(e.exportSync())}catch(e){return n(e)}}))}))}},{key:"abort",value:function(){this._abort=!0}}]),e}();Rf(c_.prototype);var h_=function(){function e(){h(this,e),this._resultArray=[],this._currentStr=-1,this._tag=null,this._fixedNumeration=!1,this._numeration=!1,this._tagStrNum=0}return Tc(e,[{key:"getResult",value:function(){return this.writeString("\n",81,81),this._resultArray.join("")}},{key:"_currentStrLength",value:function(){var e=this._resultArray[this._currentStr];return e?e.length:0}},{key:"newTag",value:function(e,t){this._tag=e||null,s.isUndefined(t)?(this._numeration=!1,this._fixedNumeration=!1,this._tagStrNum=0):s.isNumber(t)?(this._tagStrNum=t,this._numeration=!0,this._fixedNumeration=!0):s.isBoolean(t)&&(this._tagStrNum=0,this._numeration=t,this._fixedNumeration=!1)}},{key:"newString",value:function(e){this.writeString("\n",81,81),this._currentStr++,this._resultArray.push(""),e?this.writeString(e,1,6):this._tag&&this.writeString(this._tag,1,6),this._numeration&&(this._fixedNumeration||this._tagStrNum++,1!==this._tagStrNum&&this.writeString(this._tagStrNum.toString(),10,8))}},{key:"writeEntireString",value:function(e,t,n){t||(t=81);for(var r=0;r<e.length;r++)this._currentStrLength()===t&&r!==e.length-1&&(this.newString(),n&&this.writeString(n.tag,n.begin,n.end)),"\n"===e[r]?this.newString():this.writeString(e[r])}},{key:"writeString",value:function(e,t,n){var r,i=this._resultArray[this._currentStr],o=i?i.length:0;if(!s.isUndefined(e)){s.isNumber(t)||(t=o+1),s.isNumber(n)||(n=o+e.length);var a=t<n?n:t,l=t<n?t:n;if((r=s.isString(e)?e:e.toString()).length>Math.abs(t-n)+1&&(r=r.substr(0,Math.abs(t-n+1))),l>o+1)this._resultArray[this._currentStr]+=" ".repeat(l-o-1);else if(l<=o){var u=this._resultArray[this._currentStr];this._resultArray[this._currentStr]=u.slice(0,l-1)}n<t&&(r=" ".repeat(t-n+1-r.length)+r),11===l&&this._numeration&&1!==this._tagStrNum&&(r=" ".concat(r)),this._resultArray[this._currentStr]+=r,a>(i=this._resultArray[this._currentStr]).length&&(this._resultArray[this._currentStr]+=" ".repeat(a-i.length))}}},{key:"writeBondsArray",value:function(e,t){for(var n=this._getSubArrays(e,4),r=0;r<n.length;r++){this.newString(),this.writeString(t._serial,11,7);for(var i=0;i<n[r].length;i++){var o=n[r][i]._left._serial===t._serial?n[r][i]._right._serial:n[r][i]._left._serial;this.writeString(o,16+5*i,12+5*i)}}}},{key:"_getSubArrays",value:function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}},{key:"writeMatrix",value:function(e,t,n){for(var r=0;r<3;r++){this.newString(),this.writeString(n,14,18),this.writeString((r+1).toString(),19,19),this.writeString(t.toString(),23,20);for(var i=0;i<3;i++){var o=parseFloat(e.elements[4*r+i]).toFixed(6);this.writeString(o.toString(),33+10*i,24+10*i)}var a=parseFloat(e.elements[4*r+3]).toFixed(5);this.writeString(a.toString(),68,55)}}},{key:"writeMatrices",value:function(e,t){if(e)for(var n=new V,r=0;r<e.length;r++)n.copy(e[r]).transpose(),this.writeMatrix(n,r+1,t)}}]),e}(),d_=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._tags=["HEADER","TITLE","COMPND","REMARK","HELIX","SHEET","ATOM and HETATM","CONECT"],r._result=null,r._tagExtractors={HEADER:r._extractHEADER,TITLE:r._extractTITLE,"ATOM and HETATM":r._extractATOM,CONECT:r._extractCONECT,COMPND:r._extractCOMPND,REMARK:r._extractREMARK,HELIX:r._extractHELIX,SHEET:r._extractSHEET},r._stringForRemark350="COORDINATES FOR A COMPLETE MULTIMER REPRESENTING THE KNOWN\nBIOLOGICALLY SIGNIFICANT OLIGOMERIZATION STATE OF THE\nMOLECULE CAN BE GENERATED BY APPLYING BIOMT TRANSFORMATIONS\nGIVEN BELOW.  BOTH NON-CRYSTALLOGRAPHIC AND\nCRYSTALLOGRAPHIC OPERATIONS ARE GIVEN.",r._stringForRemark290="CRYSTALLOGRAPHIC SYMMETRY TRANSFORMATIONS\nTHE FOLLOWING TRANSFORMATIONS OPERATE ON THE ATOM/HETATM\nRECORDS IN THIS ENTRY TO PRODUCE CRYSTALLOGRAPHICALLY\nRELATED MOLECULES.",r}return m(t,e),Tc(t,[{key:"exportSync",value:function(){var e=new h_;if(!this._source)return this._result;for(var t=0;t<this._tags.length;t++){var n=this._tags[t],r=this._tagExtractors[n];s.isFunction(r)&&r.call(this,e)}return this._result=e.getResult(),this._result}},{key:"_extractHEADER",value:function(e){if(this._source.metadata){var t=this._source.metadata;e.newTag("HEADER"),e.newString(),t.classification&&e.writeString(t.classification,11,50),t.date&&e.writeString(t.date,51,59),t.id&&e.writeString(t.id,63,66)}}},{key:"_extractTITLE",value:function(e){if(this._source.metadata){var t=this._source.metadata;if(t.title){e.newTag("TITLE",!0);for(var n=0;n<t.title.length;n++)e.newString(),e.writeString(t.title[n],11,80)}}}},{key:"_extractCONECT",value:function(e){if(this._source._atoms){var t=this._source._atoms;e.newTag("CONECT");for(var n=0;n<t.length;n++){var r=t[n]._bonds.filter((function(e){return e._fixed}));0!==r.length&&e.writeBondsArray(r.reverse(),t[n])}}}},{key:"_extractSHEET",value:function(e){if(this._source._sheets){e.newTag("SHEET");for(var t=this._source._sheets,n=0;n<t.length;n++)if(t[n]._strands)for(var r=t[n]._strands,i=0;i<r.length;i++)e.newString(),e.writeString(i+1,10,8),e.writeString(t[n]._name,14,12),e.writeString(r.length,16,15),e.writeString(r[i].init._type._name,18,20),e.writeString(r[i].init._chain._name,22,22),e.writeString(r[i].init._sequence,26,23),e.writeString(r[i].init._icode,27,27),e.writeString(r[i].term._type._name,29,31),e.writeString(r[i].init._chain._name,33,33),e.writeString(r[i].term._sequence,37,34),e.writeString(r[i].term._icode,38,38),e.writeString(r[i].sense,40,39)}}},{key:"_extractHELIX",value:function(e){if(this._source._helices){e.newTag("HELIX");for(var t=this._source._helices,n=0;n<t.length;n++){var r=t[n],i=s.invert(Gh);e.newString(),e.writeString(r.serial,10,8),e.writeString(r.name,14,12),e.writeString(r.init._type._name,16,18),e.writeString(r.init._chain._name,20,20),e.writeString(r.init._sequence,25,22),e.writeString(r.init._icode,26,26),e.writeString(r.term._type._name,28,30),e.writeString(r.term._chain._name,32,32),e.writeString(r.term._sequence,37,34),e.writeString(r.term._icode,38,38),e.writeString(i[r.type],40,39),e.writeString(r.comment,41,70),e.writeString(r.length,76,72)}}}},{key:"_extractATOM",value:function(e){if(this._source._atoms)for(var t=this._source._atoms,n=0;n<t.length;n++){var r=t[n]._het?"HETATM":"ATOM";e.newString(r);var i=t[n].element.name.length>1||t[n]._name._name.length>3?13:14;e.writeString(t[n]._serial,11,7),e.writeString(t[n]._name._name,i,16),e.writeString(String.fromCharCode(t[n]._location),17,17),e.writeString(t[n]._residue._type._name,20,18),e.writeString(t[n]._residue._chain._name,22,22),e.writeString(t[n]._residue._sequence,26,23),e.writeString(t[n]._residue._icode,27,27),e.writeString(t[n]._position.x.toFixed(3),38,31),e.writeString(t[n]._position.y.toFixed(3),46,39),e.writeString(t[n]._position.z.toFixed(3),54,47),e.writeString(t[n]._occupancy.toFixed(2),60,55),e.writeString(t[n]._temperature.toFixed(2),66,61),e.writeString(t[n].element.name,78,77),t[n]._charge&&e.writeString(t[n]._charge,79,80)}}},{key:"_extractCOMPND",value:function(e){if(this._source._molecules){var t=this._source._molecules;e.newTag("COMPND",!0);for(var n=0;n<t.length;n++){var r=this._getMoleculeChains(t[n]);e.newString(),e.writeString("MOL_ID: ".concat(t[n]._index,";"),11,80),e.newString(),e.writeString("MOLECULE: ".concat(t[n]._name,";"),11,80),e.newString(),e.writeString("CHAIN: ",11,18);var i="".concat(r.join(", "),";");e.writeEntireString(i,81)}}}},{key:"_extractREMARK",value:function(e){this._Remark290(e),this._Remark350(e)}},{key:"_Remark290",value:function(e){if(this._source.symmetry&&0!==this._source.symmetry.length){var t=this._source.symmetry;e.newTag("REMARK",290),e.newString(),e.newString(),e.writeEntireString(this._stringForRemark290),e.writeMatrices(t,"SMTRY"),e.newString(),e.newString(),e.writeString("REMARK: NULL",11,80)}}},{key:"_Remark350",value:function(e){if(this._source.units){var t=this._source.units,n=0;e.newTag("REMARK",350),e.newString(),e.newString(),e.writeEntireString(this._stringForRemark350);for(var r=t.filter((function(e){return e instanceof vd})),i=0;i<r.length;i++){e.newString(),e.newString(),n++,e.writeString("BIOMOLECULE: ".concat(n),11,80);var o=r[i].chains.join(", ");e.newString(),e.writeString("APPLY THE FOLLOWING TO CHAINS: "),e.writeEntireString(o,69,{tag:"AND CHAINS: ",begin:31,end:42});var a=r[i].matrices;e.writeMatrices(a,"BIOMT")}}}},{key:"_getMoleculeChains",value:function(e){var t=e._residues.map((function(e){return e._chain._name}));return t.filter((function(e,n){return t.indexOf(e)===n}))}}]),t}(c_);function f_(e,t,n,r){n[r]=e[t],n[r+1]=e[t+1],n[r+2]=e[t+2]}function p_(e,t,n,r,i){n[r]=e[t],n[r+1]=e[t+1],n[r+2]=e[t+2],n[r+3]=i}d_.formats=["pdb"],d_.SourceClass=$d;var m_=new k;function v_(e,t,n,r,i){m_.set(e[t],e[t+1],e[t+2],i.w),m_.applyMatrix4(i.matrix),n[r]=m_.x,n[r+1]=m_.y,n[r+2]=m_.z}function g_(e,t,n,r,i){if(!((t.array.length-t.start)/t.stride<n||(e.array.length-e.start)/e.stride<n))if(e.stride===t.stride)t.array.set(e.array,t.start);else for(var o=t.start,a=e.start,s=0;s<n;++s,o+=t.stride,a+=e.stride)r(e.array,a,t.array,o,i)}var y_=function(){function e(){h(this,e),this.positions=null,this.normals=null,this.colors=null,this.indices=null,this.lastPos=0,this.lastNorm=0,this.lastCol=0,this.lastIdx=0}return Tc(e,[{key:"init",value:function(e,t){this.positions=new Float32Array(3*e),this.normals=new Float32Array(3*e),this.colors=new Float32Array(4*e),this.indices=new Int32Array(t)}},{key:"setPositions",value:function(e,t,n,r){g_({array:e,start:t,stride:r},{array:this.positions,start:this.lastPos,stride:3},n,f_),this.lastPos+=3*n}},{key:"setTransformedPositions",value:function(e,t,n,r,i){for(var o=this.lastPos,a=t,s={matrix:i,w:1},l=0;l<n;++l,a+=r,o+=3)v_(e,a,this.positions,o,s);this.lastPos+=3*n}},{key:"setNormals",value:function(e,t,n,r){g_({array:e,start:t,stride:r},{array:this.normals,start:this.lastNorm,stride:3},n,f_),this.lastNorm+=3*n}},{key:"setTransformedNormals",value:function(e,t,n,r,i){for(var o=this.lastNorm,a=t,s={matrix:i,w:0},l=0;l<n;++l,a+=r,o+=3)v_(e,a,this.normals,o,s);this.lastNorm+=3*n}},{key:"setColors",value:function(e,t,n,r){g_({array:e,start:t,stride:r},{array:this.colors,start:this.lastCol,stride:4},n,p_,1),this.lastCol+=4*n}},{key:"setIndices",value:function(e,t,n){this.indices.set(e,this.lastIdx),this.lastIdx+=n}},{key:"setShiftedIndices",value:function(e,t,n){var r=e.map((function(e){return e+n}));this.setIndices(r,0,t)}},{key:"getVerticesNumber",value:function(){return this.lastPos/3}},{key:"addInstance",value:function(e,t){var n=this.getVerticesNumber();this.setShiftedIndices(t.indices,t.indices.length,n);var r=t.itemSize;this.setTransformedPositions(t.positions,0,t.vertsCount,r.position,e),this.setTransformedNormals(t.normals,0,t.vertsCount,r.normal,e),this.setColors(t.colors,0,t.vertsCount,r.color)}}]),e}(),__=function(){function e(){h(this,e),this.positions=null,this.normals=null,this.colors=null,this.indices=null,this.vertsCount=0,this.itemSize=null}return Tc(e,[{key:"init",value:function(e,t){var n=e.attributes;this.itemSize={position:n.position.itemSize,normal:n.normal.itemSize,color:n.color.itemSize}}}]),e}(),x_=function(e){function t(){return h(this,t),d(this,f(t).apply(this,arguments))}return m(t,e),Tc(t,[{key:"init",value:function(e,n){Hh(f(t.prototype),"init",this).call(this,e,n);var r=e.attributes,i=r.position,o=r.normal,a=e.index;this.vertsCount=i.count,this.positions=i.array,this.normals=o.array,this.colors=new Float32Array(this.vertsCount*this.itemSize.color),this.indices=a.array}},{key:"setColors",value:function(e){for(var t=0,n=0,r=this.colors.length,i=this.itemSize.color;n<r;n+=i)this.colors[t++]=e.r,this.colors[t++]=e.g,this.colors[t++]=e.b}}]),t}(__),b_=function(e){function t(){var e;return h(this,t),(e=d(this,f(t).call(this)))._cutRawStart=0,e._cutRawEnd=0,e._facesPerSlice=0,e}return m(t,e),Tc(t,[{key:"init",value:function(e,n){Hh(f(t.prototype),"init",this).call(this,e,n);var r=e.attributes.position,i=e.index;this.vertsCount=r.count+n.addPerCylinder,this._facesPerSlice=n.addPerCylinder,this.positions=new Float32Array(this.vertsCount*r.itemSize),this.normals=new Float32Array(this.vertsCount*this.itemSize.normal),this.colors=new Float32Array(this.vertsCount*this.itemSize.color),this._extendVertices(e,n),this.indices=new Uint32Array(i.count),this._extendIndices(e,n)}},{key:"_extendVertices",value:function(e,t){var n=e.attributes.position,r=e.attributes.normal,i=e.getGeoParams();this._cutRawStart=1*i.radialSegments,this._cutRawEnd=this._cutRawStart+t.addPerCylinder;var o=n.array.slice(0,this._cutRawEnd*n.itemSize);this.positions.set(o,0),o=r.array.slice(0,this._cutRawEnd*r.itemSize),this.normals.set(o,0);var a=n.array.slice(this._cutRawStart*n.itemSize,n.array.length);this.positions.set(a,this._cutRawEnd*n.itemSize),a=r.array.slice(this._cutRawStart*r.itemSize,r.array.length),this.normals.set(a,this._cutRawEnd*r.itemSize)}},{key:"_extendIndices",value:function(e,t){var n=e.index,r=6*t.addPerCylinder,i=t.addPerCylinder,o=n.array.slice(r,n.count);o=o.map((function(e){return e+i})),this.indices.set(n.array,0),this.indices.set(o,r)}},{key:"_setColorRange",value:function(e,t,n,r){for(var i=r.length,o=e;o<t;o+=i)n.set(r,o)}},{key:"setColors",value:function(e,t){var n=this.itemSize.color,r=this._cutRawEnd*n,i=2*r;if(this._setColorRange(0,r,this.colors,e.toArray()),this._setColorRange(r,i,this.colors,t.toArray()),i<this.colors.length){var o=(this._facesPerSlice+1)*n,a=i+o;this._setColorRange(i,a,this.colors,t.toArray());var s=a+o;this._setColorRange(a,s,this.colors,e.toArray())}}}]),t}(__),w_=function(){function e(){h(this,e),this._materials=[],this._models=[]}return Tc(e,[{key:"process",value:function(e){this._extractModelsAndMaterials(e);var t=this._flattenModels();return{name:e.name,models:t,materials:this._materials}}},{key:"_extractModelsAndMaterials",value:function(e){var t=this,n=new W;n.set(Sf.LAYERS.DEFAULT),n.enable(Sf.LAYERS.TRANSPARENT),e.traverse((function(e){e instanceof Gt&&e.layers.test(n)&&t.checkExportAbility(e)&&("InstancedBufferGeometry"===e.geometry.type?t._collectInstancedGeoInfo(e):t._collectGeoInfo(e))}))}},{key:"_reworkIndices",value:function(e){for(var t=2;t<e.length;t+=3)e[t]*=-1,e[t]--}},{key:"_flattenModels",value:function(){var e=0;function t(t){return t+e}for(var n=[],r=0,i=this._models.length;r<i;r++){var o=this._models[r],a=[],s=[],l=[],u=[];e=0;for(var c=0;c<o.length;c++){var h=o[c];a.push(h.indices.map(t)),e+=h.getVerticesNumber(),s.push(h.positions),l.push(h.normals),u.push(h.colors)}a=$c.mergeTypedArraysUnsafe(a),this._reworkIndices(a),s=$c.mergeTypedArraysUnsafe(s),l=$c.mergeTypedArraysUnsafe(l),u=$c.mergeTypedArraysUnsafe(u),n.push({indices:a,positions:s,normals:l,colors:u,verticesCount:e})}return n}},{key:"checkExportAbility",value:function(e){return!(0===e.geometry.attributes.position.count||(e instanceof Hp?(zc.warn("Currently we cannot export 'sprites' modes, like BS, WV, LC. Please turn of settings 'zSprites' and try again"),1):e instanceof Jp&&(zc.warn("Currently we cannot export Lines mode"),1)))}},{key:"_collectGeoInfo",value:function(e){var t=e.geometry,n=t.attributes,r=n.position,i=n.color,o=n.normal,a=t.index,s=e.matrix,l=new y_,u=r.count;l.init(u,a.count),s.isIdentity()?(l.setPositions(r.array,0,u,r.itemSize),l.setNormals(o.array,0,u,o.itemSize)):(l.setTransformedPositions(r.array,0,u,r.itemSize,s),l.setTransformedNormals(o.array,0,u,o.itemSize,s)),l.setColors(i.array,0,u,i.itemSize),l.setIndices(a.array,0,a.count);var c=this._collectMaterialInfo(e);this._addToPool(l,c)}},{key:"_collectSpheresInfo",value:function(e){var t=e.geometry,n=t.attributes,r=n.position,i=n.color,o=t.index,a=e.matrix,s=new y_,l=e.geometry.maxInstancedCount,u=r.count,c=o.count;s.init(l*u,l*c);var h=new x_;h.init(e.geometry);for(var d=new V,f=new V,p=new $e,m=0;m<l;++m){var v=m*i.itemSize;p.fromArray(i.array,v),h.setColors(p),this._getSphereInstanceMatrix(e.geometry,m,d),f.multiplyMatrices(a,d),s.addInstance(f,h)}var g=this._collectMaterialInfo(e);this._addToPool(s,g)}},{key:"_collectCylindersInfo",value:function(e){var t=e.geometry,n=t.attributes,r=n.position,i=n.color,o=n.color2,a=t.index,s=e.matrix,l=new y_,u=e.geometry.maxInstancedCount,c=new x_;c.init(e.geometry);var h=this._gatherCylindersColoringInfo(e.geometry),d=null;h.needToSplit>0&&(d=new b_).init(e.geometry,h);var f=h.addPerCylinder*h.needToSplit,p=r.count,m=a.count;l.init(u*p+f,u*m);for(var v=new V,g=new V,y=new $e,_=new $e,x={},b=0;b<u;++b){var w=b*i.itemSize;h.is2Colored[b]?(y.fromArray(o.array,w),_.fromArray(i.array,w),d&&(d.setColors(y,_),x=d)):(y.fromArray(i.array,w),c.setColors(y),x=c),this._getCylinderInstanceMatrix(e.geometry,b,v),g.multiplyMatrices(s,v),l.addInstance(g,x)}var S=this._collectMaterialInfo(e);this._addToPool(l,S)}},{key:"_addToPool",value:function(e,t){var n=this._checkExistingMaterial(t);n<0?(this._models.push([e]),this._materials.push(t)):this._models[n].push(e)}},{key:"_checkExistingMaterial",value:function(e){return s.findIndex(this._materials,(function(t){return s.isEqual(t,e)}))}},{key:"_gatherCylindersColoringInfo",value:function(e){for(var t=e.maxInstancedCount,n=e.attributes.color.array,r=e.attributes.color2.array,i=e.attributes.color.itemSize,o=new Array(t),a=0,s=0,l=0;l<t;l++,s+=i){var u=Math.abs(n[s]-r[s])>1e-7||Math.abs(n[s+1]-r[s+1])>1e-7||Math.abs(n[s+2]-r[s+2])>1e-7;o[l]=u,a+=u}return{is2Colored:o,needToSplit:a,addPerCylinder:e.getGeoParams().radialSegments}}},{key:"_collectInstancedGeoInfo",value:function(e){e.geometry instanceof If?this._collectSpheresInfo(e):e.geometry instanceof $f&&this._collectCylindersInfo(e)}},{key:"_collectMaterialInfo",value:function(e){var t=e.material.uberOptions;return{diffuse:t.diffuse.toArray(),opacity:t.opacity,shininess:t.shininess,specular:t.specular.toArray()}}},{key:"_getCylinderInstanceMatrix",value:function(e,t,n){var r=e.attributes.matVector1.array,i=e.attributes.matVector2.array,o=e.attributes.matVector3.array,a=4*t;n.set(r[a],r[a+1],r[a+2],r[a+3],i[a],i[a+1],i[a+2],i[a+3],o[a],o[a+1],o[a+2],o[a+3],0,0,0,1)}},{key:"_getSphereInstanceMatrix",value:function(e,t,n){var r=e.attributes.offset,i=t*r.itemSize,o=r.array[i],a=r.array[i+1],s=r.array[i+2],l=r.array[i+3];n.set(l,0,0,o,0,l,0,a,0,0,l,s,0,0,0,1)}}]),e}(),S_=function(){function e(){h(this,e),this._resultArray=[],this._info=null}return Tc(e,[{key:"getResult",value:function(e){return this._info=e,this._resultArray.push(this._writeHeader()),this._resultArray.push(this._writeDefinitions()),this._resultArray.push(this._writeObjects(e.models,e.materials)),this._resultArray.push(this._writeRelations()),this._resultArray.push(this._writeConnections()),this._info=null,this._resultArray.join("")}},{key:"_writeHeader",value:function(){var e=new Date,t="Miew FBX Exporter v".concat(this._info.version);return"; FBX 6.1.0 project file\n; Created by ".concat(t," Copyright (c) 2015-2020 EPAM Systems, Inc.\n; For support please contact miew@epam.com\n; ----------------------------------------------------\n\nFBXHeaderExtension:  {\n  FBXHeaderVersion: ").concat(1003,"\n  FBXVersion: ").concat(6100,"\n  CreationTimeStamp:  {\n    Version: ").concat(1e3,"\n    Year: ").concat(e.getFullYear(),"\n    Month: ").concat(e.getMonth()+1," \n    Day: ").concat(e.getDate(),"\n    Hour: ").concat(e.getHours(),"\n    Minute: ").concat(e.getMinutes(),"\n    Second: ").concat(e.getSeconds(),"\n    Millisecond: ").concat(e.getMilliseconds(),'\n  }\n  Creator: "').concat(t,'"\n  OtherFlags:  {\n    FlagPLE: 0\n  }\n}\nCreationTime: "').concat(e,'"\nCreator: "').concat(t,'"  \n')}},{key:"_writeDefinitions",value:function(){return"\n; Object definitions\n;------------------------------------------------------------------\n\n".concat('\nDefinitions:  {\n  Version: 100\n  Count: 3\n  ObjectType: "Model" {\n    Count: 1\n  }\n  ObjectType: "Geometry" {\n    Count: 1\n  }\n  ObjectType: "Material" {\n    Count: 1\n  }\n  ObjectType: "Pose" {\n    Count: 1\n  }\n  ObjectType: "GlobalSettings" {\n    Count: 1\n  }\n} ',"\n")}},{key:"_models",value:function(){for(var e="",t=this._info.models,n=0;n<t.length;++n){var r=t[n],i=r.verticesCount;e+='\n  Model: "Model::'.concat(this._info.name,"_").concat(n,'", "Mesh" {\n    Version: ').concat(232," \n    ").concat('Properties60: {\n      Property: "QuaternionInterpolate", "bool", "",0\n      Property: "Visibility", "Visibility", "A",1\n      Property: "Lcl Translation", "Lcl Translation", "A",0.000000000000000,0.000000000000000,-1789.238037109375000\n      Property: "Lcl Rotation", "Lcl Rotation", "A",0.000009334667643,-0.000000000000000,0.000000000000000\n      Property: "Lcl Scaling", "Lcl Scaling", "A",1.000000000000000,1.000000000000000,1.000000000000000\n      Property: "RotationOffset", "Vector3D", "",0,0,0\n      Property: "RotationPivot", "Vector3D", "",0,0,0\n      Property: "ScalingOffset", "Vector3D", "",0,0,0\n      Property: "ScalingPivot", "Vector3D", "",0,0,0\n      Property: "TranslationActive", "bool", "",0\n      Property: "TranslationMin", "Vector3D", "",0,0,0\n      Property: "TranslationMax", "Vector3D", "",0,0,0\n      Property: "TranslationMinX", "bool", "",0\n      Property: "TranslationMinY", "bool", "",0\n      Property: "TranslationMinZ", "bool", "",0\n      Property: "TranslationMaxX", "bool", "",0\n      Property: "TranslationMaxY", "bool", "",0\n      Property: "TranslationMaxZ", "bool", "",0\n      Property: "RotationOrder", "enum", "",0\n      Property: "RotationSpaceForLimitOnly", "bool", "",0\n      Property: "AxisLen", "double", "",10\n      Property: "PreRotation", "Vector3D", "",0,0,0\n      Property: "PostRotation", "Vector3D", "",0,0,0\n      Property: "RotationActive", "bool", "",0\n      Property: "RotationMin", "Vector3D", "",0,0,0\n      Property: "RotationMax", "Vector3D", "",0,0,0\n      Property: "RotationMinX", "bool", "",0\n      Property: "RotationMinY", "bool", "",0\n      Property: "RotationMinZ", "bool", "",0\n      Property: "RotationMaxX", "bool", "",0\n      Property: "RotationMaxY", "bool", "",0\n      Property: "RotationMaxZ", "bool", "",0\n      Property: "RotationStiffnessX", "double", "",0\n      Property: "RotationStiffnessY", "double", "",0\n      Property: "RotationStiffnessZ", "double", "",0\n      Property: "MinDampRangeX", "double", "",0\n      Property: "MinDampRangeY", "double", "",0\n      Property: "MinDampRangeZ", "double", "",0\n      Property: "MaxDampRangeX", "double", "",0\n      Property: "MaxDampRangeY", "double", "",0\n      Property: "MaxDampRangeZ", "double", "",0\n      Property: "MinDampStrengthX", "double", "",0\n      Property: "MinDampStrengthY", "double", "",0\n      Property: "MinDampStrengthZ", "double", "",0\n      Property: "MaxDampStrengthX", "double", "",0\n      Property: "MaxDampStrengthY", "double", "",0\n      Property: "MaxDampStrengthZ", "double", "",0\n      Property: "PreferedAngleX", "double", "",0\n      Property: "PreferedAngleY", "double", "",0\n      Property: "PreferedAngleZ", "double", "",0\n      Property: "InheritType", "enum", "",0\n      Property: "ScalingActive", "bool", "",0\n      Property: "ScalingMin", "Vector3D", "",1,1,1\n      Property: "ScalingMax", "Vector3D", "",1,1,1\n      Property: "ScalingMinX", "bool", "",0\n      Property: "ScalingMinY", "bool", "",0\n      Property: "ScalingMinZ", "bool", "",0\n      Property: "ScalingMaxX", "bool", "",0\n      Property: "ScalingMaxY", "bool", "",0\n      Property: "ScalingMaxZ", "bool", "",0\n      Property: "GeometricTranslation", "Vector3D", "",0,0,0\n      Property: "GeometricRotation", "Vector3D", "",0,0,0\n      Property: "GeometricScaling", "Vector3D", "",1,1,1\n      Property: "LookAtProperty", "object", ""\n      Property: "UpVectorProperty", "object", ""\n      Property: "Show", "bool", "",1\n      Property: "NegativePercentShapeSupport", "bool", "",1\n      Property: "DefaultAttributeIndex", "int", "",0\n      Property: "Color", "Color", "A+",0,0,0\n      Property: "Size", "double", "",100\n      Property: "Look", "enum", "",1\n    }',"\n    ").concat(this._verticesIndices(r.positions,r.indices),"\n    ").concat(this._normalLayer(r.normals)," \n    ").concat(this._colorLayer(r.colors,i)," \n    ").concat('\n    LayerElementMaterial: 0 {\n      Version: 101\n      Name: ""\n      MappingInformationType: "AllSame"\n      ReferenceInformationType: "Direct"\n      Materials: 0\n    }',"  \n    ").concat('\n    Layer: 0 {\n      Version: 100\n      LayerElement:  {\n        Type: "LayerElementNormal"\n        TypedIndex: 0\n      }\n      LayerElement:  {\n        Type: "LayerElementColor"\n        TypedIndex: 0\n      }\n      LayerElement:  {\n        Type: "LayerElementMaterial"\n        TypedIndex: 0\n      }\n    }',"\n  }")}return e}},{key:"_materials",value:function(){for(var e="",t=this._info.materials,n=0;n<t.length;++n){var r=t[n];e+='\n  Material: "Material::'.concat(this._info.name,"_").concat(n,'_default", "" {\n    Version: ').concat(102,'\n    ShadingModel: "lambert"\n    MultiLayer: 0\n    ').concat(this._materialProperties(r),"\n  }")}return e}},{key:"_writeObjects",value:function(){return"\n; Object properties\n;------------------------------------------------------------------\n\nObjects:  {\n  ".concat(this._models(),"\n  ").concat(this._materials(),"\n  ").concat('GlobalSettings: {\n    Version: 1000\n    Properties60:  {\n      Property: "UpAxis", "int", "",1\n      Property: "UpAxisSign", "int", "",1\n      Property: "FrontAxis", "int", "",2\n      Property: "FrontAxisSign", "int", "",1\n      Property: "CoordAxis", "int", "",0\n      Property: "CoordAxisSign", "int", "",1\n      Property: "UnitScaleFactor", "double", "",1\n    }\n  }',"\n}\n")}},{key:"_writeRelations",value:function(){for(var e="",t=0;t<this._info.models.length;++t)e+='\n  Model: "Model::'.concat(this._info.name,"_").concat(t,'", "Mesh" {\n  }');for(var n="",r=0;r<this._info.materials.length;++r)n+='\n  Material: "Material::'.concat(this._info.name,"_").concat(r,'_default", "" {\n  }');return"\n; Object relations\n;------------------------------------------------------------------\n\nRelations:  {\n  ".concat(e,'\n  Model: "Model::Producer Perspective", "Camera" {\n  }\n  Model: "Model::Producer Top", "Camera" {\n  }\n  Model: "Model::Producer Bottom", "Camera" {\n  }\n  Model: "Model::Producer Front", "Camera" {\n  }\n  Model: "Model::Producer Back", "Camera" {\n  }\n  Model: "Model::Producer Right", "Camera" {\n  }\n  Model: "Model::Producer Left", "Camera" {\n  }\n  Model: "Model::Camera Switcher", "CameraSwitcher" {\n  }\n  ').concat(n,"\n}")}},{key:"_writeConnections",value:function(){for(var e="",t=this._info.name,n=0;n<this._info.models.length;++n)e+='\n  Connect: "OO", "Model::'.concat(t,"_").concat(n,'", "Model::Scene"');for(var r="",i=0;i<this._info.materials.length;++i)r+='\n  Connect: "OO", "Material::'.concat(t,"_").concat(i,'_default", "Model::').concat(t,"_").concat(i,'"');return"\n; Object connections\n;------------------------------------------------------------------\n\nConnections:  {\n  ".concat(e,"\n  ").concat(r,"\n}")}},{key:"_floatArrayToString",value:function(e){for(var t=[],n=0;n<e.length;++n)t[n]=e[n].toFixed(6);return t.join(",")}},{key:"_colorLayer",value:function(e,t){var n=this._floatArrayToString(e),r=Mf(Array(t).keys());return"\n    LayerElementColor: ".concat(0," {\n      Version: ").concat(101,'\n      Name: "').concat("",'"\n      MappingInformationType: "ByVertice"\n      ReferenceInformationType: "Direct"\n      Colors: ').concat(n,"\n      ColorIndex: ").concat(r,"\n    }")}},{key:"_normalLayer",value:function(e){var t=this._floatArrayToString(e);return"\n    LayerElementNormal: ".concat(0," {\n      Version: ").concat(101,'\n      Name: "').concat("",'"\n      MappingInformationType: "ByVertice"\n      ReferenceInformationType: "Direct" \n      Normals: ').concat(t,"\n    }")}},{key:"_verticesIndices",value:function(e,t){var n=this._floatArrayToString(e);return"MultiLayer: ".concat(0,"\n    MultiTake: ").concat(1,"\n    Shading: ").concat("Y",'\n    Culling: "').concat("CullingOff",'"\n    Vertices: ').concat(n,"\n    PolygonVertexIndex: ").concat(t,"\n    GeometryVersion: ").concat(124)}},{key:"_materialProperties",value:function(e){return'Properties60:  {\n      Property: "ShadingModel", "KString", "", "Lambert"\n      Property: "MultiLayer", "bool", "",0\n      Property: "EmissiveColor", "ColorRGB", "",0,0,0\n      Property: "EmissiveFactor", "double", "",0.0000\n      Property: "AmbientColor", "ColorRGB", "",1,1,1\n      Property: "AmbientFactor", "double", "",0.0000\n      Property: "DiffuseColor", "ColorRGB", "",'.concat(e.diffuse,'\n      Property: "DiffuseFactor", "double", "",1.0000\n      Property: "Bump", "Vector3D", "",0,0,0\n      Property: "TransparentColor", "ColorRGB", "",1,1,1\n      Property: "TransparencyFactor", "double", "",0.0000\n      Property: "SpecularColor", "ColorRGB", "",').concat(e.specular,'\n      Property: "SpecularFactor", "double", "",1.0000\n      Property: "ShininessExponent", "double", "",').concat(e.shininess,'\n      Property: "ReflectionColor", "ColorRGB", "",0,0,0\n      Property: "ReflectionFactor", "double", "",1\n      Property: "Ambient", "ColorRGB", "",1,1,1\n      Property: "Diffuse", "ColorRGB", "",').concat(e.diffuse,'\n      Property: "Specular", "ColorRGB", "",').concat(e.specular,'\n      Property: "Shininess", "double", "",').concat(e.shininess,'\n      Property: "Opacity", "double", "",').concat(e.opacity,'\n      Property: "Reflectivity", "double", "",0\n    }')}}]),e}(),E_=function(e){function t(e,n){var r;return h(this,t),(r=d(this,f(t).call(this,e,n)))._data=e,r._version=n.miewVersion||"0.0-UNSPECIFIED",r._extractor=new w_,r}return m(t,e),Tc(t,[{key:"exportSync",value:function(){var e=new S_;if(!this._source)return this._result;var t=this._extractor.process(this._data);return t.version=this._version,this._result=e.getResult(t),this._result}}]),t}(c_);E_.formats=["fbx"],E_.SourceClass=Jv;var T_,M_,C_,A_,R_,P_,k_,L_,N_,I_,O_,D_,z_,F_,B_={loaders:vg,parsers:l_,exporters:new u_([d_,E_])},U_=new $e,V_=function(){function e(){h(this,e),this._width=0,this._height=0,this._widthHalf=0,this._heightHalf=0,this._vector=new E,this._viewMatrix=new V,this._projectionMatrix=new V,this._domElement=document.createElement("div"),this._domElement.style.overflow="hidden",this._domElement.style.position="absolute",this._domElement.style.top="0",this._domElement.style.zIndex="0",this._domElement.style.pointerEvents="none"}return Tc(e,[{key:"getElement",value:function(){return this._domElement}},{key:"reset",value:function(){for(var e=this.getElement();e.firstChild;)e.removeChild(e.firstChild)}},{key:"setSize",value:function(e,t){this._width=e,this._height=t,this._widthHalf=this._width/2,this._heightHalf=this._height/2,this._domElement.style.width="".concat(e,"px"),this._domElement.style.height="".concat(t,"px")}},{key:"_renderObject",value:function(e,t,n){function r(e,t,n){return U_.setHex(e),U_.lerp(t,n),"#".concat(U_.getHexString())}function i(e){return U_.setHex(e),"#".concat(U_.getHexString())}if(e instanceof ef){if(this._vector.setFromMatrixPosition(e.matrixWorld),void 0!==e.userData&&void 0!==e.userData.offset){var o=new E(e.userData.offset.x,e.userData.offset.y,0);this._vector.add(o.multiplyScalar(e.matrixWorld.getMaxScaleOnAxis()))}this._vector.applyMatrix4(this._viewMatrix);var a=this._vector.z>-t.near?"hidden":"visible",s=1e4*(t.far- -this._vector.z)/(t.far-t.near),l=e.getElement();if(void 0===n.fog)l.style.color=i(e.userData.color),"transparent"!==e.userData.background&&(l.style.background=i(e.userData.background));else{var u=_.smoothstep(-this._vector.z,n.fog.near,n.fog.far);l.style.color=r(e.userData.color,n.fog.color,u),"transparent"!==e.userData.background&&(l.style.background=r(e.userData.background,n.fog.color,u))}this._vector.applyMatrix4(this._projectionMatrix);var c="".concat(e.userData!=={}?e.userData.translation:"translate(-50%, -50%) ","translate(").concat(this._vector.x*this._widthHalf+this._widthHalf,"px,").concat(-this._vector.y*this._heightHalf+this._heightHalf,"px)");l.style.visibility=a,l.style.WebkitTransform=c,l.style.MozTransform=c,l.style.oTransform=c,l.style.transform=c,l.style.zIndex=Number(s).toFixed(0),l.parentNode!==this._domElement&&this._domElement.appendChild(l)}for(var h=0,d=e.children.length;h<d;h++)this._renderObject(e.children[h],t,n)}},{key:"render",value:function(e,t){e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),this._viewMatrix.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)),this._projectionMatrix.copy(t.projectionMatrix),this._renderObject(e,t,e)}}]),e}(),G_=new b,j_=new V;function H_(e,t,n,i){this.objects=e;var o=r(e,1);this.object=o[0],this.camera=t,this.pivot=n,this.axis=new E(0,0,1),this.options=i,this.lastRotation={axis:new E,angle:0}}function W_(e,t,n,r,i){Nc.call(this);var o=this;this.object=e,this.objectPivot=t,this.camera=n,this.domElement=void 0!==r?r:document,this.getAltObj=i,this.enabled=!0,this.hotkeysEnabled=!0,this.screen={left:0,top:0,width:0,height:0},this.options={rotateFactor:Math.PI,axisRotateFactor:4*Math.PI,intertia:!0,dynamicDampingFactor:.1,intertiaThreshold:.001},this._state=-1,this._mousePrevPos=new x,this._mouseCurPos=new x,this._mainObj=new H_([this.object],this.camera,new E(0,0,0),this.options),this._altObj=new H_([this.object],this.camera,new E(0,0,0),this.options),this._affectedObj=this._mainObj,this._isAltObjFreeRotationAllowed=!0,this._isTranslationAllowed=!0,this._isKeysTranslatingObj=!1,this._pressedKeys=[],this._clock=new Mc,this._clock.start(),this._lastUpdateTime=this._clock.getElapsedTime(),this._listeners=[{obj:o.domElement,type:"mousedown",handler:function(e){o.mousedown(e)}},{obj:o.domElement,type:"mouseup",handler:function(e){o.mouseup(e)}},{obj:o.domElement,type:"mousemove",handler:function(e){o.mousemove(e)}},{obj:o.domElement,type:"mousewheel",handler:function(e){o.mousewheel(e)}},{obj:o.domElement,type:"DOMMouseScroll",handler:function(e){o.mousewheel(e)}},{obj:o.domElement,type:"mouseout",handler:function(e){o.mouseup(e)}},{obj:o.domElement,type:"touchstart",handler:function(e){o.touchstartend(e)}},{obj:o.domElement,type:"touchend",handler:function(e){o.touchstartend(e)}},{obj:o.domElement,type:"touchmove",handler:function(e){o.touchmove(e)}},{obj:o.getKeyBindObject(),type:"keydown",handler:function(e){o.keydownup(e)}},{obj:o.getKeyBindObject(),type:"keyup",handler:function(e){o.keydownup(e)}},{obj:window,type:"resize",handler:function(){o.handleResize()}},{obj:window,type:"blur",handler:function(){o.resetKeys()}},{obj:o.domElement,type:"contextmenu",handler:function(e){o.contextmenu(e)}}];for(var a=0;a<this._listeners.length;a++){var s=this._listeners[a];s.obj.addEventListener(s.type,s.handler)}this.handleResize(),this.resetKeys(),this.update()}function q_(e,t,n){Nc.call(this);var r=this;this.gfxObj=e,this.camera=t,this.domElement=void 0!==n?n:document,this.screen={left:0,top:0,width:0,height:0},this._lastMousePos=new x(0,0),this._mouseTotalDist=0,this._lastClickBeginTime=-1e3,this._lastClickPos=new x(0,0),this._clickBeginTime=0,this._clock=new Mc,this._clock.start(),this._listeners=[{obj:r.domElement,type:"mousedown",handler:function(e){r.mousedown(e)}},{obj:r.domElement,type:"mouseup",handler:function(e){r.mouseup(e)}},{obj:r.domElement,type:"mousemove",handler:function(e){r.mousemove(e)}},{obj:r.domElement,type:"touchstart",handler:function(e){r.touchstart(e)}},{obj:r.domElement,type:"touchend",handler:function(e){r.touchend(e)}},{obj:window,type:"resize",handler:function(){r.handleResize()}}];for(var i=0;i<this._listeners.length;i++){var o=this._listeners[i];o.obj.addEventListener(o.type,o.handler)}this.handleResize()}H_.prototype._rotate=function(){var e=new E,t=new b,n=new E,r=new V;return function(i){var o=0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z;if(r.copy(this.object.matrix),o?r.multiply(j_.makeRotationFromQuaternion(i)):(r.multiply(j_.makeTranslation(this.pivot.x,this.pivot.y,this.pivot.z)),r.multiply(j_.makeRotationFromQuaternion(i)),r.multiply(j_.makeTranslation(-this.pivot.x,-this.pivot.y,-this.pivot.z))),r.decompose(e,t,n),!o)for(var a=0;a<this.objects.length;++a)this.objects[a].position.copy(e);for(var s=0;s<this.objects.length;++s)this.objects[s].quaternion.copy(t),this.objects[s].updateMatrix()}}(),H_.prototype.setObjects=function(e){this.objects=e;var t=r(e,1);this.object=t[0]},H_.prototype.rotate=(T_={axis:new E,angle:0},function(e,t,n,r){this.mouse2rotation(T_,t,n,r),e.setFromAxisAngle(T_.axis,T_.angle),T_.angle&&this._rotate(e),this.lastRotation=T_}),H_.prototype.translate=(M_=new E,C_=new E,function(e){M_.set(e.x/this.camera.projectionMatrix.elements[0],e.y/this.camera.projectionMatrix.elements[5],0);var t=M_.length();M_.normalize(),M_.transformDirection(j_.getInverse(this.object.matrixWorld)),C_.copy(this.pivot),this.object.localToWorld(C_),t*=Math.abs(C_.z-this.camera.position.z),t/=this.object.matrixWorld.getMaxScaleOnAxis();for(var n=0;n<this.objects.length;++n)this.objects[n].translateOnAxis(M_,t)}),H_.prototype.update=(A_=new E,function(e,t){if(0!==eh.now.autoRotation)return eh.now.autoRotationAxisFixed||0===this.lastRotation.axis.length()?A_.set(0,1,0).transformDirection(j_.getInverse(this.object.matrixWorld)):A_.copy(this.lastRotation.axis),this._rotate(G_.setFromAxisAngle(A_,eh.now.autoRotation*e)),!0;if(this.options.intertia&&this.lastRotation.angle){var n=this.lastRotation.angle*Math.pow(1-this.options.dynamicDampingFactor,40*t);if(!(Math.abs(n)<=this.options.intertiaThreshold))return this._rotate(G_.setFromAxisAngle(this.lastRotation.axis,n)),!0;this.lastRotation.angle=0}return!1}),H_.prototype.stop=function(){this.lastRotation.angle=0},H_.prototype.mouse2rotation=(R_=new E,P_=new E,k_=new E,L_=new E,N_=new E,I_=new E,O_=new x,function(e,t,n,r){if(r)e.axis.copy(this.axis),e.angle=this.options.axisRotateFactor*(n.y-t.y);else{O_.subVectors(n,t);var i=O_.length();if(0===i)return;R_.copy(this.pivot),this.object.localToWorld(R_),P_.subVectors(this.camera.position,R_),k_.copy(P_).normalize(),L_.copy(this.camera.up).normalize(),N_.crossVectors(L_,k_).normalize(),L_.setLength(O_.y),N_.setLength(O_.x),I_.copy(L_.add(N_)),e.axis.crossVectors(I_,P_),e.angle=-i*this.options.rotateFactor}e.axis.transformDirection(j_.getInverse(this.object.matrixWorld)),e.angle<0&&(e.axis.negate(),e.angle=-e.angle)}),W_.prototype=Object.create(Nc.prototype),W_.prototype.constructor=W_,W_.prototype.resetKeys=function(){this._pressedKeys[37]=!1,this._pressedKeys[38]=!1,this._pressedKeys[39]=!1,this._pressedKeys[40]=!1},W_.prototype.contextmenu=function(e){e.stopPropagation(),e.preventDefault()},W_.prototype.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},W_.prototype.enable=function(e){this.enabled=e},W_.prototype.enableHotkeys=function(e){this.hotkeysEnabled=e},W_.prototype.allowTranslation=function(e){this._isTranslationAllowed=e},W_.prototype.allowAltObjFreeRotation=function(e){this._isAltObjFreeRotationAllowed=e},W_.prototype.keysTranslateObj=function(e){this._isKeysTranslatingObj=e},W_.prototype.isEditingAltObj=function(){return(0===this._state||1===this._state)&&this._affectedObj===this._altObj},W_.prototype.convertMouseToOnCircle=function(e,t,n){var r=Math.min(this.screen.width,this.screen.height);0!==r?e.set((t-.5*this.screen.width-this.screen.left)/r,(.5*this.screen.height+this.screen.top-n)/r):e.set(0,0)},W_.prototype.convertMouseToViewport=function(e,t,n){0!==this.screen.width&&0!==this.screen.height?e.set(2*(t-.5*this.screen.width-this.screen.left)/this.screen.width,2*(.5*this.screen.height+this.screen.top-n)/this.screen.height):e.set(0,0)},W_.prototype.stop=function(){this._mainObj.stop(),this._altObj.stop()},W_.prototype.rotateByMouse=(D_=new b,function(e){this._affectedObj.rotate(D_,this._mousePrevPos,this._mouseCurPos,e),this.dispatchEvent({type:"change",action:"rotate",quaternion:D_})}),W_.prototype.rotate=function(e){this.object.quaternion.multiply(e),this.dispatchEvent({type:"change",action:"rotate",quaternion:e})},W_.prototype.getOrientation=function(){return this.object.quaternion},W_.prototype.setOrientation=function(e){this.object.quaternion.copy(e)},W_.prototype.translate=(z_=new x,function(){z_.subVectors(this._mouseCurPos,this._mousePrevPos),this._affectedObj.translate(z_),this.dispatchEvent({type:"change",action:"translate"})}),W_.prototype.getScale=function(){return this.object.scale.x},W_.prototype.setScale=function(e){this.object.scale.set(e,e,e)},W_.prototype.scale=function(e){e<=0||(this.setScale(this.object.scale.x*e),this.dispatchEvent({type:"change",action:"zoom",factor:e}))},W_.prototype.update=(F_=new x,function(){var e=this._clock.getElapsedTime(),t=e-this._lastUpdateTime;if(-1===this._state){var n=e-this._lastMouseMoveTime;(this._mainObj.update(t,n)||this._altObj.update(t,n))&&this.dispatchEvent({type:"change",action:"auto"})}if(this._isKeysTranslatingObj){var r=Number(this._pressedKeys[39])-Number(this._pressedKeys[37]),i=Number(this._pressedKeys[38])-Number(this._pressedKeys[40]);if(0!==r||0!==i){var o=t,a=this.getAltObj();a.objects.length>0&&(this._altObj.setObjects(a.objects),this._altObj.pivot=a.pivot,"axis"in a?this._altObj.axis=a.axis.clone():this._altObj.axis.set(0,0,1),F_.set(o*r,o*i),this._altObj.translate(F_),this.dispatchEvent({type:"change",action:"translate"}))}}this._lastUpdateTime=e}),W_.prototype.reset=function(){this._state=-1,this.object.quaternion.copy(G_.set(0,0,0,1))},W_.prototype.mousedown=function(e){if(!1!==this.enabled&&-1===this._state){if(e.preventDefault(),e.stopPropagation(),-1===this._state)if(0===e.button){this._affectedObj.stop();var t=!1;if(e.altKey){var n=this.getAltObj();(t=n.objects.length>0)&&(this._altObj.setObjects(n.objects),this._altObj.pivot=n.pivot,"axis"in n?this._altObj.axis=n.axis.clone():this._altObj.axis.set(0,0,1))}this._affectedObj=t?this._altObj:this._mainObj,this._state=t&&e.ctrlKey&&this._isTranslationAllowed?1:0}else 2===e.button&&(this._state=3);0===this._state&&(this.convertMouseToOnCircle(this._mouseCurPos,e.pageX,e.pageY),this._mousePrevPos.copy(this._mouseCurPos)),1!==this._state&&3!==this._state||(this.convertMouseToViewport(this._mouseCurPos,e.pageX,e.pageY),this._mousePrevPos.copy(this._mouseCurPos))}},W_.prototype.mousemove=function(e){if(!1!==this.enabled&&-1!==this._state)switch(e.preventDefault(),e.stopPropagation(),this._state){case 0:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToOnCircle(this._mouseCurPos,e.pageX,e.pageY),this.rotateByMouse(e.altKey&&!this._isAltObjFreeRotationAllowed||e.shiftKey),this._lastMouseMoveTime=this._clock.getElapsedTime();break;case 1:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToViewport(this._mouseCurPos,e.pageX,e.pageY),this.translate();break;case 3:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToViewport(this._mouseCurPos,e.pageX,e.pageY),this.translatePivotByMouse()}},W_.prototype.mousewheel=function(e){if(!1!==this.enabled&&eh.now.zooming&&-1===this._state&&!e.shiftKey){e.preventDefault();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3);var n=1+.05*t;n=Math.max(n,.01),this.scale(n)}},W_.prototype.mouseup=function(e){!1!==this.enabled&&-1!==this._state&&(e.preventDefault(),e.stopPropagation(),this._state=-1,this._clock.getElapsedTime()-this._lastMouseMoveTime>.1&&this._affectedObj.stop())},W_.prototype.touchstartend=function(e){if(!1!==this.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:this._state=0,this.convertMouseToOnCircle(this._mouseCurPos,e.touches[0].pageX,e.touches[0].pageY),this._mousePrevPos.copy(this._mouseCurPos);break;case 2:this._mainObj.stop(),this._altObj.stop(),this._state=2;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;this._touchDistanceCur=this._touchDistanceStart=Math.sqrt(t*t+n*n),this._scaleStart=this.object.scale.x;break;default:this._state=-1}},W_.prototype.touchmove=function(e){if(!1!==this.enabled&&-1!==this._state)switch(e.preventDefault(),e.stopPropagation(),this._state){case 0:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToOnCircle(this._mouseCurPos,e.touches[0].pageX,e.touches[0].pageY),this.rotateByMouse(!1),this._lastMouseMoveTime=this._clock.getElapsedTime();break;case 2:if(eh.now.zooming){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;this._touchDistanceCur=Math.sqrt(t*t+n*n);var r=this._scaleStart*this._touchDistanceCur/this._touchDistanceStart/this.object.scale.x;this.scale(r)}}},W_.prototype.keydownup=function(e){if(!1!==this.enabled&&!1!==this.hotkeysEnabled)switch(e.keyCode){case 37:case 38:case 39:case 40:this._pressedKeys[e.keyCode]="keydown"===e.type,e.preventDefault(),e.stopPropagation()}},W_.prototype.getKeyBindObject=function(){return window.top},W_.prototype.dispose=function(){for(var e=0;e<this._listeners.length;e++){var t=this._listeners[e];t.obj.removeEventListener(t.type,t.handler)}},W_.prototype.translatePivotByMouse=function(){var e=new x;return function(){e.subVectors(this._mouseCurPos,this._mousePrevPos),this.translatePivotInWorld(eh.now.translationSpeed*e.x,eh.now.translationSpeed*e.y,0)}}(),W_.prototype.translatePivotInWorld=function(e,t,n){var r=this.objectPivot.position;r.applyMatrix4(this.object.matrixWorld),r.setX(r.x+e),r.setY(r.y+t),r.setZ(r.z+n),r.applyMatrix4(j_.getInverse(this.object.matrixWorld)),this.dispatchEvent({type:"change",action:"translatePivot"})},W_.prototype.translatePivot=function(e,t,n){var r=this.objectPivot.position;r.setX(r.x+e),r.setY(r.y+t),r.setZ(r.z+n),this.dispatchEvent({type:"change",action:"translatePivot"})},W_.prototype.setPivot=function(e){this.objectPivot.position.copy(e),this.dispatchEvent({type:"change",action:"translatePivot"})},q_.prototype=Object.create(Nc.prototype),q_.prototype.constructor=q_,q_.prototype.reset=function(){this.picked={},this.dispatchEvent({type:"newpick",obj:{}})},q_.prototype.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},q_.prototype.pickObject=function(e){if(!this.gfxObj)return this.picked={},void this.dispatchEvent({type:"newpick",obj:{}});var t=this.gfxObj,n=new Yl;n.ray.origin.setFromMatrixPosition(this.camera.matrixWorld),n.ray.direction.set(e.x,e.y,.5).unproject(this.camera).sub(n.ray.origin).normalize();var r=eh.now.draft.clipPlane&&this.clipPlaneValue?this.clipPlaneValue:1/0,i=eh.now.fog&&this.fogFarValue?this.fogFarValue:1/0,o=n.intersectVisibleObject(t,this.camera,r,i);if(!o)return this.picked={},void this.dispatchEvent({type:"newpick",obj:{}});var a={};if(o.residue||o.atom){var s=o.residue||o.atom.getResidue();"chain"===eh.now.pick?a={chain:s.getChain()}:"molecule"===eh.now.pick?a={molecule:s.getMolecule()}:o.residue||"residue"===eh.now.pick?a={residue:s}:o.atom&&(a={atom:o.atom})}this.picked=a,this.dispatchEvent({type:"newpick",obj:a})},q_.prototype.getMouseInViewport=function(e,t){return new x((e-this.screen.left)/this.screen.width*2-1,-(t-this.screen.top)/this.screen.height*2+1)},q_.prototype.mousedown=function(e){e.preventDefault(),e.stopPropagation(),0===e.button&&(this._lastMousePos=this.getMouseInViewport(e.pageX,e.pageY),this._mouseTotalDist=0,this._clickBeginTime=this._clock.getElapsedTime())},q_.prototype.mousemove=function(e){e.preventDefault(),e.stopPropagation();var t=this.getMouseInViewport(e.pageX,e.pageY);this._mouseTotalDist+=t.sub(this._lastMousePos).length()},q_.prototype.mouseup=function(e){var t=this;if(e.preventDefault(),e.stopPropagation(),0===e.button&&this._mouseTotalDist<.01){var n=this._clock.getElapsedTime(),r=this.getMouseInViewport(e.pageX,e.pageY);if(n-this._lastClickBeginTime<.7&&(new x).subVectors(r,this._lastClickPos).length()<.01)return this.dispatchEvent({type:"dblclick",obj:this.picked}),this._lastClickPos=r,void(this._lastClickBeginTime=-1e3);setTimeout((function(){t.pickObject(r)}),0),this._lastClickPos=r,this._lastClickBeginTime=this._clickBeginTime}},q_.prototype.touchstart=function(e){e.preventDefault(),e.stopPropagation(),1===e.touches.length&&(this._lastTouchdownPos=this.getMouseInViewport(e.touches[0].pageX,e.touches[0].pageY))},q_.prototype.touchend=function(e){var t=this;e.preventDefault(),e.stopPropagation(),0===e.touches.length&&1===e.changedTouches.length&&this.getMouseInViewport(e.changedTouches[0].pageX,e.changedTouches[0].pageY).sub(this._lastTouchdownPos).length()<.01&&setTimeout((function(){t.pickObject(t._lastTouchdownPos)}),0)},q_.prototype.dispose=function(){for(var e=0;e<this._listeners.length;e++){var t=this._listeners[e];t.obj.removeEventListener(t.type,t.handler)}};var Y_=function(){function e(t,n){h(this,e),this._target=t,this._targetCamera=n,this._camera=new rn(n.fov,n.aspect,1,100),this._object=new Nu(1),this._scene=new ae,this._scene.add(this._object),this._full=new x,this._update()}return Tc(e,[{key:"_update",value:function(){var e=this._targetCamera.fov,t=this._camera;t.aspect=this._targetCamera.aspect,t.setMinimalFov(e),t.setDistanceToFit(1,e),t.updateProjectionMatrix(),this._object.quaternion.copy(this._target.quaternion)}},{key:"render",value:function(e){this._update(),e.getSize(this._full);var t=.25*this._full.width,n=.25*this._full.height,r=e.autoClear;e.autoClear=!1,e.setViewport(0,0,t,n),e.clear(!1,!0,!1),e.render(this._scene,this._camera),e.setViewport(0,0,this._full.width,this._full.height),e.autoClear=r}}]),e}(),X_=["helix","strand"],Z_=["fs","ps","ns","us"];function $_(e,t){for(var n=t._residues,r=n.length,i=new Uint8Array(r),o=t._atoms,a=0,s=e.length;a<s;++a)i[o[a]._residue._index]=e[a];for(var l=[],u=0;u<r;){if(0!==i[u]){for(var c=u,h=i[u];u<r-1&&i[u+1]===h&&n[u].isConnected(n[u+1]);)++u;l.push({start:c,end:u,type:X_[h-1]})}++u}return l}function K_(e){return e>=1<<19?e-(1<<20):e}var J_=function(){function e(t,n,r){h(this,e),this._complex=t,this._secondary=null,this.isLoading=!1,this._framesRange={start:0,end:-1},this.frameIsReady=!1,this._buffer=null,this._frameRequest=null,this._callbacks=r,"function"==typeof n?(this._framesRequestLength=1,this._downloadDataFn=n):this.parseBinaryData(n,!0),this.reset(),this.setFrame(0)}return Tc(e,[{key:"_prepareBuffer",value:function(e,t){if(null==e&&(e=0),null==t&&(t=e+this._framesRequestLength),void 0!==this._framesCount&&(t=Math.min(this._framesCount-1,t)),this._downloadDataFn){var n=this;this._buffer||(this._buffer={}),this._buffer.state="downloading",this.isLoading=!0,n._callbacks&&"function"==typeof n._callbacks.onLoadStatusChanged&&n._callbacks.onLoadStatusChanged(),this._downloadDataFn({start:e,end:t+1},(function(r){if(n.isLoading=!1,n._callbacks&&"function"==typeof n._callbacks.onLoadStatusChanged&&n._callbacks.onLoadStatusChanged(),n._buffer={data:r,state:"ready",start:e,end:t},null!==n._frameRequest){var i=n._frameRequest;n._frameRequest=null,n.setFrame(i)}}),(function(){n.isLoading=!1,n._callbacks&&"function"==typeof n._callbacks.onError&&n._callbacks.onError("Streaming failed")}))}}},{key:"_parseBuffer",value:function(){if(this._buffer&&"ready"===this._buffer.state){this._framesRange={start:this._buffer.start,end:this._buffer.end},this.parseBinaryData(this._buffer.data,!1);var e=(this._buffer.end+1)%this._framesCount;if(e>=this._framesCount&&(e=0),this._buffer={state:"none"},this._prepareBuffer(e,e+this._framesRequestLength),null!==this._frameRequest){var t=this._frameRequest;this._frameRequest=null,this.setFrame(t)}}}},{key:"parseBinaryData",value:function(e){var t=new DataView(e),n=0,r=t.getUint32(n,!0);n+=4;var i=t.getUint32(n,!0);this._framesCount=i,this._framesRange.end=this._framesRange.end>0?Math.min(this._framesRange.end,i-1):i-1,n+=4,this._atomsCount=r,this._framesRequestLength=Math.ceil(1048576/(8*r));var o=this._framesRange.end-this._framesRange.start+1;if(r!==this._complex._atoms.length||e.byteLength!==12+o*r*8)throw new Error;for(var a=this._complex,s=t.getUint32(n,!0),l=0;s>1e3&&l<Z_.length-1;)s/=1e3,++l;this._timeStep="".concat(s.toString()," ").concat(Z_[l]),n+=4;for(var u=[],c=new Float32Array(o*r*3),h=0,d=new Int8Array(r),f=0;f<o;++f){for(var p=0;p<r;++p){var m=t.getUint32(n,!0);n+=4;var v=t.getUint32(n,!0);n+=4;var g=(4026531840&v)>>>28,y=K_((268435200&v)>>>8>>0),_=K_(((255&v)<<12|(4293918720&m)>>>20)>>0),x=K_((1048575&m)>>0);d[p]=0,g>0&&g<4?d[p]=1:4===g&&(d[p]=2),c[h++]=y/100,c[h++]=_/100,c[h++]=x/100}u.push($_(d,a))}this._secondaryData=u,this._data=c}},{key:"nextFrame",value:function(){this.setFrame((this._currFrame+1)%this._framesCount)}},{key:"needsColorUpdate",value:function(e){return e instanceof Iv}},{key:"getAtomColor",value:function(e,t){return e.getResidueColor(this._residues[t._residue._index],this._complex)}},{key:"getResidueColor",value:function(e,t){return e.getResidueColor(this._residues[t._index],this._complex)}},{key:"_updateSecondary",value:function(){var e,t=this._residues,n=t.length;for(e=0;e<n;++e)t[e]._secondary=null;var r=this._secondaryData[this._currFrame-this._framesRange.start];for(e=0,n=r.length;e<n;++e)for(var i=r[e],o=i.start,a=i.end,s={_start:t[o],_end:t[a],type:i.type,generic:i.generic},l=o;l<=a;++l)t[l]._secondary=s}},{key:"reset",value:function(){var e=this._complex._residues,t=e.length;this._residues=new Array(t);for(var n=this._residues,r=function(){return this._secondary},i=0;i<t;++i)n[i]={_type:e[i]._type,_isValid:e[i]._isValid,_controlPoint:null,_wingVector:null,_secondary:null,getSecondary:r}}},{key:"setFrame",value:function(e){if(this.frameIsReady=!1,e>=this._framesRange.start&&e<=this._framesRange.end)this._currFrame=e,this._cachedResidues=!1,this._updateSecondary(),this.frameIsReady=!0;else if(this._frameRequest=e,this._buffer)switch(this._buffer.state){case"none":this._prepareBuffer(e);break;case"ready":this._parseBuffer()}else this._prepareBuffer(e)}},{key:"disableEvents",value:function(){this._callbacks=null}},{key:"getAtomPos",value:function(t){var n=e._vec,r=this._data,i=3*(this._atomsCount*(this._currFrame-this._framesRange.start)+t);return n.set(r[i],r[i+1],r[i+2]),n}},{key:"getResidues",value:function(){return this._cachedResidues||this._complex.updateToFrame(this),this._residues}}]),e}();u(J_,"_vec",new E);var Q_=function(){function e(t,n){if(h(this,e),this.constructor===e)throw new Error("Can not instantiate abstract class!");this.params=t,this.opts=s.merge($c.deriveDeep(eh.now.objects[this.type],!0),n),this.needsRebuild=!1,this._mesh=null,this.id=null}return Tc(e,[{key:"identify",value:function(){var e={type:this.type,params:this.params},t=$c.objectsDiff(this.opts,eh.now.modes[this.id]);return s.isEmpty(t)||(e.opts=t),e}},{key:"toString",value:function(){return"o=".concat(this.type,",").concat(this.params.join(","))+$c.compareOptionsWithDefaults(this.opts,eh.defaults.objects[this.type])}},{key:"getGeometry",value:function(){return this._mesh}},{key:"destroy",value:function(){this._mesh&&Sf.destroyObject(this._mesh)}}]),e}();Q_.prototype.type="__";var ex=function(e){function t(e,n){var i;if(h(this,t),i=d(this,f(t).call(this,e,n)),e.length<2)throw new Error("Wrong number of argumets on line object creation!");var o=r(e,2);return i._id1=o[0],i._id2=o[1],i}return m(t,e),Tc(t,[{key:"_getAtomFromName",value:function(e,t){var n=e.getAtomByFullname(t);if(!n)throw new Error(t+" - Wrong atom format it must be '#CHAIN_NAME.#RESIDUE_NUMBER.#ATOM_NAME' (e.g. 'A.38.CO1')");return n}},{key:"build",value:function(e){var t=new Zt;this._atom1=this._getAtomFromName(e,this._id1),this._atom2=this._getAtomFromName(e,this._id2),t.vertices[0]=this._atom1._position.clone(),t.vertices[1]=this._atom2._position.clone(),t.dynamic=!0,t.computeBoundingBox(),this._line=new em.Line(t,new hf({lights:!1,overrideColor:!0,dashedLine:!0,fogTransparent:eh.now.bg.transparent})),this._line.computeLineDistances(),this._line.material.setUberOptions({fixedColor:new $e(this.opts.color),dashedLineSize:this.opts.dashSize,dashedLinePeriod:this.opts.dashSize+this.opts.gapSize}),this._line.material.updateUniforms(),this._line.raycast=function(e,t){},this._mesh=this._line;var n=e.getTransforms();n.length>0&&(this._mesh=new ci,this._mesh.add(this._line),Sf.applyTransformsToMeshes(this._mesh,n))}},{key:"updateToFrame",value:function(e){if(this._atom1&&this._atom2&&this._line){var t=this._line.geometry;t.vertices[0].copy(e.getAtomPos(this._atom1._index)),t.vertices[1].copy(e.getAtomPos(this._atom2._index)),this._line.computeLineDistances(),t.computeBoundingSphere(),t.verticesNeedUpdate=!0}}}]),t}(Q_);ex.prototype.constructor=ex,ex.prototype.type="line";var tx=function(e){function t(e){var n;h(this,t),n=d(this,f(t).call(this,e));var r={uniforms:{srcTex:{type:"t",value:null},srcDepthTex:{type:"t",value:null},srcTexSize:{type:"v2",value:new x(512,512)},color:{type:"v3",value:null},threshold:{type:"f",value:null},opacity:{type:"f",value:1},thickness:{type:"v2",value:new x(1,1)}},vertexShader:nf,fragmentShader:"precision highp float;\r\n\r\nuniform sampler2D srcTex;\r\nuniform vec2 srcTexSize;\r\nuniform vec2 thickness;\r\nvarying vec2 vUv;\r\n\r\n#ifdef DEPTH_OUTLINE\r\n  uniform sampler2D srcDepthTex; //depthTexture\r\n  uniform vec3 color;\r\n  uniform float threshold;\r\n#endif\r\n\r\nvoid main() {\r\n\r\n  vec2 pixelSize = thickness / srcTexSize;\r\n\r\n  #ifdef DEPTH_OUTLINE\r\n    float c00 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,-pixelSize.y)).x;\r\n    float c01 = texture2D(srcDepthTex, vUv + vec2(0,-pixelSize.y)).x;\r\n    float c02 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,-pixelSize.y)).x;\r\n    float c10 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,0)).x;\r\n    float c12 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,0)).x;\r\n    float c20 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,pixelSize.y)).x;\r\n    float c21 = texture2D(srcDepthTex, vUv + vec2(0,pixelSize.y)).x;\r\n    float c22 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,pixelSize.y)).x;\r\n\r\n    float horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\r\n    float vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\r\n\r\n    float grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\r\n\r\n    gl_FragColor = ( grad > threshold ) ? vec4(color.rgb, 1.0) : gl_FragColor = texture2D(srcTex, vUv);\r\n\r\n  #else\r\n    vec4 c00 = texture2D(srcTex, vUv + vec2(-pixelSize.x,-pixelSize.y));\r\n    vec4 c01 = texture2D(srcTex, vUv + vec2(0,-pixelSize.y));\r\n    vec4 c02 = texture2D(srcTex, vUv + vec2(pixelSize.x,-pixelSize.y));\r\n    vec4 c10 = texture2D(srcTex, vUv + vec2(-pixelSize.x,0));\r\n    vec4 c12 = texture2D(srcTex, vUv + vec2(pixelSize.x,0));\r\n    vec4 c20 = texture2D(srcTex, vUv + vec2(-pixelSize.x,pixelSize.y));\r\n    vec4 c21 = texture2D(srcTex, vUv + vec2(0,pixelSize.y));\r\n    vec4 c22 = texture2D(srcTex, vUv + vec2(pixelSize.x,pixelSize.y));\r\n\r\n    vec4 horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\r\n    vec4 vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\r\n\r\n    vec4 grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\r\n    gl_FragColor = grad;\r\n  #endif\r\n}\r\n",transparent:!0,depthTest:!1,depthWrite:!1};return n.setValues(r),n}return m(t,e),Tc(t,[{key:"copy",value:function(e){Hh(f(t.prototype),"copy",this).call(this,e),this.depth=e.depth}},{key:"setValues",value:function(e){if(void 0!==e){Hh(f(t.prototype),"setValues",this).call(this,e);var n={};this.depth&&(n.DEPTH_OUTLINE=1),this.defines=n}}}]),t}(Ra);tx.prototype.depth=!1;var nx=function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this,e))).setValues.call(c(n),{uniforms:{srcTex:{type:"t",value:null},srcTexelSize:{type:"v2",value:new x(1/512,1/512)},bgColor:{type:"c",value:new $e(16777215)}},vertexShader:nf,fragmentShader:"precision highp float;\r\n\r\n// edge end finding algorithm parameters\r\n#define FXAA_QUALITY_PS 8\r\n#define FXAA_QUALITY_P0 1.0\r\n#define FXAA_QUALITY_P1 1.5\r\n#define FXAA_QUALITY_P2 2.0\r\n#define FXAA_QUALITY_P3 2.0\r\n#define FXAA_QUALITY_P4 2.0\r\n#define FXAA_QUALITY_P5 2.0\r\n#define FXAA_QUALITY_P6 4.0\r\n#define FXAA_QUALITY_P7 12.0\r\n// constants\r\nfloat fxaaQualityEdgeThreshold = 0.125;\r\nfloat fxaaQualityEdgeThresholdMin = 0.0625;\r\nfloat fxaaQualitySubpix = 0.7; //0.65;\r\n// global params\r\nuniform sampler2D srcTex;\r\nuniform vec2 srcTexelSize;\r\nuniform vec3 bgColor;\r\n// from vs\r\nvarying vec2 vUv;\r\n//=====================================================================//\r\n// calc luminance from rgb\r\n//'float FxaaLuma(vec3 rgb) {return rgb.y * (0.587/0.299) + rgb.x; } // Lotte's idea about game luminance\r\nfloat FxaaLuma(vec3 rgb) {return dot(rgb, vec3(0.299, 0.587, 0.114)); } // real luminance calculation\r\n                                                                           // for non-real scene rendering\r\n// texture sampling by pixel position(coords) and offset(in pixels)\r\n vec3 FxaaTex(sampler2D tex, vec2 pos, vec2 off,  vec2 res ) {\r\n  #ifdef BG_TRANSPARENT\r\n    vec4 color = texture2D( tex, pos + off * res );\r\n    return mix(color.rgb, bgColor, 1.0 - color.a);\r\n  #else\r\n    return texture2D( tex, pos + off * res ).xyz;\r\n  #endif\r\n}\r\nvec3 FxaaTexTop(sampler2D tex, vec2 pos) {\r\n  #ifdef BG_TRANSPARENT\r\n    vec4 color = texture2D( tex, pos );\r\n    return mix(color.rgb, bgColor, 1.0 - color.a);\r\n  #else\r\n    return texture2D( tex, pos).xyz;\r\n  #endif\r\n}\r\nvec4 FxaaTexTopAlpha(sampler2D tex, vec2 pos) {\r\n  return texture2D( tex, pos);\r\n}\r\n\r\n//=====================================================================//\r\nvoid main() {\r\n  // renaming\r\n  vec2 posM = vUv;\r\n  // get luminance for neighbours\r\n  float lumaS = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, 1.0 ), srcTexelSize));\r\n  float lumaE = FxaaLuma(FxaaTex(srcTex, posM, vec2( 1.0, 0.0 ), srcTexelSize));\r\n  float lumaN = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, -1.0 ), srcTexelSize));\r\n  float lumaW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, 0.0 ), srcTexelSize));\r\n  float lumaM = FxaaLuma(FxaaTexTop(srcTex, posM));\r\n  // find max and min luminance\r\n  float rangeMax = max(max(lumaN, lumaW), max(lumaE, max(lumaS, lumaM)));\r\n  float rangeMin = min(min(lumaN, lumaW), min(lumaE, min(lumaS, lumaM)));\r\n  // calc maximum non-edge range\r\n  float rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\r\n  float range = rangeMax - rangeMin;\r\n  float rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\r\n  // exit when luma contrast is small (is not edge)\r\n  if(range < rangeMaxClamped){\r\n    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\r\n    return;\r\n  }\r\n  float subpixRcpRange = 1.0/range;\r\n  // note: the sampling coordinates can be calculated in vertex shader but the approach doesn't affect performance\r\n  // visibly, thus we decided to leave calculation here for better readability.\r\n  // calc other neighbours luminance\r\n  float lumaNE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0, -1.0 ), srcTexelSize));\r\n  float lumaSW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0,  1.0 ), srcTexelSize));\r\n  float lumaSE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0,  1.0 ), srcTexelSize));\r\n  float lumaNW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, -1.0 ), srcTexelSize));\r\n/*--------------span calculation and subpix amount calulation-----------------*/\r\n  float lumaNS = lumaN + lumaS;\r\n  float lumaWE = lumaW + lumaE;\r\n  float subpixNSWE = lumaNS + lumaWE;\r\n  float edgeHorz1 = (-2.0 * lumaM) + lumaNS;\r\n  float edgeVert1 = (-2.0 * lumaM) + lumaWE;\r\n/*--------------------------------------------------------------------------*/\r\n  float lumaNESE = lumaNE + lumaSE;\r\n  float lumaNWNE = lumaNW + lumaNE;\r\n  float edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\r\n  float edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\r\n/*--------------------------------------------------------------------------*/\r\n  float lumaNWSW = lumaNW + lumaSW;\r\n  float lumaSWSE = lumaSW + lumaSE;\r\n  float edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\r\n  float edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\r\n  float edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\r\n  float edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\r\n  float edgeHorz = abs(edgeHorz3) + edgeHorz4;\r\n  float edgeVert = abs(edgeVert3) + edgeVert4;\r\n/*--------------------subpix amount calulation------------------------------*/\r\n  float subpixNWSWNESE = lumaNWSW + lumaNESE;\r\n  float lengthSign = srcTexelSize.x;\r\n  bool horzSpan = edgeHorz >= edgeVert;\r\n   // debug  code edge span visualization\r\n/*'  if (horzSpan)\r\n      gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\r\n  else\r\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\r\n  return;*/\r\n  float subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\r\n/*--------------------------------------------------------------------------*/\r\n  if(!horzSpan) lumaN = lumaW;\r\n  if(!horzSpan) lumaS = lumaE;\r\n  if(horzSpan) lengthSign = srcTexelSize.y;\r\n  float subpixB = (subpixA * (1.0/12.0)) - lumaM;\r\n/*--------------------------------------------------------------------------*/\r\n  float gradientN = lumaN - lumaM;\r\n  float gradientS = lumaS - lumaM;\r\n  float lumaNN = lumaN + lumaM;\r\n  float lumaSS = lumaS + lumaM;\r\n  bool pairN = abs(gradientN) >= abs(gradientS);\r\n  float gradient = max(abs(gradientN), abs(gradientS));\r\n  if(pairN) lengthSign = -lengthSign;\r\n  float subpixC = clamp(abs(subpixB) * subpixRcpRange, 0.0, 1.0);\r\n/*--------------------------------------------------------------------------*/\r\n  vec2 posB;\r\n  posB = posM;\r\n  vec2 offNP;\r\n  offNP.x = (!horzSpan) ? 0.0 : srcTexelSize.x;\r\n  offNP.y = ( horzSpan) ? 0.0 : srcTexelSize.y;\r\n  if(!horzSpan) posB.x += lengthSign * 0.5;\r\n  if( horzSpan) posB.y += lengthSign * 0.5;\r\n/*--------------------------------------------------------------------------*/\r\n  vec2 posN;\r\n  posN = posB - offNP * FXAA_QUALITY_P0;\r\n  vec2 posP;\r\n  posP = posB + offNP * FXAA_QUALITY_P0;\r\n  float subpixD = ((-2.0)*subpixC) + 3.0;\r\n  float lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN));\r\n  float subpixE = subpixC * subpixC;\r\n  float lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP));\r\n/*--------------------------------------------------------------------------*/\r\n  if(!pairN) lumaNN = lumaSS;\r\n  float gradientScaled = gradient * 1.0/4.0;\r\n  float lumaMM = lumaM - lumaNN * 0.5;\r\n  float subpixF = subpixD * subpixE;\r\n  bool lumaMLTZero = lumaMM < 0.0;\r\n/*---------------------looped edge-end search-------------------------------*/\r\n  lumaEndN -= lumaNN * 0.5;\r\n  lumaEndP -= lumaNN * 0.5;\r\n  bool doneN = abs(lumaEndN) >= gradientScaled;\r\n  bool doneP = abs(lumaEndP) >= gradientScaled;\r\n  if(!doneN) posN -= offNP * FXAA_QUALITY_P1;\r\n  bool doneNP = (!doneN) || (!doneP);\r\n  if(!doneP) posP += offNP * FXAA_QUALITY_P1;\r\n/*--------------------------------------------------------------------------*/\r\n  if(doneNP) {\r\n    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n    doneN = abs(lumaEndN) >= gradientScaled;\r\n    doneP = abs(lumaEndP) >= gradientScaled;\r\n    if(!doneN) posN -= offNP * FXAA_QUALITY_P2;\r\n    doneNP = (!doneN) || (!doneP);\r\n    if(!doneP) posP += offNP * FXAA_QUALITY_P2;\r\n/*--------------------------------------------------------------------------*/\r\n    #if (FXAA_QUALITY_PS > 3)\r\n      if(doneNP) {\r\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n        doneN = abs(lumaEndN) >= gradientScaled;\r\n        doneP = abs(lumaEndP) >= gradientScaled;\r\n        if(!doneN) posN -= offNP * FXAA_QUALITY_P3;\r\n        doneNP = (!doneN) || (!doneP);\r\n        if(!doneP) posP += offNP * FXAA_QUALITY_P3;\r\n/*--------------------------------------------------------------------------*/\r\n        #if (FXAA_QUALITY_PS > 4)\r\n          if(doneNP) {\r\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n            doneN = abs(lumaEndN) >= gradientScaled;\r\n            doneP = abs(lumaEndP) >= gradientScaled;\r\n            if(!doneN) posN -= offNP * FXAA_QUALITY_P4;\r\n            doneNP = (!doneN) || (!doneP);\r\n            if(!doneP) posP += offNP * FXAA_QUALITY_P4;\r\n/*--------------------------------------------------------------------------*/\r\n            #if (FXAA_QUALITY_PS > 5)\r\n               if(doneNP) {\r\n                 if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n                 if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n                 if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                 if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                 doneN = abs(lumaEndN) >= gradientScaled;\r\n                 doneP = abs(lumaEndP) >= gradientScaled;\r\n                 if(!doneN) posN -= offNP * FXAA_QUALITY_P5;\r\n                 doneNP = (!doneN) || (!doneP);\r\n                 if(!doneP) posP += offNP * FXAA_QUALITY_P5;\r\n/*--------------------------------------------------------------------------*/\r\n                 #if (FXAA_QUALITY_PS > 6)\r\n                   if(doneNP) {\r\n                     if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n                     if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n                     if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                     if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                     doneN = abs(lumaEndN) >= gradientScaled;\r\n                     doneP = abs(lumaEndP) >= gradientScaled;\r\n                     if(!doneN) posN -= offNP * FXAA_QUALITY_P6;\r\n                     doneNP = (!doneN) || (!doneP);\r\n                     if(!doneP) posP += offNP * FXAA_QUALITY_P6;\r\n/*--------------------------------------------------------------------------*/\r\n                     #if (FXAA_QUALITY_PS > 7)\r\n                       if(doneNP) {\r\n                         if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n                         if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n                         if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                         if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                         doneN = abs(lumaEndN) >= gradientScaled;\r\n                         doneP = abs(lumaEndP) >= gradientScaled;\r\n                         if(!doneN) posN -= offNP * FXAA_QUALITY_P7;\r\n                         doneNP = (!doneN) || (!doneP);\r\n                         if(!doneP) posP += offNP * FXAA_QUALITY_P7;\r\n/*--------------------------------------------------------------------------*/\r\n                       }\r\n                     #endif\r\n                   }\r\n                 #endif\r\n               }\r\n             #endif\r\n           }\r\n         #endif\r\n      }\r\n    #endif\r\n  }\r\n/*----------------calculate subpix offset due to edge ends-------------------*/\r\n  float dstN = posM.x - posN.x;\r\n  float dstP = posP.x - posM.x;\r\n  if(!horzSpan) dstN = posM.y - posN.y;\r\n  if(!horzSpan) dstP = posP.y - posM.y;\r\n/*--------------------------------------------------------------------------*/\r\n  bool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\r\n  float spanLength = (dstP + dstN);\r\n  bool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\r\n  float spanLengthRcp = 1.0 / spanLength;\r\n/*--------------------------------------------------------------------------*/\r\n  bool directionN = dstN < dstP;\r\n  float dst = min(dstN, dstP);\r\n  bool goodSpan = directionN ? goodSpanN : goodSpanP;\r\n  float subpixG = subpixF * subpixF;\r\n  float pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\r\n  float subpixH = subpixG * fxaaQualitySubpix;\r\n/*-----------------calc texture offest using subpix-------------------------*/\r\n  float pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\r\n  float pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\r\n\r\n  float offset = pixelOffsetSubpix * lengthSign;\r\n  #ifdef BG_TRANSPARENT\r\n    // get original texel\r\n    vec4 rgbaA = FxaaTexTopAlpha(srcTex, posM);\r\n    // calc step to blended texel\r\n    vec2 step = sign((!horzSpan) ? vec2 (offset, 0.0) : vec2 (0.0, offset));\r\n    // get neighboring texel\r\n    vec4 rgbaB = FxaaTexTopAlpha(srcTex, posM + step * srcTexelSize);\r\n    //  calc blend factor from offset\r\n    float f = (!horzSpan) ? offset / srcTexelSize.x : offset / srcTexelSize.y;\r\n    f = abs(f);\r\n    // calc alpha (special formula to emulate blending with bg)\r\n    gl_FragColor.a = 1.0 - mix(1.0 - rgbaA.a, 1.0 - rgbaB.a, f);\r\n    // calc color (special formula to emulate blending with bg)\r\n    gl_FragColor.rgb = mix(rgbaA.rgb * rgbaA.a, rgbaB.rgb * rgbaB.a, f) / gl_FragColor.a;\r\n  #else\r\n    if(!horzSpan) {\r\n       posM.x += offset;\r\n    } else {\r\n       posM.y += offset;\r\n    }\r\n    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\r\n  #endif\r\n  return;\r\n}\r\n",transparent:!1,depthTest:!1,depthWrite:!1}),n.setValues(e),n}return m(t,e),Tc(t,[{key:"copy",value:function(e){Hh(f(t.prototype),"copy",this).call(this,e),this.depth=e.depth}},{key:"setValues",value:function(e){if(void 0!==e){Hh(f(t.prototype),"setValues",this).call(this,e);var n={};this.bgTransparent&&(n.BG_TRANSPARENT=1),this.defines=n}}}]),t}(Ra);nx.prototype.bgTransparent=!1;var rx=[new E(.295184,.077723,.068429),new E(-.271976,-.365221,.838363),new E(.547713,.467576,.488515),new E(.662808,-.031733,.584758),new E(-.025717,.218955,.657094),new E(-.310153,-.365223,.370701),new E(-.101407,-.006313,.747665),new E(-.769138,.360399,.086847),new E(-.271988,-.27514,.905353),new E(.09674,-.566901,.700151),new E(.562872,-.735136,.094647),new E(.379877,.359278,.190061),new E(.519064,-.023055,.405068),new E(-.301036,.114696,.088885),new E(-.282922,.598305,.487214),new E(-.181859,.25167,.679702),new E(-.191463,-.635818,.512919),new E(-.293655,.427423,.078921),new E(-.267983,.680534,.13288),new E(.139611,.319637,.477439),new E(-.352086,.31104,.653913),new E(.321032,.805279,.487345),new E(.073516,.820734,.414183),new E(-.155324,.589983,.41146),new E(.335976,.170782,.527627),new E(.46346,-.355658,.167689),new E(.222654,.59655,.769406),new E(.922138,-.04207,.147555),new E(-.72705,-.329192,.369826),new E(-.090731,.53382,.463767),new E(-.323457,-.876559,.238524),new E(-.663277,-.372384,.342856)],ix=function(e){function t(){var e;return h(this,t),(e=d(this,f(t).call(this))).setValues.call(c(e),{uniforms:{noiseTexture:{type:"t",value:af.noiseTexture},noiseTexelSize:{type:"v2",value:new x(1/af.noiseWidth,1/af.noiseHeight)},diffuseTexture:{type:"t",value:null},normalTexture:{type:"t",value:null},depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new x(1/512,1/512)},camNearFar:{type:"v2",value:new x(1,10)},projMatrix:{type:"mat4",value:new V},aspectRatio:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},samplesKernel:{type:"v3v",value:rx},kernelRadius:{type:"f",value:1},depthThreshold:{type:"f",value:1},factor:{type:"f",value:1}},vertexShader:nf,fragmentShader:"precision highp float;\r\n#define EPSILON 0.0000001\r\n\r\n#define MAX_SAMPLES_COUNT 32\r\nuniform vec3 samplesKernel[MAX_SAMPLES_COUNT];\r\nuniform sampler2D noiseTexture;\r\nuniform vec2      noiseTexelSize;\r\nuniform sampler2D diffuseTexture;\r\nuniform sampler2D depthTexture;\r\nuniform sampler2D normalTexture;\r\nuniform vec2      srcTexelSize;\r\nuniform vec2      camNearFar;\r\nuniform mat4      projMatrix;\r\n\r\nuniform float aspectRatio;\r\nuniform float tanHalfFOV;\r\n\r\nuniform float kernelRadius;\r\nuniform float depthThreshold;\r\nuniform float factor;\r\n\r\nvarying vec2 vUv;\r\n\r\nfloat CalcViewZ(vec2 screenPos)\r\n{\r\n  float depth = texture2D(depthTexture, screenPos).x;\r\n  // [0, 1]->[-1, 1]\r\n  float clipedZ = 2.0 * depth - 1.0;\r\n  // see THREE.js camera.makeFrustum for projection details\r\n  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\r\n}\r\n\r\nvec3 ViewPosFromDepth(vec2 screenPos)\r\n{\r\n  vec3 viewPos;\r\n  viewPos.z = CalcViewZ(screenPos);\r\n  //[0, 1]->[-1, 1]\r\n  vec2 projPos = 2.0 * screenPos - 1.0;\r\n  // reconstruct viewposition in right-handed sc with z to viewer\r\n  viewPos.xy = vec2(\r\n                    projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\r\n                    projPos.y * tanHalfFOV * abs(viewPos.z)\r\n                   );\r\n  return viewPos;\r\n}\r\n\r\nvoid main() {\r\n  vec3 viewPos = ViewPosFromDepth(vUv);\r\n  // remap coordinates to prevent noise exture rescale\r\n  vec2 vUvNoise = vUv / srcTexelSize * noiseTexelSize;\r\n  vec4 normalData = texture2D(normalTexture, vUv);\r\n  // return for background fragments (their normals are zero vectors)\r\n  if (length(normalData.rgb) < EPSILON) {\r\n    // 0.0 in alpha component means that it is background fragment\r\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\r\n    return;\r\n  }\r\n  //[0, 1] -> [-1, 1]\r\n  vec3 normal = (normalData.rgb * 2.0 - 1.0);\r\n  // normalData.a store 1.0 if normal was build for frontfaced surface\r\n  // and 0.0 in other case\r\n  if (normalData.a < EPSILON) {\r\n    normal *= -1.0;\r\n  }\r\n  // get random vector for sampling sphere rotation\r\n  vec3 randN = texture2D(noiseTexture, vUvNoise).rgb * 2.0 - 1.0;\r\n  randN = normalize(randN);\r\n  // build TBN (randomly rotated around normal)\r\n  vec3 tangent   = normalize(randN - normal * dot(randN, normal));\r\n  vec3 bitangent = cross(tangent, normal);\r\n  mat3 TBN = mat3(tangent, bitangent, normal);\r\n  // calc AO value\r\n  float AO = 0.0;\r\n  for (int i = 0 ; i < MAX_SAMPLES_COUNT ; i++) {\r\n    // rotate sampling kernel around normal\r\n    vec3 reflectedSample = TBN * samplesKernel[i];\r\n    // get sample\r\n    vec3 samplePos = viewPos + reflectedSample * kernelRadius;\r\n\r\n    // project sample to screen to get sample's screen pos\r\n    vec4 SampleScrPos = vec4(samplePos, 1.0);\r\n    // eye -> clip\r\n    SampleScrPos = projMatrix * SampleScrPos;\r\n    // normalize\r\n    SampleScrPos.xy /= SampleScrPos.w;\r\n    //[-1, 1] -> [0, 1]\r\n    SampleScrPos.xy = (SampleScrPos.xy + vec2(1.0)) * 0.5;\r\n\r\n    // get view z for sample projected to the objct surface\r\n    float sampleDepth = CalcViewZ(SampleScrPos.xy);\r\n    // calc occlusion made by object surface at the sample\r\n    AO += step(samplePos.z, sampleDepth);\r\n  }\r\n  // calc result AO-map color\r\n  AO = 1.0 - max(0.0, AO / float(MAX_SAMPLES_COUNT) * factor);\r\n  // write value to AO-map\r\n  gl_FragColor = vec4(AO, AO, AO, 1.0);\r\n}\r\n",transparent:!1,depthTest:!1,depthWrite:!1}),e}return m(t,e),t}(Ra),ox=[-2,-1,0,1,2],ax=function(e){function t(){var e;return h(this,t),(e=d(this,f(t).call(this))).setValues.call(c(e),{uniforms:{depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new x(1/512,1/512)},aoMap:{type:"t",value:null},samplesOffsets:{type:"fv1",value:ox}},vertexShader:nf,fragmentShader:"precision highp float;\r\n#define EPSILON 0.0000001\r\n\r\n#define MAX_SAMPLES_COUNT 5\r\nuniform float samplesOffsets[MAX_SAMPLES_COUNT];\r\nuniform sampler2D aoMap;\r\nuniform sampler2D depthTexture;\r\nuniform vec2      srcTexelSize;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n  float x = vUv.x;\r\n  float y = vUv.y;\r\n  vec4 res = vec4(0.0);\r\n  res.a = texture2D(aoMap, vec2(x, y )).a;\r\n  // return for background fragments (0.0 in alpha component means that it is background fragment)\r\n  if (res.a < EPSILON) {\r\n    gl_FragColor = res;\r\n    return;\r\n  }\r\n\r\n  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\r\n  float weightSum = 0.0;\r\n  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\r\n    if (texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )).a < EPSILON) {\r\n      continue;\r\n    }\r\n    vec2 samplePos = vec2(x + samplesOffsets[i] * srcTexelSize.x, y);\r\n    float depth = texture2D(depthTexture, samplePos).x;\r\n    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\r\n    res.rgb += texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )).rgb * weight;\r\n    weightSum += weight;\r\n  }\r\n  res.rgb = res.rgb / weightSum;\r\n  gl_FragColor = res;\r\n}\r\n",transparent:!1,depthTest:!1,depthWrite:!1}),e}return m(t,e),t}(Ra),sx=[-2,-1,0,1,2],lx=function(e){function t(e){var n;return h(this,t),(n=d(this,f(t).call(this,e))).setValues.call(c(n),{uniforms:{diffuseTexture:{type:"t",value:null},depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new x(1/512,1/512)},aoMap:{type:"t",value:null},samplesOffsets:{type:"fv1",value:sx},projMatrix:{type:"mat4",value:new V},aspectRatio:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},fogNearFar:{type:"v2",value:new x(100,100)},fogColor:{type:"v4",value:new k(0,.5,0,1)}},vertexShader:nf,fragmentShader:"precision highp float;\r\n#define EPSILON 0.0000001\r\n\r\n#define MAX_SAMPLES_COUNT 5\r\nuniform float samplesOffsets[MAX_SAMPLES_COUNT];\r\nuniform sampler2D diffuseTexture;\r\nuniform sampler2D aoMap;\r\nuniform sampler2D depthTexture;\r\nuniform vec2      srcTexelSize;\r\n\r\nuniform mat4  projMatrix;\r\nuniform float aspectRatio;\r\nuniform float tanHalfFOV;\r\n\r\n#ifdef USE_FOG\r\n  uniform vec2 fogNearFar;\r\n  uniform vec4 fogColor;\r\n#endif\r\nvarying vec2 vUv;\r\n\r\nfloat CalcViewZ(vec2 screenPos)\r\n{\r\n  float depth = texture2D(depthTexture, screenPos).x;\r\n  // [0, 1]->[-1, 1]\r\n  float clipedZ = 2.0 * depth - 1.0;\r\n  // see THREE.js camera.makeFrustum for projection details\r\n  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\r\n}\r\n\r\nvec3 ViewPosFromDepth(vec2 screenPos)\r\n{\r\n  vec3 viewPos;\r\n  viewPos.z = CalcViewZ(screenPos);\r\n  //[0, 1]->[-1, 1]\r\n  vec2 projPos = 2.0 * screenPos - 1.0;\r\n  // reconstruct viewposition in right-handed sc with z to viewer\r\n  viewPos.xy = vec2(\r\n  projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\r\n  projPos.y * tanHalfFOV * abs(viewPos.z)\r\n  );\r\n  return viewPos;\r\n}\r\n\r\nvoid main() {\r\n  vec3 viewPos = ViewPosFromDepth(vUv);\r\n  float x = vUv.x;\r\n  float y = vUv.y;\r\n  vec4 color = texture2D(diffuseTexture, vec2(x, y));\r\n  vec4 res = vec4(0.0);\r\n  res.a = texture2D(aoMap, vec2(x, y )).a;\r\n  // return for background fragments (0.0 in alpha component means that it is background fragment)\r\n  if (res.a < EPSILON) {\r\n    gl_FragColor = color;\r\n    return;\r\n  }\r\n\r\n  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\r\n  float weightSum = 0.0;\r\n  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\r\n    if (texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)).a < EPSILON) {\r\n      continue;\r\n    }\r\n    vec2 samplePos = vec2(x, y + samplesOffsets[i] * srcTexelSize.y);\r\n    float depth = texture2D(depthTexture, samplePos).x;\r\n    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\r\n    res.rgb += texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)).rgb * weight;\r\n    weightSum += weight;\r\n  }\r\n  res.rgb /= weightSum;\r\n\r\n  #if defined(USE_FOG) && !defined(FOG_TRANSPARENT)\r\n    // Add fog to the result value\r\n    // Proper way to get an image with fog and ao requires formula:\r\n    //          gl_FragColor = fragColor*AO*(1-fogFactor) + fogColor*fogFactor\r\n    // But we have already fogged molecule to add AO too. Let's split the straight formula into our real steps!\r\n    // We have:  AO, fogFactor, fogColor,\r\n    //          color = fragColor*(1-fogFactor) + fogColor*fogFactor (it comes from diffuseTexture,\r\n    //                                                                where molecule has been already drawn with fog)\r\n    // Transform:\r\n    //          fragColor*AO*(1-fogFactor) + fogColor*fogFactor =\r\n    //        = [fragColor*(1-fogFactor) = color - fogColor*fogFactor] =\r\n    //        = (color - fogColor*fogFactor)*AO + fogColor*fogFactor =\r\n    //        = color*AO + fogColor*fogFactor*(1 - AO)\r\n    // Result:  gl_FragColor = color*AO + fogColor*fogFactor*(1 - AO)\r\n    float fogFactor = smoothstep(fogNearFar.x, fogNearFar.y, - viewPos.z) * fogColor.a;\r\n    gl_FragColor.rgb = color.rgb * res.rgb + fogColor.rgb * fogFactor *(vec3(1.0, 1.0, 1.0) - res.rgb);\r\n  #else\r\n    gl_FragColor.rgb = color.rgb * res.rgb;\r\n  #endif\r\n  gl_FragColor.a = color.a;\r\n}\r\n",transparent:!1,depthTest:!1,depthWrite:!1}),n.setValues(e),n}return m(t,e),Tc(t,[{key:"setValues",value:function(e){if(void 0!==e){Hh(f(t.prototype),"setValues",this).call(this,e);var n={};this.useFog&&(n.USE_FOG=1),this.fogTransparent&&(n.FOG_TRANSPARENT=1),this.defines=n}}}]),t}(Ra);lx.prototype.useFog=!0,lx.prototype.fogTransparent=!1;var ux=function(e){function t(){var e;h(this,t),e=d(this,f(t).call(this));var n={uniforms:{srcL:{type:"t",value:null},srcR:{type:"t",value:null}},vertexShader:nf,fragmentShader:"precision highp float;\r\n\r\nuniform sampler2D srcL;\r\nuniform sampler2D srcR;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n  vec4 l = texture2D(srcL, vUv);\r\n  vec4 r = texture2D(srcR, vUv);\r\n  gl_FragColor = vec4(l.r, r.g, r.b, 1.0);\r\n}\r\n",transparent:!1,depthTest:!1,depthWrite:!1};return e.setValues(n),e}return m(t,e),t}(Ra),cx=function(){function e(){h(this,e),this.position=new E(0,0,0),this.scale=1,this.orientation=new b(0,0,0,1)}return Tc(e,[{key:"set",value:function(e,t,n){this.position=e,this.scale=t,this.orientation=n}}]),e}(),hx=new(function(){function e(){h(this,e)}return Tc(e,[{key:"setup",value:function(e,t){this._startTime=void 0,this._endTime=void 0,this._isPaused=!1,this._srcView=e,this._dstView=t,this._isMoving=!1}},{key:"isMoving",value:function(){return this._isMoving}},{key:"wasStarted",value:function(){return void 0!==this._startTime&&void 0!==this._endTime}},{key:"start",value:function(){this._startTime=Date.now();var e=eh.now.interpolateViews?1500:0;this._endTime=this._startTime+e,this._isMoving=!0}},{key:"getCurrentView",value:function(){if(void 0===this._srcView||void 0===this._dstView||!this._isMoving||!this.wasStarted())return{success:!1};var e=this.createView(),t=Date.now();if(t>this._endTime)return e=this._dstView,this.reset(),{success:!0,view:e};var n=(t-this._startTime)/(this._endTime-this._startTime);return e.position.copy(this._srcView.position),e.position.lerp(this._dstView.position,n),e.scale=(1-n)*this._srcView.scale+n*this._dstView.scale,e.orientation.copy(this._srcView.orientation),e.orientation.slerp(this._dstView.orientation,n),{success:!0,view:e}}},{key:"reset",value:function(){this._startTime=this._endTime=0,this._isMoving=!1}},{key:"pause",value:function(){this._isPaused||(this.setup(this.getCurrentView().view,this._dstView),this._isPaused=!0)}},{key:"resume",value:function(){this._isPaused=!1}},{key:"createView",value:function(){return new cx}}]),e}());function dx(e,t){this.context=e,this._opts=s.merge({path:"/"},t)}Rf(dx.prototype),dx.prototype.removeCookie=function(e){var t=this._toCount(e),n=this._getSimpleCookie(t);if(n){this._removeSimpleCookie(t),n=parseInt(n,10);for(var r=0;r<n;++r)this._removeSimpleCookie(e+r)}else this._removeSimpleCookie(e)},dx.prototype.setCookie=function(e,t){this.removeCookie(e);var n=function(e,t){for(var n=e.length,r=[],i=0,o=0;o<n;i++,o+=t)r[i]=e.slice(o,o+t);return r}(t=encodeURIComponent(t),4e3-e.length-1),r=n.length;if(1!==r){var i=this._toCount(e);this._setSimpleCookie(i,r.toString());for(var o=0;o<r;++o)this._setSimpleCookie(e+o,n[o])}else this._setSimpleCookie(e,t)},dx.prototype.getCookie=function(e){var t=this._toCount(e),n=this._getSimpleCookie(t);if(!n)return this._getSimpleCookie(e);n=parseInt(n,10);for(var r=[],i=0;i<n;++i)r[i]=this._getSimpleCookie(e+i);return r.join("")},dx.prototype._toCount=function(e){return e+"Cnt"},dx.prototype._removeSimpleCookie=function(e){document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;")},dx.prototype._getExpirationDate=function(){var e=new Date;return e.setFullYear(e.getFullYear()+10),e},dx.prototype._setSimpleCookie=function(e,t){document.cookie="".concat(e,"=").concat(t,";expires=").concat(this._getExpirationDate().toUTCString(),";path=").concat(this._opts.path)},dx.prototype._getSimpleCookie=function(e){var t=document.cookie.match(new RegExp("(?:^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[1]):""},dx.prototype._exists=function(e){return document.cookie.match(new RegExp("(?:^|; )".concat(e,"=([^;]*)")))};var fx,px,mx,vx,gx,yx,_x,xx,bx,wx=function(){function e(t){h(this,e),this._mainCamera=new rn,this._button=null,this._onToggle=t,this._molContainer=new Sf.RCGroup,this._user=new Sf.RCGroup,this._scalingPivot=new oe,this._user.add(this._scalingPivot),this._controller1=null,this._controller2=null,this._pressedGripsCounter=0,this._distance=0,this._gfx=null}return Tc(e,[{key:"startScalingByControllers",value:function(){this._distance=this._controller1.position.distanceTo(this._controller2.position),Sf.getMiddlePoint(this._controller1.position,this._controller2.position,this._scalingPivot.position),this._scalingPivot.scale.set(1,1,1),this._scalingPivot.updateMatrix(),this._scalingPivot.updateMatrixWorld(),this._scalingPivot.addSavingWorldTransform(this._molContainer)}},{key:"stopScalingByControllers",value:function(){this._gfx.scene.addSavingWorldTransform(this._molContainer)}},{key:"handleGripsDown",value:function(e){this._pressedGripsCounter++,2===this._pressedGripsCounter?this.startScalingByControllers():1===this._pressedGripsCounter&&e.target.addSavingWorldTransform(this._molContainer)}},{key:"handleGripsUp",value:function(e){this._pressedGripsCounter--,1===this._pressedGripsCounter?(this.stopScalingByControllers(),(e.target===this._controller1?this._controller2:this._controller1).addSavingWorldTransform(this._molContainer)):0===this._pressedGripsCounter&&this._gfx.scene.addSavingWorldTransform(this._molContainer)}},{key:"enable",value:function(e){if(e){this._gfx=e;var t=e.renderer,n=e.camera;if(!t)throw new Error("No renderer is available to toggle WebVR");if(!n)throw new Error("No camera is available to toggle WebVR");t.xr.enabled=!0,this._button?this._button.style.display="block":(this._button=function(e){function t(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="transparent",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator){var n=document.createElement("button");return n.style.display="none",t(n),navigator.xr.isSessionSupported("immersive-vr").then((function(t){return t?function(t){t.style.display="",t.style.cursor="pointer",t.style.left="calc(50% - 50px)",t.style.width="100px",t.textContent="ENTER VR";var n=null;function r(){n.removeEventListener("end",r),t.textContent="ENTER VR",n=null}function i(i){i.addEventListener("end",r),e._gfx.renderer.xr.setReferenceSpaceType("local"),e._gfx.renderer.xr.setSession(i),t.textContent="EXIT VR",n=i}t.onmouseenter=function(){t.style.opacity="1.0"},t.onmouseleave=function(){t.style.opacity="0.5"},t.onclick=function(){null===n?(navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]}).then(i),e.moveSceneBehindHeadset()):n.end()}}(n):function(e){e.style.display="",e.style.cursor="auto",e.style.left="calc(50% - 75px)",e.style.width="150px",e.textContent="VR NOT FOUND",e.onmouseenter=null,e.onmouseleave=null,e.onclick=null}(n)})),n}var r=document.createElement("a");return r.href="https://webvr.info",r.innerHTML="WEBXR NOT SUPPORTED",r.style.left="calc(50% - 90px)",r.style.width="180px",r.style.textDecoration="none",t(r),r}(this),document.body.appendChild(this._button)),this._mainFog=eh.now.fog,eh.set("fog",!1),this._plugVRNodesIntoScene(e,t),this._setControllersListeners(),this._onToggle&&this._onToggle(!0)}else zc.warn("WebVR couldn't be enabled, because gfx is not defined")}},{key:"_plugVRNodesIntoScene",value:function(e,t){this._mainCamera.copy(e.camera),e.scene.add(this._user),e.scene.add(this._molContainer),this._molContainer.add(e.root),this._controller1=t.xr.getController(0),this._controller2=t.xr.getController(1);var n=this._createControllerMesh();this._controller1.add(n),this._controller2.add(n.clone()),this._user.add(this._controller1),this._user.add(this._controller2)}},{key:"_setControllersListeners",value:function(){var e=this;this._controller1.addEventListener("selectstart",(function(t){e.handleGripsDown(t)})),this._controller1.addEventListener("selectend",(function(t){e.handleGripsUp(t)})),this._controller2.addEventListener("selectstart",(function(t){e.handleGripsDown(t)})),this._controller2.addEventListener("selectend",(function(t){e.handleGripsUp(t)})),this._controller1.addEventListener("squeezestart",(function(t){e.handleGripsDown(t)})),this._controller1.addEventListener("squeezeend",(function(t){e.handleGripsUp(t)})),this._controller2.addEventListener("squeezestart",(function(t){e.handleGripsDown(t)})),this._controller2.addEventListener("squeezeend",(function(t){e.handleGripsUp(t)}))}},{key:"disable",value:function(){if(this._gfx){var e=this._gfx,t=e.renderer,n=e.camera;if(!t)throw new Error("No renderer is available to toggle WebVR");t.setAnimationLoop(null);var r=t.xr.getSession();r&&r.end(),t.xr.enabled=!1,this._button&&(this._button.style.display="none"),eh.set("fog",this._mainFog),this._unplugVRNodesFromScene(n),this._onToggle&&this._onToggle(!1)}}},{key:"_unplugVRNodesFromScene",value:function(e){this._mainCamera&&e&&e.copy(this._mainCamera);var t=this._molContainer.children[0];t&&this._gfx.scene.add(t),this._molContainer.parent.remove(this._molContainer),this._user&&this._gfx.scene.remove(this._user),this._molContainer=null,this._user=null,this._scalingPivot=null,this._user=null,this._controller1=null,this._controller2=null}},{key:"_createControllerMesh",value:function(){var e=new ba(.04,.04,.3),t=new hf({lights:!1,overrideColor:!0});t.setUberOptions({fixedColor:new $e(4474111)}),t.updateUniforms();var n=new Gt(e,t);return n.rotateX(-Math.PI/2),n}},{key:"updateMoleculeScale",value:function(){if(this._controller1&&this._controller2&&2===this._pressedGripsCounter){Sf.getMiddlePoint(this._controller1.position,this._controller2.position,this._scalingPivot.position);var e=this._controller1.position.distanceTo(this._controller2.position),t=e/this._distance;this._scalingPivot.scale.multiplyScalar(t),this._distance=e}}},{key:"moveSceneBehindHeadset",value:function(){var e=this._gfx,t=e.camera,n=this._molContainer;n.matrix.identity(),n.position.set(0,0,-4),n.updateMatrix(),n.matrixWorld.multiplyMatrices(t.matrixWorld,n.matrix),e.scene.addSavingWorldTransform(n),this._onToggle&&this._onToggle(!0)}},{key:"getCanvas",value:function(){var e=this._gfx;return e&&e.renderer?e.renderer.domElement:null}}]),e}(),Sx=Qd.selectors,Ex=Qd.Atom,Tx=Qd.Residue,Mx=Qd.Chain,Cx=Qd.Molecule,Ax="Could not find suitable loader for this source",Rx=$c.createElement;function Px(e){var t=e.lastIndexOf(".");return t>=0&&(e=e.substr(0,t)),e}function kx(e,t,n){void 0!==n?e.debug("".concat(t,"... ").concat(Math.floor(100*n),"%")):e.debug("".concat(t,"..."))}function Lx(){return eh.now.fogColorEnable?eh.now.fogColor:eh.now.bg.color}function Nx(e){Nc.call(this),this._opts=s.merge({settingsCookie:"settings",cookiePath:"/"},e),this._gfx=null,this._container=e&&e.container||document.getElementById("miew-container")||s.head(document.getElementsByClassName("miew-container"))||document.body,this._containerRoot=this._container,this._running=!1,this._halting=!1,this._building=!1,this._needRender=!0,this._hotKeysEnabled=!0,this.settings=eh;var t=zc;t.console=!1,t.level="info",this.logger=t,this._cookies=new dx(this),this.restoreSettings(),e&&e.settings&&this.settings.set(e.settings),this._spinner=null,this._loading=[],this._animInterval=null,this._visuals={},this._curVisualName=null,this._objects=[],this._sourceWindow=null,this.reset(),this._repr&&t.debug("Selected ".concat(this._repr.mode.name," mode with ").concat(this._repr.colorer.name," colorer."));var n=this;Nx.registeredPlugins.forEach((function(e){e.call(n)})),this._initOnSettingsChanged()}function Ix(e,t){for(var n=e;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(t)}Nx.prototype=Object.create(Nc.prototype),Nx.prototype.constructor=Nx,Nx.prototype.getMaxRepresentationCount=function(){return Jv.NUM_REPRESENTATION_BITS},Nx.prototype._updateShadowCamera=function(){var e=new V,t=new E,n={center:new E,halfSize:new E};return function(){this._gfx.scene.updateMatrixWorld();for(var r=0;r<this._gfx.scene.children.length;r++)if("DirectionalLight"===this._gfx.scene.children[r].type){var i=this._gfx.scene.children[r];e.copy(i.shadow.camera.matrixWorldInverse),this.getOBB(e,n),t.subVectors(i.target.position,i.position),i.position.subVectors(n.center,t),i.target.position.copy(n.center),i.shadow.bias=.09,i.shadow.camera.bottom=-n.halfSize.y,i.shadow.camera.top=n.halfSize.y,i.shadow.camera.right=n.halfSize.x,i.shadow.camera.left=-n.halfSize.x,i.shadow.camera.near=t.length()-n.halfSize.z,i.shadow.camera.far=t.length()+n.halfSize.z,i.shadow.camera.updateProjectionMatrix()}}}(),Nx.prototype.init=function(){var e=this._container,t=$c.createElement("div",{class:"miew-canvas"});Ix(e,t),this._container=t;var n=document.createDocumentFragment();if(n.appendChild(this._msgMode=Rx("div",{class:"mode-message overlay"},Rx("p",{},"COMPONENT EDIT MODE"))),n.appendChild(this._msgAtomInfo=Rx("div",{class:"atom-info overlay"},Rx("p",{},""))),e.appendChild(n),null!==this._gfx)return!0;var r=this;this._showMessage("Viewer is being initialized...");try{this._initGfx(),this._initListeners(),this._spinner=new yc({lines:13,length:28,width:14,radius:42,color:"#fff",zIndex:700}),window.top.addEventListener("keydown",(function(e){r._onKeyDown(e)})),window.top.addEventListener("keyup",(function(e){r._onKeyUp(e)})),this._objectControls=new W_(this._gfx.root,this._gfx.pivot,this._gfx.camera,this._gfx.renderer.domElement,(function(){return r._getAltObj()})),this._objectControls.addEventListener("change",(function(e){switch(eh.now.shadow.on&&r._updateShadowCamera(),e.action){case"rotate":r.dispatchEvent({type:"rotate",quaternion:e.quaternion});break;case"zoom":r.dispatchEvent({type:"zoom",factor:e.factor});break;default:r.dispatchEvent({type:e.action})}r.dispatchEvent({type:"transform"}),r._needRender=!0}));var i=this._gfx;this._picker=new q_(i.root,i.camera,i.renderer.domElement),this._picker.addEventListener("newpick",(function(e){r._onPick(e)})),this._picker.addEventListener("dblclick",(function(e){r.center(e)}))}catch(e){if("TypeError"===e.name&&"Cannot read property 'getExtension' of null"===e.message)this._showMessage("Could not create WebGL context.");else{if(!(e.message.search(/webgl/i)>1))throw this._showMessage("Viewer initialization failed."),e;this._showMessage(e.message)}return!1}var o=this._opts&&this._opts.load;if(o){var a=this._opts&&this._opts.type;this.load(o,{fileType:a,keepRepsInfo:!0})}return!0},Nx.prototype.term=function(){this._showMessage("Viewer has been terminated."),this._loading.forEach((function(e){e.cancel()})),this._loading.length=0,this.halt(),this._gfx=null},Nx.prototype._showMessage=function(e){var t=document.createElement("div");t.setAttribute("class","miew-message"),t.appendChild(document.createElement("p")).appendChild(document.createTextNode(e)),Ix(this._container,t)},Nx.prototype._showCanvas=function(){Ix(this._container,this._gfx.renderer.domElement)},Nx.prototype._requestAnimationFrame=function(e){var t=this._gfx.renderer.xr;t&&t.enabled?this._gfx.renderer.setAnimationLoop(e):requestAnimationFrame(e)},Nx.prototype._initGfx=function(){var e={width:this._container.clientWidth,height:this._container.clientHeight},t={preserveDrawingBuffer:!0,alpha:!0,premultipliedAlpha:!1};eh.now.antialias&&(t.antialias=!0),e.renderer2d=new V_,e.renderer=new di(t),e.renderer.shadowMap.enabled=eh.now.shadow.on,e.renderer.shadowMap.type=1,rf.init(e.renderer),e.renderer.getContext().getExtension("EXT_frag_depth")||eh.set("zSprites",!1),e.renderer.getContext().getExtension("WEBGL_depth_texture")&&e.renderer.getContext().getExtension("WEBGL_draw_buffers")||eh.set("ao",!1),e.renderer.autoClear=!1,e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(e.width,e.height),e.renderer.setClearColor(eh.now.bg.color,Number(!eh.now.bg.transparent)),e.renderer.clearColor(),e.renderer2d.setSize(e.width,e.height),e.camera=new rn(eh.now.camFov,e.width/e.height,eh.now.camNear,eh.now.camFar),e.camera.setMinimalFov(eh.now.camFov),e.camera.position.z=eh.now.camDistance,e.camera.updateProjectionMatrix(),e.camera.layers.set(Sf.LAYERS.DEFAULT),e.camera.layers.enable(Sf.LAYERS.VOLUME),e.camera.layers.enable(Sf.LAYERS.VOLUME_BFPLANE),e.stereoCam=new gl,e.scene=new ae;var n=Lx();e.scene.fog=new pi(n,eh.now.camNear,eh.now.camFar),e.root=new Sf.RCGroup,e.scene.add(e.root),e.pivot=new Sf.RCGroup,e.root.add(e.pivot),e.selectionScene=new ae,e.selectionRoot=new ci,e.selectionRoot.matrixAutoUpdate=!1,e.selectionScene.add(e.selectionRoot),e.selectionPivot=new ci,e.selectionPivot.matrixAutoUpdate=!1,e.selectionRoot.add(e.selectionPivot);var r=new Hs(16777215,.45);r.position.set(0,.414,1),r.layers.enable(Sf.LAYERS.TRANSPARENT),r.castShadow=!0,r.shadow=new js,r.shadow.bias=.09,r.shadow.radius=eh.now.shadow.radius;var i=e.renderer.getPixelRatio(),o=Math.max(e.width,e.height)*i;r.shadow.mapSize.width=o,r.shadow.mapSize.height=o,r.target.position.set(0,0,0),e.scene.add(r),e.scene.add(r.target);var a=new Ws(6710886);a.layers.enable(Sf.LAYERS.TRANSPARENT),e.scene.add(a),e.axes=new Y_(e.root,e.camera);var s=e.width*i,l=e.height*i;e.offscreenBuf=new L(s,l,{minFilter:1006,magFilter:1003,format:1023,depthBuffer:!0}),e.renderer.getContext().getExtension("WEBGL_depth_texture")&&(e.offscreenBuf.depthTexture=new mo,e.offscreenBuf.depthTexture.type=1012),e.offscreenBuf2=new L(s,l,{minFilter:1006,magFilter:1006,format:1023,depthBuffer:!1}),e.offscreenBuf3=new L(s,l,{minFilter:1006,magFilter:1006,format:1023,depthBuffer:!1}),e.offscreenBuf4=new L(s,l,{minFilter:1006,magFilter:1006,format:1023,depthBuffer:!1}),e.volBFTex=e.offscreenBuf3,e.volFFTex=e.offscreenBuf4,e.volWFFTex=e.offscreenBuf,e.renderer.getContext().getExtension("OES_texture_float")?(e.offscreenBuf5=new L(s,l,{minFilter:1006,magFilter:1006,format:1023,type:1015,depthBuffer:!1}),e.offscreenBuf6=new L(s,l,{minFilter:1006,magFilter:1006,format:1023,type:1015,depthBuffer:!1}),e.offscreenBuf7=new L(s,l,{minFilter:1006,magFilter:1006,format:1023,type:1015,depthBuffer:!0}),e.volBFTex=e.offscreenBuf5,e.volFFTex=e.offscreenBuf6,e.volWFFTex=e.offscreenBuf7):this.logger.warn("Device doesn't support OES_texture_float extension"),e.stereoBufL=new L(s,l,{minFilter:1006,magFilter:1006,format:1023,depthBuffer:!1}),e.stereoBufR=new L(s,l,{minFilter:1006,magFilter:1006,format:1023,depthBuffer:!1}),this._gfx=e,this._showCanvas(),this._embedWebXR("WEBVR"===eh.now.stereo),this._container.appendChild(e.renderer2d.getElement());var u=new Rc;u.domElement.style.position="absolute",u.domElement.style.right="0",u.domElement.style.bottom="0",this._container.appendChild(u.domElement),this._fps=u,this._fps.show(eh.now.fps)},Nx.prototype._initListeners=function(){var e=this;window.addEventListener("resize",(function(){e._onResize()}))},Nx.prototype._makeUniqueVisualName=function(e){if(!e)return Math.random().toString();for(var t=e,n=1;this._visuals.hasOwnProperty(t);)t="".concat(e," (").concat(n.toString(),")"),n++;return t},Nx.prototype._addVisual=function(e){if(!e)return null;var t=this._makeUniqueVisualName(e.name);return e.name=t,this._visuals[t]=e,this._gfx.pivot.add(e),e.getSelectionGeo&&this._gfx.selectionPivot.add(e.getSelectionGeo()),t},Nx.prototype._removeVisual=function(e){var t="",n=null;e instanceof Tf?(t=e.name,n=e):"string"==typeof e&&(t=e,n=this._visuals[t]),n&&this._visuals.hasOwnProperty(t)&&this._visuals[t]===n&&(t===this._curVisualName&&(this._curVisualName=void 0),delete this._visuals[t],n.release(),this._needRender=!0)},Nx.prototype._forEachVisual=function(e){for(var t in this._visuals)this._visuals.hasOwnProperty(t)&&e(this._visuals[t])},Nx.prototype._releaseAllVisuals=function(){if(this._gfx&&this._gfx.pivot){for(var e in this._visuals)this._visuals.hasOwnProperty(e)&&this._visuals[e].release();this._visuals={}}},Nx.prototype._forEachComplexVisual=function(e){if(this._gfx&&this._gfx.pivot)for(var t in this._visuals)this._visuals.hasOwnProperty(t)&&this._visuals[t]instanceof Jv&&e(this._visuals[t])},Nx.prototype._getComplexVisual=function(e){e=e||this._curVisualName;var t=null,n=null;return this._forEachComplexVisual((function(r){t=r,r.name===e&&(n=r)})),n||t},Nx.prototype._getVolumeVisual=function(){var e=null;return this._forEachVisual((function(t){t instanceof sg&&(e=t)})),e},Nx.prototype._getVisualForComplex=function(e){if(!e)return null;var t=null;return this._forEachComplexVisual((function(n){n.getComplex()===e&&(t=n)})),t},Nx.prototype.getVisuals=function(){return Object.keys(this._visuals)},Nx.prototype.getComplexVisualsCount=function(){var e=0;return this._forEachComplexVisual((function(){return e++})),e},Nx.prototype.getCurrentVisual=function(){return this._curVisualName},Nx.prototype.setCurrentVisual=function(e){this._visuals[e]&&(this._curVisualName=e)},Nx.prototype.run=function(){var e=this;if(!this._running){if(this._running=!0,this._halting)return void(this._halting=!1);this._objectControls.enable(!0),hx.resume(),this._requestAnimationFrame((function(){return e._onTick()}))}},Nx.prototype.halt=function(){this._running&&(this._discardComponentEdit(),this._discardFragmentEdit(),this._objectControls.enable(!1),hx.pause(),this._halting=!0)},Nx.prototype.enableHotKeys=function(e){this._hotKeysEnabled=e,this._objectControls.enableHotkeys(e)},Nx.prototype._onResize=function(){this._needRender=!0;var e=this._gfx;e.width=this._container.clientWidth,e.height=this._container.clientHeight,e.camera.aspect=e.width/e.height,e.camera.setMinimalFov(eh.now.camFov),e.camera.updateProjectionMatrix(),e.renderer.setSize(e.width,e.height),e.renderer2d.setSize(e.width,e.height),this.dispatchEvent({type:"resize"})},Nx.prototype._resizeOffscreenBuffers=function(e,t,n){var r=this._gfx,i="NONE"===(n=n||"NONE")||"ANAGLYPH"===n,o=i?1:.5;r.offscreenBuf.setSize(o*e,t),r.offscreenBuf2.setSize(o*e,t),r.offscreenBuf3.setSize(o*e,t),r.offscreenBuf4.setSize(o*e,t),r.offscreenBuf5&&r.offscreenBuf5.setSize(o*e,t),r.offscreenBuf6&&r.offscreenBuf6.setSize(o*e,t),r.offscreenBuf7&&r.offscreenBuf7.setSize(o*e,t),i&&(r.stereoBufL.setSize(e,t),r.stereoBufR.setSize(e,t))},Nx.prototype._onTick=function(){var e=this;if(this._halting)return this._running=!1,void(this._halting=!1);this._fps.update(),this._requestAnimationFrame((function(){return e._onTick()})),this._onUpdate(),this._needRender&&(this._onRender(),this._needRender=!eh.now.suspendRender||"WEBVR"===eh.now.stereo)},Nx.prototype._getBSphereRadius=function(){var e=0;return this._forEachVisual((function(t){e=Math.max(e,t.getBoundaries().boundingSphere.radius)})),e*this._objectControls.getScale()},Nx.prototype.getOBB=function(){var e=new Se,t=new xe,n=new xe,r=new V,i=[new E,new E,new E,new E];return function(o,a){n.makeEmpty(),this._forEachVisual((function(r){e.copy(r.getBoundaries().boundingSphere),e.applyMatrix4(r.matrixWorld).applyMatrix4(o),e.getBoundingBox(t),n.union(t)})),n.getCenter(a.center),r.getInverse(o),a.center.applyMatrix4(r);var s=n.min,l=n.max;i[0].set(s.x,s.y,s.z),i[1].set(l.x,s.y,s.z),i[2].set(s.x,l.y,s.z),i[3].set(s.x,s.y,l.z);for(var u=0,c=i.length;u<c;u++)i[u].applyMatrix4(r);a.halfSize.set(Math.abs(i[0].x-i[1].x),Math.abs(i[0].y-i[2].y),Math.abs(i[0].z-i[3].z)).multiplyScalar(.5)}}(),Nx.prototype._updateFog=function(){var e=this._gfx;if(eh.now.fog){if(void 0===e.scene.fog||null===e.scene.fog){var t=Lx();e.scene.fog=new pi(t),this._setUberMaterialValues({fog:eh.now.fog})}!function(e,t,n){e.near=t-n*eh.now.fogNearFactor,e.far=t+n*eh.now.fogFarFactor}(e.scene.fog,e.camera.position.z,this._getBSphereRadius())}else e.scene.fog&&(e.scene.fog=void 0,this._setUberMaterialValues({fog:eh.now.fog}))},Nx.prototype._onUpdate=function(){void 0!==this.isScriptingCommandAvailable&&this.isScriptingCommandAvailable()&&!this._building&&this.callNextCmd(),this._objectControls.update(),this._forEachComplexVisual((function(e){e.getComplex().update()})),eh.now.autobuild&&!this._loading.length&&!this._building&&this._needRebuild()&&this.rebuild(),this._loading.length||this._building||this._needRebuild()||this._updateView(),this._updateFog(),this._gfx.renderer.xr.enabled&&this.webVR.updateMoleculeScale()},Nx.prototype._onRender=function(){var e=this._gfx;e.scene.updateMatrixWorld(),e.camera.updateMatrixWorld(),this._clipPlaneUpdateValue(this._getBSphereRadius()),this._fogFarUpdateValue(),e.renderer.setRenderTarget(null),e.renderer.clear(),this._renderFrame(eh.now.stereo)},Nx.prototype._renderFrame=(fx=new ux,px=new x,function(e){var t=this._gfx,n=t.renderer;n.getSize(px),"NONE"!==e&&(t.camera.focus=t.camera.position.z,t.stereoCam.aspect=1,"ANAGLYPH"===e?t.stereoCam.update(t.camera):t.stereoCam.updateHalfSized(t.camera,eh.now.camFov));var r=t.renderer.getPixelRatio();switch(this._resizeOffscreenBuffers(px.width*r,px.height*r,e),e){case"WEBVR":case"NONE":this._renderScene(t.camera,!1);break;case"SIMPLE":case"DISTORTED":n.setScissorTest(!0),n.setScissor(0,0,px.width/2,px.height),n.setViewport(0,0,px.width/2,px.height),this._renderScene(this._gfx.stereoCam.cameraL,"DISTORTED"===e),n.setScissor(px.width/2,0,px.width/2,px.height),n.setViewport(px.width/2,0,px.width/2,px.height),this._renderScene(this._gfx.stereoCam.cameraR,"DISTORTED"===e),n.setScissorTest(!1);break;case"ANAGLYPH":this._renderScene(this._gfx.stereoCam.cameraL,!1,t.stereoBufL),this._renderScene(this._gfx.stereoCam.cameraR,!1,t.stereoBufR),n.setRenderTarget(null),fx.uniforms.srcL.value=t.stereoBufL.texture,fx.uniforms.srcR.value=t.stereoBufR.texture,t.renderer.renderScreenQuad(fx)}t.renderer2d.render(t.scene,t.camera),eh.now.axes&&t.axes&&!t.renderer.xr.enabled&&t.axes.render(n)}),Nx.prototype._onBgColorChanged=function(){var e=this._gfx,t=Lx();e&&(e.scene.fog&&e.scene.fog.color.set(t),e.renderer.setClearColor(eh.now.bg.color,Number(!eh.now.bg.transparent))),this._needRender=!0},Nx.prototype._onFogColorChanged=function(){var e=this._gfx,t=Lx();e&&e.scene.fog&&e.scene.fog.color.set(t),this._needRender=!0},Nx.prototype._setUberMaterialValues=function(e){this._gfx.root.traverse((function(t){(t instanceof Gt||t instanceof no||t instanceof Qi)&&t.material instanceof hf&&(t.material.setValues(e),t.material.needsUpdate=!0)}))},Nx.prototype._enableMRT=function(e,t,n){var r=this._gfx,i=r.renderer.getContext(),o=i.getExtension("WEBGL_draw_buffers"),a=r.renderer.properties;if(e){r.renderer.setRenderTarget(n);var s=a.get(n.texture).__webglTexture;i.bindTexture(i.TEXTURE_2D,s),r.renderer.setRenderTarget(t);var l=a.get(t).__webglFramebuffer,u=a.get(t.texture).__webglTexture;i.bindFramebuffer(i.FRAMEBUFFER,l),l.width=t.width,l.height=t.height,i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,u,0),i.framebufferTexture2D(i.FRAMEBUFFER,o.COLOR_ATTACHMENT1_WEBGL,i.TEXTURE_2D,s,0),o.drawBuffersWEBGL([i.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1_WEBGL])}else o.drawBuffersWEBGL([i.COLOR_ATTACHMENT0,null])},Nx.prototype._renderScene=function(e,t,n){t=t||!1,n=n||null;var r=this._gfx;if(r.renderer.setClearColor(eh.now.bg.color,Number(!eh.now.bg.transparent)),r.renderer.setRenderTarget(n),r.renderer.clear(),r.renderer.xr.enabled)r.renderer.render(r.scene,e);else{r.renderer.setClearColor(0,0),r.renderer.setRenderTarget(r.offscreenBuf4),r.renderer.clearColor(),r.renderer.setClearColor(eh.now.bg.color,Number(!eh.now.bg.transparent)),r.renderer.setRenderTarget(r.offscreenBuf),r.renderer.clear();var i=null!==this._getComplexVisual(),o=this._getVolumeVisual(),a=i&&eh.now.ao;a&&this._enableMRT(!0,r.offscreenBuf,r.offscreenBuf4),"prepass"===eh.now.transparency?this._renderWithPrepassTransparency(e,r.offscreenBuf):"standard"===eh.now.transparency&&(r.renderer.setRenderTarget(r.offscreenBuf),r.renderer.render(r.scene,e)),a&&this._enableMRT(!1,null,null);var s=i&&eh.now.outline.on,l=i&&eh.now.fxaa,u=null!==o&&null!=o.getMesh().material,c=a||s||u||l||t?r.offscreenBuf2:n,h=r.offscreenBuf;a?(this._performAO(h,r.offscreenBuf4,r.offscreenBuf.depthTexture,c,r.offscreenBuf3,r.offscreenBuf2),l||t||u||s||(h=c,c=n,r.renderer.setRenderTarget(c),r.renderer.renderScreenQuadFromTex(h.texture,1))):(r.renderer.setRenderTarget(c),r.renderer.renderScreenQuadFromTex(h.texture,1)),s&&(h=c,c=u||l||t?r.offscreenBuf3:n,null!=h&&this._renderOutline(e,r.offscreenBuf,h,c)),this._renderSelection(e,r.offscreenBuf,c),u&&(r.renderer.setRenderTarget(r.offscreenBuf),r.renderer.renderScreenQuadFromTex(c.texture,1),c=r.offscreenBuf,this._renderVolume(o,e,c,r.volBFTex,r.volFFTex,r.volWFFTex),l||t||(r.renderer.setRenderTarget(n),r.renderer.renderScreenQuadFromTex(c.texture,1))),h=c,l&&(c=t?r.offscreenBuf4:n,this._performFXAA(h,c),h=c),t&&(c=n,this._performDistortion(h,c,!0))}},Nx.prototype._performDistortion=function(){var e=new ae,t=new Gs(-1,1,1,-1,-500,1e3),n=new Ra({uniforms:{srcTex:{type:"t",value:null},aberration:{type:"fv3",value:new E(1)}},vertexShader:nf,fragmentShader:"precision highp float;\r\n\r\nvarying vec2 vUv;\r\nuniform sampler2D srcTex;\r\nuniform vec3 aberration;\r\n\r\nvoid main() {\r\n  vec2 uv = vUv * 2.0 - 1.0;\r\n  \r\n  gl_FragColor.r = texture2D(srcTex, 0.5 * (uv * aberration[0] + 1.0)).r;\r\n  gl_FragColor.g = texture2D(srcTex, 0.5 * (uv * aberration[1] + 1.0)).g;\r\n  gl_FragColor.b = texture2D(srcTex, 0.5 * (uv * aberration[2] + 1.0)).b;\r\n  gl_FragColor.a = 1.0;\r\n}",transparent:!1,depthTest:!1,depthWrite:!1}),r=Sf.buildDistorionMesh(10,10,eh.now.debug.stereoBarrel);return e.add(new em.Mesh(r,n)),function(r,i,o){this._gfx.renderer.setRenderTarget(i),this._gfx.renderer.clear(),o?(n.uniforms.srcTex.value=r.texture,n.uniforms.aberration.value.set(.995,1,1.01),this._gfx.renderer.render(e,t)):this._gfx.renderer.renderScreenQuadFromTexWithDistortion(r,eh.now.debug.stereoBarrel)}}(),Nx.prototype._renderOutline=(mx=new tx({depth:!0}),function(e,t,n,r){var i=this._gfx;mx.uniforms.srcTex.value=n.texture,mx.uniforms.srcDepthTex.value=t.depthTexture,mx.uniforms.srcTexSize.value.set(t.width,t.height),mx.uniforms.color.value=new $e(eh.now.outline.color),mx.uniforms.threshold.value=eh.now.outline.threshold,mx.uniforms.thickness.value=new x(eh.now.outline.thickness,eh.now.outline.thickness),i.renderer.setRenderTarget(r),i.renderer.renderScreenQuad(mx)}),Nx.prototype._hasSelectionToRender=function(){for(var e=this._gfx.selectionPivot,t=0;t<e.children.length;t++)if(e.children[t].children.length>0)return!0;return!1},Nx.prototype._renderSelection=function(){var e=new tx;return function(t,n,r){var i=this._gfx;i.renderer.setClearColor("black",0),i.renderer.setRenderTarget(n),i.renderer.clear(!0,!1,!1),this._hasSelectionToRender()?(i.selectionRoot.matrix=i.root.matrix,i.selectionPivot.matrix=i.pivot.matrix,i.renderer.render(i.selectionScene,t)):i.renderer.renderDummyQuad(),i.renderer.setRenderTarget(r),i.renderer.renderScreenQuadFromTex(n.texture,.6),e.uniforms.srcTex.value=n.texture,e.uniforms.srcTexSize.value.set(n.width,n.height),i.renderer.renderScreenQuad(e)}}(),Nx.prototype._checkVolumeRenderingSupport=function(e){if(!e)return!1;var t=this._gfx,n=t.renderer.getRenderTarget();t.renderer.setRenderTarget(e);var r=t.renderer.getContext(),i=r.checkFramebufferStatus(r.FRAMEBUFFER);return t.renderer.setRenderTarget(n),i===r.FRAMEBUFFER_COMPLETE||(this.logger.warn("Device doesn't support electron density rendering"),!1)},Nx.prototype._renderVolume=(gx=new rg.BackFacePosMaterial,yx=new rg.FrontFacePosMaterial,_x=(new V).makeTranslation(.5,.5,.5),xx=new V,function(e,t,n,r,i,o){var a=this._gfx;if(void 0===vx&&(vx=this._checkVolumeRenderingSupport(r)),vx){var s=e.getMesh();s.rebuild(a.camera),a.renderer.setClearColor("black",0),a.renderer.setRenderTarget(r),a.renderer.clear(),a.renderer.setRenderTarget(i),a.renderer.clear(),a.renderer.setRenderTarget(o),a.renderer.clear(),a.renderer.setRenderTarget(r),t.layers.set(Sf.LAYERS.VOLUME_BFPLANE),a.renderer.render(a.scene,t),t.layers.set(Sf.LAYERS.VOLUME),a.scene.overrideMaterial=gx,a.renderer.render(a.scene,t),a.renderer.setRenderTarget(i),t.layers.set(Sf.LAYERS.VOLUME),a.scene.overrideMaterial=yx,a.renderer.render(a.scene,t),a.scene.overrideMaterial=null,t.layers.set(Sf.LAYERS.DEFAULT),xx.getInverse(s.matrixWorld),hf.prototype.uberOptions.world2colorMatrix.multiplyMatrices(_x,xx),t.layers.set(Sf.LAYERS.COLOR_FROM_POSITION),a.renderer.setRenderTarget(o),a.renderer.render(a.scene,t);var l=s.material;l.uniforms._BFRight.value=r.texture,l.uniforms._FFRight.value=i.texture,l.uniforms._WFFRight.value=o.texture,t.layers.set(Sf.LAYERS.VOLUME),a.renderer.setRenderTarget(n),a.renderer.render(a.scene,t),t.layers.set(Sf.LAYERS.DEFAULT)}}),Nx.prototype._renderWithPrepassTransparency=function(e,t){var n=this._gfx;n.renderer.setRenderTarget(t),e.layers.set(Sf.LAYERS.DEFAULT),n.renderer.render(n.scene,e),e.layers.set(Sf.LAYERS.PREPASS_TRANSPARENT),n.renderer.getContext().colorMask(!1,!1,!1,!1),n.renderer.render(n.scene,e),n.renderer.getContext().colorMask(!0,!0,!0,!0),e.layers.set(Sf.LAYERS.TRANSPARENT),n.renderer.render(n.scene,e),e.layers.set(Sf.LAYERS.DEFAULT)},Nx.prototype._performFXAA=(bx=new nx,function(e,t){if(void 0!==e&&void 0!==t){var n=this._gfx;n.renderer.setClearColor(eh.now.bg.color,Number(!eh.now.bg.transparent)),n.renderer.setRenderTarget(t),n.renderer.clear(),bx.uniforms.srcTex.value=e.texture,bx.uniforms.srcTexelSize.value.set(1/e.width,1/e.height),bx.uniforms.bgColor.value.set(eh.now.bg.color),bx.bgTransparent!==eh.now.bg.transparent&&(bx.setValues({bgTransparent:eh.now.bg.transparent}),bx.needsUpdate=!0),n.renderer.renderScreenQuad(bx)}}),Nx.prototype._performAO=function(){var e=new ix,t=new ax,n=new lx,r=new E;return function(i,o,a,s,l,u){if(i&&o&&a&&s&&l&&u){var c=this._gfx,h=Math.tan(.5*_.DEG2RAD*c.camera.fov);e.uniforms.diffuseTexture.value=i.texture,e.uniforms.depthTexture.value=a,e.uniforms.normalTexture.value=o.texture,e.uniforms.srcTexelSize.value.set(1/i.width,1/i.height),e.uniforms.camNearFar.value.set(c.camera.near,c.camera.far),e.uniforms.projMatrix.value=c.camera.projectionMatrix,e.uniforms.aspectRatio.value=c.camera.aspect,e.uniforms.tanHalfFOV.value=h,c.root.matrix.extractScale(r),e.uniforms.kernelRadius.value=eh.now.debug.ssaoKernelRadius*r.x,e.uniforms.depthThreshold.value=2*this._getBSphereRadius(),e.uniforms.factor.value=eh.now.debug.ssaoFactor,c.renderer.setRenderTarget(u),c.renderer.renderScreenQuad(e),t.uniforms.aoMap.value=u.texture,t.uniforms.srcTexelSize.value.set(1/u.width,1/u.height),t.uniforms.depthTexture.value=a,c.renderer.setRenderTarget(l),c.renderer.renderScreenQuad(t),n.uniforms.aoMap.value=l.texture,n.uniforms.diffuseTexture.value=i.texture,n.uniforms.srcTexelSize.value.set(1/l.width,1/l.height),n.uniforms.depthTexture.value=a,n.uniforms.projMatrix.value=c.camera.projectionMatrix,n.uniforms.aspectRatio.value=c.camera.aspect,n.uniforms.tanHalfFOV.value=h;var d=c.scene.fog;d&&(n.uniforms.fogNearFar.value.set(d.near,d.far),n.uniforms.fogColor.value.set(d.color.r,d.color.g,d.color.b,eh.now.fogAlpha)),n.useFog===eh.now.fog&&n.fogTransparent===eh.now.bg.transparent||(n.setValues({useFog:eh.now.fog,fogTransparent:eh.now.bg.transparent}),n.needsUpdate=!0),c.renderer.setRenderTarget(s),c.renderer.renderScreenQuad(n)}}}(),Nx.prototype.reset=function(){this._picker&&this._picker.reset(),this._lastPick=null,this._releaseAllVisuals(),this._setEditMode(0),this._resetObjects(),this._gfx&&(Sf.clearTree(this._gfx.pivot),this._gfx.renderer2d.reset()),this.setNeedRender()},Nx.prototype._resetScene=function(){this._objectControls.reset(),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this.resetReps(),this.resetPivot(),this.rebuildAll()},Nx.prototype.resetView=function(){this._picker&&this._picker.reset(),this._setEditMode(0),this._resetScene(),this._forEachComplexVisual((function(e){e.updateSelectionMask({}),e.rebuildSelectionGeometry()}))},Nx.prototype._export=function(e){var t=s.head(B_.exporters.find({format:e}));if(!t)return this.logger.error("Could not find suitable exporter for this source"),Promise.reject(new Error("Could not find suitable exporter for this source"));if(this.dispatchEvent({type:"exporting"}),this._visuals[this._curVisualName]instanceof Jv){var n=null;return t.SourceClass===Jv?n=this._visuals[this._curVisualName]:t.SourceClass===$d&&(n=this._visuals[this._curVisualName]._complex),new t(n,{miewVersion:Nx.VERSION}).export().then((function(e){return e}))}return this._visuals[this._curVisualName]instanceof sg?Promise.reject(new Error("Sorry, exporter for volume data not implemented yet")):Promise.reject(new Error("Unexpected format of data"))};var Ox,Dx=/^(?:(pdb|cif|mmtf|ccp4|dsn6):\s*)?(\d[a-z\d]{3})$/i,zx=/^(?:pc|pubchem):\s*([a-z]+)$/i,Fx=/^([a-z][a-z\d\-+.]*):/i;Nx.prototype.load=function(e,t){var n=this;t=s.merge({},t,{context:this}),this.settings.now.use.multiFile||(this._loading.length&&(this._loading.forEach((function(e){e.cancel()})),this._loading.length=0),t.animation||this.reset(!0)),hx.reset(),this.dispatchEvent({type:"load",options:t,source:e}),this.dispatchEvent({type:"loading",options:t,source:e});var i=new Kc;this._loading.push(i),i.addEventListener("notification",(function(e){n.dispatchEvent(e.slaveEvent)})),this._spinner.spin(this._container);var o=function(e){var t=n._loading.indexOf(i);return-1!==t&&n._loading.splice(t,1),n._spinner.stop(),n._refreshTitle(),i.notify({type:"loadingDone",anything:e}),e};return function(e,t,n){return new Promise((function(i){if(n.shouldCancel())throw new Error("Operation cancelled");n.notify({type:"fetching"}),e=function(e,t){if(!s.isString(e))return e;var n=Dx.exec(e);if(n){var i=r(n,3),o=i[1],a=void 0===o?"pdb":o,l=i[2];switch(a=a.toLowerCase(),l=l.toUpperCase(),a){case"pdb":e="https://files.rcsb.org/download/".concat(l,".pdb");break;case"cif":e="https://files.rcsb.org/download/".concat(l,".cif");break;case"mmtf":e="https://mmtf.rcsb.org/v1.0/full/".concat(l);break;case"ccp4":e="https://www.ebi.ac.uk/pdbe/coordinates/files/".concat(l.toLowerCase(),".ccp4");break;case"dsn6":e="https://edmaps.rcsb.org/maps/".concat(l.toLowerCase(),"_2fofc.dsn6");break;default:throw new Error("Unexpected data format shortcut")}return t.fileType=a,t.fileName="".concat(l,".").concat(a),t.sourceType="url",e}var u=zx.exec(e);if(u){var c=u[1].toLowerCase();return e="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/".concat(c,"/JSON?record_type=3d"),t.fileType="pubchem",t.fileName="".concat(c,".json"),t.sourceType="url",e}return"url"!==t.sourceType&&void 0!==t.sourceType||(t.sourceType="url",Fx.test(e)||(e=$c.resolveURL(e))),e}(e,t);var o=s.head(B_.loaders.find({type:t.sourceType,source:e}));if(!o)throw new Error(Ax);var a=t.fileName||o.extractName(e);if(a){var l=$c.splitFileName(a),u=r(l,2),c=u[0],h=u[1];s.defaults(t,{name:c,fileExt:h,fileName:a})}!function(e){var t=e.binary;if(void 0!==e.fileType){var n=s.head(B_.parsers.find({format:e.fileType}));if(!n)throw new Error("Could not find suitable parser for this format");t=n.binary||!1}if(void 0===t&&void 0!==e.fileExt){var r=s.head(B_.parsers.find({ext:e.fileExt}));r&&(t=r.binary||!1)}void 0!==e.fileExt&&".man"===e.fileExt.toLowerCase()&&(e.binary=!0,e.animation=!0),void 0!==t&&void 0!==e.binary&&e.binary!==t&&e.context.logger.warn("Overriding incorrect binary mode"),e.binary=t||!1}(t);var d=s.get(t,"preset.expression");if(!s.isUndefined(d)&&(d=JSON.parse(d))&&d.settings)for(var f=["singleUnit"],p=0,m=f.length;p<m;++p){var v=f[p],g=s.get(d.settings,v);s.isUndefined(g)||eh.set(v,g)}var y=new o(e,t);y.context=t.context,n.addEventListener("cancel",(function(){return y.abort()})),y.addEventListener("progress",(function(e){e.lengthComputable&&e.total>0?kx(y.logger,"Fetching",e.loaded/e.total):kx(y.logger,"Fetching")})),console.time("fetch"),i(y.load().then((function(e){return console.timeEnd("fetch"),t.context.logger.info("Fetching finished"),n.notify({type:"fetchingFinished",data:e}),n.notify({type:"fetchingDone",data:e}),e})).catch((function(e){throw console.timeEnd("fetch"),t.context.logger.debug(e.message),e.stack&&t.context.logger.debug(e.stack),t.context.logger.error("Fetching failed"),n.notify({type:"fetchingFinished",error:e}),n.notify({type:"fetchingDone",error:e}),e})))}))}(e,t,i).then((function(e){return function(e,t,n){if(n.shouldCancel())return Promise.reject(new Error("Operation cancelled"));n.notify({type:"parse"}),n.notify({type:"parsing"});var r=s.head(B_.parsers.find({format:t.fileType,ext:t.fileExt,data:e}));if(!r)return Promise.reject(new Error("Could not find suitable parser"));var i=new r(e,t);return i.context=t.context,n.addEventListener("cancel",(function(){return i.abort()})),console.time("parse"),i.parse().then((function(e){return console.timeEnd("parse"),n.notify({type:"parsingFinished",data:e}),n.notify({type:"parsingDone",data:e}),e})).catch((function(e){throw console.timeEnd("parse"),t.error=e,t.context.logger.debug(e.message),e.stack&&t.context.logger.debug(e.stack),t.context.logger.error("Parsing failed"),n.notify({type:"parsingFinished",error:e}),n.notify({type:"parsingDone",error:e}),e}))}(e,t,i)})).then((function(e){var r=n._onLoad(e,t);return o(r)})).catch((function(e){throw n.logger.error("Could not load data"),n.logger.debug(e),o(e)}))},Nx.prototype.unload=function(e){this._removeVisual(e||this.getCurrentVisual()),this.resetPivot(),eh.now.shadow.on&&this._updateShadowCamera()},Nx.prototype._startAnimation=function(e){this._stopAnimation();var t=this,n=this._getComplexVisual();if(null!==n){try{this._frameInfo=new J_(n.getComplex(),e,{onLoadStatusChanged:function(){t.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:t._isAnimating,isLoading:!t._frameInfo||t._frameInfo.isLoading}})},onError:function(e){t._stopAnimation(),t.logger.error(e)}})}catch(e){return void this.logger.error("Animation file does not fit to current complex!")}this._continueAnimation()}else this.logger.error("Unable to start animation - no molecule is loaded.")},Nx.prototype._pauseAnimation=function(){null!==this._animInterval&&(this._isAnimating=!1,clearInterval(this._animInterval),this._animInterval=null,this._frameInfo&&this.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:this._isAnimating,isLoading:this._frameInfo.isLoading}}))},Nx.prototype._continueAnimation=function(){this._isAnimating=!0;var e=1e3/eh.now.maxfps;e=Number.isNaN(e)?0:e;var t=this,n=t._gfx.pivot,r=this._getComplexVisual();r&&(r.resetSelectionMask(),r.rebuildSelectionGeometry(),this._msgAtomInfo.style.opacity=0),this._animInterval=setInterval((function(){if(t.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:t._isAnimating,isLoading:t._frameInfo.isLoading}}),t._frameInfo.frameIsReady){n.updateToFrame(t._frameInfo),t._updateObjsToFrame(t._frameInfo),t._refreshTitle(" Frame ".concat(t._frameInfo._currFrame," of ").concat(t._frameInfo._framesCount," time interval - ").concat(t._frameInfo._timeStep));try{t._frameInfo.nextFrame()}catch(e){return t.logger.error("Error during animation"),void t._stopAnimation()}t._needRender=!0}}),e)},Nx.prototype._stopAnimation=function(){null!==this._animInterval&&(clearInterval(this._animInterval),this._frameInfo.disableEvents(),this._frameInfo=null,this._animInterval=null,this.dispatchEvent({type:"mdPlayerStateChanged",state:null}))},Nx.prototype._onLoad=function(e,t){var n=this._gfx,r=null;if(t.animation)return this._refreshTitle(),this._startAnimation(e),null;if(this._stopAnimation(),t&&t.keepRepsInfo||(this._opts.reps=null,this._opts._objects=null),"Complex"===e.id){var i=e;t.fileName?i.name=i.name||Px(t.fileName).toUpperCase():t.amberFileName?i.name=i.name||Px(t.amberFileName).toUpperCase():i.name="Dynamic ".concat(t.fileType," molecule"),r=this._addVisual(new Jv(i.name,i)),this._curVisualName=r;var o=this.info();if(this.logger.info("Parsed ".concat(t.fileName," (").concat(o.atoms," atoms, ").concat(o.bonds," bonds, ").concat(o.residues," residues, ").concat(o.chains," chains).")),s.isNumber(this._opts.unit)&&i.setCurrentUnit(this._opts.unit),t.preset);else if(eh.now.autoPreset)switch(t.fileType){case"cml":this.resetReps("small");break;case"pdb":case"mmtf":case"cif":!function(e){var t=!1;return e.forEachComponent((function(e){e.forEachResidue((function(e){e._isValid&&(t=!0)}))})),t}(i)?this.resetReps("small"):this.resetReps("macro");break;default:this.resetReps("default")}else this.resetReps("default")}else"Volume"===e.id&&(this.resetEd(),r=this._onLoadEd(e));return n.camera.updateProjectionMatrix(),this._updateFog(),n.root.resetTransform(),this.resetPivot(),this._objectControls.setScale(eh.now.radiusToFit/this._getBSphereRadius()),this._resetObjects(),eh.now.autoResolution&&this._tweakResolution(),eh.now.shadow.on&&this._updateShadowCamera(),this._opts.view&&(this.view(this._opts.view),delete this._opts.view),t.error?this.dispatchEvent({type:"onParseError",error:t.error}):this.dispatchEvent({type:"onParseDone"}),this._refreshTitle(),r},Nx.prototype.resetEd=function(){this._edLoader&&(this._edLoader.abort(),this._edLoader=null),this._removeVisual(this._getVolumeVisual()),this._needRender=!0},Nx.prototype.loadEd=function(e){var t=this;this.resetEd();var n=s.head(B_.loaders.find({source:e}));if(!n)return this.logger.error(Ax),Promise.reject(new Error(Ax));var r=this._edLoader=new n(e,{binary:!0});return r.context=this,r.load().then((function(e){var n=s.head(B_.parsers.find({format:"ccp4"}));if(!n)throw new Error("Could not find suitable parser for this source");var r=new n(e);return r.context=t,r.parse().then((function(e){t._onLoadEd(e)}))})).catch((function(e){t.logger.error("Could not load ED data"),t.logger.debug(e)}))},Nx.prototype._onLoadEd=function(e){e.normalize();var t=new sg("volume",e);t.getMesh().layers.set(Sf.LAYERS.VOLUME);var n=this._addVisual(t);return this._needRender=!0,n},Nx.prototype._needRebuild=function(){var e=!1;return this._forEachComplexVisual((function(t){e=e||t.needsRebuild()})),e},Nx.prototype._rebuildObjects=function(){var e,t,n=this,r=this._gfx,i=[];for(e=0;e<r.pivot.children.length;++e){var o=r.pivot.children[e];o instanceof Tf||i.push(o)}for(e=0;e<i.length;++e)i[e].parent.remove(i[e]);setTimeout((function(){var i=n._objects;for(e=0,t=i.length;e<t;++e){var o=i[e];o.needsRebuild&&o.build(),o.getGeometry()&&r.pivot.add(o.getGeometry())}}),10)},Nx.prototype.changeUnit=function(e,t){var n=this._getComplexVisual(t);if(!n)throw new Error("There is no complex to change!");return void 0===e||(s.isString(e)&&(e=Math.max(parseInt(e,10),0)),n.getComplex().setCurrentUnit(e)&&(this._resetScene(),this._updateInfoPanel())),function(){var e=n?n.getComplex().getCurrentUnit():0,t=e>0?"Bio molecule ".concat(e):"Asymmetric unit";return"Current unit: ".concat(e," (").concat(t,")")}()},Nx.prototype.rebuild=function(){var e=this;if(this._building)this.logger.warn("Miew.rebuild(): already building!");else{this._building=!0,this.dispatchEvent({type:"rebuild"}),this.dispatchEvent({type:"rebuilding"}),this._rebuildObjects(),this._gfx.renderer2d.reset();var t=[];this._forEachComplexVisual((function(e){e.needsRebuild()&&t.push(e.rebuild().then((function(){return new Promise((function(t){e.rebuildSelectionGeometry(),t()}))})))}));var n=this;this._spinner.spin(this._container),Promise.all(t).then((function(){n._spinner.stop(),n._needRender=!0,n._refreshTitle(),e.dispatchEvent({type:"buildingDone"}),n._building=!1}))}},Nx.prototype.rebuildAll=function(){this._forEachComplexVisual((function(e){e.setNeedsRebuild()}))},Nx.prototype._refreshTitle=function(e){var t;e=void 0===e?"":e;var n=this._getComplexVisual();if(n){t=n.getComplex().name;var r=n.repGet(n.repCurrent());t+=r?" – ".concat(r.mode.name," Mode"):""}else t=Object.keys(this._visuals).length>0?"Unknown":"No Data";t+=e,this.dispatchEvent({type:"titleChanged",data:t})},Nx.prototype.setNeedRender=function(){this._needRender=!0},Nx.prototype._extractRepresentation=function(){var e=this,t=[];this._forEachComplexVisual((function(n){if(0!==n.getSelectionCount()){var r=n.buildSelectorFromMask(1<<n.getSelectionBit()),i=eh.now.presets.default,o=n.repAdd({selector:r,mode:i[0].mode.id,colorer:i[0].colorer.id,material:i[0].material.id});o?(e.dispatchEvent({type:"repAdded",index:o.index,name:n.name}),n.repCurrent(o.index),t.push(n.name)):n.repCount()===Jv.NUM_REPRESENTATION_BITS&&e.logger.warn("Number of representations is limited to ".concat(Jv.NUM_REPRESENTATION_BITS))}})),t.length>0&&(this.logger.report("New representation from selection for complexes: ".concat(t.join(", "))),this.dispatchEvent({type:"repAdd"}))},Nx.prototype._setReps=function(e){e=e||this._opts&&this._opts.reps||[],this._forEachComplexVisual((function(t){return t.resetReps(e)}))},Nx.prototype.applyPreset=function(e){for(var t=eh.now.presets,n=[e||eh.defaults.preset,eh.defaults.preset,Object.keys(t)[0]],r=null,i=0;!r&&i<n.length;++i)eh.set("preset",n[i]),(r=t[eh.now.preset])||this.logger.warn('Unknown preset "'.concat(eh.now.preset,'"'));this._setReps(r)},Nx.prototype.resetReps=function(e){var t=this._opts&&this._opts.reps;t?this._setReps(t):this.applyPreset(e)},Nx.prototype.repCount=function(e){var t=this._getComplexVisual(e);return t?t.repCount():0},Nx.prototype.repCurrent=function(e,t){var n=this._getComplexVisual(t),r=n?n.repCurrent(e):-1;return e&&r!==e&&this.logger.warn("Representation ".concat(e," was not found. Current rep remains unchanged.")),r},Nx.prototype.rep=function(e,t){var n=this._getComplexVisual("");if(!n)return null;var r=n.rep(e,t);return"created"===r.status?this.dispatchEvent({type:"repAdded",index:r.index,name:n.name}):"changed"===r.status&&this.dispatchEvent({type:"repChanged",index:r.index,name:n.name}),r.desc},Nx.prototype.repGet=function(e,t){var n=this._getComplexVisual(t);return n?n.repGet(e):null},Nx.prototype.repAdd=function(e,t){var n=this._getComplexVisual(t);if(!n)return-1;var r=n.repAdd(e);return r?(this.dispatchEvent({type:"repAdded",index:r.index,name:t}),r.index):-1},Nx.prototype.repRemove=function(e,t){var n=this._getComplexVisual(t);n&&(n.repRemove(e),this.dispatchEvent({type:"repRemoved",index:e,name:t}))},Nx.prototype.repHide=function(e,t,n){this._needRender=!0;var r=this._getComplexVisual(n);return r?r.repHide(e,t):null},Nx.prototype._setEditMode=function(e){this._editMode=e;var t=this._msgMode;t&&(t.style.opacity=0===e?0:1,0!==e&&(t.getElementsByTagName("p")[0].innerHTML=1===e?"COMPONENT EDIT MODE":"FRAGMENT EDIT MODE")),this.dispatchEvent({type:"editModeChanged",data:0===e})},Nx.prototype._enterComponentEditMode=function(){if(0===this._editMode){var e=[];this._forEachComplexVisual((function(t){var n=t.beginComponentEdit();n&&e.push(n)})),e!==[]&&(this._editors=e,this.logger.info("COMPONENT EDIT MODE -- ON"),this._setEditMode(1),this._objectControls.keysTranslateObj(!0))}},Nx.prototype._applyComponentEdit=function(){if(1===this._editMode){this._objectControls.stop(),this._objectControls.keysTranslateObj(!1);for(var e=0;e<this._editors.length;++e)this._editors[e].apply();this._editors=[],this.logger.info("COMPONENT EDIT MODE -- OFF (applied)"),this._setEditMode(0),this.rebuildAll()}},Nx.prototype._discardComponentEdit=function(){if(1===this._editMode){this._objectControls.stop(),this._objectControls.keysTranslateObj(!1);for(var e=0;e<this._editors.length;++e)this._editors[e].discard();this._editors=[],this.logger.info("COMPONENT EDIT MODE -- OFF (discarded)"),this._setEditMode(0),this._needRender=!0,this.rebuildAll()}},Nx.prototype._enterFragmentEditMode=function(){if(0===this._editMode){var e=[];if(this._forEachComplexVisual((function(t){t instanceof Jv&&t.getSelectionCount()>0&&e.push(t)})),1===e.length){var t=e[0].beginFragmentEdit();t&&(this._editors=[t],this.logger.info("FRAGMENT EDIT MODE -- ON (single bond)"),this._setEditMode(2),this._objectControls.allowTranslation(!1),this._objectControls.allowAltObjFreeRotation(t.isFreeRotationAllowed()),this._needRender=!0)}}},Nx.prototype._applyFragmentEdit=function(){if(2===this._editMode){this._objectControls.stop();for(var e=0;e<this._editors.length;++e)this._editors[e].apply();this._editors=[],this.logger.info("FRAGMENT EDIT MODE -- OFF (applied)"),this._setEditMode(0),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this.rebuildAll()}},Nx.prototype._discardFragmentEdit=function(){if(2===this._editMode){this._objectControls.stop();for(var e=0;e<this._editors.length;++e)this._editors[e].discard();this._editors=[],this.logger.info("FRAGMENT EDIT MODE -- OFF (discarded)"),this._setEditMode(0),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this._needRender=!0}},Nx.prototype._onPick=function(e){if(eh.now.picking&&null===this._animInterval&&2!==this._editMode&&!this._objectControls.isEditingAltObj()){var t=null;if(e.obj.atom?(t=e.obj.atom.getResidue().getChain().getComplex(),this._lastPick=e.obj.atom):e.obj.residue?(t=e.obj.residue.getChain().getComplex(),this._lastPick=e.obj.residue):e.obj.chain?(t=e.obj.chain.getComplex(),this._lastPick=e.obj.chain):e.obj.molecule?(t=e.obj.molecule.getComplex(),this._lastPick=e.obj.molecule):this._lastPick=null,t){var n=this._getVisualForComplex(t);n&&(r(n),this._needRender=!0)}else this._forEachComplexVisual(r),this._needRender=!0;this._updateInfoPanel(),this.dispatchEvent(e)}function r(t){t.updateSelectionMask(e.obj),t.rebuildSelectionGeometry()}},Nx.prototype._onKeyDown=function(e){if(this._running&&this._hotKeysEnabled)switch(e.keyCode){case"C".charCodeAt(0):eh.now.editing&&this._enterComponentEditMode();break;case"F".charCodeAt(0):eh.now.editing&&this._enterFragmentEditMode();break;case"A".charCodeAt(0):switch(this._editMode){case 1:this._applyComponentEdit();break;case 2:this._applyFragmentEdit()}break;case"D".charCodeAt(0):switch(this._editMode){case 1:this._discardComponentEdit();break;case 2:this._discardFragmentEdit()}break;case"S".charCodeAt(0):e.preventDefault(),e.stopPropagation(),eh.set("ao",!eh.now.ao),this._needRender=!0;break;case 107:e.preventDefault(),e.stopPropagation(),this._forEachComplexVisual((function(e){e.expandSelection(),e.rebuildSelectionGeometry()})),this._updateInfoPanel(),this._needRender=!0;break;case 109:e.preventDefault(),e.stopPropagation(),this._forEachComplexVisual((function(e){e.shrinkSelection(),e.rebuildSelectionGeometry()})),this._updateInfoPanel(),this._needRender=!0}},Nx.prototype._onKeyUp=function(e){this._running&&this._hotKeysEnabled&&e.keyCode==="X".charCodeAt(0)&&this._extractRepresentation()},Nx.prototype._updateInfoPanel=function(){var e,t,n=this._msgAtomInfo.getElementsByTagName("p")[0],r=0;for(this._forEachComplexVisual((function(e){r+=e.getSelectionCount()}));n.firstChild;)n.removeChild(n.firstChild);if(0!==r){var i="".concat(String(r)," atom").concat(1!==r?"s":""," selected");null!==this._lastPick&&(i+=", the last pick:");var o="",a="",s="";if(this._lastPick instanceof Ex){t=(e=this._lastPick)._residue;var l=e.getName();a=null!==l.getNode()?l.getNode():l.getString();var u=32!==e._location?String.fromCharCode(e._location):"";o="".concat(e.element.fullName," #").concat(e._serial).concat(u,":       ").concat(t._chain._name,".").concat(t._type._name).concat(t._sequence).concat(t._icode.trim(),"."),"string"==typeof a&&(o+=a),s="Coord: (".concat(e._position.x.toFixed(2).toString(),",     ").concat(e._position.y.toFixed(2).toString(),",     ").concat(e._position.z.toFixed(2).toString(),")")}else this._lastPick instanceof Tx?(t=this._lastPick,o="".concat(t._type._fullName,":       ").concat(t._chain._name,".").concat(t._type._name).concat(t._sequence).concat(t._icode.trim())):this._lastPick instanceof Mx?o="chain ".concat(this._lastPick._name):this._lastPick instanceof Cx&&(o="molecule ".concat(this._lastPick._name));if(n.appendChild(document.createTextNode(i)),""!==o&&(n.appendChild(document.createElement("br")),n.appendChild(document.createTextNode(o))),"string"!=typeof a){var c=a.cloneNode(!0);c.style.fontSize="85%",n.appendChild(c)}""!==s&&(n.appendChild(document.createElement("br")),n.appendChild(document.createTextNode(s))),this._msgAtomInfo.style.opacity=1}else this._msgAtomInfo.style.opacity=0},Nx.prototype._getAltObj=function(){if(this._editors){for(var e=null,t=0;t<this._editors.length;++t){var n=this._editors[t].getAltObj();if(n.objects.length>0){if(e){e=null;break}e=n}}if(e)return e}return{objects:[],pivot:new E(0,0,0)}},Nx.prototype.resetPivot=function(){var e=new xe,t=new E;return function(){e.makeEmpty(),this._forEachVisual((function(t){e.union(t.getBoundaries().boundingBox)})),e.getCenter(t),this._objectControls.setPivot(t.negate()),this.dispatchEvent({type:"transform"})}}(),Nx.prototype.setPivotResidue=function(){var e=new E;return function(t){var n=this._getVisualForComplex(t.getChain().getComplex());if(n){if(t._controlPoint)e.copy(t._controlPoint);else{for(var r=0,i=0,o=0,a=t._atoms.length,s=0;s<a;++s){var l=t._atoms[s]._position;r+=l.x/a,i+=l.y/a,o+=l.z/a}e.set(r,i,o)}e.applyMatrix4(n.matrix).negate(),this._objectControls.setPivot(e),this.dispatchEvent({type:"transform"})}}}(),Nx.prototype.setPivotAtom=function(){var e=new E;return function(t){var n=this._getVisualForComplex(t.getResidue().getChain().getComplex());n&&(e.copy(t._position),e.applyMatrix4(n.matrix).negate(),this._objectControls.setPivot(e),this.dispatchEvent({type:"transform"}))}}(),Nx.prototype.getSelectionCenter=(Ox=new E(0,0,0),function(e,t,n){e.set(0,0,0);var r=0;return this._forEachComplexVisual((function(i){i.getSelectionCenter(Ox,t,n||i.getSelectionBit())&&(e.add(Ox),r++)})),0!==r&&(e.divideScalar(r),e.negate(),!0)}),Nx.prototype.setPivotSubset=function(){var e=new E(0,0,0);function t(e,t){return e._mask&1<<t}function n(e,t){return t.selector.includesAtom(e)}return function(r){var i=r?n:t;this.getSelectionCenter(e,i,r)?(this._objectControls.setPivot(e),this.dispatchEvent({type:"transform"})):this.logger.warn("selection is empty. Center operation not performed")}}(),Nx.prototype.benchmarkGfx=function(e){var t=this,n=new ug(this._gfx.renderer);return new Promise((function(r){e||eh.now.autoResolution?(t.dispatchEvent({type:"profile"}),t._spinner.spin(t._container),n.runOnTicks(50,1e3,2e3).then((function(e){t._gfxScore=0,e>=5&&(t._gfxScore=1e3/n.mean()),e>0&&(t._gfxScore=.5*e),t._spinner.stop(),r()}))):r()}))},Nx.prototype.screenshot=function(e,t){var n,r,i=this._gfx,o=i.renderer.domElement.width,a=i.renderer.domElement.height;function s(){var n;if($c.getBrowser()===$c.browserType.SAFARI){var r=document.createElement("canvas"),s=r.getContext("2d");r.width=void 0===e?o:e,r.height=void 0===t?a:t,s.drawImage(i.renderer.domElement,0,0,r.width,r.height),n=r.toDataURL("image/png")}else n=i.renderer.domElement.toDataURL("image/png");return n}if(t=t||e,void 0===e&&void 0===t||e===o&&t===a)n=s();else{var l=i.camera.aspect,u=i.camera.fov,c=function(e){return Math.tan(_.degToRad(.5*e))}(i.camera.fov)*Math.min(i.width,i.height)/i.height,h=e/t;i.renderer.setPixelRatio(1),i.camera.aspect=h,i.camera.fov=(r=c/Math.min(h,1),2*_.radToDeg(Math.atan(r))),i.camera.updateProjectionMatrix(),i.renderer.setDrawingBufferSize(e,t,1),this._renderFrame(eh.now.stereo),n=s(),i.renderer.setPixelRatio(window.devicePixelRatio),i.camera.aspect=l,i.camera.fov=u,i.camera.updateProjectionMatrix(),i.renderer.setDrawingBufferSize(i.width,i.height,window.devicePixelRatio),this._needRender=!0}return n},Nx.prototype.screenshotSave=function(e,t,n){var r=this.screenshot(t,n);$c.shotDownload(r,e)},Nx.prototype.save=function(e){var t=this;this._export(e.fileType).then((function(n){var r=t._visuals[t._curVisualName]._complex.name;$c.download(n,r,e.fileType),t._refreshTitle(),t.dispatchEvent({type:"exportingDone"})})).catch((function(e){t.logger.error("Could not export data"),t.logger.debug(e),t._refreshTitle(),t.dispatchEvent({type:"exportingDone",error:e})}))},Nx.prototype._tweakResolution=function(){var e=[["poor",100],["low",500],["medium",1e3],["high",5e3],["ultra",Number.MAX_VALUE]],t=0;if(this._forEachComplexVisual((function(e){t+=e.getComplex().getAtomCount()})),t>0)for(var n=1e6*this._gfxScore/t,r=0;r<e.length;++r)if(n<e[r][1]){this._autoChangeResolution(e[r][0]);break}},Nx.prototype._autoChangeResolution=function(e){e!==eh.now.resolution&&this.logger.report('Your rendering resolution was changed to "'.concat(e,'" for best performance.')),eh.now.resolution=e},Nx.prototype.saveSettings=function(){this._cookies.setCookie(this._opts.settingsCookie,JSON.stringify(this.settings.getDiffs(!0)))},Nx.prototype.restoreSettings=function(){try{var e=this._cookies.getCookie(this._opts.settingsCookie),t=e?JSON.parse(e):{};this.settings.applyDiffs(t,!0)}catch(e){this.logger.error("Cookies parse error: ".concat(e.message))}},Nx.prototype.resetSettings=function(){this.settings.reset()},Nx.prototype.setOptions=function(e){"string"==typeof e&&(e=Nx.options.fromAttr(e)),e.reps&&(this._opts.reps=null),s.merge(this._opts,e),e.settings&&this.set(e.settings),this._opts._objects=e._objects,this._resetObjects(),e.load&&this.load(e.load,{fileType:e.type}),e.preset&&(eh.now.preset=e.preset),e.reps&&this.resetReps(e.preset),this._opts.view&&(this.view(this._opts.view),delete this._opts.view);var t=this._getComplexVisual();t&&(t.getComplex().resetCurrentUnit(),s.isNumber(e.unit)&&t.getComplex().setCurrentUnit(e.unit),this.resetView(),this.rebuildAll())},Nx.prototype.info=function(e){var t=this._getComplexVisual(e);if(!t)return{};var n=t.getComplex(),r=n.metadata;return{id:r.id||n.name||"UNKNOWN",title:r.title&&r.title.join(" ")||"UNKNOWN DATA",atoms:n.getAtomCount(),bonds:n.getBondCount(),residues:n.getResidueCount(),chains:n.getChainCount()}},Nx.prototype.addObject=function(e,t){var n=null;if(e.type===ex.prototype.type&&(n=ex),null===n)throw new Error("Unknown scene object type - ".concat(e.type));try{var r=new n(e.params,e.opts);this._addSceneObject(r)}catch(e){if(t)throw e;this.logger.debug("Error during scene object creation: ".concat(e.message))}this._needRender=!0},Nx.prototype._addSceneObject=function(e){var t=this._getComplexVisual();e.build&&t&&(e.build(t.getComplex()),this._gfx.pivot.add(e.getGeometry()));var n=this._objects;n[n.length]=e},Nx.prototype._updateObjsToFrame=function(e){for(var t=this._objects,n=0,r=t.length;n<r;++n)t[n].updateToFrame&&t[n].updateToFrame(e)},Nx.prototype._resetObjects=function(){var e=this._opts._objects;if(this._objects=[],e)for(var t=0,n=e.length;t<n;++t)this.addObject(e[t],!1)},Nx.prototype.removeObject=function(e){var t=this._objects[e];if(!t)throw new Error("Scene object with index ".concat(e," does not exist"));t.destroy(),this._objects.splice(e,1),this._needRender=!0},Nx.prototype.getURL=function(e){return xh.toURL(this.getState(s.defaults(e,{compact:!0,settings:!1,view:!1})))},Nx.prototype.getScript=function(e){return xh.toScript(this.getState(s.defaults(e,{compact:!0,settings:!0,view:!0})))},Nx.prototype._compareReps=function(e,t){var n={},r=0;e&&(r=e.repCount());var i=eh.defaults.presets[eh.now.preset],o=t;void 0===i||i.length>r?(o=!1,n.preset="empty"):eh.now.preset!==eh.defaults.preset&&(n.preset=eh.now.preset);for(var a=[],l=!0,u=0,c=r;u<c;++u)a[u]=e.repGet(u).compare(o?i[u]:null),s.isEmpty(a[u])||(l=!1);return l||(n.reps=a),n},Nx.prototype.getState=function(e){var t={};e=s.defaults(e,{compact:!0,settings:!1,view:!1});var n=this._getComplexVisual();if(null!==n){var r=n.getComplex(),i=r.metadata;if(i.id){var o=i.format?"".concat(i.format,":"):"";t.load=o+i.id}var a=r.getCurrentUnit();1!==a&&(t.unit=a)}var l=this._compareReps(n,e.compact);l.preset&&(t.preset=l.preset),l.reps&&(t.reps=l.reps);for(var u=this._objects,c=[],h=0,d=u.length;h<d;++h)c[h]=u[h].identify();if(u.length>0&&(t._objects=c),e.view&&(t.view=this.view()),e.settings){var f=this.settings.getDiffs(!1);s.isEmpty(f)||(t.settings=f)}return t},Nx.prototype.get=function(e,t){return eh.get(e,t)},Nx.prototype._clipPlaneUpdateValue=function(e){var t=Math.max(this._gfx.camera.position.z-e*eh.now.draft.clipPlaneFactor,eh.now.camNear),n={clipPlaneValue:t};this._forEachComplexVisual((function(e){e.setUberOptions(n)}));for(var r=0,i=this._objects.length;r<i;++r){var o=this._objects[r];o._line&&o._line.material.setUberOptions(n)}null!==this._picker&&(this._picker.clipPlaneValue=t)},Nx.prototype._fogFarUpdateValue=function(){null!==this._picker&&(this._gfx.scene.fog?this._picker.fogFarValue=this._gfx.scene.fog.far:this._picker.fogFarValue=void 0)},Nx.prototype._updateMaterials=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this._forEachComplexVisual((function(r){return r.setMaterialValues(e,t,n)}));for(var r=0,i=this._objects.length;r<i;++r){var o=this._objects[r];o._line&&(o._line.material.setValues(e),o._line.material.needsUpdate=!0)}},Nx.prototype._fogAlphaChanged=function(){this._forEachComplexVisual((function(e){e.setUberOptions({fogAlpha:eh.now.fogAlpha})}))},Nx.prototype._embedWebXR=function(){var e=this;if("WEBVR"!==eh.now.stereo)return this.webVR&&this.webVR.disable(),void(this.webVR=null);this.webVR||(this.webVR=new wx((function(){e._requestAnimationFrame((function(){return e._onTick()})),e._needRender=!0,e._onResize()}))),this.webVR.enable(this._gfx)},Nx.prototype._initOnSettingsChanged=function(){var e=this,t=function(t,n){(t=s.isArray(t)?t:[t]).forEach((function(t){e.settings.addEventListener("change:".concat(t),n)}))};t("modes.VD.frame",(function(){var t=e._getVolumeVisual();null!==t&&(t.showFrame(eh.now.modes.VD.frame),e._needRender=!0)})),t("modes.VD.isoMode",(function(){var t=e._getVolumeVisual();null!==t&&(t.getMesh().material.updateDefines(),e._needRender=!0)})),t("bg.color",(function(){e._onBgColorChanged()})),t("ao",(function(){var t={normalsToGBuffer:eh.now.ao};e._setUberMaterialValues(t)})),t("fogColor",(function(){e._onFogColorChanged()})),t("fogColorEnable",(function(){e._onFogColorChanged()})),t("bg.transparent",(function(t){var n=e._gfx;n&&n.renderer.setClearColor(eh.now.bg.color,Number(!eh.now.bg.transparent)),e._updateMaterials({fogTransparent:t.value}),e.rebuildAll()})),t("draft.clipPlane",(function(t){e._updateMaterials({clipPlane:t.value}),e.rebuildAll()})),t("shadow.on",(function(t){var n={shadowmap:t.value,shadowmapType:eh.now.shadow.type},r=e._gfx;r&&(r.renderer.shadowMap.enabled=Boolean(n.shadowmap)),n.shadowmap&&e._updateShadowCamera(),e._updateMaterials(n,!0,(function(e){n.shadowmap?Sf.prepareObjMaterialForShadow(e):e.customDepthMaterial=null})),e._needRender=!0})),t("shadow.type",(function(t){eh.now.shadow.on&&(e._updateMaterials({shadowmapType:t.value},!0),e._needRender=!0)})),t("shadow.radius",(function(t){for(var n=0;n<e._gfx.scene.children.length;n++)void 0!==e._gfx.scene.children[n].shadow&&(e._gfx.scene.children[n].shadow.radius=t.value,e._needRender=!0)})),t("fps",(function(){e._fps.show(eh.now.fps)})),t(["fog","fogNearFactor","fogFarFactor"],(function(){e._updateFog(),e._needRender=!0})),t("fogAlpha",(function(){var t=eh.now.fogAlpha;(t<0||t>1)&&e.logger.warn("fogAlpha must belong range [0,1]"),e._fogAlphaChanged(),e._needRender=!0})),t("autoResolution",(function(t){t.value&&!e._gfxScore&&e.logger.warn("Benchmarks are missed, autoresolution will not work! Autoresolution should be set during miew startup.")})),t("stereo",(function(){e._embedWebXR("WEBVR"===eh.now.stereo),e._needRender=!0})),t(["transparency","palette"],(function(){e.rebuildAll()})),t("resolution",(function(){e.rebuildAll();var t=e._getVolumeVisual();t&&(t.getMesh().material.updateDefines(),e._needRender=!0)})),t(["axes","fxaa","ao","outline.on","outline.color","outline.threshold","outline.thickness"],(function(){e._needRender=!0}))},Nx.prototype.set=function(e,t){eh.set(e,t)},Nx.prototype.select=function(e,t){var n=this._getComplexVisual();if(n){var r=e;s.isString(e)&&(r=Sx.parse(e).selector),n.select(r,t),this._lastPick=null,this._updateInfoPanel(),this._needRender=!0}},Nx.prototype.view=function(e){var t,n,r,i=this,o=this._gfx.pivot,a=[];return void 0===e?(t=o.position,n=i._objectControls.getScale()/eh.now.radiusToFit,(r=new H).setFromQuaternion(i._objectControls.getOrientation(),"ZXY"),a=[t.x,t.y,t.z,n,r.x,r.y,r.z],"1"+$c.arrayToBase64(a,Float32Array)):(function(){40===e.length&&(e="0".concat(e));var t=e[0];if(a=$c.arrayFromBase64(e.substr(1),Float32Array),"1"!==t){if("0"!==t)return void i.logger.warn("Encoded view version mismatch, stored as ".concat(t," vs ").concat("1"," expected"));a[3]/=8}var n=hx.createView();n.position.copy(o.position),n.scale=i._objectControls.getScale(),n.orientation.copy(i._objectControls.getOrientation());var r=hx.createView();r.position.set(a[0],a[1],a[2]),i._getComplexVisual()&&r.position.sub(i._getComplexVisual().position),r.scale=a[3],r.orientation.setFromEuler(new H(a[4],a[5],a[6],"ZXY")),hx.setup(n,r)}(),e)},Nx.prototype._updateView=function(){var e=this._gfx.pivot;if(hx.wasStarted()||hx.start(),hx.isMoving()){var t=hx.getCurrentView();if(t.success){var n=t.view;e.position.copy(n.position),this._objectControls.setScale(n.scale*eh.now.radiusToFit),this._objectControls.setOrientation(n.orientation),this.dispatchEvent({type:"transform"}),this._needRender=!0}}},Nx.prototype.translate=function(e,t,n){this._objectControls.translatePivot(e,t,n),this.dispatchEvent({type:"transform"}),this._needRender=!0},Nx.prototype.rotate=function(e,t,n){this._objectControls.rotate((new b).setFromEuler(new H(e,t,n,"XYZ"))),this.dispatchEvent({type:"transform"}),this._needRender=!0},Nx.prototype.scale=function(e){if(e<=0)throw new RangeError("Scale should be greater than zero");this._objectControls.scale(e),this.dispatchEvent({type:"transform"}),this._needRender=!0},Nx.prototype.center=function(e){if(void 0===e)return this.setPivotSubset(),void(this._needRender=!0);if(void 0!==e.obj&&("atom"in e.obj||"residue"in e.obj))return"atom"in e.obj?this.setPivotAtom(e.obj.atom):this.setPivotResidue(e.obj.residue),void(this._needRender=!0);if(void 0===e.obj&&""!==e){var t=Sx.parse(e);if(void 0===t.error)return this.setPivotSubset(t),void(this._needRender=!0)}this.resetPivot(),this._needRender=!0},Nx.prototype.within=function(e,t){var n=this._getComplexVisual();if(!n)return Sx.None();e instanceof String&&(e=Sx.parse(e));var r=n.within(e,t);return r&&(n.rebuildSelectionGeometry(),this._needRender=!0),r},Nx.prototype.projected=function(e,t){var n=this._getComplexVisual(t);if(!n)return!1;var r=n.getComplex().getAtomByFullname(e);if(null===r)return!1;var i=r._position.clone();return this._gfx.pivot.updateMatrixWorldRecursive(),this._gfx.camera.updateMatrixWorldRecursive(),this._gfx.pivot.localToWorld(i),i.project(this._gfx.camera),{x:.5*(i.x+1)*this._gfx.width,y:.5*(1-i.y)*this._gfx.height}},Nx.prototype.dssp=function(e){var t=this._getComplexVisual(e);t&&(t.getComplex().dssp(),t._reprList.forEach((function(e){"CA"!==e.mode.id&&"SS"!==e.colorer.id||(e.needsRebuild=!0)})))},Nx.prototype.exportCML=function(){var e=this,t=e._getComplexVisual(),n=t?t.getComplex():null;return n&&n.originalCML?(function(t){var n=function(e){var t=new E,n=new E,r=new E;e.extractBasis(t,n,r),t.normalize(),n.normalize(),r.normalize();var i=new V;return i.identity(),i.makeBasis(t,n,r),i}(e._gfx.root.matrixWorld),r=new k(0,0,0,0),i=new k(0,0,0,0),o=null,a=null;t.forEachAtom((function(e){e.xmlNodeRef&&e.xmlNodeRef.xmlNode&&(o=e.xmlNodeRef.xmlNode,a=e.getPosition(),r.set(a.x,a.y,a.z,1),r.applyMatrix4(n),o.setAttribute("x3",r.x.toString()),o.setAttribute("y3",r.y.toString()),o.setAttribute("z3",r.z.toString()),o.removeAttribute("x2"),o.removeAttribute("y2"))})),t.forEachSGroup((function(e){if(e.xmlNodeRef&&e.xmlNodeRef.xmlNode){o=e.xmlNodeRef.xmlNode,a=e.getPosition(),r.set(a.x,a.y,a.z,1);var t=e.getCentralPoint();null===t?r.applyMatrix4(n):(i.set(t.x,t.y,t.z,0),r.add(i),r.applyMatrix4(n),i.set(t.x,t.y,t.z,1),i.applyMatrix4(n),r.sub(i)),o.setAttribute("x",r.x.toString()),o.setAttribute("y",r.y.toString()),o.setAttribute("z",r.z.toString())}}))}(n),(new XMLSerializer).serializeToString(n.originalCML)):null},Nx.prototype.motm=function(){eh.set({fogColorEnable:!0,fogColor:0,outline:{on:!0,threshold:.01},bg:{color:16777215}}),this._forEachComplexVisual((function(e){for(var t=[],n=e.getComplex(),r=Av.get(eh.now.palette),i=0;i<n.getChainCount();i++){var o=n._chains[i]._name,a=r.getChainColor(o);t[i]={selector:"chain ".concat(o),mode:"VW",colorer:["CB",{color:a,factor:.9}],material:"FL"}}e.resetReps(t)}))},Nx.prototype.VERSION="0.8.7",s.assign(Nx,{VERSION:Nx.prototype.VERSION,registeredPlugins:[],chem:Qd,io:B_,modes:cv,colorers:jv,materials:Wv,palettes:Av,options:xh,settings:eh,utils:$c,gfx:{Representation:Yv},thirdParty:{lodash:s,three:mc}});var Bx=function(){var e=function(e,t,n,r){for(n=n||{},r=e.length;r--;n[e[r]]=t);return n},t=[1,60],n=[1,62],r=[1,63],i=[1,65],o=[1,66],a=[1,67],s=[1,68],l=[1,69],u=[1,80],c=[1,72],h=[1,73],d=[1,74],f=[1,75],p=[1,99],m=[1,76],v=[1,100],g=[1,79],y=[1,51],_=[1,81],x=[1,82],b=[1,84],w=[1,83],S=[1,85],E=[1,96],T=[1,97],M=[1,98],C=[1,86],A=[1,87],R=[1,64],P=[1,70],k=[1,71],L=[1,77],N=[1,78],I=[1,53],O=[1,54],D=[1,55],z=[1,61],F=[1,88],B=[1,89],U=[1,90],V=[1,91],G=[1,92],j=[1,93],H=[1,94],W=[1,95],q=[1,101],Y=[1,102],X=[1,103],Z=[1,104],$=[1,105],K=[1,56],J=[1,57],Q=[1,58],ee=[1,59],te=[1,115],ne=[1,111],re=[1,114],ie=[1,112],oe=[1,113],ae=[1,118],se=[1,117],le=[1,134],ue=[1,149],ce=[1,150],he=[1,157],de=[5,6,7,9,13,14,15,17,18,19,20,23,25,26,27,30,33,34,35,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,72,74,77,78,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,101],fe=[5,6,7,9,13,14,15,17,18,19,20,23,25,26,27,30,33,34,35,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,71,72,74,77,78,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,101],pe=[5,6,7,9,13,15,17,18,19,20,23,25,26,27,30,33,34,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,72,82,83,84,85,86,87,88,89,90,91,92,93,94,95],me=[5,70,72],ve=[5,74],ge=[71,101],ye={trace:function(){},yy:{},symbols_:{error:2,Program:3,Command:4,EOF:5,RESET:6,BUILD:7,ALL:8,HELP:9,Path:10,MOTM:11,OneArgCommand:12,GET:13,STRING:14,SET:15,Value:16,SET_SAVE:17,SET_RESTORE:18,SET_RESET:19,PRESET:20,AddRepresentation:21,EditRepresentation:22,REMOVE:23,RepresentationReference:24,HIDE:25,SHOW:26,LIST:27,EXPAND_KEY:28,SELECTOR_KEY:29,SELECT:30,AS:31,WordAll:32,SELECTOR:33,WITHIN:34,NUMBER:35,OF:36,MATERIAL:37,IDENTIFIER:38,ModeCMD:39,ColorCMD:40,VIEW:41,BASE_64:42,UNIT:43,DSSP:44,SCALE:45,ROTATE:46,AxesList:47,TRANSLATE:48,CENTER:49,GetURLBranch:50,Screenshot:51,LINE:52,ArgList:53,LISTOBJ:54,REMOVEOBJ:55,URL:56,VIEW_KEY:57,SCREENSHOT:58,LOAD:59,Url:60,FILE_KEY:61,ADD:62,Description:63,REP:64,MODE:65,COLOR:66,Descriptor:67,RepresentationOwnProperty:68,RepresentationOwnPropertyOpts:69,DESC_KEY:70,"=":71,DESC_KEY_OPTS:72,AxesArg:73,DESC_KEY_AXES:74,Arg:75,PathWoDescKey:76,HEX:77,BOOL:78,Word:79,CommandSetWoDESC_KEY:80,DescKeys:81,CLEAR:82,FILE_LIST:83,FILE_REGISTER:84,FILE_DELETE:85,PRESET_ADD:86,PRESET_DELETE:87,PRESET_UPDATE:88,PRESET_RENAME:89,PRESET_OPEN:90,CREATE_SCENARIO:91,RESET_SCENARIO:92,DELETE_SCENARIO:93,ADD_SCENARIO_ITEM:94,LIST_SCENARIO:95,PDB_KEY:96,DELAY_KEY:97,PRST_KEY:98,DESCRIPTION_KEY:99,CommandSet:100,".":101,PresetPath:102,"/":103,HexOrNumber:104,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"RESET",7:"BUILD",8:"ALL",9:"HELP",11:"MOTM",13:"GET",14:"STRING",15:"SET",17:"SET_SAVE",18:"SET_RESTORE",19:"SET_RESET",20:"PRESET",23:"REMOVE",25:"HIDE",26:"SHOW",27:"LIST",28:"EXPAND_KEY",29:"SELECTOR_KEY",30:"SELECT",31:"AS",33:"SELECTOR",34:"WITHIN",35:"NUMBER",36:"OF",37:"MATERIAL",38:"IDENTIFIER",41:"VIEW",42:"BASE_64",43:"UNIT",44:"DSSP",45:"SCALE",46:"ROTATE",48:"TRANSLATE",49:"CENTER",52:"LINE",54:"LISTOBJ",55:"REMOVEOBJ",56:"URL",57:"VIEW_KEY",58:"SCREENSHOT",59:"LOAD",61:"FILE_KEY",62:"ADD",64:"REP",65:"MODE",66:"COLOR",70:"DESC_KEY",71:"=",72:"DESC_KEY_OPTS",74:"DESC_KEY_AXES",77:"HEX",78:"BOOL",82:"CLEAR",83:"FILE_LIST",84:"FILE_REGISTER",85:"FILE_DELETE",86:"PRESET_ADD",87:"PRESET_DELETE",88:"PRESET_UPDATE",89:"PRESET_RENAME",90:"PRESET_OPEN",91:"CREATE_SCENARIO",92:"RESET_SCENARIO",93:"DELETE_SCENARIO",94:"ADD_SCENARIO_ITEM",95:"LIST_SCENARIO",96:"PDB_KEY",97:"DELAY_KEY",98:"PRST_KEY",99:"DESCRIPTION_KEY",101:".",103:"/"},productions_:[0,[3,2],[3,1],[4,1],[4,1],[4,2],[4,1],[4,2],[4,1],[4,1],[4,2],[4,2],[4,3],[4,3],[4,1],[4,1],[4,1],[4,1],[4,2],[4,1],[4,1],[4,2],[4,2],[4,2],[4,2],[4,1],[4,2],[4,2],[4,2],[4,4],[4,2],[4,6],[4,2],[4,1],[4,1],[4,1],[4,2],[4,2],[4,1],[4,2],[4,1],[4,2],[4,2],[4,2],[4,1],[4,2],[4,1],[4,1],[4,3],[4,3],[4,4],[4,4],[4,1],[4,2],[50,1],[50,2],[50,2],[50,3],[50,3],[51,1],[51,2],[51,3],[12,2],[12,2],[12,2],[21,1],[21,2],[21,2],[21,3],[22,2],[22,3],[39,2],[39,3],[40,2],[40,3],[24,1],[24,1],[63,1],[63,2],[63,3],[63,4],[67,1],[67,1],[67,2],[68,3],[69,3],[47,1],[47,2],[73,2],[53,1],[53,2],[75,3],[16,1],[16,1],[16,1],[16,1],[16,1],[79,1],[79,1],[32,1],[32,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[81,1],[81,1],[81,1],[81,1],[81,1],[81,1],[81,1],[100,1],[100,1],[76,1],[76,3],[76,3],[10,1],[10,1],[10,3],[10,3],[10,3],[60,1],[102,1],[102,3],[104,1],[104,1]],performAction:function(e,t,n,r,i,o,a){var s=o.length-1;switch(i){case 1:return o[s-1];case 3:this.$=r.miew.reset(!1),r.ClearContext(),r.miew.resetReps("empty");break;case 4:this.$=r.miew.rebuild();break;case 5:this.$=r.miew.rebuildAll(),r.miew.rebuild();break;case 6:this.$=r.echo(r.utils.help().toString());break;case 7:this.$=r.echo(r.utils.help(o[s]).toString());break;case 8:this.$=r.miew.motm();break;case 10:case 11:this.$=r.utils.propagateProp(o[s]),r.echo(r.miew.get(o[s]).toString());break;case 12:case 13:this.$=r.miew.set(o[s-1],r.utils.propagateProp(o[s-1],o[s]));break;case 14:this.$=r.miew.saveSettings();break;case 15:this.$=r.miew.restoreSettings();break;case 16:this.$=r.miew.resetSettings();break;case 17:this.$=r.miew.resetReps();break;case 18:this.$=r.miew.applyPreset(o[s]);break;case 21:this.$=r.miew.repRemove(o[s]),r.representations.remove(o[s]);break;case 22:this.$=r.miew.repHide(o[s]);break;case 23:this.$=r.miew.repHide(o[s],!1);break;case 24:this.$=r.echo(r.utils.listRep(r.miew,r.representations,o[s],"-e"));break;case 25:this.$=r.echo(r.utils.list(r.miew,r.representations));break;case 26:this.$=r.echo(r.utils.list(r.miew,r.representations,o[s]));break;case 27:this.$=r.echo(r.utils.listSelector(r.miew,r.Context));break;case 28:this.$=r.miew.select(r.utils.checkArg(o[s-1].toLowerCase(),o[s],!0));break;case 29:this.$=r.Context[o[s].toLowerCase()]=r.utils.checkArg(o[s-3].toLowerCase(),o[s-2],!0),r.miew.select(r.Context[o[s].toLowerCase()]);break;case 30:this.$=r.miew.rep(r.miew.repCurrent(),{selector:r.utils.checkArg(o[s-1].toLowerCase(),o[s])});break;case 31:this.$=r.Context[o[s].toLowerCase()]=r.miew.within(r.utils.checkArg("select",o[s-2],!0),Number(o[s-4]));break;case 32:this.$=r.miew.rep(r.miew.repCurrent(),{material:r.utils.checkArg(o[s-1].toLowerCase(),o[s].toUpperCase())});break;case 35:this.$=r.echo(r.miew.view());break;case 36:case 37:this.$=r.miew.view(o[s]);break;case 38:this.$=r.echo(r.miew.changeUnit());break;case 39:this.$=r.echo(r.miew.changeUnit(o[s]));break;case 40:this.$=r.miew.dssp();break;case 41:this.$=r.miew.scale(o[s]);break;case 42:for(var l=0,u=o[s].length;l<u;l++)r.miew.rotate(o[s][l].x*Math.PI/180,o[s][l].y*Math.PI/180,o[s][l].z*Math.PI/180);break;case 43:for(l=0,u=o[s].length;l<u;l++)r.miew.translate(o[s][l].x||0,o[s][l].y||0,o[s][l].z||0);break;case 44:this.$=r.miew.center();break;case 45:this.$=r.miew.center(o[s]);break;case 48:case 49:this.$=r.miew.addObject({type:"line",params:[o[s-1],o[s]]},!0);break;case 50:case 51:this.$=r.miew.addObject({type:"line",params:[o[s-2],o[s-1]],opts:o[s].toJSO(r.utils,"objects","line")},!0);break;case 52:this.$=r.echo(r.utils.listObjs(r.miew));break;case 53:this.$=r.miew.removeObject(o[s]);break;case 54:this.$=r.echo(r.miew.getURL({view:!1,settings:!1}));break;case 55:this.$=r.echo(r.miew.getURL({view:!1,settings:!0}));break;case 56:this.$=r.echo(r.miew.getURL({view:!0,settings:!1}));break;case 57:case 58:this.$=r.echo(r.miew.getURL({view:!0,settings:!0}));break;case 59:this.$=r.miew.screenshotSave();break;case 60:this.$=r.miew.screenshotSave("",Number(o[s]));break;case 61:this.$=r.miew.screenshotSave("",Number(o[s-1]),Number(o[s]));break;case 62:case 63:case 64:this.$=r.utils.load(r.miew,o[s]),r.representations.clear();break;case 65:this.$=r.echo(r.representations.add(r.miew.repAdd()));break;case 66:this.$=r.echo(r.representations.add(o[s],r.miew.repAdd()));break;case 67:this.$=r.echo(r.representations.add(r.miew.repAdd(o[s])));break;case 68:this.$=r.echo(r.representations.add(o[s-1],r.miew.repAdd(o[s])));break;case 69:this.$=r.miew.rep(o[s]),r.miew.repCurrent(o[s]);break;case 70:this.$=r.miew.rep(o[s-1],o[s]),r.miew.repCurrent(o[s-1]);break;case 71:this.$=r.miew.rep(r.miew.repCurrent(),{mode:r.utils.checkArg(o[s-1].toLowerCase(),o[s].toUpperCase())});break;case 72:this.$=r.miew.rep(r.miew.repCurrent(),{mode:new Array(r.utils.checkArg(o[s-2].toLowerCase(),o[s-1].toUpperCase()),o[s].toJSO(r.utils,o[s-2],o[s-1].toUpperCase()))});break;case 73:this.$=r.miew.rep(r.miew.repCurrent(),{colorer:r.utils.checkArg(o[s-1].toLowerCase(),o[s].toUpperCase())});break;case 74:this.$=r.miew.rep(r.miew.repCurrent(),{colorer:new Array(r.utils.checkArg(o[s-2].toLowerCase(),o[s-1].toUpperCase()),o[s].toJSO(r.utils,o[s-2],o[s-1].toUpperCase()))});break;case 75:this.$=Number(r.representations.get(o[s]));break;case 76:case 92:this.$=Number(o[s]);break;case 77:this.$=o[s];break;case 78:this.$=r._.assign(o[s-1],o[s]);break;case 79:this.$=r._.assign(o[s-2],o[s-1],o[s]);break;case 80:this.$=r._.assign(o[s-3],o[s-2],o[s-1],o[s]);break;case 81:case 82:this.$=r.CreateObjectPair(o[s].key,o[s].val);break;case 83:this.$=r.CreateObjectPair(o[s-1].key,new Array(o[s-1].val,o[s].toJSO(r.utils,o[s-1].key,o[s-1].val)));break;case 84:case 85:this.$=Object.create({key:r.keyRemap(o[s-2]),val:r.utils.checkArg(o[s-2],o[s])});break;case 86:this.$=[o[s]];break;case 87:this.$=o[s-1].concat(o[s]);break;case 88:this.$=r.CreateObjectPair(o[s-1].toLowerCase(),Number(o[s]));break;case 89:this.$=new r.ArgList(o[s]);break;case 90:this.$=o[s-1].append(o[s]);break;case 91:this.$=new r.Arg(o[s-2],o[s]);break;case 93:this.$=parseInt(o[s]);break;case 94:this.$=JSON.parse(o[s]);break;case 95:case 96:this.$=String(o[s]);break;case 157:case 158:case 161:case 162:case 163:this.$=o[s-2]+o[s-1]+o[s];break;case 166:this.$=o[s-2]=o[s-2]+o[s-1]+o[s]}},table:[{3:1,4:2,5:[1,3],6:[1,4],7:[1,5],9:[1,6],11:[1,7],12:8,13:[1,9],15:[1,10],17:[1,11],18:[1,12],19:[1,13],20:[1,14],21:15,22:16,23:[1,17],25:[1,18],26:[1,19],27:[1,20],30:[1,21],33:[1,22],34:[1,23],37:[1,24],39:25,40:26,41:[1,27],43:[1,28],44:[1,29],45:[1,30],46:[1,31],48:[1,32],49:[1,33],50:34,51:35,52:[1,36],54:[1,37],55:[1,38],56:[1,44],58:[1,45],59:[1,39],62:[1,40],64:[1,41],65:[1,42],66:[1,43]},{1:[3]},{5:[1,46]},{1:[2,2]},{5:[2,3]},{5:[2,4],8:[1,47]},{5:[2,6],6:t,7:n,9:r,10:48,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,70:I,72:O,74:D,79:49,80:52,81:50,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$,96:K,97:J,98:Q,99:ee},{5:[2,8]},{5:[2,9]},{6:t,7:n,9:r,10:106,13:i,14:[1,107],15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,70:I,72:O,74:D,79:49,80:52,81:50,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$,96:K,97:J,98:Q,99:ee},{6:t,7:n,9:r,10:108,13:i,14:[1,109],15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,70:I,72:O,74:D,79:49,80:52,81:50,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$,96:K,97:J,98:Q,99:ee},{5:[2,14]},{5:[2,15]},{5:[2,16]},{5:[2,17],14:te,16:110,35:ne,38:re,77:ie,78:oe},{5:[2,19]},{5:[2,20]},{24:116,35:ae,38:se},{24:119,35:ae,38:se},{24:120,35:ae,38:se},{5:[2,25],24:121,28:[1,122],29:[1,123],35:ae,38:se},{14:[1,124]},{14:[1,125]},{35:[1,126]},{38:[1,127]},{5:[2,33]},{5:[2,34]},{5:[2,35],14:[1,128],42:[1,129]},{5:[2,38],35:[1,130]},{5:[2,40]},{35:[1,131]},{47:132,73:133,74:le},{47:135,73:133,74:le},{5:[2,44],14:[1,136]},{5:[2,46]},{5:[2,47]},{6:t,7:n,9:r,10:138,13:i,14:[1,137],15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,70:I,72:O,74:D,79:49,80:52,81:50,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$,96:K,97:J,98:Q,99:ee},{5:[2,52]},{35:[1,139]},{14:[1,143],38:[1,141],60:140,61:[1,142]},{5:[2,65],38:[1,144],63:145,67:146,68:147,69:148,70:ue,72:ce},{24:151,35:ae,38:se},{38:[1,152]},{38:[1,153]},{5:[2,54],29:[1,154],57:[1,155]},{5:[2,59],35:[1,156]},{1:[2,1]},{5:[2,5]},{5:[2,7],101:he},e(de,[2,159]),e(de,[2,160]),e(fe,[2,97]),e(fe,[2,98]),e(de,[2,147]),e(de,[2,148]),e(de,[2,149]),e(de,[2,150]),e(de,[2,151]),e(de,[2,152]),e(de,[2,153]),e(fe,[2,101]),e(fe,[2,102]),e(fe,[2,103]),e(fe,[2,104]),e(fe,[2,105]),e(fe,[2,106]),e(fe,[2,107]),e(fe,[2,108]),e(fe,[2,109]),e(fe,[2,110]),e(fe,[2,111]),e(fe,[2,112]),e(fe,[2,113]),e(fe,[2,114]),e(fe,[2,115]),e(fe,[2,116]),e(fe,[2,117]),e(fe,[2,118]),e(fe,[2,119]),e(fe,[2,120]),e(fe,[2,121]),e(fe,[2,122]),e(fe,[2,123]),e(fe,[2,124]),e(fe,[2,125]),e(fe,[2,126]),e(fe,[2,127]),e(fe,[2,128]),e(fe,[2,129]),e(fe,[2,130]),e(fe,[2,131]),e(fe,[2,132]),e(fe,[2,133]),e(fe,[2,134]),e(fe,[2,135]),e(fe,[2,136]),e(fe,[2,137]),e(fe,[2,138]),e(fe,[2,139]),e(fe,[2,140]),e(fe,[2,141]),e(fe,[2,142]),e(fe,[2,143]),e(fe,[2,144]),e(fe,[2,145]),e(fe,[2,146]),{5:[2,10],101:he},{5:[2,11]},{14:te,16:158,35:ne,38:re,77:ie,78:oe,101:he},{14:te,16:159,35:ne,38:re,77:ie,78:oe},{5:[2,18]},e(pe,[2,92]),e(pe,[2,93]),e(pe,[2,94]),e(pe,[2,95]),e(pe,[2,96]),{5:[2,21]},e(me,[2,75]),e(me,[2,76]),{5:[2,22]},{5:[2,23]},{5:[2,24]},{5:[2,26]},{5:[2,27]},{5:[2,28],31:[1,160]},{5:[2,30]},{36:[1,161]},{5:[2,32]},{5:[2,36]},{5:[2,37]},{5:[2,39]},{5:[2,41]},{5:[2,42],73:162,74:le},e(ve,[2,86]),{35:[1,163]},{5:[2,43],73:162,74:le},{5:[2,45]},{14:[1,164]},{6:t,7:n,9:r,10:165,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,70:I,72:O,74:D,79:49,80:52,81:50,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$,96:K,97:J,98:Q,99:ee,101:he},{5:[2,53]},{5:[2,62]},{5:[2,63]},{5:[2,64]},{5:[2,164]},{5:[2,66],63:166,67:146,68:147,69:148,70:ue,72:ce},{5:[2,67]},{5:[2,77],67:167,68:147,69:148,70:ue,72:ce},e(me,[2,81]),e(me,[2,82],{80:52,53:168,75:169,76:170,79:171,6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$}),{71:[1,172]},{71:[1,173]},{5:[2,69],63:174,67:146,68:147,69:148,70:ue,72:ce},{5:[2,71],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,53:175,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,75:169,76:170,79:171,80:52,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$},{5:[2,73],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,53:176,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,75:169,76:170,79:171,80:52,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$},{5:[2,55],57:[1,177]},{5:[2,56],29:[1,178]},{5:[2,60],35:[1,179]},{6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,35:[1,181],37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,70:I,72:O,74:D,79:180,80:52,81:182,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$,96:K,97:J,98:Q,99:ee},{5:[2,12]},{5:[2,13]},{6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,32:183,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,70:I,72:O,74:D,79:184,80:52,81:185,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$,96:K,97:J,98:Q,99:ee},{14:[1,186]},e(ve,[2,87]),e(ve,[2,88]),{5:[2,48],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,53:187,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,75:169,76:170,79:171,80:52,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$},{5:[2,49],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,53:188,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,75:169,76:170,79:171,80:52,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$,101:he},{5:[2,68]},{5:[2,78],67:189,68:147,69:148,70:ue,72:ce},e(me,[2,83],{80:52,76:170,79:171,75:190,6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$}),e(pe,[2,89]),{71:[1,191],101:[1,192]},e(ge,[2,156]),{14:te,16:193,35:ne,38:re,77:ie,78:oe},{14:te,16:194,35:ne,38:re,77:ie,78:oe},{5:[2,70]},{5:[2,72],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,75:190,76:170,79:171,80:52,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$},{5:[2,74],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,75:190,76:170,79:171,80:52,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$},{5:[2,57]},{5:[2,58]},{5:[2,61]},e(de,[2,161]),e(de,[2,162]),e(de,[2,163]),{5:[2,29]},{5:[2,99]},{5:[2,100]},{31:[1,195]},{5:[2,50],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,75:190,76:170,79:171,80:52,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$},{5:[2,51],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,75:190,76:170,79:171,80:52,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$},{5:[2,79],67:196,68:147,69:148,70:ue,72:ce},e(pe,[2,90]),{14:te,16:197,35:ne,38:re,77:ie,78:oe},{6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,33:m,34:v,35:[1,199],37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,79:198,80:52,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$},e(me,[2,84]),e(pe,[2,85]),{6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:u,23:c,25:h,26:d,27:f,30:p,32:200,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:E,54:T,55:M,56:C,58:A,59:R,62:P,64:k,65:L,66:N,70:I,72:O,74:D,79:184,80:52,81:185,82:z,83:F,84:B,85:U,86:V,87:G,88:j,89:H,90:W,91:q,92:Y,93:X,94:Z,95:$,96:K,97:J,98:Q,99:ee},{5:[2,80]},e(pe,[2,91]),e(ge,[2,157]),e(ge,[2,158]),{5:[2,31]}],defaultActions:{3:[2,2],4:[2,3],7:[2,8],8:[2,9],11:[2,14],12:[2,15],13:[2,16],15:[2,19],16:[2,20],25:[2,33],26:[2,34],29:[2,40],34:[2,46],35:[2,47],37:[2,52],46:[2,1],47:[2,5],107:[2,11],110:[2,18],116:[2,21],119:[2,22],120:[2,23],121:[2,24],122:[2,26],123:[2,27],125:[2,30],127:[2,32],128:[2,36],129:[2,37],130:[2,39],131:[2,41],136:[2,45],139:[2,53],140:[2,62],141:[2,63],142:[2,64],143:[2,164],145:[2,67],158:[2,12],159:[2,13],166:[2,68],174:[2,70],177:[2,57],178:[2,58],179:[2,61],183:[2,29],184:[2,99],185:[2,100],196:[2,80],200:[2,31]},parseError:function(e,t){if(!t.recoverable){var n=new Error(e);throw n.hash=t,n}this.trace(e)},parse:function(e){var t=this,n=[0],r=[],i=[null],o=[],a=this.table,s="",l=0,u=0,c=2,h=1,d=o.slice.call(arguments,1),f=Object.create(this.lexer),p={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(p.yy[m]=this.yy[m]);f.setInput(e,p.yy),p.yy.lexer=f,p.yy.parser=this,void 0===f.yylloc&&(f.yylloc={});var v=f.yylloc;o.push(v);var g=f.options&&f.options.ranges;function y(){var e;return"number"!=typeof(e=r.pop()||f.lex()||h)&&(e instanceof Array&&(e=(r=e).pop()),e=t.symbols_[e]||e),e}"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var _,x,b,w,S,E,T,M,C={};;){if(x=n[n.length-1],this.defaultActions[x]?b=this.defaultActions[x]:(null==_&&(_=y()),b=a[x]&&a[x][_]),void 0===b||!b.length||!b[0]){var A="";for(S in M=[],a[x])this.terminals_[S]&&S>c&&M.push("'"+this.terminals_[S]+"'");A=f.showPosition?"Parse error on line "+(l+1)+":\n"+f.showPosition()+"\nExpecting "+M.join(", ")+", got '"+(this.terminals_[_]||_)+"'":"Parse error on line "+(l+1)+": Unexpected "+(_==h?"end of input":"'"+(this.terminals_[_]||_)+"'"),this.parseError(A,{text:f.match,token:this.terminals_[_]||_,line:f.yylineno,loc:v,expected:M})}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+_);switch(b[0]){case 1:n.push(_),i.push(f.yytext),o.push(f.yylloc),n.push(b[1]),_=null,u=f.yyleng,s=f.yytext,l=f.yylineno,v=f.yylloc;break;case 2:if(E=this.productions_[b[1]][1],C.$=i[i.length-E],C._$={first_line:o[o.length-(E||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(E||1)].first_column,last_column:o[o.length-1].last_column},g&&(C._$.range=[o[o.length-(E||1)].range[0],o[o.length-1].range[1]]),void 0!==(w=this.performAction.apply(C,[s,u,l,p.yy,b[1],i,o].concat(d))))return w;E&&(n=n.slice(0,-1*E*2),i=i.slice(0,-1*E),o=o.slice(0,-1*E)),n.push(this.productions_[b[1]][0]),i.push(C.$),o.push(C._$),T=a[n[n.length-2]][n[n.length-1]],n.push(T);break;case 3:return!0}}return!0}},_e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,r,i;if(this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(i.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var o in i)this[o]=i[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,n,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),o=0;o<i.length;o++)if((n=this._input.match(this.rules[i[o]]))&&(!t||n[0].length>t[0].length)){if(t=n,r=o,this.options.backtrack_lexer){if(!1!==(e=this.test_match(n,i[o])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,i[r]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{"case-insensitive":!0},performAction:function(e,t,n,r){switch(n){case 0:break;case 1:case 2:return"";case 3:return 42;case 4:return 35;case 5:return 77;case 6:case 7:return 78;case 8:return 8;case 9:return 6;case 10:return 82;case 11:return 7;case 12:return 9;case 13:return 59;case 14:return 13;case 15:return 15;case 16:return 17;case 17:return 18;case 18:return 19;case 19:return 20;case 20:return 11;case 21:return 62;case 22:return 64;case 23:return 23;case 24:return 25;case 25:return 26;case 26:return 27;case 27:return 30;case 28:return 34;case 29:return 33;case 30:return 65;case 31:return 66;case 32:return 37;case 33:return 41;case 34:return 43;case 35:return 52;case 36:return 54;case 37:return 55;case 38:return 46;case 39:return 48;case 40:return 45;case 41:return 49;case 42:return 56;case 43:return 58;case 44:return 44;case 45:return 83;case 46:return 84;case 47:return 85;case 48:return 86;case 49:return 87;case 50:return 88;case 51:return 89;case 52:return 90;case 53:return 91;case 54:return 92;case 55:return 93;case 56:return 94;case 57:return 95;case 58:case 59:return 70;case 60:case 61:return 72;case 62:case 63:case 64:return 74;case 65:return 31;case 66:return 36;case 67:return 96;case 68:return 97;case 69:return 98;case 70:return 99;case 71:return t.yytext=e.utils.unquoteString(t.yytext),14;case 72:return 38;case 73:return 5;case 74:return 101;case 75:return 103;case 76:return"\\";case 77:return 28;case 78:return 61;case 79:return 29;case 80:return 57;case 81:return 71}},rules:[/^(?:\s+)/i,/^(?:[#].*)/i,/^(?:\/\/.*)/i,/^(?:([_A-Z0-9\/\+]+==))/i,/^(?:-?[0-9]+(\.[0-9]+)?\b)/i,/^(?:0[xX][0-9A-F]+\b)/i,/^(?:false\b)/i,/^(?:true\b)/i,/^(?:all\b)/i,/^(?:reset\b)/i,/^(?:clear\b)/i,/^(?:build\b)/i,/^(?:help\b)/i,/^(?:load\b)/i,/^(?:get\b)/i,/^(?:set\b)/i,/^(?:set_save\b)/i,/^(?:set_restore\b)/i,/^(?:set_reset\b)/i,/^(?:preset\b)/i,/^(?:motm\b)/i,/^(?:add\b)/i,/^(?:rep\b)/i,/^(?:remove\b)/i,/^(?:hide\b)/i,/^(?:show\b)/i,/^(?:list\b)/i,/^(?:select\b)/i,/^(?:within\b)/i,/^(?:selector\b)/i,/^(?:mode\b)/i,/^(?:color\b)/i,/^(?:material\b)/i,/^(?:view\b)/i,/^(?:unit\b)/i,/^(?:line\b)/i,/^(?:listobj\b)/i,/^(?:removeobj\b)/i,/^(?:rotate\b)/i,/^(?:translate\b)/i,/^(?:scale\b)/i,/^(?:center\b)/i,/^(?:url\b)/i,/^(?:screenshot\b)/i,/^(?:dssp\b)/i,/^(?:file_list\b)/i,/^(?:file_register\b)/i,/^(?:file_delete\b)/i,/^(?:preset_add\b)/i,/^(?:preset_delete\b)/i,/^(?:preset_update\b)/i,/^(?:preset_rename\b)/i,/^(?:preset_open\b)/i,/^(?:create_scenario\b)/i,/^(?:reset_scenario\b)/i,/^(?:delete_scenario\b)/i,/^(?:add_scenario_item\b)/i,/^(?:list_scenario\b)/i,/^(?:s\b)/i,/^(?:mt\b)/i,/^(?:m\b)/i,/^(?:c\b)/i,/^(?:x\b)/i,/^(?:y\b)/i,/^(?:z\b)/i,/^(?:as\b)/i,/^(?:of\b)/i,/^(?:pdb\b)/i,/^(?:delay\b)/i,/^(?:prst\b)/i,/^(?:desc\b)/i,/^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i,/^(?:([_A-Z0-9]+))/i,/^(?:$)/i,/^(?:\.)/i,/^(?:\/)/i,/^(?:\\)/i,/^(?:-e\b)/i,/^(?:-f\b)/i,/^(?:-s\b)/i,/^(?:-v\b)/i,/^(?:=)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81],inclusive:!0}}};function xe(){this.yy={}}return ye.lexer=_e,xe.prototype=ye,ye.Parser=xe,new xe}(),Ux={$help:["Rendering mode shortcut","    BS - balls and sticks mode","    LN - lines mode","    LC - licorice mode","    VW - van der waals mode","    TR - trace mode","    TU - tube mode","    CA - cartoon mode","    SA - isosurface mode","    QS - quick surface mode","    SE - solvent excluded mode","    TX - text mode"],BS:{$help:["   Balls and sticks","      aromrad = <number> #aromatic radius","      atom = <number>    #atom radius","      bond = <number>    #bond radius","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic","      space = <number>   #space value\n"]},CA:{$help:["   Cartoon","      arrow = <number>   #arrow size","      depth = <number>   #depth of surface","      heightSegmentsRatio = <number>","      radius = <number>  #tube radius","      tension = <number> #","      width = <number>  #secondary width\n"]},LN:{$help:["   Lines","      atom = <number>    #atom radius","      chunkarom = <number>","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic","      offsarom = <number>\n"]},LC:{$help:["   Licorice","      aromrad = <number> #aromatic radius","      bond = <number>    #bond radius","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic","      space = <number>   #space value\n"]},VW:{$help:["   Van der Waals","      nothing\n"]},TR:{$help:["   Trace","      radius = <number>  #tube radius\n"]},TU:{$help:["   Tube","      heightSegmentsRatio = <number>","      radius = <number>  #tube radius","      tension = <number> \n"]},SA:{$help:["   Surface","      zClip = <bool> #clip z plane\n"]},QS:{$help:["   Quick surface","      isoValue = <number>","      scale = <number>","      wireframe = <bool>","      zClip = <bool> #clip z plane\n"]},SE:{$help:["   Solvent excluded surface","      zClip = <bool> #clip z plane\n"]},TX:{$help:["   Text mode",'      template = <format string> string that can include "{{ id }}"',"          it will be replaced by value, id can be one of next:","          serial, name, type, sequence, residue, chain, hetatm, water\n",'      horizontalAlign = <string> {"left", "right", "center"}','      verticalAlign = <string> {"top", "bottom", "middle"}',"      dx = <number> #offset along x","      dy = <number> #offset along y","      dz = <number> #offset along z","      fg = <string> #text color modificator","           could be keyword, named color or hex","      fg = <string> #back color modificator","           could be keyword, named color or hex","      showBg = <bool> #if set show background","           plate under text"]}},Vx={$help:["Coloring mode shortcut","    EL - color by element","    CH - color by chain","    SQ - color by sequence","    RT - color by residue type","    SS - color by secondary structure","    UN - uniform"],UN:{$help:["Parameters of coloring modes customization","   Uniform","      color = <number|color> #RGB->HEX->dec\n"],color:{$help:Object.keys(Av.get(eh.now.palette).namedColors).sort().join("\n")}}},Gx={$help:["Material shortcut","    DF - diffuse","    TR - transparent","    SF - soft plastic","    PL - glossy plastic","    ME - metal","    GL - glass"]},jx={$help:["Short (packed) representation description as a set of variables","    s=<EXPRESSION>","        selector property","    m=<MODE_ID>[!<PARAMETER>:<VALUE>[,...]]","        render mode property","    c=<COLORER_ID>[!<PARAMETER>:<VALUE>[,...]]","        color mode property","    mt=<MATERIAL_ID>","        material property"],s:{$help:"Selection expression string as it is in menu->representations->selection"},m:Ux,c:Vx,mt:Gx},Hx={$help:["Parameters of rendering modes customization: modes","Parameters of colorer customization: colorers","Autobuild: autobuild = (<number>|<bool>)"],modes:Ux,colorers:Vx},Wx={$help:["help (<cmd name>| <path to property>)","You can get detailed information about command options",'   using "help cmd.opt.opt.[...]"\n',"   you can use one line comments","   everything started from (#|//) will be skipped","   Example: >build //some comment\n","List of available commands:"],reset:{$help:["Reload current object, delete all representations","    Nothing will work until load new object"]},load:{$help:["load (<PDBID>|<URL>|-f [<*.NC FILE URL STRING>])","    Load new pdb object from selected source"],PDBID:{$help:"pdb id in remote molecule database"},URL:{$help:"url to source file"},f:{$help:["open file system dialog to fetch local file","optionally you can determine trajectory file","via URL for *.top model"]}},clear:{$help:"No args. Clear terminal"},add:{$help:["add [<REP_NAME>] [<DESCRIPTION>]","    Add new item to representation set with","    default or <DESCRIPTION> params"],REP_NAME:{$help:"Identifier string [_,a-z,A-Z,0-9] can not start from digit"},DESCRIPTION:jx},rep:{$help:["rep [<REP_NAME>|<REP_INDEX>] [<DESCRIPTION>]","    set current representation by name or index","    edit current representation by <DESCRIPTION>"],REP_NAME:{$help:["Identifier string [_,a-z,A-Z,0-9] can not start from digit","Must be declared before"]},REP_INDEX:{$help:"Index of available representation"},DESCRIPTION:jx},remove:{$help:["remove (<REP_NAME>|<REP_INDEX>)","Remove representation by name or index"],REP_NAME:{$help:["Identifier string [_,a-z,A-Z,0-9] can not start from digit","Must be declared before"]},REP_INDEX:{$help:"Index of available representation"}},selector:{$help:["selector <EXPRESSION>","   set selector from EXPRESSION to current representation"],EXPRESSION:{$help:"Selection expression string as it is in menu->representations->selection"}},mode:{$help:["mode <MODE_ID> [<PARAMETER>=<VALUE>...]","   set rendering mode and apply parameters to current representation"],MODE_ID:Ux},color:{$help:["color <COLORER_ID> [<PARAMETER>=<VALUE>...]","   set colorer and apply parameters to current representation"],COLORER_ID:Vx},material:{$help:["material <MATERIAL_ID>","   set material to current representation"],MATERIAL_ID:Gx},build:{$help:"build help str",add:{$help:"build.add",new:{$help:["add.new","add.new new line 1","add.new new line 2","add.new new line 3"]}},del:{$help:"build.del"}},list:{$help:["list [-e|-s|<REP_NAME>|<REP_INDEX>]","Print representations if no args print list of representations","    -e expand list and show all representations","    -s show all user-registered selectors","    <REP_NAME>|<REP_INDEX> show only current representation"]},hide:{$help:["hide (<REP_NAME>|<REP_INDEX>)","Hide representation referenced in args"]},show:{$help:["show (<REP_NAME>|<REP_INDEX>)","Show representation referenced in args"]},get:{$help:["get <PARAMETER>","Print <PARAMETER> value","    <PARAMETER> - path to option use get.PARAMETER to get more info"],PARAMETER:Hx},set:{$help:["set <PARAMETER> <VALUE>","Set <PARAMETER> with <VALUE>","    <PARAMETER> - path to option use set.PARAMETER to get more info"],PARAMETER:Hx},set_save:{$help:["set_save","Save current settings to cookie"]},set_restore:{$help:["set_restore","Load and apply settings from cookie"]},set_reset:{$help:["set_reset","Reset current settings to the defaults"]},preset:{$help:["preset [<PRESET>]","Reset current representation or set preset to <PRESET>"],PRESET:{$help:["default","wire","small","macro"]}},unit:{$help:["unit [<unit_id>]","Change current biological structure view. Zero <unit_id> value means asymmetric unit,","positive values set an assembly with corresponding number.","Being called with no parameters command prints current unit information."]},view:{$help:["view [<ENCODED_VIEW>]","Get current encoded view or set if ENCODED_VIEW placed as argument"],ENCODED_VIEW:{$help:["encoded view matrix string (binary code)"]}},rotate:{$help:["rotate (x|y|z) [<DEGREES>] [(x|y|z) [<DEGREES>]]...","Rotate scene"]},scale:{$help:["scale <SCALE>","Scale scene"]},select:{$help:["select <SELECTOR_STRING> [as <SELECTOR_NAME>]","Select atoms using selector defined in SELECTOR_STRING","    and if SELECTOR_NAME is defined register it in viewer","    you can use it later as a complex selector"]},within:{$help:["within <DISTANCE> of <SELECTOR_STRING> as <SELECTOR_NAME>","Build within named selector","    DISTANCE        <number>","    SELECTOR_STRING <string(selection language)>","    SELECTOR_NAME   <identifier>"]},url:{$help:["url [-s] [-v]","Report URL encoded scene","    if -s set that include settings in the URL","    if -v set that include view in the URL"]},screenshot:{$help:["screenshot [<WIDTH> [<HEIGHT>]]","Make a screenshot of the scene","    WIDTH  <number> in pixels","    HEIGHT <number> in pixels, equal to WIDTH by default"]},line:{$help:["line <first_atom_path> <second_atom_path> [<PARAMETER>=<VALUE>]","Draw dashed line between two specified atoms"]},removeobj:{$help:["removeobj <id>","Remove scene object by its index. Indices could be obtained by <listobj> command"]},listobj:{$help:["listobj","Display the list of all existing scene objects"]}},qx=Nx.chem.selectors,Yx=Nx.modes,Xx=Nx.colorers,Zx=Nx.materials,$x=Nx.palettes,Kx=Nx.options,Jx=Nx.settings;var Qx,eb=(Qx=new function(){},function(){return Qx}),tb=new(function(){function e(){h(this,e),this.representationMap={},this.representationID={}}return Tc(e,[{key:"get",value:function(e){return this.representationMap[e]||this.representationID[e]||"<no name>"}},{key:"add",value:function(e,t){if(-1===e)return"Can not create representation: there is no data";if(void 0!==t){if(this.representationMap.hasOwnProperty(e))return"This name has already existed, registered without name";this.representationMap[e.toString()]=t,this.representationID[t]=e.toString()}return"Representation ".concat(e," successfully added")}},{key:"remove",value:function(e){e&&this.representationID.hasOwnProperty(e)&&(delete this.representationMap[this.representationID[e]],delete this.representationID[e]);var t=Object.keys(this.representationID).sort();for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r>e&&(this.representationID[r-1]=this.representationID[r],this.representationMap[this.representationID[r]]-=1,delete this.representationID[r])}}},{key:"clear",value:function(){this.representationMap={},this.representationID={}}}]),e}());function nb(e){var t={s:"selector",m:"mode",c:"colorer",mt:"material",mode:"modes",color:"colorers",colorer:"colorers",select:"selector",material:"materials",selector:"selector"}[e];return void 0===t?e:t}var rb=new(function(){function e(){h(this,e)}return Tc(e,[{key:"list",value:function(e,t,n){var r="";if(e&&void 0!==t&&(void 0===n||"-e"===n))for(var i=e.repCount(),o=0;o<i;o++)r+=this.listRep(e,t,o,n);return r}},{key:"listRep",value:function(e,t,n,r){var i="",o=e.repGet(n);if(!o)return zc.warn("Rep ".concat(n," does not exist!")),i;var a=n,s=t.get(a),l=o.mode,u=o.colorer,c=o.selectorString,h=o.materialPreset;return i+="#".concat(a," : ").concat(l.name).concat("<no name>"===s?"":", ".concat(s),"\n"),void 0!==r&&(i+='    selection : "'.concat(c,'"\n'),i+="    mode      : (".concat(l.id,"), ").concat(l.name,"\n"),i+="    colorer   : (".concat(u.id,"), ").concat(u.name,"\n"),i+="    material  : (".concat(h.id,"), ").concat(h.name,"\n")),i}},{key:"listSelector",value:function(e,t){var n="";for(var r in t)t.hasOwnProperty(r)&&(n+="".concat(r,' : "').concat(t[r],'"\n'));return n}},{key:"listObjs",value:function(e){var t=e._objects;if(!t||!Array.isArray(t)||0===t.length)return"There are no objects on the scene";for(var n=[],r=0,i=t.length;r<i;++r)n[r]="".concat(r,": ").concat(t[r].toString());return n.join("\n")}},{key:"joinHelpStr",value:function(e){return e instanceof Array?e.join("\n"):e}},{key:"help",value:function(e){if(s.isUndefined(e))return"".concat(this.joinHelpStr(Wx.$help),"\n").concat(s.slice(s.sortBy(s.keys(Wx)),1).join(", "),"\n");var t=s.get(Wx,e);return s.isUndefined(t)?this.help():"".concat(this.joinHelpStr(t.$help),"\n")}},{key:"load",value:function(e,t){if(void 0!==e&&void 0!==t&&"-f"!==t){e.awaitWhileCMDisInProcess();var n=function(){return e.finishAwaitingCMDInProcess()};e.load(t).then(n,n)}}},{key:"checkArg",value:function(e,t,n){if(void 0!==e&&void 0!==t){if("selector"===nb(e)){var r=qx.parse(t);if(void 0!==r.error)throw{message:r.error};return void 0!==n&&n?r.selector:t}for(var i,o={colorers:Xx,modes:Yx,materials:Zx},a=e;a!==i;)a=nb(i=a);if(void 0===o[a].get(t))throw{message:"".concat(t," is not existed in ").concat(a)};return t}return eb}},{key:"propagateProp",value:function(e,t){if(void 0!==e){var n=Kx.adapters[l(s.get(Jx.defaults,e))];if(void 0===n)throw{message:"".concat(e," is not existed")};if((e.endsWith(".color")||e.endsWith(".baseColor")||e.endsWith(".EL.carbon"))&&"number"!=typeof t&&(t=$x.get(Jx.now.palette).getNamedColor(t)),e.endsWith(".fg")||e.endsWith(".bg"))if("number"!=typeof t){var r=$x.get(Jx.now.palette).getNamedColor(t,!0);void 0!==r&&(t="0x".concat(r.toString(16)))}else t="0x".concat(t.toString(16));if(e.endsWith(".template")&&(t=t.replace(/\\n/g,"\n")),void 0!==t&&n(t)!==t&&n(t)!==t>0)throw{message:"".concat(e,' must be a "').concat(l(s.get(Jx.defaults,e)),'"')}}return t}},{key:"unquoteString",value:function(e){return $c.unquoteString(e)}}]),e}());function ib(e){if(e instanceof this.constructor)return e;this._values=e instanceof Array?e.slice(0):e?[e]:[]}ib.prototype.append=function(e){var t=this._values;return t[t.length]=e,this},ib.prototype.remove=function(e){var t=this._values,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},ib.prototype.toJSO=function(e,t,n){for(var r={},i=this._values,o=0,a=i.length;o<a;++o)s.set(r,i[o].id,e.propagateProp("".concat(nb(t),".").concat(n,".").concat(i[o].id),i[o].val));return r};var ob=Object.create({});ob.Arg=function(e,t){this.id=e,this.val=t},ob.ArgList=ib,ob.miew=null,ob.echo=null,ob.representations=tb,ob.utils=rb,ob._=s,ob.CreateObjectPair=function(e,t){var n={};return n[e]=t,n},ob.keyRemap=nb,ob.Context=qx.Context,ob.ClearContext=qx.ClearContext,ob.NULL=eb,ob.notimplemented=function(){return this.NULL},Nx.prototype.script=function(e,t,n){Bx.yy.miew=this,Bx.yy.echo=t,Bx.yy.error=n,void 0===this.cmdQueue&&(this.cmdQueue=[]),void 0===this.commandInAction&&(this.commandInAction=!1),this.cmdQueue=this.cmdQueue.concat(e.split("\n"))},Nx.prototype.awaitWhileCMDisInProcess=function(){this.commandInAction=!0},Nx.prototype.finishAwaitingCMDInProcess=function(){this.commandInAction=!1},Nx.prototype.isScriptingCommandAvailable=function(){return void 0!==this.commandInAction&&!this.commandInAction&&void 0!==this.cmdQueue&&this.cmdQueue.length>0},Nx.prototype.callNextCmd=function(){if(this.isScriptingCommandAvailable()){var e=this.cmdQueue.shift(),t={success:!1};try{Bx.parse(e),t.success=!0}catch(e){t.error=e.message,Bx.yy.error(t.error),this.finishAwaitingCMDInProcess()}return t}return""},Bx.yy=ob,Bx.yy.parseError=Bx.parseError,t.a=Nx}).call(this,r(12))},function(e,t,n){var r=n(5),i=n(6);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var o=(r(i,{insert:"head",singleton:!1}),i.locals?i.locals:{});e.exports=o},function(e,t,n){"use strict";var r,i=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),o=[];function a(e){for(var t=-1,n=0;n<o.length;n++)if(o[n].identifier===e){t=n;break}return t}function s(e,t){for(var n={},r=[],i=0;i<e.length;i++){var s=e[i],l=t.base?s[0]+t.base:s[0],u=n[l]||0,c="".concat(l," ").concat(u);n[l]=u+1;var h=a(c),d={css:s[1],media:s[2],sourceMap:s[3]};-1!==h?(o[h].references++,o[h].updater(d)):o.push({identifier:c,updater:m(d,t),references:1}),r.push(c)}return r}function l(e){var t=document.createElement("style"),r=e.attributes||{};if(void 0===r.nonce){var o=n.nc;o&&(r.nonce=o)}if(Object.keys(r).forEach((function(e){t.setAttribute(e,r[e])})),"function"==typeof e.insert)e.insert(t);else{var a=i(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var u,c=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function h(e,t,n,r){var i=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(e.styleSheet)e.styleSheet.cssText=c(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}function d(e,t,n){var r=n.css,i=n.media,o=n.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),o&&btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var f=null,p=0;function m(e,t){var n,r,i;if(t.singleton){var o=p++;n=f||(f=l(t)),r=h.bind(null,n,o,!1),i=h.bind(null,n,o,!0)}else n=l(t),r=d.bind(null,n,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r));var n=s(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<n.length;r++){var i=a(n[r]);o[i].references--}for(var l=s(e,t),u=0;u<n.length;u++){var c=a(n[u]);0===o[c].references&&(o[c].updater(),o.splice(c,1))}n=l}}}},function(e,t,n){(t=n(7)(!1)).push([e.i,"/* stylelint-disable no-descending-specificity */\r\n\r\n@keyframes spinner-line-fade-more {\r\n  0%, 100% {\r\n    opacity: 0; /* minimum opacity */\r\n  }\r\n  1% {\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n@keyframes spinner-line-fade-quick {\r\n  0%, 39%, 100% {\r\n    opacity: 0.25; /* minimum opacity */\r\n  }\r\n  40% {\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n@keyframes spinner-line-fade-default {\r\n  0%, 100% {\r\n    opacity: 0.22; /* minimum opacity */\r\n  }\r\n  1% {\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n@keyframes spinner-line-shrink {\r\n  0%, 25%, 100% {\r\n    /* minimum scale and opacity */\r\n    transform: scale(0.5);\r\n    opacity: 0.25;\r\n  }\r\n  26% {\r\n    transform: scale(1);\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n.miew-canvas > canvas {\r\n  display: block;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.miew-container,\r\n.miew-canvas {\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow: hidden;\r\n  position: relative;\r\n}\r\n\r\n.miew-message {\r\n  /* trick for centered error-reporting*/\r\n  background-color: #ccc;\r\n  display: table;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.miew-message p {\r\n    display: table-cell;\r\n    vertical-align: middle;\r\n    text-align: center;\r\n    font-size: large;\r\n  }\r\n\r\n.mode-message {\r\n  position: absolute;\r\n  top: 10px;\r\n  right: 10px;\r\n  border-radius: 4px;\r\n  color: silver;\r\n  background-color: rgba(64, 64, 64, 0.75);\r\n  display: flex;\r\n  align-items: left;\r\n  justify-content: left;\r\n  opacity: 0;\r\n}\r\n\r\n.atom-info {\r\n  margin: 10px;\r\n  text-align: left;\r\n}\r\n\r\n.overlay {\r\n  pointer-events: none;\r\n}\r\n\r\n/*////////////////////////////////////////////////////////////////////////////*/\r\n\r\n/* Full-page web application*/\r\n\r\n/*////////////////////////////////////////////////////////////////////////////*/\r\n\r\nhtml,\r\nbody {\r\n  height: 100%;\r\n  margin: 0;\r\n  background-color: #202020;\r\n}\r\n\r\n/*////////////////////////////////////////////////////////////////////////////*/\r\n\r\n/* ...*/\r\n\r\n/*////////////////////////////////////////////////////////////////////////////*/\r\n\r\n.mode-message {\r\n  top: 50px;\r\n  width: 200px;\r\n  height: 50px;\r\n  color: silver;\r\n  background-color: rgba(64, 64, 64, 0.75);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  opacity: 0;\r\n}\r\n\r\n.mode-message p {\r\n    margin: 0;\r\n    text-align: center;\r\n  }\r\n\r\n.miew-error {\r\n  position: absolute;\r\n  left: 0;\r\n  bottom: 0;\r\n  width: 100%;\r\n  max-height: 25%;\r\n  overflow: auto;\r\n  border-top: 2px solid #aaa;\r\n  background-color: #333;\r\n  padding-top: 10px;\r\n  font-weight: bold;\r\n}\r\n\r\n.miew-error p {\r\n    color: yellow;\r\n    margin: 0;\r\n  }\r\n\r\n.miew-error pre {\r\n    margin: 0;\r\n    border-radius: 0;\r\n    border: 0;\r\n    background-color: transparent;\r\n    color: #f55;\r\n  }\r\n\r\n.atom-info {\r\n  position: absolute;\r\n  top: 50px;\r\n  right: 10px;\r\n  border-radius: 4px;\r\n  color: silver;\r\n  background-color: rgba(64, 64, 64, 0.75);\r\n  display: flex;\r\n  justify-content: left;\r\n  opacity: 0;\r\n}\r\n\r\n.atom-info p {\r\n    margin: 10px;\r\n    text-align: left;\r\n  }\r\n\r\n/*////////////////////////////////////////////////////////////////////////////*/\r\n\r\n/* Menu*/\r\n\r\n/*////////////////////////////////////////////////////////////////////////////*/\r\n\r\n.dg.ac {\r\n  top: 40px !important;\r\n}\r\n\r\n.dg.a {\r\n  margin-right: 0 !important;\r\n}\r\n\r\n.dg input {\r\n  line-height: normal;\r\n}\r\n\r\n.blur {\r\n  filter: blur(10px);\r\n}\r\n\r\n#miew-menu .btn-titlebar,\r\n  #miew-menu .btn-titlebar:hover,\r\n  #miew-menu .btn-titlebar.hover,\r\n  #miew-menu .btn-titlebar:focus,\r\n  #miew-menu .btn-titlebar.active,\r\n  #miew-menu .btn-titlebar.active:hover,\r\n  #miew-menu .btn-titlebar.active.hover,\r\n  #miew-menu .btn-titlebar.active:focus {\r\n    background-color: transparent;\r\n    color: silver;\r\n    border: none;\r\n    border-radius: 0;\r\n    width: 40px;\r\n    height: 40px;\r\n    outline-color: rgba(64, 64, 64, 0.75);\r\n    /* font-size: larger;*/\r\n  }\r\n\r\n#miew-menu .btns-miew-titlebar-left {\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n  }\r\n\r\n#miew-menu .btns-miew-titlebar-right {\r\n    position: absolute;\r\n    right: 0;\r\n    top: 0;\r\n  }\r\n\r\n#miew-menu .titlebar {\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    padding: 10px;\r\n    width: 100%;\r\n    height: 40px;\r\n    text-align: center;\r\n    color: silver;\r\n    background-color: rgba(64, 64, 64, 0.75);\r\n  }\r\n\r\n#miew-menu .titlebar .tooltip-inner {\r\n      color: #383838;\r\n      background-color: #eee;\r\n    }\r\n\r\n#miew-menu .titlebar .tooltip-arrow {\r\n      display: none;\r\n    }\r\n\r\n#miew-menu [data-toolbar-type=miew-menu-toolbar-mode],\r\n  #miew-menu [data-toolbar-type=miew-menu-toolbar-colorer],\r\n  #miew-menu [data-toolbar-type=miew-menu-toolbar-resolution] {\r\n    position: absolute;\r\n    right: 0;\r\n    top: 40px;\r\n    width: 100%;\r\n    height: calc(100% - 40px);\r\n    background-color: transparent;\r\n    overflow: auto;\r\n  }\r\n\r\n#miew-menu [data-toolbar-type=miew-menu-toolbar-mode] .pseudo-row, #miew-menu [data-toolbar-type=miew-menu-toolbar-colorer] .pseudo-row, #miew-menu [data-toolbar-type=miew-menu-toolbar-resolution] .pseudo-row {\r\n      position: absolute;\r\n      right: 0;\r\n      display: flex;\r\n      flex-wrap: wrap;\r\n      flex-direction: column;\r\n      justify-content: flex-start;\r\n      padding: 0;\r\n      margin: 0;\r\n      max-width: 626px;\r\n      background-color: #eee;\r\n    }\r\n\r\n#miew-menu [data-toolbar-type=miew-menu-toolbar-mode] .pseudo-row .row, #miew-menu [data-toolbar-type=miew-menu-toolbar-colorer] .pseudo-row .row, #miew-menu [data-toolbar-type=miew-menu-toolbar-resolution] .pseudo-row .row {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        justify-content: flex-start;\r\n        padding: 0;\r\n        margin: 0;\r\n      }\r\n\r\n#miew-menu [data-toolbar-type=miew-menu-toolbar-mode] .pseudo-row .row .thumbnail, #miew-menu [data-toolbar-type=miew-menu-toolbar-colorer] .pseudo-row .row .thumbnail, #miew-menu [data-toolbar-type=miew-menu-toolbar-resolution] .pseudo-row .row .thumbnail {\r\n          background-color: #eee;\r\n          color: #ccc;\r\n          border: hidden;\r\n        }\r\n\r\n#miew-menu [data-toolbar-type=miew-menu-toolbar-mode] .pseudo-row .row .thumbnail img, #miew-menu [data-toolbar-type=miew-menu-toolbar-colorer] .pseudo-row .row .thumbnail img, #miew-menu [data-toolbar-type=miew-menu-toolbar-resolution] .pseudo-row .row .thumbnail img {\r\n            width: 96px;\r\n            height: 96px;\r\n          }\r\n\r\n#miew-menu [data-toolbar-type=miew-menu-toolbar-mode] .pseudo-row .row .thumbnail .caption, #miew-menu [data-toolbar-type=miew-menu-toolbar-colorer] .pseudo-row .row .thumbnail .caption, #miew-menu [data-toolbar-type=miew-menu-toolbar-resolution] .pseudo-row .row .thumbnail .caption {\r\n            padding: 0;\r\n            margin-top: 5px;\r\n          }\r\n\r\n#miew-menu [data-toolbar-type=miew-menu-toolbar-mode] .pseudo-row .row .thumbnail.active .caption, #miew-menu [data-toolbar-type=miew-menu-toolbar-colorer] .pseudo-row .row .thumbnail.active .caption, #miew-menu [data-toolbar-type=miew-menu-toolbar-resolution] .pseudo-row .row .thumbnail.active .caption {\r\n            color: #fff;\r\n            background-color: #337ab7;\r\n          }\r\n\r\n#miew-menu [data-toolbar-type=miew-menu-toolbar-mode] .pseudo-row .row h5, #miew-menu [data-toolbar-type=miew-menu-toolbar-colorer] .pseudo-row .row h5, #miew-menu [data-toolbar-type=miew-menu-toolbar-resolution] .pseudo-row .row h5 {\r\n          color: #333;\r\n          font-weight: 700;\r\n          margin-left: 5px;\r\n        }\r\n\r\n/* Nav links */\r\n\r\n#miew-menu .blog-nav-item {\r\n    position: relative;\r\n    display: inline;\r\n    padding: 10px;\r\n    font-weight: 500;\r\n  }\r\n\r\n#miew-menu .blog-nav .active::after {\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 50%;\r\n    width: 0;\r\n    height: 0;\r\n    margin-left: -5px;\r\n    vertical-align: middle;\r\n    content: \" \";\r\n    border-right: 5px solid transparent;\r\n    border-bottom: 5px solid;\r\n    border-left: 5px solid transparent;\r\n    color: #eee;\r\n  }\r\n\r\n#miew-menu .main-menu {\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    padding: 0;\r\n    background-color: rgba(64, 64, 64, 0.75);\r\n  }\r\n\r\n/* full-height menus*/\r\n\r\n#miew-menu .main-menu .row {\r\n      height: 100%;\r\n      max-width: 1024px;\r\n      display: flex;\r\n      flex-wrap: wrap;\r\n      margin-left: 0;\r\n      margin-right: auto;\r\n      padding: 0;\r\n    }\r\n\r\n#miew-menu .main-menu .row::before,\r\n    #miew-menu .main-menu .row::after {\r\n      display: none;\r\n    }\r\n\r\n#miew-menu .main-menu input[type=number]::-webkit-outer-spin-button,\r\n    #miew-menu .main-menu input[type=number]::-webkit-inner-spin-button {\r\n      -webkit-appearance: none;\r\n    }\r\n\r\n#miew-menu .main-menu input[type=number] {\r\n      -moz-appearance: textfield;\r\n    }\r\n\r\n#miew-menu .panel-menu {\r\n    padding: 0;\r\n    margin-bottom: 0;\r\n    /* border-color: #aaa;*/\r\n    /* border-radius: 0;*/\r\n    border: none;\r\n    background-color: #eee;\r\n    height: 100%;\r\n  }\r\n\r\n#miew-menu .panel-menu .panel-heading {\r\n      border-radius: 0;\r\n      border: none;\r\n      padding: 0;\r\n      height: 40px;\r\n      background-color: rgb(56, 56, 56);\r\n      color: silver;\r\n    }\r\n\r\n#miew-menu .panel-menu .panel-heading .panel-title {\r\n        padding: 11.5px;\r\n        font-weight: bold;\r\n        text-align: center;\r\n      }\r\n\r\n#miew-menu .panel-menu .panel-body {\r\n      height: calc(100% - 40px);\r\n      overflow: auto;\r\n    }\r\n\r\n#miew-menu .panel-menu .panel-body .miew-repr-list-controls {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        margin-bottom: 20px;\r\n      }\r\n\r\n#miew-menu .panel-menu .panel-body .miew-repr-list-controls .btn {\r\n          flex-grow: 2;\r\n        }\r\n\r\n#miew-menu .panel-menu .panel-body [data-toggle='preset-pdb'] {\r\n        padding-left: 5px;\r\n        padding-right: 5px;\r\n      }\r\n\r\n#miew-menu .panel-menu .list-group {\r\n      padding: 0;\r\n    }\r\n\r\n#miew-menu .panel-menu [data-toggle=selectcolor] {\r\n      padding-left: 5px;\r\n      padding-right: 5px;\r\n    }\r\n\r\n#miew-menu .panel-menu [data-toggle=selectcolor].active a {\r\n        border-width: 2px;\r\n        border-color: #337ab7;\r\n      }\r\n\r\n#miew-menu .panel-dark {\r\n    background-color: rgb(56, 56, 56);\r\n  }\r\n\r\n#miew-menu .panel-dark .list-group {\r\n      border: none;\r\n    }\r\n\r\n#miew-menu .panel-dark .list-group .list-group-item {\r\n        background-color: rgb(56, 56, 56);\r\n        color: silver;\r\n        border: none;\r\n      }\r\n\r\n#miew-menu .panel-dark .list-group .list-group-item.active {\r\n        background-color: #eee;\r\n        color: rgb(56, 56, 56);\r\n      }\r\n\r\n#miew-menu .miew-menu-panel-tooltips > .tooltip > .tooltip-inner {\r\n    color: rgb(56, 56, 56);\r\n    background-color: transparent;\r\n  }\r\n\r\n#miew-menu .miew-menu-panel-tooltips > .tooltip > .tooltip-arrow {\r\n    display: none;\r\n  }\r\n\r\n#miew-menu .panel-menu[data-panel-type=miew-menu-panel-select-color] .row {\r\n    align-content: flex-start;\r\n  }\r\n\r\n#miew-menu .panel-menu[data-panel-type=miew-menu-panel-selection] .row {\r\n      display: flex;\r\n      margin: 0;\r\n      height: 294px;\r\n    }\r\n\r\n#miew-menu .panel-menu[data-panel-type=miew-menu-panel-selection] .row .column {\r\n        padding: 0 2px;\r\n      }\r\n\r\n#miew-menu .panel-menu[data-panel-type=miew-menu-panel-selection] .row .column .nav-tabs li a {\r\n          padding-right: 7px;\r\n          padding-left: 7px;\r\n          margin: 0;\r\n          height: 42px;\r\n        }\r\n\r\n#miew-menu .panel-menu[data-panel-type=miew-menu-panel-selection] .row .column .list-group {\r\n          height: 294px;\r\n          overflow: auto;\r\n        }\r\n\r\n#miew-menu .panel-menu[data-panel-type=miew-menu-panel-selection] .row .column .list-group .list-group-item {\r\n            height: 42px;\r\n          }\r\n\r\n#miew-menu .panel-menu[data-panel-type=miew-menu-panel-selection] .row .calc {\r\n        margin-top: 42px;\r\n      }\r\n\r\n#miew-menu .panel-menu[data-panel-type=miew-menu-panel-selection] .row .calc .btn-calc {\r\n          height: 42px;\r\n          padding-left: 3px;\r\n          padding-right: 3px;\r\n          text-align: center;\r\n          vertical-align: middle;\r\n          background: linear-gradient(to top, #eee, #f9f9f9);\r\n        }\r\n\r\n#miew-menu .panel-menu[data-panel-type=miew-menu-panel-selection] .row .calc .btn-calc.digit {\r\n          background: linear-gradient(to top, #f1f1f1, #fff);\r\n        }\r\n\r\n#miew-menu .panel-menu[data-panel-type=miew-menu-panel-selection] .row .calc .btn-calc.char {\r\n          background: linear-gradient(to top, #f1f1f1, #fff);\r\n        }\r\n\r\n#miew-menu [data-modal-type=miew-menu-modal-rename-preset] input[type=text] {\r\n      border-width: 0;\r\n      width: 100%;\r\n    }\r\n\r\n#miew-menu [data-modal-type=miew-menu-modal-rename-preset] input[type=text]:focus {\r\n      outline: none;\r\n      border-width: 0;\r\n    }\r\n\r\n#miew-menu .miew-menu-btns-preset-edit .btn {\r\n    margin-left: 4px;\r\n    border: none;\r\n    color: #337ab7;\r\n  }\r\n\r\n#miew-menu .miew-repr-list .panel-heading {\r\n      background-color: #fff;\r\n      color: #333;\r\n      height: 40px;\r\n    }\r\n\r\n#miew-menu .miew-repr-list .panel-heading .panel-title {\r\n        text-align: left;\r\n        display: flex;\r\n        flex-wrap: nowrap;\r\n      }\r\n\r\n#miew-menu .miew-repr-list .panel-heading .panel-title a {\r\n          white-space: pre-wrap;\r\n          overflow: hidden;\r\n          max-height: 20px;\r\n        }\r\n\r\n#miew-menu .miew-repr-list .panel-heading .panel-title .pseudo-div {\r\n          flex-grow: 5;\r\n          margin-left: 5px;\r\n        }\r\n\r\n#miew-menu .miew-repr-list .panel-heading .panel-title .pseudo-div .badge {\r\n            background-color: #333;\r\n            color: #fff;\r\n          }\r\n\r\n#miew-menu .miew-repr-list .panel-heading .btn {\r\n        padding: 0;\r\n        margin-right: 10px;\r\n        height: 20px;\r\n        width: 20px;\r\n        border: 0;\r\n      }\r\n\r\n#miew-menu .miew-repr-list .panel-heading.active {\r\n      background-color: #337ab7;\r\n      color: #fff;\r\n    }\r\n\r\n#miew-menu .miew-repr-list .panel-heading.active .pseudo-div .badge {\r\n        background-color: #fff;\r\n        color: #337ab7;\r\n      }\r\n\r\n#miew-menu .miew-repr-list .panel-heading.active .btn {\r\n        background-color: #337ab7;\r\n        color: #fff;\r\n      }\r\n\r\n#miew-menu .miew-repr-list .spinner-inc-btn,\r\n    #miew-menu .miew-repr-list .spinner-dec-btn {\r\n      width: auto;\r\n      height: auto;\r\n      padding: 1px 2px;\r\n    }\r\n\r\n#miew-menu .miew-repr-list input[type=number] {\r\n      width: 32px;\r\n      height: auto;\r\n      padding: 1px 2px;\r\n      text-align: center;\r\n    }\r\n\r\n#miew-menu .miew-repr-list .list-group-item {\r\n      border-width: 1px;\r\n      max-height: 40px;\r\n    }\r\n\r\n#miew-menu .miew-repr-list .list-group-item .thumbnail {\r\n        width: 21px;\r\n        height: 21px;\r\n        margin: 0;\r\n        padding: 0;\r\n      }\r\n\r\n#miew-menu .miew-repr-list [data-value=miew-menu-panel-select-color] span.pull-right {\r\n        display: flex;\r\n      }\r\n\r\n#miew-menu .miew-repr-list [data-value=miew-menu-panel-selection] {\r\n      display: flex;\r\n      flex-wrap: nowrap;\r\n      justify-content: space-between;\r\n    }\r\n\r\n#miew-menu .miew-repr-list [data-value=miew-menu-panel-selection] span.pull-right {\r\n        margin-left: 15px;\r\n        display: flex;\r\n        flex-wrap: nowrap;\r\n        justify-content: flex-end;\r\n      }\r\n\r\n#miew-menu .miew-repr-list [data-value=miew-menu-panel-selection] span.pull-right [data-type=selection-target] {\r\n          text-align: right;\r\n          white-space: pre-wrap;\r\n          overflow: hidden;\r\n          max-height: 20px;\r\n        }\r\n\r\n#miew-menu [data-form-type=miew-menu-form-load-pdb] {\r\n    overflow: hidden;\r\n  }\r\n\r\n#miew-menu [data-form-type=miew-menu-form-load-pdb] input[type=file] {\r\n      position: absolute;\r\n      top: 0;\r\n      right: 0;\r\n      min-width: 100%;\r\n      min-height: 100%;\r\n      font-size: 100px;\r\n      text-align: right;\r\n      filter: alpha(opacity=0);\r\n      opacity: 0;\r\n      outline: none;\r\n      background: white;\r\n      cursor: inherit;\r\n      display: block;\r\n    }\r\n\r\n#miew-menu .list-group-item label {\r\n    font-weight: normal;\r\n    margin-bottom: 0;\r\n  }\r\n\r\n#miew-menu .checkbox-background .bootstrap-switch .bootstrap-switch-handle-on.bootstrap-switch-primary {\r\n      color: #eee;\r\n      background-color: #383838;\r\n    }\r\n\r\n#miew-menu .checkbox-background .bootstrap-switch .bootstrap-switch-handle-off.bootstrap-switch-default {\r\n      color: #383838;\r\n      background-color: #eee;\r\n    }\r\n\r\n#miew-menu .modal-body {\r\n    overflow: auto;\r\n  }\r\n\r\n.miew-terminal {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  bottom: 0;\r\n  width: 30%;\r\n  padding: 0;\r\n  margin-top: 40px;\r\n\r\n  --background: transparent;\r\n}\r\n\r\n.miew-terminal .row {\r\n    margin-left: 0;\r\n    margin-right: 0;\r\n  }\r\n\r\n.miew-terminal-body {\r\n  display: block;\r\n  height: 100%;\r\n  border: 1px solid #444;\r\n  background: rgba(0, 0, 0, 0.75);\r\n}\r\n\r\n.miew-configured-pdb-list-action,\r\n.miew-configured-pdb-list-item-action {\r\n  color: #337ab7;\r\n  cursor: pointer;\r\n}\r\n\r\n.miew-configured-pdb-list-item-action {\r\n  margin-left: 10px;\r\n}\r\n\r\n.active .miew-configured-pdb-list-item-action {\r\n  color: white;\r\n}\r\n\r\n@keyframes rotating {\r\n  from {\r\n    transform: rotate(0deg);\r\n  }\r\n\r\n  to {\r\n    transform: rotate(360deg);\r\n  }\r\n}\r\n\r\n.rotating {\r\n  animation: rotating 2s linear infinite;\r\n}\r\n\r\n.toast-error {\r\n  background-color: #b22746;\r\n}\r\n\r\n.toast-warning {\r\n  background-color: #f8aa02;\r\n}\r\n\r\n.toast-info {\r\n  background-color: #39c2d7;\r\n}\r\n\r\n.toast-top-right {\r\n  top: 46px;\r\n  right: 6px;\r\n}\r\n\r\n#toast-container > div {\r\n  opacity: 0.9;\r\n  box-shadow: none;\r\n  -webkit-box-shadow: none;\r\n  -moz-box-shadow: none;\r\n  font-weight: bold;\r\n}\r\n\r\n.toolbar-thumb {\r\n  width: 96px;\r\n  height: 96px;\r\n  box-shadow: inset 0 0 0 4px rgba(0, 0, 0, 0.75);\r\n}\r\n",""]),e.exports=t},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n,r,i,o=e[1]||"",a=e[3];if(!a)return o;if(t&&"function"==typeof btoa){var s=(n=a,r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),"/*# ".concat(i," */")),l=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[o].concat(l).concat([s]).join("\n")}return[o].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(r)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(i[a]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);r&&i[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},function(e,t,r){"use strict";
/** @license React v16.13.0
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i=r(1),o="function"==typeof Symbol&&Symbol.for,a=o?Symbol.for("react.element"):60103,s=o?Symbol.for("react.portal"):60106,l=o?Symbol.for("react.fragment"):60107,u=o?Symbol.for("react.strict_mode"):60108,c=o?Symbol.for("react.profiler"):60114,h=o?Symbol.for("react.provider"):60109,d=o?Symbol.for("react.context"):60110,f=o?Symbol.for("react.forward_ref"):60112,p=o?Symbol.for("react.suspense"):60113,m=o?Symbol.for("react.memo"):60115,v=o?Symbol.for("react.lazy"):60116,g="function"==typeof Symbol&&Symbol.iterator;function y(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x={};function b(e,t,n){this.props=e,this.context=t,this.refs=x,this.updater=n||_}function w(){}function S(e,t,n){this.props=e,this.context=t,this.refs=x,this.updater=n||_}b.prototype.isReactComponent={},b.prototype.setState=function(e,t){if("object"!=n(e)&&"function"!=typeof e&&null!=e)throw Error(y(85));this.updater.enqueueSetState(this,e,t,"setState")},b.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},w.prototype=b.prototype;var E=S.prototype=new w;E.constructor=S,i(E,b.prototype),E.isPureReactComponent=!0;var T={current:null},M=Object.prototype.hasOwnProperty,C={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,n){var r,i={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)M.call(t,r)&&!C.hasOwnProperty(r)&&(i[r]=t[r]);var l=arguments.length-2;if(1===l)i.children=n;else if(1<l){for(var u=Array(l),c=0;c<l;c++)u[c]=arguments[c+2];i.children=u}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===i[r]&&(i[r]=l[r]);return{$$typeof:a,type:e,key:o,ref:s,props:i,_owner:T.current}}function R(e){return"object"==n(e)&&null!==e&&e.$$typeof===a}var P=/\/+/g,k=[];function L(e,t,n,r){if(k.length){var i=k.pop();return i.result=e,i.keyPrefix=t,i.func=n,i.context=r,i.count=0,i}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function N(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>k.length&&k.push(e)}function I(e,t,r){return null==e?0:function e(t,r,i,o){var l=n(t);"undefined"!==l&&"boolean"!==l||(t=null);var u=!1;if(null===t)u=!0;else switch(l){case"string":case"number":u=!0;break;case"object":switch(t.$$typeof){case a:case s:u=!0}}if(u)return i(o,t,""===r?"."+O(t,0):r),1;if(u=0,r=""===r?".":r+":",Array.isArray(t))for(var c=0;c<t.length;c++){var h=r+O(l=t[c],c);u+=e(l,h,i,o)}else if("function"==typeof(h=null===t||"object"!=n(t)?null:"function"==typeof(h=g&&t[g]||t["@@iterator"])?h:null))for(t=h.call(t),c=0;!(l=t.next()).done;)u+=e(l=l.value,h=r+O(l,c++),i,o);else if("object"===l)throw i=""+t,Error(y(31,"[object Object]"===i?"object with keys {"+Object.keys(t).join(", ")+"}":i,""));return u}(e,"",t,r)}function O(e,t){return"object"==n(e)&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function D(e,t){e.func.call(e.context,t,e.count++)}function z(e,t,n){var r=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?F(e,r,n,(function(e){return e})):null!=e&&(R(e)&&(e=function(e,t){return{$$typeof:a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,i+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(P,"$&/")+"/")+n)),r.push(e))}function F(e,t,n,r,i){var o="";null!=n&&(o=(""+n).replace(P,"$&/")+"/"),I(e,z,t=L(t,o,r,i)),N(t)}var B={current:null};function U(){var e=B.current;if(null===e)throw Error(y(321));return e}var V={ReactCurrentDispatcher:B,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:T,IsSomeRendererActing:{current:!1},assign:i};t.Children={map:function(e,t,n){if(null==e)return e;var r=[];return F(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;I(e,D,t=L(null,null,t,n)),N(t)},count:function(e){return I(e,(function(){return null}),null)},toArray:function(e){var t=[];return F(e,t,null,(function(e){return e})),t},only:function(e){if(!R(e))throw Error(y(143));return e}},t.Component=b,t.Fragment=l,t.Profiler=c,t.PureComponent=S,t.StrictMode=u,t.Suspense=p,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,t.cloneElement=function(e,t,n){if(null==e)throw Error(y(267,e));var r=i({},e.props),o=e.key,s=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,l=T.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)M.call(t,c)&&!C.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=n;else if(1<c){u=Array(c);for(var h=0;h<c;h++)u[h]=arguments[h+2];r.children=u}return{$$typeof:a,type:e.type,key:o,ref:s,props:r,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:d,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:h,_context:e},e.Consumer=e},t.createElement=A,t.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:f,render:e}},t.isValidElement=R,t.lazy=function(e){return{$$typeof:v,_ctor:e,_status:-1,_result:null}},t.memo=function(e,t){return{$$typeof:m,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return U().useCallback(e,t)},t.useContext=function(e,t){return U().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return U().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return U().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return U().useLayoutEffect(e,t)},t.useMemo=function(e,t){return U().useMemo(e,t)},t.useReducer=function(e,t,n){return U().useReducer(e,t,n)},t.useRef=function(e){return U().useRef(e)},t.useState=function(e){return U().useState(e)},t.version="16.13.0"},function(e,t,r){"use strict";
/** @license React v16.13.0
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i=r(0),o=r(1),a=r(10);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!i)throw Error(s(227));function l(e,t,n,r,i,o,a,s,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(e){this.onError(e)}}var u=!1,c=null,h=!1,d=null,f={onError:function(e){u=!0,c=e}};function p(e,t,n,r,i,o,a,s,h){u=!1,c=null,l.apply(f,arguments)}var m=null,v=null,g=null;function y(e,t,n){var r=e.type||"unknown-event";e.currentTarget=g(n),function(e,t,n,r,i,o,a,l,f){if(p.apply(this,arguments),u){if(!u)throw Error(s(198));var m=c;u=!1,c=null,h||(h=!0,d=m)}}(r,t,void 0,e),e.currentTarget=null}var _=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;_.hasOwnProperty("ReactCurrentDispatcher")||(_.ReactCurrentDispatcher={current:null}),_.hasOwnProperty("ReactCurrentBatchConfig")||(_.ReactCurrentBatchConfig={suspense:null});var x=/^(.*)[\\\/]/,b="function"==typeof Symbol&&Symbol.for,w=b?Symbol.for("react.element"):60103,S=b?Symbol.for("react.portal"):60106,E=b?Symbol.for("react.fragment"):60107,T=b?Symbol.for("react.strict_mode"):60108,M=b?Symbol.for("react.profiler"):60114,C=b?Symbol.for("react.provider"):60109,A=b?Symbol.for("react.context"):60110,R=b?Symbol.for("react.concurrent_mode"):60111,P=b?Symbol.for("react.forward_ref"):60112,k=b?Symbol.for("react.suspense"):60113,L=b?Symbol.for("react.suspense_list"):60120,N=b?Symbol.for("react.memo"):60115,I=b?Symbol.for("react.lazy"):60116,O=b?Symbol.for("react.block"):60121,D="function"==typeof Symbol&&Symbol.iterator;function z(e){return null===e||"object"!=n(e)?null:"function"==typeof(e=D&&e[D]||e["@@iterator"])?e:null}function F(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case E:return"Fragment";case S:return"Portal";case M:return"Profiler";case T:return"StrictMode";case k:return"Suspense";case L:return"SuspenseList"}if("object"==n(e))switch(e.$$typeof){case A:return"Context.Consumer";case C:return"Context.Provider";case P:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case N:return F(e.type);case O:return F(e.render);case I:if(e=1===e._status?e._result:null)return F(e)}return null}function B(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var r=e._debugOwner,i=e._debugSource,o=F(e.type);n=null,r&&(n=F(r.type)),r=o,o="",i?o=" (at "+i.fileName.replace(x,"")+":"+i.lineNumber+")":n&&(o=" (created by "+n+")"),n="\n    in "+(r||"Unknown")+o}t+=n,e=e.return}while(e);return t}var U=null,V={};function G(){if(U)for(var e in V){var t=V[e],n=U.indexOf(e);if(!(-1<n))throw Error(s(96,e));if(!H[n]){if(!t.extractEvents)throw Error(s(97,e));for(var r in H[n]=t,n=t.eventTypes){var i=void 0,o=n[r],a=t,l=r;if(W.hasOwnProperty(l))throw Error(s(99,l));W[l]=o;var u=o.phasedRegistrationNames;if(u){for(i in u)u.hasOwnProperty(i)&&j(u[i],a,l);i=!0}else o.registrationName?(j(o.registrationName,a,l),i=!0):i=!1;if(!i)throw Error(s(98,r,e))}}}}function j(e,t,n){if(q[e])throw Error(s(100,e));q[e]=t,Y[e]=t.eventTypes[n].dependencies}var H=[],W={},q={},Y={};function X(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];if(!V.hasOwnProperty(t)||V[t]!==r){if(V[t])throw Error(s(102,t));V[t]=r,n=!0}}n&&G()}var Z=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),$=null,K=null,J=null;function Q(e){if(e=v(e)){if("function"!=typeof $)throw Error(s(280));var t=e.stateNode;t&&(t=m(t),$(e.stateNode,e.type,t))}}function ee(e){K?J?J.push(e):J=[e]:K=e}function te(){if(K){var e=K,t=J;if(J=K=null,Q(e),t)for(e=0;e<t.length;e++)Q(t[e])}}function ne(e,t){return e(t)}function re(e,t,n,r,i){return e(t,n,r,i)}function ie(){}var oe=ne,ae=!1,se=!1;function le(){null===K&&null===J||(ie(),te())}function ue(e,t,n){if(se)return e(t,n);se=!0;try{return oe(e,t,n)}finally{se=!1,le()}}var ce=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,he=Object.prototype.hasOwnProperty,de={},fe={};function pe(e,t,n,r,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o}var me={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){me[e]=new pe(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];me[t]=new pe(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){me[e]=new pe(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){me[e]=new pe(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){me[e]=new pe(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){me[e]=new pe(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){me[e]=new pe(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){me[e]=new pe(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){me[e]=new pe(e,5,!1,e.toLowerCase(),null,!1)}));var ve=/[\-:]([a-z])/g;function ge(e){return e[1].toUpperCase()}function ye(e,t,r,i){var o=me.hasOwnProperty(t)?me[t]:null;(null!==o?0===o.type:!i&&2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1]))||(function(e,t,r,i){if(null==t||function(e,t,r,i){if(null!==r&&0===r.type)return!1;switch(n(t)){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==r?!r.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,r,i))return!0;if(i)return!1;if(null!==r)switch(r.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,r,o,i)&&(r=null),i||null===o?function(e){return!!he.call(fe,e)||!he.call(de,e)&&(ce.test(e)?fe[e]=!0:(de[e]=!0,!1))}(t)&&(null===r?e.removeAttribute(t):e.setAttribute(t,""+r)):o.mustUseProperty?e[o.propertyName]=null===r?3!==o.type&&"":r:(t=o.attributeName,i=o.attributeNamespace,null===r?e.removeAttribute(t):(r=3===(o=o.type)||4===o&&!0===r?"":""+r,i?e.setAttributeNS(i,t,r):e.setAttribute(t,r))))}function _e(e){switch(n(e)){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function xe(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function be(e){e._valueTracker||(e._valueTracker=function(e){var t=xe(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function we(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=xe(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Se(e,t){var n=t.checked;return o({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=_e(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Te(e,t){null!=(t=t.checked)&&ye(e,"checked",t,!1)}function Me(e,t){Te(e,t);var n=_e(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?Ae(e,t.type,n):t.hasOwnProperty("defaultValue")&&Ae(e,t.type,_e(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Ce(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Ae(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function Re(e,t){return e=o({children:void 0},t),(t=function(e){var t="";return i.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function Pe(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+_e(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function ke(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return o({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Le(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:_e(n)}}function Ne(e,t){var n=_e(t.value),r=_e(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function Ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(ve,ge);me[t]=new pe(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(ve,ge);me[t]=new pe(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(ve,ge);me[t]=new pe(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){me[e]=new pe(e,1,!1,e.toLowerCase(),null,!1)})),me.xlinkHref=new pe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){me[e]=new pe(e,1,!1,e.toLowerCase(),null,!0)}));function Oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function De(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ze,Fe=function(e){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction((function(){return e(t,n)}))}:e}((function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ze=ze||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ze.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}}));function Be(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function Ue(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ve={animationend:Ue("Animation","AnimationEnd"),animationiteration:Ue("Animation","AnimationIteration"),animationstart:Ue("Animation","AnimationStart"),transitionend:Ue("Transition","TransitionEnd")},Ge={},je={};function He(e){if(Ge[e])return Ge[e];if(!Ve[e])return e;var t,n=Ve[e];for(t in n)if(n.hasOwnProperty(t)&&t in je)return Ge[e]=n[t];return e}Z&&(je=document.createElement("div").style,"AnimationEvent"in window||(delete Ve.animationend.animation,delete Ve.animationiteration.animation,delete Ve.animationstart.animation),"TransitionEvent"in window||delete Ve.transitionend.transition);var We=He("animationend"),qe=He("animationiteration"),Ye=He("animationstart"),Xe=He("transitionend"),Ze="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$e=new("function"==typeof WeakMap?WeakMap:Map);function Ke(e){var t=$e.get(e);return void 0===t&&(t=new Map,$e.set(e,t)),t}function Je(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).effectTag)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function et(e){if(Je(e)!==e)throw Error(s(188))}function tt(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=Je(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return et(i),e;if(o===r)return et(i),t;o=o.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=o;else{for(var a=!1,l=i.child;l;){if(l===n){a=!0,n=i,r=o;break}if(l===r){a=!0,r=i,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,r=i;break}if(l===r){a=!0,r=o,n=i;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function nt(e,t){if(null==t)throw Error(s(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function rt(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var it=null;function ot(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)y(e,t[r],n[r]);else t&&y(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function at(e){if(null!==e&&(it=nt(it,e)),e=it,it=null,e){if(rt(e,ot),it)throw Error(s(95));if(h)throw e=d,h=!1,d=null,e}}function st(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function lt(e){if(!Z)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t}var ut=[];function ct(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>ut.length&&ut.push(e)}function ht(e,t,n,r){if(ut.length){var i=ut.pop();return i.topLevelType=e,i.eventSystemFlags=r,i.nativeEvent=t,i.targetInst=n,i}return{topLevelType:e,eventSystemFlags:r,nativeEvent:t,targetInst:n,ancestors:[]}}function dt(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r=n;if(3===r.tag)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=3!==r.tag?null:r.stateNode.containerInfo}if(!r)break;5!==(t=n.tag)&&6!==t||e.ancestors.push(n),n=Mn(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var i=st(e.nativeEvent);r=e.topLevelType;var o=e.nativeEvent,a=e.eventSystemFlags;0===n&&(a|=64);for(var s=null,l=0;l<H.length;l++){var u=H[l];u&&(u=u.extractEvents(r,t,o,i,a))&&(s=nt(s,u))}at(s)}}function ft(e,t,n){if(!n.has(e)){switch(e){case"scroll":Yt(t,"scroll",!0);break;case"focus":case"blur":Yt(t,"focus",!0),Yt(t,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":lt(e)&&Yt(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===Ze.indexOf(e)&&qt(e,t)}n.set(e,null)}}var pt,mt,vt,gt=!1,yt=[],_t=null,xt=null,bt=null,wt=new Map,St=new Map,Et=[],Tt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Mt="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Ct(e,t,n,r,i){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|n,nativeEvent:i,container:r}}function At(e,t){switch(e){case"focus":case"blur":_t=null;break;case"dragenter":case"dragleave":xt=null;break;case"mouseover":case"mouseout":bt=null;break;case"pointerover":case"pointerout":wt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":St.delete(t.pointerId)}}function Rt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e=Ct(t,n,r,i,o),null!==t&&null!==(t=Cn(t))&&mt(t),e):(e.eventSystemFlags|=r,e)}function Pt(e){var t=Mn(e.target);if(null!==t){var n=Je(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Qe(n)))return e.blockedOn=t,void a.unstable_runWithPriority(e.priority,(function(){vt(n)}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function kt(e){if(null!==e.blockedOn)return!1;var t=Kt(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(null!==t){var n=Cn(t);return null!==n&&mt(n),e.blockedOn=t,!1}return!0}function Lt(e,t,n){kt(e)&&n.delete(t)}function Nt(){for(gt=!1;0<yt.length;){var e=yt[0];if(null!==e.blockedOn){null!==(e=Cn(e.blockedOn))&&pt(e);break}var t=Kt(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);null!==t?e.blockedOn=t:yt.shift()}null!==_t&&kt(_t)&&(_t=null),null!==xt&&kt(xt)&&(xt=null),null!==bt&&kt(bt)&&(bt=null),wt.forEach(Lt),St.forEach(Lt)}function It(e,t){e.blockedOn===t&&(e.blockedOn=null,gt||(gt=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Nt)))}function Ot(e){function t(t){return It(t,e)}if(0<yt.length){It(yt[0],e);for(var n=1;n<yt.length;n++){var r=yt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==_t&&It(_t,e),null!==xt&&It(xt,e),null!==bt&&It(bt,e),wt.forEach(t),St.forEach(t),n=0;n<Et.length;n++)(r=Et[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Et.length&&null===(n=Et[0]).blockedOn;)Pt(n),null===n.blockedOn&&Et.shift()}var Dt={},zt=new Map,Ft=new Map,Bt=["abort","abort",We,"animationEnd",qe,"animationIteration",Ye,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Xe,"transitionEnd","waiting","waiting"];function Ut(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1],o="on"+(i[0].toUpperCase()+i.slice(1));o={phasedRegistrationNames:{bubbled:o,captured:o+"Capture"},dependencies:[r],eventPriority:t},Ft.set(r,t),zt.set(r,o),Dt[i]=o}}Ut("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Ut("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Ut(Bt,2);for(var Vt="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Gt=0;Gt<Vt.length;Gt++)Ft.set(Vt[Gt],0);var jt=a.unstable_UserBlockingPriority,Ht=a.unstable_runWithPriority,Wt=!0;function qt(e,t){Yt(t,e,!1)}function Yt(e,t,n){var r=Ft.get(t);switch(void 0===r?2:r){case 0:r=Xt.bind(null,t,1,e);break;case 1:r=Zt.bind(null,t,1,e);break;default:r=$t.bind(null,t,1,e)}n?e.addEventListener(t,r,!0):e.addEventListener(t,r,!1)}function Xt(e,t,n,r){ae||ie();var i=$t,o=ae;ae=!0;try{re(i,e,t,n,r)}finally{(ae=o)||le()}}function Zt(e,t,n,r){Ht(jt,$t.bind(null,e,t,n,r))}function $t(e,t,n,r){if(Wt)if(0<yt.length&&-1<Tt.indexOf(e))e=Ct(null,e,t,n,r),yt.push(e);else{var i=Kt(e,t,n,r);if(null===i)At(e,r);else if(-1<Tt.indexOf(e))e=Ct(i,e,t,n,r),yt.push(e);else if(!function(e,t,n,r,i){switch(t){case"focus":return _t=Rt(_t,e,t,n,r,i),!0;case"dragenter":return xt=Rt(xt,e,t,n,r,i),!0;case"mouseover":return bt=Rt(bt,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return wt.set(o,Rt(wt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,St.set(o,Rt(St.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r)){At(e,r),e=ht(e,r,null,t);try{ue(dt,e)}finally{ct(e)}}}}function Kt(e,t,n,r){if(null!==(n=Mn(n=st(r)))){var i=Je(n);if(null===i)n=null;else{var o=i.tag;if(13===o){if(null!==(n=Qe(i)))return n;n=null}else if(3===o){if(i.stateNode.hydrate)return 3===i.tag?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null)}}e=ht(e,r,n,t);try{ue(dt,e)}finally{ct(e)}return null}var Jt={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Qt=["Webkit","ms","Moz","O"];function en(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||Jt.hasOwnProperty(e)&&Jt[e]?(""+t).trim():t+"px"}function tn(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=en(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(Jt).forEach((function(e){Qt.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Jt[t]=Jt[e]}))}));var nn=o({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function rn(e,t){if(t){if(nn[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if(!("object"==n(t.dangerouslySetInnerHTML)&&"__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!=n(t.style))throw Error(s(62,""))}}function on(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var an="http://www.w3.org/1999/xhtml";function sn(e,t){var n=Ke(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=Y[t];for(var r=0;r<t.length;r++)ft(t[r],e,n)}function ln(){}function un(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function cn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hn(e,t){var n,r=cn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cn(r)}}function dn(){for(var e=window,t=un();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=un((e=t.contentWindow).document)}return t}function fn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var pn=null,mn=null;function vn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function gn(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==n(t.dangerouslySetInnerHTML)&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var yn="function"==typeof setTimeout?setTimeout:void 0,_n="function"==typeof clearTimeout?clearTimeout:void 0;function xn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function bn(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var wn=Math.random().toString(36).slice(2),Sn="__reactInternalInstance$"+wn,En="__reactEventHandlers$"+wn,Tn="__reactContainere$"+wn;function Mn(e){var t=e[Sn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Tn]||n[Sn]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=bn(e);null!==e;){if(n=e[Sn])return n;e=bn(e)}return t}n=(e=n).parentNode}return null}function Cn(e){return!(e=e[Sn]||e[Tn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function An(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function Rn(e){return e[En]||null}function Pn(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function kn(e,t){var r=e.stateNode;if(!r)return null;var i=m(r);if(!i)return null;r=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(r&&"function"!=typeof r)throw Error(s(231,t,n(r)));return r}function Ln(e,t,n){(t=kn(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=nt(n._dispatchListeners,t),n._dispatchInstances=nt(n._dispatchInstances,e))}function Nn(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=Pn(t);for(t=n.length;0<t--;)Ln(n[t],"captured",e);for(t=0;t<n.length;t++)Ln(n[t],"bubbled",e)}}function In(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=kn(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=nt(n._dispatchListeners,t),n._dispatchInstances=nt(n._dispatchInstances,e))}function On(e){e&&e.dispatchConfig.registrationName&&In(e._targetInst,null,e)}function Dn(e){rt(e,Nn)}var zn=null,Fn=null,Bn=null;function Un(){if(Bn)return Bn;var e,t,n=Fn,r=n.length,i="value"in zn?zn.value:zn.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[o-t];t++);return Bn=i.slice(e,1<t?1-t:void 0)}function Vn(){return!0}function Gn(){return!1}function jn(e,t,n,r){for(var i in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(i)&&((t=e[i])?this[i]=t(n):"target"===i?this.target=r:this[i]=n[i]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?Vn:Gn,this.isPropagationStopped=Gn,this}function Hn(e,t,n,r){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,e,t,n,r),i}return new this(e,t,n,r)}function Wn(e){if(!(e instanceof this))throw Error(s(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function qn(e){e.eventPool=[],e.getPooled=Hn,e.release=Wn}o(jn.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Vn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Vn)},persist:function(){this.isPersistent=Vn},isPersistent:Gn,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Gn,this._dispatchInstances=this._dispatchListeners=null}}),jn.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},jn.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var i=new t;return o(i,n.prototype),n.prototype=i,n.prototype.constructor=n,n.Interface=o({},r.Interface,e),n.extend=r.extend,qn(n),n},qn(jn);var Yn=jn.extend({data:null}),Xn=jn.extend({data:null}),Zn=[9,13,27,32],$n=Z&&"CompositionEvent"in window,Kn=null;Z&&"documentMode"in document&&(Kn=document.documentMode);var Jn=Z&&"TextEvent"in window&&!Kn,Qn=Z&&(!$n||Kn&&8<Kn&&11>=Kn),er=String.fromCharCode(32),tr={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},nr=!1;function rr(e,t){switch(e){case"keyup":return-1!==Zn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function ir(e){return"object"==n(e=e.detail)&&"data"in e?e.data:null}var or=!1,ar={eventTypes:tr,extractEvents:function(e,t,n,r){var i;if($n)e:{switch(e){case"compositionstart":var o=tr.compositionStart;break e;case"compositionend":o=tr.compositionEnd;break e;case"compositionupdate":o=tr.compositionUpdate;break e}o=void 0}else or?rr(e,n)&&(o=tr.compositionEnd):"keydown"===e&&229===n.keyCode&&(o=tr.compositionStart);return o?(Qn&&"ko"!==n.locale&&(or||o!==tr.compositionStart?o===tr.compositionEnd&&or&&(i=Un()):(Fn="value"in(zn=r)?zn.value:zn.textContent,or=!0)),o=Yn.getPooled(o,t,n,r),(i||null!==(i=ir(n)))&&(o.data=i),Dn(o),i=o):i=null,(e=Jn?function(e,t){switch(e){case"compositionend":return ir(t);case"keypress":return 32!==t.which?null:(nr=!0,er);case"textInput":return(e=t.data)===er&&nr?null:e;default:return null}}(e,n):function(e,t){if(or)return"compositionend"===e||!$n&&rr(e,t)?(e=Un(),Bn=Fn=zn=null,or=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Qn&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))?((t=Xn.getPooled(tr.beforeInput,t,n,r)).data=e,Dn(t)):t=null,null===i?t:null===t?i:[i,t]}},sr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function lr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!sr[e.type]:"textarea"===t}var ur={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function cr(e,t,n){return(e=jn.getPooled(ur.change,e,t,n)).type="change",ee(n),Dn(e),e}var hr=null,dr=null;function fr(e){at(e)}function pr(e){if(we(An(e)))return e}function mr(e,t){if("change"===e)return t}var vr=!1;function gr(){hr&&(hr.detachEvent("onpropertychange",yr),dr=hr=null)}function yr(e){if("value"===e.propertyName&&pr(dr))if(e=cr(dr,e,st(e)),ae)at(e);else{ae=!0;try{ne(fr,e)}finally{ae=!1,le()}}}function _r(e,t,n){"focus"===e?(gr(),dr=n,(hr=t).attachEvent("onpropertychange",yr)):"blur"===e&&gr()}function xr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return pr(dr)}function br(e,t){if("click"===e)return pr(t)}function wr(e,t){if("input"===e||"change"===e)return pr(t)}Z&&(vr=lt("input")&&(!document.documentMode||9<document.documentMode));var Sr={eventTypes:ur,_isInputEventSupported:vr,extractEvents:function(e,t,n,r){var i=t?An(t):window,o=i.nodeName&&i.nodeName.toLowerCase();if("select"===o||"input"===o&&"file"===i.type)var a=mr;else if(lr(i))if(vr)a=wr;else{a=xr;var s=_r}else(o=i.nodeName)&&"input"===o.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(a=br);if(a&&(a=a(e,t)))return cr(a,n,r);s&&s(e,i,t),"blur"===e&&(e=i._wrapperState)&&e.controlled&&"number"===i.type&&Ae(i,"number",i.value)}},Er=jn.extend({view:null,detail:null}),Tr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mr(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tr[e])&&!!t[e]}function Cr(){return Mr}var Ar=0,Rr=0,Pr=!1,kr=!1,Lr=Er.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Cr,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Ar;return Ar=e.screenX,Pr?"mousemove"===e.type?e.screenX-t:0:(Pr=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Rr;return Rr=e.screenY,kr?"mousemove"===e.type?e.screenY-t:0:(kr=!0,0)}}),Nr=Lr.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Ir={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Or={eventTypes:Ir,extractEvents:function(e,t,n,r,i){var o="mouseover"===e||"pointerover"===e,a="mouseout"===e||"pointerout"===e;if(o&&0==(32&i)&&(n.relatedTarget||n.fromElement)||!a&&!o)return null;if(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,a?(a=t,null!==(t=(t=n.relatedTarget||n.toElement)?Mn(t):null)&&(t!==Je(t)||5!==t.tag&&6!==t.tag)&&(t=null)):a=null,a===t)return null;if("mouseout"===e||"mouseover"===e)var s=Lr,l=Ir.mouseLeave,u=Ir.mouseEnter,c="mouse";else"pointerout"!==e&&"pointerover"!==e||(s=Nr,l=Ir.pointerLeave,u=Ir.pointerEnter,c="pointer");if(e=null==a?o:An(a),o=null==t?o:An(t),(l=s.getPooled(l,a,n,r)).type=c+"leave",l.target=e,l.relatedTarget=o,(n=s.getPooled(u,t,n,r)).type=c+"enter",n.target=o,n.relatedTarget=e,c=t,(r=a)&&c)e:{for(u=c,a=0,e=s=r;e;e=Pn(e))a++;for(e=0,t=u;t;t=Pn(t))e++;for(;0<a-e;)s=Pn(s),a--;for(;0<e-a;)u=Pn(u),e--;for(;a--;){if(s===u||s===u.alternate)break e;s=Pn(s),u=Pn(u)}s=null}else s=null;for(u=s,s=[];r&&r!==u&&(null===(a=r.alternate)||a!==u);)s.push(r),r=Pn(r);for(r=[];c&&c!==u&&(null===(a=c.alternate)||a!==u);)r.push(c),c=Pn(c);for(c=0;c<s.length;c++)In(s[c],"bubbled",l);for(c=r.length;0<c--;)In(r[c],"captured",n);return 0==(64&i)?[l]:[l,n]}},Dr="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},zr=Object.prototype.hasOwnProperty;function Fr(e,t){if(Dr(e,t))return!0;if("object"!=n(e)||null===e||"object"!=n(t)||null===t)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++)if(!zr.call(t,r[i])||!Dr(e[r[i]],t[r[i]]))return!1;return!0}var Br=Z&&"documentMode"in document&&11>=document.documentMode,Ur={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},Vr=null,Gr=null,jr=null,Hr=!1;function Wr(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return Hr||null==Vr||Vr!==un(n)?null:(n="selectionStart"in(n=Vr)&&fn(n)?{start:n.selectionStart,end:n.selectionEnd}:{anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},jr&&Fr(jr,n)?null:(jr=n,(e=jn.getPooled(Ur.select,Gr,e,t)).type="select",e.target=Vr,Dn(e),e))}var qr={eventTypes:Ur,extractEvents:function(e,t,n,r,i,o){if(!(o=!(i=o||(r.window===r?r.document:9===r.nodeType?r:r.ownerDocument)))){e:{i=Ke(i),o=Y.onSelect;for(var a=0;a<o.length;a++)if(!i.has(o[a])){i=!1;break e}i=!0}o=!i}if(o)return null;switch(i=t?An(t):window,e){case"focus":(lr(i)||"true"===i.contentEditable)&&(Vr=i,Gr=t,jr=null);break;case"blur":jr=Gr=Vr=null;break;case"mousedown":Hr=!0;break;case"contextmenu":case"mouseup":case"dragend":return Hr=!1,Wr(n,r);case"selectionchange":if(Br)break;case"keydown":case"keyup":return Wr(n,r)}return null}},Yr=jn.extend({animationName:null,elapsedTime:null,pseudoElement:null}),Xr=jn.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Zr=Er.extend({relatedTarget:null});function $r(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var Kr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Qr=Er.extend({key:function(e){if(e.key){var t=Kr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=$r(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Jr[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Cr,charCode:function(e){return"keypress"===e.type?$r(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?$r(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),ei=Lr.extend({dataTransfer:null}),ti=Er.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Cr}),ni=jn.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),ri=Lr.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),ii={eventTypes:Dt,extractEvents:function(e,t,n,r){var i=zt.get(e);if(!i)return null;switch(e){case"keypress":if(0===$r(n))return null;case"keydown":case"keyup":e=Qr;break;case"blur":case"focus":e=Zr;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Lr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=ei;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=ti;break;case We:case qe:case Ye:e=Yr;break;case Xe:e=ni;break;case"scroll":e=Er;break;case"wheel":e=ri;break;case"copy":case"cut":case"paste":e=Xr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Nr;break;default:e=jn}return Dn(t=e.getPooled(i,t,n,r)),t}};if(U)throw Error(s(101));U=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),G(),m=Rn,v=Cn,g=An,X({SimpleEventPlugin:ii,EnterLeaveEventPlugin:Or,ChangeEventPlugin:Sr,SelectEventPlugin:qr,BeforeInputEventPlugin:ar});var oi=[],ai=-1;function si(e){0>ai||(e.current=oi[ai],oi[ai]=null,ai--)}function li(e,t){ai++,oi[ai]=e.current,e.current=t}var ui={},ci={current:ui},hi={current:!1},di=ui;function fi(e,t){var n=e.type.contextTypes;if(!n)return ui;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function pi(e){return null!=e.childContextTypes}function mi(){si(hi),si(ci)}function vi(e,t,n){if(ci.current!==ui)throw Error(s(168));li(ci,t),li(hi,n)}function gi(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in e))throw Error(s(108,F(t)||"Unknown",i));return o({},n,{},r)}function yi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ui,di=ci.current,li(ci,e),li(hi,hi.current),!0}function _i(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=gi(e,t,di),r.__reactInternalMemoizedMergedChildContext=e,si(hi),si(ci),li(ci,e)):si(hi),li(hi,n)}var xi=a.unstable_runWithPriority,bi=a.unstable_scheduleCallback,wi=a.unstable_cancelCallback,Si=a.unstable_requestPaint,Ei=a.unstable_now,Ti=a.unstable_getCurrentPriorityLevel,Mi=a.unstable_ImmediatePriority,Ci=a.unstable_UserBlockingPriority,Ai=a.unstable_NormalPriority,Ri=a.unstable_LowPriority,Pi=a.unstable_IdlePriority,ki={},Li=a.unstable_shouldYield,Ni=void 0!==Si?Si:function(){},Ii=null,Oi=null,Di=!1,zi=Ei(),Fi=1e4>zi?Ei:function(){return Ei()-zi};function Bi(){switch(Ti()){case Mi:return 99;case Ci:return 98;case Ai:return 97;case Ri:return 96;case Pi:return 95;default:throw Error(s(332))}}function Ui(e){switch(e){case 99:return Mi;case 98:return Ci;case 97:return Ai;case 96:return Ri;case 95:return Pi;default:throw Error(s(332))}}function Vi(e,t){return e=Ui(e),xi(e,t)}function Gi(e,t,n){return e=Ui(e),bi(e,t,n)}function ji(e){return null===Ii?(Ii=[e],Oi=bi(Mi,Wi)):Ii.push(e),ki}function Hi(){if(null!==Oi){var e=Oi;Oi=null,wi(e)}Wi()}function Wi(){if(!Di&&null!==Ii){Di=!0;var e=0;try{var t=Ii;Vi(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Ii=null}catch(t){throw null!==Ii&&(Ii=Ii.slice(e+1)),bi(Mi,Hi),t}finally{Di=!1}}}function qi(e,t,n){return 1073741821-(1+((1073741821-e+t/10)/(n/=10)|0))*n}function Yi(e,t){if(e&&e.defaultProps)for(var n in t=o({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var Xi={current:null},Zi=null,$i=null,Ki=null;function Ji(){Ki=$i=Zi=null}function Qi(e){var t=Xi.current;si(Xi),e.type._context._currentValue=t}function eo(e,t){for(;null!==e;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t);else{if(!(null!==n&&n.childExpirationTime<t))break;n.childExpirationTime=t}e=e.return}}function to(e,t){Zi=e,Ki=$i=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(Ra=!0),e.firstContext=null)}function no(e,t){if(Ki!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(Ki=e,t=1073741823),t={context:e,observedBits:t,next:null},null===$i){if(null===Zi)throw Error(s(308));$i=t,Zi.dependencies={expirationTime:0,firstContext:t,responders:null}}else $i=$i.next=t;return e._currentValue}var ro=!1;function io(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function ao(e,t){return(e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null}).next=e}function so(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function lo(e,t){var n=e.alternate;null!==n&&oo(n,e),null===(n=(e=e.updateQueue).baseQueue)?(e.baseQueue=t.next=t,t.next=t):(t.next=n.next,n.next=t)}function uo(e,t,n,r){var i=e.updateQueue;ro=!1;var a=i.baseQueue,s=i.shared.pending;if(null!==s){if(null!==a){var l=a.next;a.next=s.next,s.next=l}a=s,i.shared.pending=null,null!==(l=e.alternate)&&null!==(l=l.updateQueue)&&(l.baseQueue=s)}if(null!==a){l=a.next;var u=i.baseState,c=0,h=null,d=null,f=null;if(null!==l)for(var p=l;;){if((s=p.expirationTime)<r){var m={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===f?(d=f=m,h=u):f=f.next=m,s>c&&(c=s)}else{null!==f&&(f=f.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null}),il(s,p.suspenseConfig);e:{var v=e,g=p;switch(s=t,m=n,g.tag){case 1:if("function"==typeof(v=g.payload)){u=v.call(m,u,s);break e}u=v;break e;case 3:v.effectTag=-4097&v.effectTag|64;case 0:if(null==(s="function"==typeof(v=g.payload)?v.call(m,u,s):v))break e;u=o({},u,s);break e;case 2:ro=!0}}null!==p.callback&&(e.effectTag|=32,null===(s=i.effects)?i.effects=[p]:s.push(p))}if(null===(p=p.next)||p===l){if(null===(s=i.shared.pending))break;p=a.next=s.next,s.next=l,i.baseQueue=a=s,i.shared.pending=null}}null===f?h=u:f.next=d,i.baseState=h,i.baseQueue=f,ol(c),e.expirationTime=c,e.memoizedState=u}}function co(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=i,i=n,"function"!=typeof r)throw Error(s(191,r));r.call(i)}}}var ho=_.ReactCurrentBatchConfig,fo=(new i.Component).refs;function po(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:o({},t,n),e.memoizedState=n,0===e.expirationTime&&(e.updateQueue.baseState=n)}var mo={isMounted:function(e){return!!(e=e._reactInternalFiber)&&Je(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=Ws(),i=ho.suspense;(i=ao(r=qs(r,e,i),i)).payload=t,null!=n&&(i.callback=n),so(e,i),Ys(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=Ws(),i=ho.suspense;(i=ao(r=qs(r,e,i),i)).tag=1,i.payload=t,null!=n&&(i.callback=n),so(e,i),Ys(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=Ws(),r=ho.suspense;(r=ao(n=qs(n,e,r),r)).tag=2,null!=t&&(r.callback=t),so(e,r),Ys(e,n)}};function vo(e,t,n,r,i,o,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!(t.prototype&&t.prototype.isPureReactComponent&&Fr(n,r)&&Fr(i,o))}function go(e,t,r){var i=!1,o=ui,a=t.contextType;return"object"==n(a)&&null!==a?a=no(a):(o=pi(t)?di:ci.current,a=(i=null!=(i=t.contextTypes))?fi(e,o):ui),t=new t(r,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=mo,e.stateNode=t,t._reactInternalFiber=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=a),t}function yo(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&mo.enqueueReplaceState(t,t.state,null)}function _o(e,t,r,i){var o=e.stateNode;o.props=r,o.state=e.memoizedState,o.refs=fo,io(e);var a=t.contextType;"object"==n(a)&&null!==a?o.context=no(a):(a=pi(t)?di:ci.current,o.context=fi(e,a)),uo(e,r,o,i),o.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(po(e,t,a,r),o.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(t=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&mo.enqueueReplaceState(o,o.state,null),uo(e,r,o,i),o.state=e.memoizedState),"function"==typeof o.componentDidMount&&(e.effectTag|=4)}var xo=Array.isArray;function bo(e,t,r){if(null!==(e=r.ref)&&"function"!=typeof e&&"object"!=n(e)){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(s(309));var i=r.stateNode}if(!i)throw Error(s(147,e));var o=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===o?t.ref:((t=function(e){var t=i.refs;t===fo&&(t=i.refs={}),null===e?delete t[o]:t[o]=e})._stringRef=o,t)}if("string"!=typeof e)throw Error(s(284));if(!r._owner)throw Error(s(290,e))}return e}function wo(e,t){if("textarea"!==e.type)throw Error(s(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function So(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function r(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Tl(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function l(t){return e&&null===t.alternate&&(t.effectTag=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Al(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=o(t,n.props)).ref=bo(e,t,n),r.return=e,r):((r=Ml(n.type,n.key,n.props,null,e.mode,r)).ref=bo(e,t,n),r.return=e,r)}function h(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Rl(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,r,i){return null===t||7!==t.tag?((t=Cl(n,e.mode,r,i)).return=e,t):((t=o(t,n)).return=e,t)}function f(e,t,r){if("string"==typeof t||"number"==typeof t)return(t=Al(""+t,e.mode,r)).return=e,t;if("object"==n(t)&&null!==t){switch(t.$$typeof){case w:return(r=Ml(t.type,t.key,t.props,null,e.mode,r)).ref=bo(e,null,t),r.return=e,r;case S:return(t=Rl(t,e.mode,r)).return=e,t}if(xo(t)||z(t))return(t=Cl(t,e.mode,r,null)).return=e,t;wo(e,t)}return null}function p(e,t,r,i){var o=null!==t?t.key:null;if("string"==typeof r||"number"==typeof r)return null!==o?null:u(e,t,""+r,i);if("object"==n(r)&&null!==r){switch(r.$$typeof){case w:return r.key===o?r.type===E?d(e,t,r.props.children,i,o):c(e,t,r,i):null;case S:return r.key===o?h(e,t,r,i):null}if(xo(r)||z(r))return null!==o?null:d(e,t,r,i,null);wo(e,r)}return null}function m(e,t,r,i,o){if("string"==typeof i||"number"==typeof i)return u(t,e=e.get(r)||null,""+i,o);if("object"==n(i)&&null!==i){switch(i.$$typeof){case w:return e=e.get(null===i.key?r:i.key)||null,i.type===E?d(t,e,i.props.children,o,i.key):c(t,e,i,o);case S:return h(t,e=e.get(null===i.key?r:i.key)||null,i,o)}if(xo(i)||z(i))return d(t,e=e.get(r)||null,i,o,null);wo(t,i)}return null}function v(n,o,s,l){for(var u=null,c=null,h=o,d=o=0,v=null;null!==h&&d<s.length;d++){h.index>d?(v=h,h=null):v=h.sibling;var g=p(n,h,s[d],l);if(null===g){null===h&&(h=v);break}e&&h&&null===g.alternate&&t(n,h),o=a(g,o,d),null===c?u=g:c.sibling=g,c=g,h=v}if(d===s.length)return r(n,h),u;if(null===h){for(;d<s.length;d++)null!==(h=f(n,s[d],l))&&(o=a(h,o,d),null===c?u=h:c.sibling=h,c=h);return u}for(h=i(n,h);d<s.length;d++)null!==(v=m(h,n,d,s[d],l))&&(e&&null!==v.alternate&&h.delete(null===v.key?d:v.key),o=a(v,o,d),null===c?u=v:c.sibling=v,c=v);return e&&h.forEach((function(e){return t(n,e)})),u}function g(n,o,l,u){var c=z(l);if("function"!=typeof c)throw Error(s(150));if(null==(l=c.call(l)))throw Error(s(151));for(var h=c=null,d=o,v=o=0,g=null,y=l.next();null!==d&&!y.done;v++,y=l.next()){d.index>v?(g=d,d=null):g=d.sibling;var _=p(n,d,y.value,u);if(null===_){null===d&&(d=g);break}e&&d&&null===_.alternate&&t(n,d),o=a(_,o,v),null===h?c=_:h.sibling=_,h=_,d=g}if(y.done)return r(n,d),c;if(null===d){for(;!y.done;v++,y=l.next())null!==(y=f(n,y.value,u))&&(o=a(y,o,v),null===h?c=y:h.sibling=y,h=y);return c}for(d=i(n,d);!y.done;v++,y=l.next())null!==(y=m(d,n,v,y.value,u))&&(e&&null!==y.alternate&&d.delete(null===y.key?v:y.key),o=a(y,o,v),null===h?c=y:h.sibling=y,h=y);return e&&d.forEach((function(e){return t(n,e)})),c}return function(e,i,a,u){var c="object"==n(a)&&null!==a&&a.type===E&&null===a.key;c&&(a=a.props.children);var h="object"==n(a)&&null!==a;if(h)switch(a.$$typeof){case w:e:{for(h=a.key,c=i;null!==c;){if(c.key===h){switch(c.tag){case 7:if(a.type===E){r(e,c.sibling),(i=o(c,a.props.children)).return=e,e=i;break e}break;default:if(c.elementType===a.type){r(e,c.sibling),(i=o(c,a.props)).ref=bo(e,c,a),i.return=e,e=i;break e}}r(e,c);break}t(e,c),c=c.sibling}a.type===E?((i=Cl(a.props.children,e.mode,u,a.key)).return=e,e=i):((u=Ml(a.type,a.key,a.props,null,e.mode,u)).ref=bo(e,i,a),u.return=e,e=u)}return l(e);case S:e:{for(c=a.key;null!==i;){if(i.key===c){if(4===i.tag&&i.stateNode.containerInfo===a.containerInfo&&i.stateNode.implementation===a.implementation){r(e,i.sibling),(i=o(i,a.children||[])).return=e,e=i;break e}r(e,i);break}t(e,i),i=i.sibling}(i=Rl(a,e.mode,u)).return=e,e=i}return l(e)}if("string"==typeof a||"number"==typeof a)return a=""+a,null!==i&&6===i.tag?(r(e,i.sibling),(i=o(i,a)).return=e,e=i):(r(e,i),(i=Al(a,e.mode,u)).return=e,e=i),l(e);if(xo(a))return v(e,i,a,u);if(z(a))return g(e,i,a,u);if(h&&wo(e,a),void 0===a&&!c)switch(e.tag){case 1:case 0:throw e=e.type,Error(s(152,e.displayName||e.name||"Component"))}return r(e,i)}}var Eo=So(!0),To=So(!1),Mo={},Co={current:Mo},Ao={current:Mo},Ro={current:Mo};function Po(e){if(e===Mo)throw Error(s(174));return e}function ko(e,t){switch(li(Ro,t),li(Ao,e),li(Co,Mo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:De(null,"");break;default:t=De(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}si(Co),li(Co,t)}function Lo(){si(Co),si(Ao),si(Ro)}function No(e){Po(Ro.current);var t=Po(Co.current),n=De(t,e.type);t!==n&&(li(Ao,e),li(Co,n))}function Io(e){Ao.current===e&&(si(Co),si(Ao))}var Oo={current:0};function Do(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function zo(e,t){return{responder:e,props:t}}var Fo=_.ReactCurrentDispatcher,Bo=_.ReactCurrentBatchConfig,Uo=0,Vo=null,Go=null,jo=null,Ho=!1;function Wo(){throw Error(s(321))}function qo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Dr(e[n],t[n]))return!1;return!0}function Yo(e,t,n,r,i,o){if(Uo=o,Vo=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,Fo.current=null===e||null===e.memoizedState?va:ga,e=n(r,i),t.expirationTime===Uo){o=0;do{if(t.expirationTime=0,!(25>o))throw Error(s(301));o+=1,jo=Go=null,t.updateQueue=null,Fo.current=ya,e=n(r,i)}while(t.expirationTime===Uo)}if(Fo.current=ma,t=null!==Go&&null!==Go.next,Uo=0,jo=Go=Vo=null,Ho=!1,t)throw Error(s(300));return e}function Xo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===jo?Vo.memoizedState=jo=e:jo=jo.next=e,jo}function Zo(){if(null===Go){var e=Vo.alternate;e=null!==e?e.memoizedState:null}else e=Go.next;var t=null===jo?Vo.memoizedState:jo.next;if(null!==t)jo=t,Go=e;else{if(null===e)throw Error(s(310));e={memoizedState:(Go=e).memoizedState,baseState:Go.baseState,baseQueue:Go.baseQueue,queue:Go.queue,next:null},null===jo?Vo.memoizedState=jo=e:jo=jo.next=e}return jo}function $o(e,t){return"function"==typeof t?t(e):t}function Ko(e){var t=Zo(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=Go,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var l=a=o=null,u=i;do{var c=u.expirationTime;if(c<Uo){var h={expirationTime:u.expirationTime,suspenseConfig:u.suspenseConfig,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null};null===l?(a=l=h,o=r):l=l.next=h,c>Vo.expirationTime&&(Vo.expirationTime=c,ol(c))}else null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:u.suspenseConfig,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null}),il(c,u.suspenseConfig),r=u.eagerReducer===e?u.eagerState:e(r,u.action);u=u.next}while(null!==u&&u!==i);null===l?o=r:l.next=a,Dr(r,t.memoizedState)||(Ra=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=l,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function Jo(e){var t=Zo(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{o=e(o,a.action),a=a.next}while(a!==i);Dr(o,t.memoizedState)||(Ra=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Qo(e){var t=Xo();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:$o,lastRenderedState:e}).dispatch=pa.bind(null,Vo,e),[t.memoizedState,e]}function ea(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Vo.updateQueue)?(t={lastEffect:null},Vo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function ta(){return Zo().memoizedState}function na(e,t,n,r){var i=Xo();Vo.effectTag|=e,i.memoizedState=ea(1|t,n,void 0,void 0===r?null:r)}function ra(e,t,n,r){var i=Zo();r=void 0===r?null:r;var o=void 0;if(null!==Go){var a=Go.memoizedState;if(o=a.destroy,null!==r&&qo(r,a.deps))return void ea(t,n,o,r)}Vo.effectTag|=e,i.memoizedState=ea(1|t,n,o,r)}function ia(e,t){return na(516,4,e,t)}function oa(e,t){return ra(516,4,e,t)}function aa(e,t){return ra(4,2,e,t)}function sa(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function la(e,t,n){return n=null!=n?n.concat([e]):null,ra(4,2,sa.bind(null,t,e),n)}function ua(){}function ca(e,t){return Xo().memoizedState=[e,void 0===t?null:t],e}function ha(e,t){var n=Zo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&qo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function da(e,t){var n=Zo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&qo(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function fa(e,t,n){var r=Bi();Vi(98>r?98:r,(function(){e(!0)})),Vi(97<r?97:r,(function(){var r=Bo.suspense;Bo.suspense=void 0===t?null:t;try{e(!1),n()}finally{Bo.suspense=r}}))}function pa(e,t,n){var r=Ws(),i=ho.suspense;i={expirationTime:r=qs(r,e,i),suspenseConfig:i,action:n,eagerReducer:null,eagerState:null,next:null};var o=t.pending;if(null===o?i.next=i:(i.next=o.next,o.next=i),t.pending=i,o=e.alternate,e===Vo||null!==o&&o===Vo)Ho=!0,i.expirationTime=Uo,Vo.expirationTime=Uo;else{if(0===e.expirationTime&&(null===o||0===o.expirationTime)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(i.eagerReducer=o,i.eagerState=s,Dr(s,a))return}catch(e){}Ys(e,r)}}var ma={readContext:no,useCallback:Wo,useContext:Wo,useEffect:Wo,useImperativeHandle:Wo,useLayoutEffect:Wo,useMemo:Wo,useReducer:Wo,useRef:Wo,useState:Wo,useDebugValue:Wo,useResponder:Wo,useDeferredValue:Wo,useTransition:Wo},va={readContext:no,useCallback:ca,useContext:no,useEffect:ia,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,na(4,2,sa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return na(4,2,e,t)},useMemo:function(e,t){var n=Xo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Xo();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=pa.bind(null,Vo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Xo().memoizedState=e},useState:Qo,useDebugValue:ua,useResponder:zo,useDeferredValue:function(e,t){var n=Qo(e),r=n[0],i=n[1];return ia((function(){var n=Bo.suspense;Bo.suspense=void 0===t?null:t;try{i(e)}finally{Bo.suspense=n}}),[e,t]),r},useTransition:function(e){var t=Qo(!1),n=t[0];return t=t[1],[ca(fa.bind(null,t,e),[t,e]),n]}},ga={readContext:no,useCallback:ha,useContext:no,useEffect:oa,useImperativeHandle:la,useLayoutEffect:aa,useMemo:da,useReducer:Ko,useRef:ta,useState:function(){return Ko($o)},useDebugValue:ua,useResponder:zo,useDeferredValue:function(e,t){var n=Ko($o),r=n[0],i=n[1];return oa((function(){var n=Bo.suspense;Bo.suspense=void 0===t?null:t;try{i(e)}finally{Bo.suspense=n}}),[e,t]),r},useTransition:function(e){var t=Ko($o),n=t[0];return t=t[1],[ha(fa.bind(null,t,e),[t,e]),n]}},ya={readContext:no,useCallback:ha,useContext:no,useEffect:oa,useImperativeHandle:la,useLayoutEffect:aa,useMemo:da,useReducer:Jo,useRef:ta,useState:function(){return Jo($o)},useDebugValue:ua,useResponder:zo,useDeferredValue:function(e,t){var n=Jo($o),r=n[0],i=n[1];return oa((function(){var n=Bo.suspense;Bo.suspense=void 0===t?null:t;try{i(e)}finally{Bo.suspense=n}}),[e,t]),r},useTransition:function(e){var t=Jo($o),n=t[0];return t=t[1],[ha(fa.bind(null,t,e),[t,e]),n]}},_a=null,xa=null,ba=!1;function wa(e,t){var n=Sl(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Sa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Ea(e){if(ba){var t=xa;if(t){var n=t;if(!Sa(e,t)){if(!(t=xn(n.nextSibling))||!Sa(e,t))return e.effectTag=-1025&e.effectTag|2,ba=!1,void(_a=e);wa(_a,n)}_a=e,xa=xn(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,ba=!1,_a=e}}function Ta(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;_a=e}function Ma(e){if(e!==_a)return!1;if(!ba)return Ta(e),ba=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!gn(t,e.memoizedProps))for(t=xa;t;)wa(e,t),t=xn(t.nextSibling);if(Ta(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){xa=xn(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}xa=null}}else xa=_a?xn(e.stateNode.nextSibling):null;return!0}function Ca(){xa=_a=null,ba=!1}var Aa=_.ReactCurrentOwner,Ra=!1;function Pa(e,t,n,r){t.child=null===e?To(t,null,n,r):Eo(t,e.child,n,r)}function ka(e,t,n,r,i){n=n.render;var o=t.ref;return to(t,i),r=Yo(e,t,n,r,o,i),null===e||Ra?(t.effectTag|=1,Pa(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Ya(e,t,i))}function La(e,t,n,r,i,o){if(null===e){var a=n.type;return"function"!=typeof a||El(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ml(n.type,null,r,null,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Na(e,t,a,r,i,o))}return a=e.child,i<o&&(i=a.memoizedProps,(n=null!==(n=n.compare)?n:Fr)(i,r)&&e.ref===t.ref)?Ya(e,t,o):(t.effectTag|=1,(e=Tl(a,r)).ref=t.ref,e.return=t,t.child=e)}function Na(e,t,n,r,i,o){return null!==e&&Fr(e.memoizedProps,r)&&e.ref===t.ref&&(Ra=!1,i<o)?(t.expirationTime=e.expirationTime,Ya(e,t,o)):Oa(e,t,n,r,o)}function Ia(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function Oa(e,t,n,r,i){var o=pi(n)?di:ci.current;return o=fi(t,o),to(t,i),n=Yo(e,t,n,r,o,i),null===e||Ra?(t.effectTag|=1,Pa(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Ya(e,t,i))}function Da(e,t,r,i,o){if(pi(r)){var a=!0;yi(t)}else a=!1;if(to(t,o),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),go(t,r,i),_o(t,r,i,o),i=!0;else if(null===e){var s=t.stateNode,l=t.memoizedProps;s.props=l;var u=s.context,c=r.contextType;c="object"==n(c)&&null!==c?no(c):fi(t,c=pi(r)?di:ci.current);var h=r.getDerivedStateFromProps,d="function"==typeof h||"function"==typeof s.getSnapshotBeforeUpdate;d||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(l!==i||u!==c)&&yo(t,s,i,c),ro=!1;var f=t.memoizedState;s.state=f,uo(t,i,s,o),u=t.memoizedState,l!==i||f!==u||hi.current||ro?("function"==typeof h&&(po(t,r,h,i),u=t.memoizedState),(l=ro||vo(t,r,l,i,f,u,c))?(d||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.effectTag|=4)):("function"==typeof s.componentDidMount&&(t.effectTag|=4),t.memoizedProps=i,t.memoizedState=u),s.props=i,s.state=u,s.context=c,i=l):("function"==typeof s.componentDidMount&&(t.effectTag|=4),i=!1)}else s=t.stateNode,oo(e,t),l=t.memoizedProps,s.props=t.type===t.elementType?l:Yi(t.type,l),u=s.context,c="object"==n(c=r.contextType)&&null!==c?no(c):fi(t,c=pi(r)?di:ci.current),(d="function"==typeof(h=r.getDerivedStateFromProps)||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(l!==i||u!==c)&&yo(t,s,i,c),ro=!1,u=t.memoizedState,s.state=u,uo(t,i,s,o),f=t.memoizedState,l!==i||u!==f||hi.current||ro?("function"==typeof h&&(po(t,r,h,i),f=t.memoizedState),(h=ro||vo(t,r,l,i,u,f,c))?(d||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(i,f,c),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,f,c)),"function"==typeof s.componentDidUpdate&&(t.effectTag|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof s.componentDidUpdate||l===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!=typeof s.getSnapshotBeforeUpdate||l===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),t.memoizedProps=i,t.memoizedState=f),s.props=i,s.state=f,s.context=c,i=h):("function"!=typeof s.componentDidUpdate||l===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!=typeof s.getSnapshotBeforeUpdate||l===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),i=!1);return za(e,t,r,i,a,o)}function za(e,t,n,r,i,o){Ia(e,t);var a=0!=(64&t.effectTag);if(!r&&!a)return i&&_i(t,n,!1),Ya(e,t,o);r=t.stateNode,Aa.current=t;var s=a&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&a?(t.child=Eo(t,e.child,null,o),t.child=Eo(t,null,s,o)):Pa(e,t,s,o),t.memoizedState=r.state,i&&_i(t,n,!0),t.child}function Fa(e){var t=e.stateNode;t.pendingContext?vi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&vi(0,t.context,!1),ko(e,t.containerInfo)}var Ba,Ua,Va,Ga={dehydrated:null,retryTime:0};function ja(e,t,n){var r,i=t.mode,o=t.pendingProps,a=Oo.current,s=!1;if((r=0!=(64&t.effectTag))||(r=0!=(2&a)&&(null===e||null!==e.memoizedState)),r?(s=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===o.fallback||!0===o.unstable_avoidThisFallback||(a|=1),li(Oo,1&a),null===e){if(void 0!==o.fallback&&Ea(t),s){if(s=o.fallback,(o=Cl(null,i,0,null)).return=t,0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(n=Cl(s,i,n,null)).return=t,o.sibling=n,t.memoizedState=Ga,t.child=o,n}return i=o.children,t.memoizedState=null,t.child=To(t,null,i,n)}if(null!==e.memoizedState){if(i=(e=e.child).sibling,s){if(o=o.fallback,(n=Tl(e,e.pendingProps)).return=t,0==(2&t.mode)&&(s=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(n.child=s;null!==s;)s.return=n,s=s.sibling;return(i=Tl(i,o)).return=t,n.sibling=i,n.childExpirationTime=0,t.memoizedState=Ga,t.child=n,i}return n=Eo(t,e.child,o.children,n),t.memoizedState=null,t.child=n}if(e=e.child,s){if(s=o.fallback,(o=Cl(null,i,0,null)).return=t,o.child=e,null!==e&&(e.return=o),0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(n=Cl(s,i,n,null)).return=t,o.sibling=n,n.effectTag|=2,o.childExpirationTime=0,t.memoizedState=Ga,t.child=o,n}return t.memoizedState=null,t.child=Eo(t,e,o.children,n)}function Ha(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t),eo(e.return,t)}function Wa(e,t,n,r,i,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailExpiration:0,tailMode:i,lastEffect:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailExpiration=0,a.tailMode=i,a.lastEffect=o)}function qa(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Pa(e,t,r.children,n),0!=(2&(r=Oo.current)))r=1&r|2,t.effectTag|=64;else{if(null!==e&&0!=(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ha(e,n);else if(19===e.tag)Ha(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(li(Oo,r),0==(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Do(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Wa(t,!1,i,n,o,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Do(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Wa(t,!0,n,null,o,t.lastEffect);break;case"together":Wa(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function Ya(e,t,n){null!==e&&(t.dependencies=e.dependencies);var r=t.expirationTime;if(0!==r&&ol(r),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Tl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Tl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Xa(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Za(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return pi(t.type)&&mi(),null;case 3:return Lo(),si(hi),si(ci),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||!Ma(t)||(t.effectTag|=4),null;case 5:Io(t),n=Po(Ro.current);var i=t.type;if(null!==e&&null!=t.stateNode)Ua(e,t,i,r,n),e.ref!==t.ref&&(t.effectTag|=128);else{if(!r){if(null===t.stateNode)throw Error(s(166));return null}if(e=Po(Co.current),Ma(t)){r=t.stateNode,i=t.type;var a=t.memoizedProps;switch(r[Sn]=t,r[En]=a,i){case"iframe":case"object":case"embed":qt("load",r);break;case"video":case"audio":for(e=0;e<Ze.length;e++)qt(Ze[e],r);break;case"source":qt("error",r);break;case"img":case"image":case"link":qt("error",r),qt("load",r);break;case"form":qt("reset",r),qt("submit",r);break;case"details":qt("toggle",r);break;case"input":Ee(r,a),qt("invalid",r),sn(n,"onChange");break;case"select":r._wrapperState={wasMultiple:!!a.multiple},qt("invalid",r),sn(n,"onChange");break;case"textarea":Le(r,a),qt("invalid",r),sn(n,"onChange")}for(var l in rn(i,a),e=null,a)if(a.hasOwnProperty(l)){var u=a[l];"children"===l?"string"==typeof u?r.textContent!==u&&(e=["children",u]):"number"==typeof u&&r.textContent!==""+u&&(e=["children",""+u]):q.hasOwnProperty(l)&&null!=u&&sn(n,l)}switch(i){case"input":be(r),Ce(r,a,!0);break;case"textarea":be(r),Ie(r);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(r.onclick=ln)}n=e,t.updateQueue=n,null!==n&&(t.effectTag|=4)}else{switch(l=9===n.nodeType?n:n.ownerDocument,e===an&&(e=Oe(i)),e===an?"script"===i?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=l.createElement(i,{is:r.is}):(e=l.createElement(i),"select"===i&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,i),e[Sn]=t,e[En]=r,Ba(e,t),t.stateNode=e,l=on(i,r),i){case"iframe":case"object":case"embed":qt("load",e),u=r;break;case"video":case"audio":for(u=0;u<Ze.length;u++)qt(Ze[u],e);u=r;break;case"source":qt("error",e),u=r;break;case"img":case"image":case"link":qt("error",e),qt("load",e),u=r;break;case"form":qt("reset",e),qt("submit",e),u=r;break;case"details":qt("toggle",e),u=r;break;case"input":Ee(e,r),u=Se(e,r),qt("invalid",e),sn(n,"onChange");break;case"option":u=Re(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},u=o({},r,{value:void 0}),qt("invalid",e),sn(n,"onChange");break;case"textarea":Le(e,r),u=ke(e,r),qt("invalid",e),sn(n,"onChange");break;default:u=r}rn(i,u);var c=u;for(a in c)if(c.hasOwnProperty(a)){var h=c[a];"style"===a?tn(e,h):"dangerouslySetInnerHTML"===a?null!=(h=h?h.__html:void 0)&&Fe(e,h):"children"===a?"string"==typeof h?("textarea"!==i||""!==h)&&Be(e,h):"number"==typeof h&&Be(e,""+h):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(q.hasOwnProperty(a)?null!=h&&sn(n,a):null!=h&&ye(e,a,h,l))}switch(i){case"input":be(e),Ce(e,r,!1);break;case"textarea":be(e),Ie(e);break;case"option":null!=r.value&&e.setAttribute("value",""+_e(r.value));break;case"select":e.multiple=!!r.multiple,null!=(n=r.value)?Pe(e,!!r.multiple,n,!1):null!=r.defaultValue&&Pe(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof u.onClick&&(e.onclick=ln)}vn(i,r)&&(t.effectTag|=4)}null!==t.ref&&(t.effectTag|=128)}return null;case 6:if(e&&null!=t.stateNode)Va(0,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(s(166));n=Po(Ro.current),Po(Co.current),Ma(t)?(n=t.stateNode,r=t.memoizedProps,n[Sn]=t,n.nodeValue!==r&&(t.effectTag|=4)):((n=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Sn]=t,t.stateNode=n)}return null;case 13:return si(Oo),r=t.memoizedState,0!=(64&t.effectTag)?(t.expirationTime=n,t):(n=null!==r,r=!1,null===e?void 0!==t.memoizedProps.fallback&&Ma(t):(r=null!==(i=e.memoizedState),n||null===i||null!==(i=e.child.sibling)&&(null!==(a=t.firstEffect)?(t.firstEffect=i,i.nextEffect=a):(t.firstEffect=t.lastEffect=i,i.nextEffect=null),i.effectTag=8)),n&&!r&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&Oo.current)?Ms===_s&&(Ms=xs):(Ms!==_s&&Ms!==xs||(Ms=bs),0!==ks&&null!==Ss&&(Ll(Ss,Ts),Nl(Ss,ks)))),(n||r)&&(t.effectTag|=4),null);case 4:return Lo(),null;case 10:return Qi(t),null;case 17:return pi(t.type)&&mi(),null;case 19:if(si(Oo),null===(r=t.memoizedState))return null;if(i=0!=(64&t.effectTag),null===(a=r.rendering)){if(i)Xa(r,!1);else if(Ms!==_s||null!==e&&0!=(64&e.effectTag))for(a=t.child;null!==a;){if(null!==(e=Do(a))){for(t.effectTag|=64,Xa(r,!1),null!==(i=e.updateQueue)&&(t.updateQueue=i,t.effectTag|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=t.child;null!==r;)a=n,(i=r).effectTag&=2,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null,null===(e=i.alternate)?(i.childExpirationTime=0,i.expirationTime=a,i.child=null,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null):(i.childExpirationTime=e.childExpirationTime,i.expirationTime=e.expirationTime,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,a=e.dependencies,i.dependencies=null===a?null:{expirationTime:a.expirationTime,firstContext:a.firstContext,responders:a.responders}),r=r.sibling;return li(Oo,1&Oo.current|2),t.child}a=a.sibling}}else{if(!i)if(null!==(e=Do(a))){if(t.effectTag|=64,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.effectTag|=4),Xa(r,!0),null===r.tail&&"hidden"===r.tailMode&&!a.alternate)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Fi()-r.renderingStartTime>r.tailExpiration&&1<n&&(t.effectTag|=64,i=!0,Xa(r,!1),t.expirationTime=t.childExpirationTime=n-1);r.isBackwards?(a.sibling=t.child,t.child=a):(null!==(n=r.last)?n.sibling=a:t.child=a,r.last=a)}return null!==r.tail?(0===r.tailExpiration&&(r.tailExpiration=Fi()+500),n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Fi(),n.sibling=null,t=Oo.current,li(Oo,i?1&t|2:1&t),n):null}throw Error(s(156,t.tag))}function $a(e){switch(e.tag){case 1:pi(e.type)&&mi();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(Lo(),si(hi),si(ci),0!=(64&(t=e.effectTag)))throw Error(s(285));return e.effectTag=-4097&t|64,e;case 5:return Io(e),null;case 13:return si(Oo),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return si(Oo),null;case 4:return Lo(),null;case 10:return Qi(e),null;default:return null}}function Ka(e,t){return{value:e,source:t,stack:B(t)}}Ba=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ua=function(e,t,n,r,i){var a=e.memoizedProps;if(a!==r){var s,l,u=t.stateNode;switch(Po(Co.current),e=null,n){case"input":a=Se(u,a),r=Se(u,r),e=[];break;case"option":a=Re(u,a),r=Re(u,r),e=[];break;case"select":a=o({},a,{value:void 0}),r=o({},r,{value:void 0}),e=[];break;case"textarea":a=ke(u,a),r=ke(u,r),e=[];break;default:"function"!=typeof a.onClick&&"function"==typeof r.onClick&&(u.onclick=ln)}for(s in rn(n,r),n=null,a)if(!r.hasOwnProperty(s)&&a.hasOwnProperty(s)&&null!=a[s])if("style"===s)for(l in u=a[s])u.hasOwnProperty(l)&&(n||(n={}),n[l]="");else"dangerouslySetInnerHTML"!==s&&"children"!==s&&"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(q.hasOwnProperty(s)?e||(e=[]):(e=e||[]).push(s,null));for(s in r){var c=r[s];if(u=null!=a?a[s]:void 0,r.hasOwnProperty(s)&&c!==u&&(null!=c||null!=u))if("style"===s)if(u){for(l in u)!u.hasOwnProperty(l)||c&&c.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in c)c.hasOwnProperty(l)&&u[l]!==c[l]&&(n||(n={}),n[l]=c[l])}else n||(e||(e=[]),e.push(s,n)),n=c;else"dangerouslySetInnerHTML"===s?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(e=e||[]).push(s,c)):"children"===s?u===c||"string"!=typeof c&&"number"!=typeof c||(e=e||[]).push(s,""+c):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&(q.hasOwnProperty(s)?(null!=c&&sn(i,s),e||u===c||(e=[])):(e=e||[]).push(s,c))}n&&(e=e||[]).push("style",n),i=e,(t.updateQueue=i)&&(t.effectTag|=4)}},Va=function(e,t,n,r){n!==r&&(t.effectTag|=4)};var Ja="function"==typeof WeakSet?WeakSet:Set;function Qa(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=B(n)),null!==n&&F(n.type),t=t.value,null!==e&&1===e.tag&&F(e.type);try{console.error(t)}catch(e){setTimeout((function(){throw e}))}}function es(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){gl(e,t)}else t.current=null}function ts(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Yi(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(s(163))}function ns(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.destroy;n.destroy=void 0,void 0!==r&&r()}n=n.next}while(n!==t)}}function rs(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function is(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:return void rs(3,n);case 1:if(e=n.stateNode,4&n.effectTag)if(null===t)e.componentDidMount();else{var r=n.elementType===n.type?t.memoizedProps:Yi(n.type,t.memoizedProps);e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}return void(null!==(t=n.updateQueue)&&co(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}co(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.effectTag&&vn(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Ot(n)))));case 19:case 17:case 20:case 21:return}throw Error(s(163))}function os(e,t,n){switch("function"==typeof bl&&bl(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e.next;Vi(97<n?97:n,(function(){var e=r;do{var n=e.destroy;if(void 0!==n){var i=t;try{n()}catch(e){gl(i,e)}}e=e.next}while(e!==r)}))}break;case 1:es(t),"function"==typeof(n=t.stateNode).componentWillUnmount&&function(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){gl(e,t)}}(t,n);break;case 5:es(t);break;case 4:us(e,t,n)}}function as(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,null!==t&&as(t)}function ss(e){return 5===e.tag||3===e.tag||4===e.tag}function ls(e){e:{for(var t=e.return;null!==t;){if(ss(t)){var n=t;break e}t=t.return}throw Error(s(160))}switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(s(161))}16&n.effectTag&&(Be(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||ss(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}r?function e(t,n,r){var i=t.tag,o=5===i||6===i;if(o)t=o?t.stateNode:t.stateNode.instance,n?8===r.nodeType?r.parentNode.insertBefore(t,n):r.insertBefore(t,n):(8===r.nodeType?(n=r.parentNode).insertBefore(t,r):(n=r).appendChild(t),null!==(r=r._reactRootContainer)&&void 0!==r||null!==n.onclick||(n.onclick=ln));else if(4!==i&&null!==(t=t.child))for(e(t,n,r),t=t.sibling;null!==t;)e(t,n,r),t=t.sibling}(e,n,t):function e(t,n,r){var i=t.tag,o=5===i||6===i;if(o)t=o?t.stateNode:t.stateNode.instance,n?r.insertBefore(t,n):r.appendChild(t);else if(4!==i&&null!==(t=t.child))for(e(t,n,r),t=t.sibling;null!==t;)e(t,n,r),t=t.sibling}(e,n,t)}function us(e,t,n){for(var r,i,o=t,a=!1;;){if(!a){a=o.return;e:for(;;){if(null===a)throw Error(s(160));switch(r=a.stateNode,a.tag){case 5:i=!1;break e;case 3:case 4:r=r.containerInfo,i=!0;break e}a=a.return}a=!0}if(5===o.tag||6===o.tag){e:for(var l=e,u=o,c=n,h=u;;)if(os(l,h,c),null!==h.child&&4!==h.tag)h.child.return=h,h=h.child;else{if(h===u)break e;for(;null===h.sibling;){if(null===h.return||h.return===u)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}i?(l=r,u=o.stateNode,8===l.nodeType?l.parentNode.removeChild(u):l.removeChild(u)):r.removeChild(o.stateNode)}else if(4===o.tag){if(null!==o.child){r=o.stateNode.containerInfo,i=!0,o.child.return=o,o=o.child;continue}}else if(os(e,o,n),null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(a=!1)}o.sibling.return=o.return,o=o.sibling}}function cs(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void ns(3,t);case 1:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps,i=null!==e?e.memoizedProps:r;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(n[En]=r,"input"===e&&"radio"===r.type&&null!=r.name&&Te(n,r),on(e,i),t=on(e,r),i=0;i<o.length;i+=2){var a=o[i],l=o[i+1];"style"===a?tn(n,l):"dangerouslySetInnerHTML"===a?Fe(n,l):"children"===a?Be(n,l):ye(n,a,l,t)}switch(e){case"input":Me(n,r);break;case"textarea":Ne(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(e=r.value)?Pe(n,!!r.multiple,e,!1):t!==!!r.multiple&&(null!=r.defaultValue?Pe(n,!!r.multiple,r.defaultValue,!0):Pe(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(s(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((t=t.stateNode).hydrate&&(t.hydrate=!1,Ot(t.containerInfo)));case 12:return;case 13:if(n=t,null===t.memoizedState?r=!1:(r=!0,n=t.child,Ns=Fi()),null!==n)e:for(e=n;;){if(5===e.tag)o=e.stateNode,r?"function"==typeof(o=o.style).setProperty?o.setProperty("display","none","important"):o.display="none":(o=e.stateNode,i=null!=(i=e.memoizedProps.style)&&i.hasOwnProperty("display")?i.display:null,o.style.display=en("display",i));else if(6===e.tag)e.stateNode.nodeValue=r?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(o=e.child.sibling).return=e,e=o;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===n)break;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}return void hs(t);case 19:return void hs(t);case 17:return}throw Error(s(163))}function hs(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ja),t.forEach((function(t){var r=_l.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}var ds="function"==typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=ao(n,null)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Os||(Os=!0,Ds=r),Qa(e,t)},n}function ps(e,t,n){(n=ao(n,null)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return Qa(e,t),r(i)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){"function"!=typeof r&&(null===zs?zs=new Set([this]):zs.add(this),Qa(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var ms,vs=Math.ceil,gs=_.ReactCurrentDispatcher,ys=_.ReactCurrentOwner,_s=0,xs=3,bs=4,ws=0,Ss=null,Es=null,Ts=0,Ms=_s,Cs=null,As=1073741823,Rs=1073741823,Ps=null,ks=0,Ls=!1,Ns=0,Is=null,Os=!1,Ds=null,zs=null,Fs=!1,Bs=null,Us=90,Vs=null,Gs=0,js=null,Hs=0;function Ws(){return 0!=(48&ws)?1073741821-(Fi()/10|0):0!==Hs?Hs:Hs=1073741821-(Fi()/10|0)}function qs(e,t,n){if(0==(2&(t=t.mode)))return 1073741823;var r=Bi();if(0==(4&t))return 99===r?1073741823:1073741822;if(0!=(16&ws))return Ts;if(null!==n)e=qi(e,0|n.timeoutMs||5e3,250);else switch(r){case 99:e=1073741823;break;case 98:e=qi(e,150,100);break;case 97:case 96:e=qi(e,5e3,250);break;case 95:e=2;break;default:throw Error(s(326))}return null!==Ss&&e===Ts&&--e,e}function Ys(e,t){if(50<Gs)throw Gs=0,js=null,Error(s(185));if(null!==(e=Xs(e,t))){var n=Bi();1073741823===t?0!=(8&ws)&&0==(48&ws)?Js(e):($s(e),0===ws&&Hi()):$s(e),0==(4&ws)||98!==n&&99!==n||(null===Vs?Vs=new Map([[e,t]]):(void 0===(n=Vs.get(e))||n>t)&&Vs.set(e,t))}}function Xs(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,i=null;if(null===r&&3===e.tag)i=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){i=r.stateNode;break}r=r.return}return null!==i&&(Ss===i&&(ol(t),Ms===bs&&Ll(i,Ts)),Nl(i,t)),i}function Zs(e){var t=e.lastExpiredTime;if(0!==t)return t;if(!kl(e,t=e.firstPendingTime))return t;var n=e.lastPingedTime;return 2>=(e=n>(e=e.nextKnownPendingLevel)?n:e)&&t!==e?0:e}function $s(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=ji(Js.bind(null,e));else{var t=Zs(e),n=e.callbackNode;if(0===t)null!==n&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var r=Ws();if(r=1073741823===t?99:1===t||2===t?95:0>=(r=10*(1073741821-t)-10*(1073741821-r))?99:250>=r?98:5250>=r?97:95,null!==n){var i=e.callbackPriority;if(e.callbackExpirationTime===t&&i>=r)return;n!==ki&&wi(n)}e.callbackExpirationTime=t,e.callbackPriority=r,t=1073741823===t?ji(Js.bind(null,e)):Gi(r,Ks.bind(null,e),{timeout:10*(1073741821-t)-Fi()}),e.callbackNode=t}}}function Ks(e,t){if(Hs=0,t)return Il(e,t=Ws()),$s(e),null;var n=Zs(e);if(0!==n){if(t=e.callbackNode,0!=(48&ws))throw Error(s(327));if(pl(),e===Ss&&n===Ts||tl(e,n),null!==Es){var r=ws;ws|=16;for(var i=rl();;)try{sl();break}catch(t){nl(e,t)}if(Ji(),ws=r,gs.current=i,1===Ms)throw t=Cs,tl(e,n),Ll(e,n),$s(e),t;if(null===Es)switch(i=e.finishedWork=e.current.alternate,e.finishedExpirationTime=n,r=Ms,Ss=null,r){case _s:case 1:throw Error(s(345));case 2:Il(e,2<n?2:n);break;case xs:if(Ll(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=cl(i)),1073741823===As&&10<(i=Ns+500-Fi())){if(Ls){var o=e.lastPingedTime;if(0===o||o>=n){e.lastPingedTime=n,tl(e,n);break}}if(0!==(o=Zs(e))&&o!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}e.timeoutHandle=yn(hl.bind(null,e),i);break}hl(e);break;case bs:if(Ll(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=cl(i)),Ls&&(0===(i=e.lastPingedTime)||i>=n)){e.lastPingedTime=n,tl(e,n);break}if(0!==(i=Zs(e))&&i!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}if(1073741823!==Rs?r=10*(1073741821-Rs)-Fi():1073741823===As?r=0:(r=10*(1073741821-As)-5e3,0>(r=(i=Fi())-r)&&(r=0),(n=10*(1073741821-n)-i)<(r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*vs(r/1960))-r)&&(r=n)),10<r){e.timeoutHandle=yn(hl.bind(null,e),r);break}hl(e);break;case 5:if(1073741823!==As&&null!==Ps){o=As;var a=Ps;if(0>=(r=0|a.busyMinDurationMs)?r=0:(i=0|a.busyDelayMs,r=(o=Fi()-(10*(1073741821-o)-(0|a.timeoutMs||5e3)))<=i?0:i+r-o),10<r){Ll(e,n),e.timeoutHandle=yn(hl.bind(null,e),r);break}}hl(e);break;default:throw Error(s(329))}if($s(e),e.callbackNode===t)return Ks.bind(null,e)}}return null}function Js(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,0!=(48&ws))throw Error(s(327));if(pl(),e===Ss&&t===Ts||tl(e,t),null!==Es){var n=ws;ws|=16;for(var r=rl();;)try{al();break}catch(t){nl(e,t)}if(Ji(),ws=n,gs.current=r,1===Ms)throw n=Cs,tl(e,t),Ll(e,t),$s(e),n;if(null!==Es)throw Error(s(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,Ss=null,hl(e),$s(e)}return null}function Qs(e,t){var n=ws;ws|=1;try{return e(t)}finally{0===(ws=n)&&Hi()}}function el(e,t){var n=ws;ws&=-2,ws|=8;try{return e(t)}finally{0===(ws=n)&&Hi()}}function tl(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,_n(n)),null!==Es)for(n=Es.return;null!==n;){var r=n;switch(r.tag){case 1:null!=(r=r.type.childContextTypes)&&mi();break;case 3:Lo(),si(hi),si(ci);break;case 5:Io(r);break;case 4:Lo();break;case 13:case 19:si(Oo);break;case 10:Qi(r)}n=n.return}Ss=e,Es=Tl(e.current,null),Ts=t,Ms=_s,Cs=null,Rs=As=1073741823,Ps=null,ks=0,Ls=!1}function nl(e,t){for(;;){try{if(Ji(),Fo.current=ma,Ho)for(var r=Vo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}if(Uo=0,jo=Go=Vo=null,Ho=!1,null===Es||null===Es.return)return Ms=1,Cs=t,Es=null;e:{var o=e,a=Es.return,s=Es,l=t;if(t=Ts,s.effectTag|=2048,s.firstEffect=s.lastEffect=null,null!==l&&"object"==n(l)&&"function"==typeof l.then){var u=l;if(0==(2&s.mode)){var c=s.alternate;c?(s.memoizedState=c.memoizedState,s.expirationTime=c.expirationTime):s.memoizedState=null}var h=0!=(1&Oo.current),d=a;do{var f;if(f=13===d.tag){var p=d.memoizedState;if(null!==p)f=null!==p.dehydrated;else{var m=d.memoizedProps;f=void 0!==m.fallback&&(!0!==m.unstable_avoidThisFallback||!h)}}if(f){var v=d.updateQueue;if(null===v){var g=new Set;g.add(u),d.updateQueue=g}else v.add(u);if(0==(2&d.mode)){if(d.effectTag|=64,s.effectTag&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var y=ao(1073741823,null);y.tag=2,so(s,y)}s.expirationTime=1073741823;break e}l=void 0,s=t;var _=o.pingCache;if(null===_?(_=o.pingCache=new ds,l=new Set,_.set(u,l)):void 0===(l=_.get(u))&&(l=new Set,_.set(u,l)),!l.has(s)){l.add(s);var x=yl.bind(null,o,u,s);u.then(x,x)}d.effectTag|=4096,d.expirationTime=t;break e}d=d.return}while(null!==d);l=Error((F(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+B(s))}5!==Ms&&(Ms=2),l=Ka(l,s),d=a;do{switch(d.tag){case 3:u=l,d.effectTag|=4096,d.expirationTime=t,lo(d,fs(d,u,t));break e;case 1:u=l;var b=d.type,w=d.stateNode;if(0==(64&d.effectTag)&&("function"==typeof b.getDerivedStateFromError||null!==w&&"function"==typeof w.componentDidCatch&&(null===zs||!zs.has(w)))){d.effectTag|=4096,d.expirationTime=t,lo(d,ps(d,u,t));break e}}d=d.return}while(null!==d)}Es=ul(Es)}catch(e){t=e;continue}break}}function rl(){var e=gs.current;return gs.current=ma,null===e?ma:e}function il(e,t){e<As&&2<e&&(As=e),null!==t&&e<Rs&&2<e&&(Rs=e,Ps=t)}function ol(e){e>ks&&(ks=e)}function al(){for(;null!==Es;)Es=ll(Es)}function sl(){for(;null!==Es&&!Li();)Es=ll(Es)}function ll(e){var t=ms(e.alternate,e,Ts);return e.memoizedProps=e.pendingProps,null===t&&(t=ul(e)),ys.current=null,t}function ul(e){Es=e;do{var t=Es.alternate;if(e=Es.return,0==(2048&Es.effectTag)){if(t=Za(t,Es,Ts),1===Ts||1!==Es.childExpirationTime){for(var n=0,r=Es.child;null!==r;){var i=r.expirationTime,o=r.childExpirationTime;i>n&&(n=i),o>n&&(n=o),r=r.sibling}Es.childExpirationTime=n}if(null!==t)return t;null!==e&&0==(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=Es.firstEffect),null!==Es.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=Es.firstEffect),e.lastEffect=Es.lastEffect),1<Es.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=Es:e.firstEffect=Es,e.lastEffect=Es))}else{if(null!==(t=$a(Es)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=Es.sibling))return t;Es=e}while(null!==Es);return Ms===_s&&(Ms=5),null}function cl(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function hl(e){var t=Bi();return Vi(99,dl.bind(null,e,t)),null}function dl(e,t){do{pl()}while(null!==Bs);if(0!=(48&ws))throw Error(s(327));var n=e.finishedWork,r=e.finishedExpirationTime;if(null===n)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var i=cl(n);if(e.firstPendingTime=i,r<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:r<=e.firstSuspendedTime&&(e.firstSuspendedTime=r-1),r<=e.lastPingedTime&&(e.lastPingedTime=0),r<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===Ss&&(Es=Ss=null,Ts=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,null!==i){var o=ws;ws|=32,ys.current=null,pn=Wt;var a=dn();if(fn(a)){if("selectionStart"in a)var l={start:a.selectionStart,end:a.selectionEnd};else e:{var u=(l=(l=a.ownerDocument)&&l.defaultView||window).getSelection&&l.getSelection();if(u&&0!==u.rangeCount){l=u.anchorNode;var c=u.anchorOffset,h=u.focusNode;u=u.focusOffset;try{l.nodeType,h.nodeType}catch(e){l=null;break e}var d=0,f=-1,p=-1,m=0,v=0,g=a,y=null;t:for(;;){for(var _;g!==l||0!==c&&3!==g.nodeType||(f=d+c),g!==h||0!==u&&3!==g.nodeType||(p=d+u),3===g.nodeType&&(d+=g.nodeValue.length),null!==(_=g.firstChild);)y=g,g=_;for(;;){if(g===a)break t;if(y===l&&++m===c&&(f=d),y===h&&++v===u&&(p=d),null!==(_=g.nextSibling))break;y=(g=y).parentNode}g=_}l=-1===f||-1===p?null:{start:f,end:p}}else l=null}l=l||{start:0,end:0}}else l=null;mn={activeElementDetached:null,focusedElem:a,selectionRange:l},Wt=!1,Is=i;do{try{fl()}catch(e){if(null===Is)throw Error(s(330));gl(Is,e),Is=Is.nextEffect}}while(null!==Is);Is=i;do{try{for(a=e,l=t;null!==Is;){var x=Is.effectTag;if(16&x&&Be(Is.stateNode,""),128&x){var b=Is.alternate;if(null!==b){var w=b.ref;null!==w&&("function"==typeof w?w(null):w.current=null)}}switch(1038&x){case 2:ls(Is),Is.effectTag&=-3;break;case 6:ls(Is),Is.effectTag&=-3,cs(Is.alternate,Is);break;case 1024:Is.effectTag&=-1025;break;case 1028:Is.effectTag&=-1025,cs(Is.alternate,Is);break;case 4:cs(Is.alternate,Is);break;case 8:us(a,c=Is,l),as(c)}Is=Is.nextEffect}}catch(e){if(null===Is)throw Error(s(330));gl(Is,e),Is=Is.nextEffect}}while(null!==Is);if(w=mn,b=dn(),x=w.focusedElem,l=w.selectionRange,b!==x&&x&&x.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):"contains"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(x.ownerDocument.documentElement,x)){null!==l&&fn(x)&&(b=l.start,void 0===(w=l.end)&&(w=b),"selectionStart"in x?(x.selectionStart=b,x.selectionEnd=Math.min(w,x.value.length)):(w=(b=x.ownerDocument||document)&&b.defaultView||window).getSelection&&(w=w.getSelection(),c=x.textContent.length,a=Math.min(l.start,c),l=void 0===l.end?a:Math.min(l.end,c),!w.extend&&a>l&&(c=l,l=a,a=c),c=hn(x,a),h=hn(x,l),c&&h&&(1!==w.rangeCount||w.anchorNode!==c.node||w.anchorOffset!==c.offset||w.focusNode!==h.node||w.focusOffset!==h.offset)&&((b=b.createRange()).setStart(c.node,c.offset),w.removeAllRanges(),a>l?(w.addRange(b),w.extend(h.node,h.offset)):(b.setEnd(h.node,h.offset),w.addRange(b))))),b=[];for(w=x;w=w.parentNode;)1===w.nodeType&&b.push({element:w,left:w.scrollLeft,top:w.scrollTop});for("function"==typeof x.focus&&x.focus(),x=0;x<b.length;x++)(w=b[x]).element.scrollLeft=w.left,w.element.scrollTop=w.top}Wt=!!pn,mn=pn=null,e.current=n,Is=i;do{try{for(x=e;null!==Is;){var S=Is.effectTag;if(36&S&&is(x,Is.alternate,Is),128&S){b=void 0;var E=Is.ref;if(null!==E){var T=Is.stateNode;switch(Is.tag){case 5:b=T;break;default:b=T}"function"==typeof E?E(b):E.current=b}}Is=Is.nextEffect}}catch(e){if(null===Is)throw Error(s(330));gl(Is,e),Is=Is.nextEffect}}while(null!==Is);Is=null,Ni(),ws=o}else e.current=n;if(Fs)Fs=!1,Bs=e,Us=t;else for(Is=i;null!==Is;)t=Is.nextEffect,Is.nextEffect=null,Is=t;if(0===(t=e.firstPendingTime)&&(zs=null),1073741823===t?e===js?Gs++:(Gs=0,js=e):Gs=0,"function"==typeof xl&&xl(n.stateNode,r),$s(e),Os)throw Os=!1,e=Ds,Ds=null,e;return 0!=(8&ws)||Hi(),null}function fl(){for(;null!==Is;){var e=Is.effectTag;0!=(256&e)&&ts(Is.alternate,Is),0==(512&e)||Fs||(Fs=!0,Gi(97,(function(){return pl(),null}))),Is=Is.nextEffect}}function pl(){if(90!==Us){var e=97<Us?97:Us;return Us=90,Vi(e,ml)}}function ml(){if(null===Bs)return!1;var e=Bs;if(Bs=null,0!=(48&ws))throw Error(s(331));var t=ws;for(ws|=32,e=e.current.firstEffect;null!==e;){try{var n=e;if(0!=(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:case 22:ns(5,n),rs(5,n)}}catch(t){if(null===e)throw Error(s(330));gl(e,t)}n=e.nextEffect,e.nextEffect=null,e=n}return ws=t,Hi(),!0}function vl(e,t,n){so(e,t=fs(e,t=Ka(n,t),1073741823)),null!==(e=Xs(e,1073741823))&&$s(e)}function gl(e,t){if(3===e.tag)vl(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){vl(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===zs||!zs.has(r))){so(n,e=ps(n,e=Ka(t,e),1073741823)),null!==(n=Xs(n,1073741823))&&$s(n);break}}n=n.return}}function yl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),Ss===e&&Ts===n?Ms===bs||Ms===xs&&1073741823===As&&Fi()-Ns<500?tl(e,Ts):Ls=!0:kl(e,n)&&(0!==(t=e.lastPingedTime)&&t<n||(e.lastPingedTime=n,$s(e)))}function _l(e,t){var n=e.stateNode;null!==n&&n.delete(t),0==(t=0)&&(t=qs(t=Ws(),e,null)),null!==(e=Xs(e,t))&&$s(e)}ms=function(e,t,r){var i=t.expirationTime;if(null!==e){var o=t.pendingProps;if(e.memoizedProps!==o||hi.current)Ra=!0;else{if(i<r){switch(Ra=!1,t.tag){case 3:Fa(t),Ca();break;case 5:if(No(t),4&t.mode&&1!==r&&o.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:pi(t.type)&&yi(t);break;case 4:ko(t,t.stateNode.containerInfo);break;case 10:i=t.memoizedProps.value,o=t.type._context,li(Xi,o._currentValue),o._currentValue=i;break;case 13:if(null!==t.memoizedState)return 0!==(i=t.child.childExpirationTime)&&i>=r?ja(e,t,r):(li(Oo,1&Oo.current),null!==(t=Ya(e,t,r))?t.sibling:null);li(Oo,1&Oo.current);break;case 19:if(i=t.childExpirationTime>=r,0!=(64&e.effectTag)){if(i)return qa(e,t,r);t.effectTag|=64}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null),li(Oo,Oo.current),!i)return null}return Ya(e,t,r)}Ra=!1}}else Ra=!1;switch(t.expirationTime=0,t.tag){case 2:if(i=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,o=fi(t,ci.current),to(t,r),o=Yo(null,t,i,e,o,r),t.effectTag|=1,"object"==n(o)&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,pi(i)){var a=!0;yi(t)}else a=!1;t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,io(t);var l=i.getDerivedStateFromProps;"function"==typeof l&&po(t,i,l,e),o.updater=mo,t.stateNode=o,o._reactInternalFiber=t,_o(t,i,e,r),t=za(null,t,i,!0,a,r)}else t.tag=0,Pa(null,t,o,r),t=t.child;return t;case 16:e:{if(o=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,function(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}(o),1!==o._status)throw o._result;switch(o=o._result,t.type=o,a=t.tag=function(e){if("function"==typeof e)return El(e)?1:0;if(null!=e){if((e=e.$$typeof)===P)return 11;if(e===N)return 14}return 2}(o),e=Yi(o,e),a){case 0:t=Oa(null,t,o,e,r);break e;case 1:t=Da(null,t,o,e,r);break e;case 11:t=ka(null,t,o,e,r);break e;case 14:t=La(null,t,o,Yi(o.type,e),i,r);break e}throw Error(s(306,o,""))}return t;case 0:return i=t.type,o=t.pendingProps,Oa(e,t,i,o=t.elementType===i?o:Yi(i,o),r);case 1:return i=t.type,o=t.pendingProps,Da(e,t,i,o=t.elementType===i?o:Yi(i,o),r);case 3:if(Fa(t),i=t.updateQueue,null===e||null===i)throw Error(s(282));if(i=t.pendingProps,o=null!==(o=t.memoizedState)?o.element:null,oo(e,t),uo(t,i,null,r),(i=t.memoizedState.element)===o)Ca(),t=Ya(e,t,r);else{if((o=t.stateNode.hydrate)&&(xa=xn(t.stateNode.containerInfo.firstChild),_a=t,o=ba=!0),o)for(r=To(t,null,i,r),t.child=r;r;)r.effectTag=-3&r.effectTag|1024,r=r.sibling;else Pa(e,t,i,r),Ca();t=t.child}return t;case 5:return No(t),null===e&&Ea(t),i=t.type,o=t.pendingProps,a=null!==e?e.memoizedProps:null,l=o.children,gn(i,o)?l=null:null!==a&&gn(i,a)&&(t.effectTag|=16),Ia(e,t),4&t.mode&&1!==r&&o.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(Pa(e,t,l,r),t=t.child),t;case 6:return null===e&&Ea(t),null;case 13:return ja(e,t,r);case 4:return ko(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Eo(t,null,i,r):Pa(e,t,i,r),t.child;case 11:return i=t.type,o=t.pendingProps,ka(e,t,i,o=t.elementType===i?o:Yi(i,o),r);case 7:return Pa(e,t,t.pendingProps,r),t.child;case 8:case 12:return Pa(e,t,t.pendingProps.children,r),t.child;case 10:e:{i=t.type._context,o=t.pendingProps,l=t.memoizedProps,a=o.value;var u=t.type._context;if(li(Xi,u._currentValue),u._currentValue=a,null!==l)if(u=l.value,0==(a=Dr(u,a)?0:0|("function"==typeof i._calculateChangedBits?i._calculateChangedBits(u,a):1073741823))){if(l.children===o.children&&!hi.current){t=Ya(e,t,r);break e}}else for(null!==(u=t.child)&&(u.return=t);null!==u;){var c=u.dependencies;if(null!==c){l=u.child;for(var h=c.firstContext;null!==h;){if(h.context===i&&0!=(h.observedBits&a)){1===u.tag&&((h=ao(r,null)).tag=2,so(u,h)),u.expirationTime<r&&(u.expirationTime=r),null!==(h=u.alternate)&&h.expirationTime<r&&(h.expirationTime=r),eo(u.return,r),c.expirationTime<r&&(c.expirationTime=r);break}h=h.next}}else l=10===u.tag&&u.type===t.type?null:u.child;if(null!==l)l.return=u;else for(l=u;null!==l;){if(l===t){l=null;break}if(null!==(u=l.sibling)){u.return=l.return,l=u;break}l=l.return}u=l}Pa(e,t,o.children,r),t=t.child}return t;case 9:return o=t.type,i=(a=t.pendingProps).children,to(t,r),i=i(o=no(o,a.unstable_observedBits)),t.effectTag|=1,Pa(e,t,i,r),t.child;case 14:return a=Yi(o=t.type,t.pendingProps),La(e,t,o,a=Yi(o.type,a),i,r);case 15:return Na(e,t,t.type,t.pendingProps,i,r);case 17:return i=t.type,o=t.pendingProps,o=t.elementType===i?o:Yi(i,o),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,pi(i)?(e=!0,yi(t)):e=!1,to(t,r),go(t,i,o),_o(t,i,o,r),za(null,t,i,!0,e,r);case 19:return qa(e,t,r)}throw Error(s(156,t.tag))};var xl=null,bl=null;function wl(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Sl(e,t,n,r){return new wl(e,t,n,r)}function El(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Tl(e,t){var n=e.alternate;return null===n?((n=Sl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ml(e,t,r,i,o,a){var l=2;if(i=e,"function"==typeof e)El(e)&&(l=1);else if("string"==typeof e)l=5;else e:switch(e){case E:return Cl(r.children,o,a,t);case R:l=8,o|=7;break;case T:l=8,o|=1;break;case M:return(e=Sl(12,r,t,8|o)).elementType=M,e.type=M,e.expirationTime=a,e;case k:return(e=Sl(13,r,t,o)).type=k,e.elementType=k,e.expirationTime=a,e;case L:return(e=Sl(19,r,t,o)).elementType=L,e.expirationTime=a,e;default:if("object"==n(e)&&null!==e)switch(e.$$typeof){case C:l=10;break e;case A:l=9;break e;case P:l=11;break e;case N:l=14;break e;case I:l=16,i=null;break e;case O:l=22;break e}throw Error(s(130,null==e?e:n(e),""))}return(t=Sl(l,r,t,o)).elementType=e,t.type=i,t.expirationTime=a,t}function Cl(e,t,n,r){return(e=Sl(7,e,r,t)).expirationTime=n,e}function Al(e,t,n){return(e=Sl(6,e,null,t)).expirationTime=n,e}function Rl(e,t,n){return(t=Sl(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Pl(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function kl(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==n&&n>=t&&e<=t}function Ll(e,t){var n=e.firstSuspendedTime,r=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(r>t||0===n)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function Nl(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;0!==n&&(t>=n?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Il(e,t){var n=e.lastExpiredTime;(0===n||n>t)&&(e.lastExpiredTime=t)}function Ol(e,t,n,r){var i=t.current,o=Ws(),a=ho.suspense;o=qs(o,i,a);e:if(n){t:{if(Je(n=n._reactInternalFiber)!==n||1!==n.tag)throw Error(s(170));var l=n;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(pi(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(s(171))}if(1===n.tag){var u=n.type;if(pi(u)){n=gi(n,u,l);break e}}n=l}else n=ui;return null===t.context?t.context=n:t.pendingContext=n,(t=ao(o,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),so(i,t),Ys(i,o),o}function Dl(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function zl(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function Fl(e,t){zl(e,t),(e=e.alternate)&&zl(e,t)}function Bl(e,t,n){var r=new Pl(e,t,n=null!=n&&!0===n.hydrate),i=Sl(3,null,null,2===t?7:1===t?3:0);r.current=i,i.stateNode=r,io(i),e[Tn]=r.current,n&&0!==t&&function(e,t){var n=Ke(t);Tt.forEach((function(e){ft(e,t,n)})),Mt.forEach((function(e){ft(e,t,n)}))}(0,9===e.nodeType?e:e.ownerDocument),this._internalRoot=r}function Ul(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Vl(e,t,n,r,i){var o=n._reactRootContainer;if(o){var a=o._internalRoot;if("function"==typeof i){var s=i;i=function(){var e=Dl(a);s.call(e)}}Ol(t,a,e,i)}else{if(o=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new Bl(e,0,t?{hydrate:!0}:void 0)}(n,r),a=o._internalRoot,"function"==typeof i){var l=i;i=function(){var e=Dl(a);l.call(e)}}el((function(){Ol(t,a,e,i)}))}return Dl(a)}function Gl(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function jl(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Ul(t))throw Error(s(200));return Gl(e,t,null,n)}Bl.prototype.render=function(e){Ol(e,this._internalRoot,null,null)},Bl.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Ol(null,e,null,(function(){t[Tn]=null}))},pt=function(e){if(13===e.tag){var t=qi(Ws(),150,100);Ys(e,t),Fl(e,t)}},mt=function(e){13===e.tag&&(Ys(e,3),Fl(e,3))},vt=function(e){if(13===e.tag){var t=Ws();Ys(e,t=qs(t,e,null)),Fl(e,t)}},$=function(e,t,n){switch(t){case"input":if(Me(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Rn(r);if(!i)throw Error(s(90));we(r),Me(r,i)}}}break;case"textarea":Ne(e,n);break;case"select":null!=(t=n.value)&&Pe(e,!!n.multiple,t,!1)}},ne=Qs,re=function(e,t,n,r,i){var o=ws;ws|=4;try{return Vi(98,e.bind(null,t,n,r,i))}finally{0===(ws=o)&&Hi()}},ie=function(){0==(49&ws)&&(function(){if(null!==Vs){var e=Vs;Vs=null,e.forEach((function(e,t){Il(t,e),$s(t)})),Hi()}}(),pl())},oe=function(e,t){var n=ws;ws|=2;try{return e(t)}finally{0===(ws=n)&&Hi()}};var Hl,Wl,ql={Events:[Cn,An,Rn,X,W,Dn,function(e){rt(e,On)},ee,te,$t,at,pl,{current:!1}]};Wl=(Hl={findFiberByHostInstance:Mn,bundleType:0,version:"16.13.0",rendererPackageName:"react-dom"}).findFiberByHostInstance,function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);xl=function(e){try{t.onCommitFiberRoot(n,e,void 0,64==(64&e.current.effectTag))}catch(e){}},bl=function(e){try{t.onCommitFiberUnmount(n,e)}catch(e){}}}catch(e){}}(o({},Hl,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=tt(e))?null:e.stateNode},findFiberByHostInstance:function(e){return Wl?Wl(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null})),t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ql,t.createPortal=jl,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"==typeof e.render)throw Error(s(188));throw Error(s(268,Object.keys(e)))}return null===(e=tt(t))?null:e.stateNode},t.flushSync=function(e,t){if(0!=(48&ws))throw Error(s(187));var n=ws;ws|=1;try{return Vi(99,e.bind(null,t))}finally{ws=n,Hi()}},t.hydrate=function(e,t,n){if(!Ul(t))throw Error(s(200));return Vl(null,e,t,!0,n)},t.render=function(e,t,n){if(!Ul(t))throw Error(s(200));return Vl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Ul(e))throw Error(s(40));return!!e._reactRootContainer&&(el((function(){Vl(null,null,e,!1,(function(){e._reactRootContainer=null,e[Tn]=null}))})),!0)},t.unstable_batchedUpdates=Qs,t.unstable_createPortal=function(e,t){return jl(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Ul(n))throw Error(s(200));if(null==e||void 0===e._reactInternalFiber)throw Error(s(38));return Vl(e,t,n,!1,r)},t.version="16.13.0"},function(e,t,n){"use strict";e.exports=n(11)},function(e,t,r){"use strict";
/** @license React v0.19.0
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i,o,a,s,l;if("undefined"==typeof window||"function"!=typeof MessageChannel){var u=null,c=null,h=function e(){if(null!==u)try{var n=t.unstable_now();u(!0,n),u=null}catch(n){throw setTimeout(e,0),n}},d=Date.now();t.unstable_now=function(){return Date.now()-d},i=function(e){null!==u?setTimeout(i,0,e):(u=e,setTimeout(h,0))},o=function(e,t){c=setTimeout(e,t)},a=function(){clearTimeout(c)},s=function(){return!1},l=t.unstable_forceFrameRate=function(){}}else{var f=window.performance,p=window.Date,m=window.setTimeout,v=window.clearTimeout;if("undefined"!=typeof console){var g=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof g&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"==n(f)&&"function"==typeof f.now)t.unstable_now=function(){return f.now()};else{var y=p.now();t.unstable_now=function(){return p.now()-y}}var _=!1,x=null,b=-1,w=5,S=0;s=function(){return t.unstable_now()>=S},l=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):w=0<e?Math.floor(1e3/e):5};var E=new MessageChannel,T=E.port2;E.port1.onmessage=function(){if(null!==x){var e=t.unstable_now();S=e+w;try{x(!0,e)?T.postMessage(null):(_=!1,x=null)}catch(e){throw T.postMessage(null),e}}else _=!1},i=function(e){x=e,_||(_=!0,T.postMessage(null))},o=function(e,n){b=m((function(){e(t.unstable_now())}),n)},a=function(){v(b),b=-1}}function M(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<R(i,t)))break e;e[r]=t,e[n]=i,n=r}}function C(e){return void 0===(e=e[0])?null:e}function A(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var o=2*(r+1)-1,a=e[o],s=o+1,l=e[s];if(void 0!==a&&0>R(a,n))void 0!==l&&0>R(l,a)?(e[r]=l,e[s]=n,r=s):(e[r]=a,e[o]=n,r=o);else{if(!(void 0!==l&&0>R(l,n)))break e;e[r]=l,e[s]=n,r=s}}}return t}return null}function R(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var P=[],k=[],L=1,N=null,I=3,O=!1,D=!1,z=!1;function F(e){for(var t=C(k);null!==t;){if(null===t.callback)A(k);else{if(!(t.startTime<=e))break;A(k),t.sortIndex=t.expirationTime,M(P,t)}t=C(k)}}function B(e){if(z=!1,F(e),!D)if(null!==C(P))D=!0,i(U);else{var t=C(k);null!==t&&o(B,t.startTime-e)}}function U(e,n){D=!1,z&&(z=!1,a()),O=!0;var r=I;try{for(F(n),N=C(P);null!==N&&(!(N.expirationTime>n)||e&&!s());){var i=N.callback;if(null!==i){N.callback=null,I=N.priorityLevel;var l=i(N.expirationTime<=n);n=t.unstable_now(),"function"==typeof l?N.callback=l:N===C(P)&&A(P),F(n)}else A(P);N=C(P)}if(null!==N)var u=!0;else{var c=C(k);null!==c&&o(B,c.startTime-n),u=!1}return u}finally{N=null,I=r,O=!1}}function V(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var G=l;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){D||O||(D=!0,i(U))},t.unstable_getCurrentPriorityLevel=function(){return I},t.unstable_getFirstCallbackNode=function(){return C(P)},t.unstable_next=function(e){switch(I){case 1:case 2:case 3:var t=3;break;default:t=I}var n=I;I=t;try{return e()}finally{I=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=G,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=I;I=e;try{return t()}finally{I=n}},t.unstable_scheduleCallback=function(e,r,s){var l=t.unstable_now();if("object"==n(s)&&null!==s){var u=s.delay;u="number"==typeof u&&0<u?l+u:l,s="number"==typeof s.timeout?s.timeout:V(e)}else s=V(e),u=l;return e={id:L++,callback:r,priorityLevel:e,startTime:u,expirationTime:s=u+s,sortIndex:-1},u>l?(e.sortIndex=u,M(k,e),null===C(P)&&e===C(k)&&(z?a():z=!0,o(B,u-l))):(e.sortIndex=s,M(P,e),D||O||(D=!0,i(U))),e},t.unstable_shouldYield=function(){var e=t.unstable_now();F(e);var n=C(P);return n!==N&&null!==N&&null!==n&&null!==n.callback&&n.startTime<=e&&n.expirationTime<N.expirationTime||s()},t.unstable_wrapCallback=function(e){var t=I;return function(){var n=I;I=t;try{return e.apply(this,arguments)}finally{I=n}}}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==("undefined"==typeof window?"undefined":n(window))&&(r=window)}e.exports=r},function(e,t,r){"use strict";r.r(t),r(4);var i=r(0),o=r.n(i),a=r(2),s=r.n(a),l=r(3);function u(e){return(u="function"==typeof Symbol&&"symbol"==n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p={width:"640px",height:"480px"},m=function(e){function t(e){var n,r,i,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?d(e):t}(this,h(t).call(this,e)),o=function(e){n.props.onChange({prefs:e})},(i="_onChange")in(r=d(n))?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o,n._viewer=null,n._onChange=n._onChange.bind(d(n)),n}var n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,e),n=t,(r=[{key:"componentDidMount",value:function(){this._viewer=new l.a({container:this.domElement,load:"1crn"}),this._viewer.settings.addEventListener("change:axes",this._onChange),this._viewer.settings.addEventListener("change:autoRotation",this._onChange),this.props.onChange({viewer:this._viewer}),this._viewer.init()&&this._viewer.run()}},{key:"componentWillUnmount",value:function(){this._viewer.settings.now.removeEventListener(this._onChange),this._viewer.dispose(),this._viewer=null,this.props.onChange({viewer:this._viewer})}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return o.a.createElement("div",{className:"miew-container",ref:this.domElement,style:p})}}])&&c(n.prototype,r),t}(o.a.Component);function v(e){return(v="function"==typeof Symbol&&"symbol"==n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)})(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?_(e):t}(this,y(t).call(this)))._viewer=null,e._onViewerChange=e._onViewerChange.bind(_(e)),e}var n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(t,e),n=t,(r=[{key:"_onViewerChange",value:function(e){void 0!==e.viewer&&(this._viewer=e.viewer),this.forceUpdate()}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(m,{onChange:this._onViewerChange}))}}])&&g(n.prototype,r),t}(o.a.Component),w=document.getElementsByClassName("main")[0];s.a.render(o.a.createElement(b,null),w)}])}]);